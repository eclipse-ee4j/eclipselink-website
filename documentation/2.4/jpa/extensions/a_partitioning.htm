<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>@Partitioning | EclipseLink 2.4.x Java Persistence API (JPA) Extensions Reference</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 1.0.11" />
<meta name="date" content="2012-07-20T8:40:24Z" />
<meta name="robots" content="noarchive" />
<meta name="doctitle" content="@Partitioning" />
<meta name="relnum" content="Release 2.4" />
<link rel="stylesheet" type="text/css" href="../../../dcommon/style.css" media="screen" />
<link rel="copyright" href="http://www.eclipse.org/org/documents/epl-v10.php" title="Copyright" type="text/html" />  
<link rel="start" href="../../index.htm" title="Home" type="text/html" />
<link rel="contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="prev" href="a_partitioned.htm" title="Previous" type="text/html" />
<link rel="next" href="a_pinnedpartitioning.htm" title="Next" type="text/html" />
<!-- START: Disqus --><script type="text/javascript">  var disqus_developer = 0; </script><!-- END: Disqus --><!-- START: Sharethis --><script type="text/javascript">var switchTo5x=true;</script><script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript" src="http://s.sharethis.com/loader.js"></script> <!-- END: Sharethis --></head>
<body bgcolor="#FFFFFF"><iframe id="docheader" frameborder="0" framemargin="0" scrolling="no" src="../../../dcommon/header.html"></iframe><div id="cse-search-form" style="width: 100%;"><span class="loadingspin">Loading</span></div><script src="http://www.google.com/jsapi" type="text/javascript"></script><script type="text/javascript">   google.load('search', '1', {language : 'en'});  google.setOnLoadCallback(function() {    var customSearchOptions = {};  var customSearchControl = new google.search.CustomSearchControl(      '016171230611334810008:4sqnhke2any', customSearchOptions);    customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);    var options = new google.search.DrawOptions();    options.setSearchFormRoot('cse-search-form');    customSearchControl.draw('cse', options);  }, true);</script><link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css" /><div id="cse" style="width:100%;"></div> 
<div class="header"><a id="top" name="top"></a>
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top"><div class="booktitle">Java Persistence API (JPA) Extensions Reference for EclipseLink, 
Release 2.4</div></td>
<td valign="bottom" align="right" width="144">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td>&nbsp;</td>
<td align="center" valign="top"><a href="toc.htm"><img src="../../../dcommon/images/contents.png" alt="Go To Table Of Contents" border="0" height="16" width="16" /><br />
<span class="mini">Contents</span></a></td><td>&nbsp;</td><td align="center"><a href="../../../" target="_top" class="external text" title="Other searches" rel="nofollow"><img src="../../../dcommon/images/search.png" alt="Search" style="border:0;" /><br /><span class="mini">Other&nbsp;Searches</span></a></td><td>&nbsp;</td><td align="center"><a href="../../eclipselink_jpa_extensions.pdf" title="PDF" target="_blank"><img src="../../../dcommon/images/pdf_icon.png" style="padding-right:5px;border:0" alt="PDF"><br /><span class="mini">PDF</span></a>
</tr>
</table>
</td>
</tr>
</table>
<hr />
<table class="navigation simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100" align="center">
<tr>
<td align="center"><a href="a_partitioned.htm"><img src="../../../dcommon/images/larrow.png" alt="Previous" border="0" height="16" width="16" /></a></td>
<td align="center"><a href="a_pinnedpartitioning.htm"><img src="../../../dcommon/images/rarrow.png" alt="Next" border="0" height="16" width="16" /></a></td>
<td>&nbsp;</td>
</tr>
</table>
</div>
<!-- class="header" -->
<div class="ind"><!-- End Header --><a id="CEGDCFDA" name="CEGDCFDA"></a>
<hr />
<div class="refsect1">
<h2 class="refsect1"><font face="arial, helvetica, sans-serif" color="#330099">@Partitioning</font></h2>
<p>Use <code>@Partitioning</code> to configure a custom <code>PartitioningPolicy</code>.</p>
<a id="sthref259" name="sthref259"></a>
<p><strong><br /><span class="refsubsect">Annotation Elements</span></strong></p>
<p><a href="#CEGGJJDE">Table 2-45</a> describes this annotation's elements.</p>
<div class="tblhruleformalwide"><a id="sthref260" name="sthref260"></a><a id="CEGGJJDE" name="CEGGJJDE"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Table 2-45 @Partitioning Annotation Elements</font></em></strong></p>
<table class="HRuleFormalWide" title="@Partitioning Annotation Elements" summary="This table describes this annotation&rsquo;s elements." dir="ltr" border="1" width="100%" frame="hsides" rules="rows" cellpadding="3" cellspacing="0">
<col width="23%" />
<col width="*" />
<col width="19%" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t55"><font face="Arial, Helvetica, sans-serif"><strong>Annotation Element</strong></font></th>
<th align="left" valign="bottom" id="r1c2-t55"><font face="Arial, Helvetica, sans-serif"><strong>Description</strong></font></th>
<th align="left" valign="bottom" id="r1c3-t55"><font face="Arial, Helvetica, sans-serif"><strong>Default</strong></font></th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t55" headers="r1c1-t55">
<p><code>name</code></p>
</td>
<td align="left" headers="r2c1-t55 r1c2-t55">
<p>Name of the partition policy. Names must be unique for the persistence unit.</p>
</td>
<td align="left" headers="r2c1-t55 r1c3-t55"><br /></td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t55" headers="r1c1-t55">
<p><code>PartitioningClass</code></p>
</td>
<td align="left" headers="r3c1-t55 r1c2-t55">
<p>(Required) Full <code>package.class</code> name of a subclass of <code>PartitioningPolicy</code>.</p>
</td>
<td align="left" headers="r3c1-t55 r1c3-t55"><br /></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<a id="sthref261" name="sthref261"></a>
<p><strong><br /><span class="refsubsect">Usage</span></strong></p>
<p>Data partitioning allows for an application to scale its data across more than a single database machine. EclipseLink supports data partitioning at the Entity level to allow a different set of entity instances for the same class to be stored in a different physical database or different node within a database cluster. Both regular databases and clustered databases are supported. Data can be partitioned both horizontally and vertically.</p>
<p>Partitioning can be enabled on an entity, a relationship, a query, or a persistence unit.</p>
<a id="sthref262" name="sthref262"></a>
<p><b><font face="arial, helvetica, sans-serif" color="#330099">Partitioning Policies</font></b></p>
<p>To configure data partitioning, use the <code>@Partitioned</code> annotation and one or more partitioning policy annotations. The annotations for defining the different kinds of policies are:</p>
<ul>
<li>
<p><code><a href="a_hashpartitioning.htm#CEGBDBEG">@HashPartitioning</a></code>: Partitions access to a database cluster by the hash of a field value from the object, such as the object's ID, location, or tenant. The hash indexes into the list of connection pools/nodes. All write or read request for objects with that hash value are sent to the same server. If a query does not include the hash field as a parameter, it can be sent to all servers and unioned, or it can be left to the session's default behavior.</p>
</li>
<li>
<p><code><a href="a_pinnedpartitioning.htm#BCGIIAFB">@PinnedPartitioning</a></code>: Pins requests to a single connection pool/node. This allows for vertical partitioning.</p>
</li>
<li>
<p><code><a href="a_rangepartitioning.htm#BCGCGEIH">@RangePartitioning</a></code>: Partitions access to a database cluster by a field value from the object, such as the object's ID, location, or tenant. Each server is assigned a range of values. All write or read requests for objects with that value are sent to the same server. If a query does not include the field as a parameter, then it can either be sent to all server's and unioned, or left to the session's default behavior.</p>
</li>
<li>
<p><code><a href="a_replicationpartitioning.htm#BABJEFJH">@ReplicationPartitioning</a></code>: Sends requests to a set of connection pools/nodes. This policy is for replicating data across a cluster of database machines. Only modification queries are replicated.</p>
</li>
<li>
<p><code><a href="a_roundrobinpartitioning.htm#BCGBJGFF">@RoundRobinPartitioning</a></code>: Sends requests in a round-robin fashion to the set of connection pools/nodes. It is for load balancing read queries across a cluster of database machines. It requires that the full database be replicated on each machine, so it does not support partitioning. The data should either be read-only, or writes should be replicated.</p>
</li>
<li>
<p><code><a href="a_unionpartitioning.htm#BCGEJFAH">@UnionPartitioning</a></code>: Sends queries to all connection pools and unions the results. This is for queries or relationships that span partitions when partitioning is used, such as on a <code>ManyToMany</code> cross partition relationship.</p>
</li>
<li>
<p><code><a href="a_valuepartitioning.htm#CEGHFJDJ">@ValuePartitioning</a></code>: Partitions access to a database cluster by a field value from the object, such as the object's location or tenant. Each value is assigned a specific server. All write or read requests for objects with that value are sent to the same server. If a query does not include the field as a parameter, then it can be sent to all servers and unioned, or it can be left to the session's default behavior.</p>
</li>
<li>
<p><code>@Partitioning</code>: Partitions access to a database cluster by a custom partitioning policy. A PartitioningPolicy class must be provided and implemented.</p>
</li>
</ul>
<p>Partitioning policies are globally-named objects in a persistence unit and are reusable across multiple descriptors or queries. This improves the usability of the configuration, specifically with JPA annotations and XML.</p>
<p>The persistence unit properties support adding named connection pools in addition to the existing configuration for read/write/sequence. A named connection pool must be defined for each node in the database cluster.</p>
<p>If a transaction modifies data from multiple partitions, JTA should be used to ensure 2-phase commit of the data. An exclusive connection can also be configured in the EntityManager to ensure only a single node is used for a single transaction.</p>
<a id="sthref263" name="sthref263"></a>
<p><b><font face="arial, helvetica, sans-serif" color="#330099">Clustered Databases and Oracle RAC</font></b></p>
<p>Some databases support clustering the database across multiple machines. Oracle RAC allows for a single database to span multiple different server nodes. Oracle RAC also supports table and node partitioning of data. A database cluster allows for any of the data to be accessed from any node in the cluster. However, it is generally it is more efficient to partition the data access to specific nodes, to reduce cross node communication.</p>
<p>EclipseLink partitioning can be used in conjunction with a clustered database to reduce cross node communication, and improve scalability.</p>
<p>To use partitioning with a database cluster to following is required:</p>
<ul>
<li>
<p>Partition policy should not enable replication, as database cluster makes data available to all nodes.</p>
</li>
<li>
<p>Partition policy should not use unions, as database cluster returns the complete query result from any node.</p>
</li>
<li>
<p>A data source and EclipseLink connection pool should be defined for each node in the cluster.</p>
</li>
<li>
<p>The application's data access and data partitioning should be designed to have each transaction only require access to a single node.</p>
</li>
<li>
<p>Usage of an exclusive connection for an EntityManager is recommended to avoid having multiple nodes in a single transaction and avoid 2-phase commit.</p>
</li>
</ul>
<a id="sthref264" name="sthref264"></a>
<p><strong><br /><span class="refsubsect">Examples</span></strong></p>
<p><a href="#CEGHAIDJ">Example 2-76</a> shows how to partition Employee data by location. The two primary sites, <strong>Ottawa</strong> and <strong>Toronto</strong> are each stored on a separate database. All other locations are stored on the default database. Project is range partitioned by its ID, as shown in <a href="#CEGJCEIH">Example 2-77</a>. Each range of ID values are stored on a different database. The employee/project relationship is an example of a cross partition relationship. To allow the employees and projects to be stored on different databases a union policy is used and the join table is replicated to each database.</p>
<div class="example"><a id="CEGHAIDJ" name="CEGHAIDJ"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-76 Using Partitioning</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
@Entity
@IdClass(EmployeePK.class)
@UnionPartitioning(
        name="UnionPartitioningAllNodes",
        replicateWrites=true)
@ValuePartitioning(
        name="ValuePartitioningByLOCATION",
        partitionColumn=@Column(name="LOCATION"),
        unionUnpartitionableQueries=true,
        defaultConnectionPool="default",
        partitions={
            @ValuePartition(connectionPool="node2", value="Ottawa"),
            @ValuePartition(connectionPool="node3", value="Toronto")
        })
@Partitioned("ValuePartitioningByLOCATION")
public class Employee {
    @Id
    @Column(name = "EMP_ID")
    private Integer id;
 
    @Id
    private String location;
    ...
 
    @ManyToMany(cascade = { PERSIST, MERGE })
    @Partitioned("UnionPartitioningAllNodes")
    private Collection&lt;Project&gt; projects;
    ...
}
</pre></div>
<!-- class="example" -->
<div class="example"><a id="CEGJCEIH" name="CEGJCEIH"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-77 Using @RangePartitioning</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
@Entity
@RangePartitioning(
        name="RangePartitioningByPROJ_ID",
        partitionColumn=@Column(name="PROJ_ID"),
        partitionValueType=Integer.class,
        unionUnpartitionableQueries=true,
        partitions={
            @RangePartition(connectionPool="default", startValue="0", endValue="1000"),
            @RangePartition(connectionPool="node2", startValue="1000", endValue="2000"),
            @RangePartition(connectionPool="node3", startValue="2000")
        })
@Partitioned("RangePartitioningByPROJ_ID")
public class Project {
    @Id
    @Column(name="PROJ_ID")
    private Integer id;
    ...
}
</pre></div>
<!-- class="example" -->
<a id="sthref265" name="sthref265"></a>
<p><strong><br /><span class="refsubsect">See Also</span></strong></p>
<p>For more information, see:</p>
<ul>
<li>
<p><a href="a_partitioned.htm#CHDDAHEB">"@Partitioned"</a></p>
</li>
<li>
<p><a href="a_hashpartitioning.htm#CEGBDBEG">"@HashPartitioning"</a></p>
</li>
<li>
<p><a href="a_pinnedpartitioning.htm#BCGIIAFB">"@PinnedPartitioning"</a></p>
</li>
<li>
<p><a href="a_rangepartitioning.htm#BCGCGEIH">"@RangePartitioning"</a></p>
</li>
<li>
<p><a href="a_replicationpartitioning.htm#BABJEFJH">"@ReplicationPartitioning"</a></p>
</li>
<li>
<p><a href="a_roundrobinpartitioning.htm#BCGBJGFF">"@RoundRobinPartitioning"</a></p>
</li>
<li>
<p><a href="a_unionpartitioning.htm#BCGEJFAH">"@UnionPartitioning"</a></p>
</li>
<li>
<p><a href="a_valuepartitioning.htm#CEGHFJDJ">"@ValuePartitioning"</a></p>
</li>
<li>
<p>"Data Partitioning"<br />
<code><a href="http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning">http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Advanced_JPA_Development/Data_Partitioning</a></code></p>
</li>
<li>
<p>EclipseLink Examples<br />
<code>http://wiki.eclipse.org/EclipseLink/Examples/JPA/Partitioning</code></p>
</li>
</ul>
</div>
<!-- class="refsect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
<div class="footer">
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<col width="33%" />
<col width="*" />
<col width="33%" />
<tr>
<td valign="bottom">
<table class="navigation simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100" align="center">
<col width="*" />
<col width="48%" />
<col width="48%" />
<tr>
<td>&nbsp;</td>
<td align="center"><a href="a_partitioned.htm"><img src="../../../dcommon/images/larrow.png" alt="Previous" border="0" height="16" width="16" /></a></td>
<td align="center"><a href="a_pinnedpartitioning.htm"><img src="../../../dcommon/images/rarrow.png" alt="Next" border="0" height="16" width="16" /></a></td>
</tr>
</table>
</td>
<td align="center" width="34%"><a href="http://www.eclipse.org/eclipselink/" title="EclipseLink home"><img src="../../../dcommon/images/ellogo.png" alt="EclipseLink" width="150" border="0" /></a><br />
<font size="-2">Copyright&nbsp;&copy;&nbsp;2012,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.</font> <a href="../../../dcommon/html/cpyr.htm"><br />
  
<td valign="bottom" align="right">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="225">
<tr>
<td>&nbsp;</td>
<td align="center" valign="top"><a href="toc.htm"><img src="../../../dcommon/images/contents.png" alt="Go To Table Of Contents" border="0" height="16" width="16" /><br />
<span class="mini">Contents</span></a></td><td>&nbsp;</td><td align="center"><a href="../../../" target="_top" class="external text" title="Other searches" rel="nofollow"><img src="../../../dcommon/images/search.png" alt="Search" style="border:0;" /><br /><span class="mini">Other&nbsp;Searches</span></a></td><td>&nbsp;</td><td align="center"><a href="../../eclipselink_jpa_extensions.pdf" title="PDF" target="_blank"><img src="../../../dcommon/images/pdf_icon.png" style="padding-right:5px;border:0" alt="PDF"><br /><span class="mini">PDF</span></a>
</tr>
</table>
</td>
</tr>
</table>
</div>
<!-- class="footer" -->
<div id="copyright">Copyright &copy; 2012 by The Eclipse Foundation under the <a href="http://www.eclipse.org/org/documents/epl-v10.php">Eclipse Public License (EPL)</a><br /> <script type="text/javascript">var LastUpdated = document.lastModified;document.writeln ("Updated: " + LastUpdated);</script> </div><!-- START: Analytics --><script type="text/javascript">		  var _gaq = _gaq || [];		  _gaq.push(['_setAccount', 'UA-1608008-2']);		  _gaq.push(['_trackPageview']);				  (function() {		    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;		    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);		  })();				</script><!-- END: Analytics --><!-- START: Sharethis --><script>var options={ "publisher": "e2fe9e07-fab6-4f84-83ea-0991b429842c", "position": "right", "ad": { "visible": false, "openDelay": 5, "closeDelay": 0}};var st_hover_widget = new sharethis.widgets.hoverbuttons(options);</script><!-- END: Sharethis --><!-- START: Disqus --><div id="disqus_thread"></div>        <script type="text/javascript">            var disqus_developer = 1;var disqus_shortname = 'eclipselinkdoc';              (function() {                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);            })();        </script>        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>        <a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a><!-- END: Disqus --></body>
</html>
