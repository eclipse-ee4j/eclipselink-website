<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Script-Type" content="text/javascript" />
<title>@Multitenant</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Version 5.1.2 Build 067" />
<meta name="date" content="2012-06-27T14:23:49Z" />
<meta name="robots" content="noarchive" />
<meta name="doctitle" content="@Multitenant" />
 
<link rel="stylesheet" type="text/css" href="../../../../dcommon/style.css" media="screen" />
  
<link rel="start" href="../../index.htm" title="Home" type="text/html" />
<link rel="contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="prev" href="a_mapkeyconvert.htm" title="Previous" type="text/html" />
<link rel="next" href="a_mutable.htm" title="Next" type="text/html" />
</head>
<body bgcolor="#FFFFFF">
<div class="header"><a id="top" name="top"></a>
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td align="left" valign="top"><font face="helvetica, arial, sans-serif"><strong>Java Persistence API (JPA) Extensions Reference for EclipseLink</strong> <br />
<strong>Release 2.4.x</strong><br />
 </font></td>
<td valign="bottom" align="right" width="144">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<tr>
<td>&nbsp;</td>
<td align="center" valign="top" width="25%"><a href="../../index.htm"><img src="../../../../dcommon/images/information.png" alt="Go To Documentation Library" border="0" height="16" width="16" /><br />
Documentation</a></td><td>&nbsp;</td><td><a href="http://www.google.com/cse/home?cx=016171230611334810008:y5kxq4rqd8s&amp;hl=en" class="external text" title="http://www.google.com/cse/home?cx=016171230611334810008:y5kxq4rqd8s&amp;hl=en" rel="nofollow"><img src="../../../../dcommon/images/search.png" alt="Search" style="border:0;" /><br />Search</a>
<td align="center" valign="top"><a href="toc.htm"><img src="../../../../dcommon/images/contents.png" alt="Go To Table Of Contents" border="0" height="16" width="16" /><br />
Contents</a></td>
</tr>
</table>
</td>
</tr>
</table>
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100">
<tr>
<td align="center"><a href="a_mapkeyconvert.htm"><img src="../../../../dcommon/images/larrow.png" alt="Previous" border="0" height="16" width="16" /></a></td>
<td align="center"><a href="a_mutable.htm"><img src="../../../../dcommon/images/rarrow.png" alt="Next" border="0" height="16" width="16" /></a></td>
<td>&nbsp;</td>
</tr>
</table>
</div>
<!-- class="header" -->
<div class="ind"><!-- End Header -->
<p align="center"><font color="#FF0000">Beta Draft: 2012-06-27</font></p>
<a id="BABIEJGD" name="BABIEJGD"></a>
<hr />
<div class="refsect1">
<h2 class="refsect1"><font face="arial, helvetica, sans-serif" color="#330099">@Multitenant</font></h2>
<p>The <code>@Multitenant</code> annotation specifies that a given entity is shared among multiple tenants of an application. The multitenant type specifies how the data for these entities are to be stored on the database for each tenant. Multitenancy can be specified at the entity or mapped superclass level.</p>
<a id="sthref195" name="sthref195"></a>
<p><strong><font face="arial, helvetica, sans-serif" color="#330099">Annotation Elements</font></strong></p>
<p><a href="#CHDGJGDC">Table 2-34</a> describes this annotation's elements.</p>
<div class="tblhruleformalwide"><a id="sthref196" name="sthref196"></a><a id="CHDGJGDC" name="CHDGJGDC"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Table 2-34 @Multitenant Annotation Elements</font></em></strong></p>
<table class="HRuleFormalWide" title="@Multitenant Annotation Elements" summary="This table describes the list of attributes for this annotation." dir="ltr" border="1" width="100%" frame="hsides" rules="rows" cellpadding="3" cellspacing="0">
<col width="31%" />
<col width="*" />
<col width="28%" />
<thead>
<tr align="left" valign="top">
<th align="left" valign="bottom" id="r1c1-t43"><font face="Arial, Helvetica, sans-serif"><strong>Annotation Element</strong></font></th>
<th align="left" valign="bottom" id="r1c2-t43"><font face="Arial, Helvetica, sans-serif"><strong>Description</strong></font></th>
<th align="left" valign="bottom" id="r1c3-t43"><font face="Arial, Helvetica, sans-serif"><strong>Default</strong></font></th>
</tr>
</thead>
<tbody>
<tr align="left" valign="top">
<td align="left" id="r2c1-t43" headers="r1c1-t43">
<p><code>boolean IncludeCriteria</code></p>
</td>
<td align="left" headers="r2c1-t43 r1c2-t43">
<p>Indicates if the database requires the tenant criteria to be added to the <code>SELECT</code>, <code>UPDATE</code>, and <code>DELETE</code> queries.</p>
</td>
<td align="left" headers="r2c1-t43 r1c3-t43">
<p><code>true</code></p>
</td>
</tr>
<tr align="left" valign="top">
<td align="left" id="r3c1-t43" headers="r1c1-t43">
<p><code>MultitenantType value</code></p>
</td>
<td align="left" headers="r3c1-t43 r1c2-t43">
<p>Specifies the multitenant strategy to use: <code>SINGLE_TABLE</code>, <code>TABLE_PER_TENANT</code>, or <code>VDP</code>.</p>
</td>
<td align="left" headers="r3c1-t43 r1c3-t43">
<p><code>SINGLE_TABLE</code></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" -->
<a id="sthref197" name="sthref197"></a>
<p><strong><font face="arial, helvetica, sans-serif" color="#330099">Usage</font></strong></p>
<p>To use the <code>@Multitenant</code> annotation, include the annotation with an <code>@Entity</code> or <code>@MappedSuperclass</code> annotation. For example:</p>
<pre xml:space="preserve" class="oac_no_warn">
@Entity
@Multitenant
...
public class Employee() {
  ...
}
 
</pre>
<p>Three types of multitenancy are available:</p>
<ul>
<li>
<p><a href="#BABICDGI">Single-Table Multitenancy</a></p>
</li>
<li>
<p><a href="#BABEGBIJ">Table-Per-Tenanat Multitenancy</a></p>
</li>
<li>
<p><a href="#CHDBFBGI">VDP Multitenancy</a></p>
</li>
</ul>
<a id="BABICDGI" name="BABICDGI"></a>
<hr />
<h3 class="refsect2"><font face="arial, helvetica, sans-serif" color="#330099">Single-Table Multitenancy</font></h3>
<p>The <code>SINGLE_TABLE</code> multitenant type specifies that any table to which an entity or mapped superclass maps can include rows for multiple tenants. Access to tenant-specific rows is restricted to the tenant.</p>
<p>Tenant-specific rows are associated with the tenant by using tenant discriminator columns. The discriminator columns are used with application context values to limit what a persistence context can access.</p>
<p>The results of queries on the mapped tables are limited to the tenant discriminator value(s) provided as property values. This applies to all insert, update, and delete operations on the table. When multitenant metadata is applied at the mapped superclass level, it is applied to all subentities unless they specify their own multitenant metadata.</p>
<div align="center">
<div class="inftblnote"><br />
<table class="Note oac_no_warn" summary="" border="1" width="80%" frame="hsides" rules="groups" cellpadding="3" cellspacing="0">
<tbody>
<tr>
<td align="left">
<p><font face="arial, helvetica, sans-serif"><strong>Note:</strong></font></p>
In the context of single-table multitenancy, &ldquo;single-table&rdquo; means multiple tenants can share a single table, and each tenant's data is distinguished from other tenants' data via the discriminator column(s). It is possible to use multiple tables with single-table multitenancy; but in that case, an entity's persisted data is stored in multiple tables (<code>Table</code> and <code>SecondaryTable</code>), and multiple tenants can share all the tables.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblnote" --></div>
<p>For more information how to use tenant discriminator columns to configure single-table multitenancy, see <a href="a_tenantdiscriminatorcolumn.htm#CHECIDGH">"@TenantDiscriminatorColumn"</a>.</p>
<a id="sthref198" name="sthref198"></a>
<h4 class="refsect3"><font face="arial, helvetica, sans-serif" color="#330099">Examples</font></h4>
<p>The following example uses <code>@Multitenant</code>, <code>@TenantDiscriminatorColumn</code>, and a context property to define single-table multitenancy on an entity:</p>
<div class="example"><a id="sthref199" name="sthref199"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-51 Example Using @Multitenant</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
@Entity 
@Table(name=&ldquo;EMP&rdquo;) 
@Multitenant(SINGLE_TABLE) 
@TenantDiscriminatorColumn(name = &ldquo;TENANT_ID&rdquo;, 
   contextProperty = "employee-tenant.id")
</pre></div>
<!-- class="example" -->
<p>The following example uses the <code>&lt;multitenant&gt;</code> element to specify a minimal single-table multitenancy. <code>SINGLE_TABLE</code> is the default value and therefore does not have to be specified.</p>
<div class="example"><a id="sthref200" name="sthref200"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-52 Example Using &lt;multitenant&gt;</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
&lt;entity class="model.Employee"&gt;
  &lt;multitenant/&gt;
  &lt;table name="EMP"/&gt;
  ...
&lt;/entity&gt;
</pre></div>
<!-- class="example" -->
<a id="BABEGBIJ" name="BABEGBIJ"></a>
<hr />
<h3 class="refsect2"><font face="arial, helvetica, sans-serif" color="#330099">Table-Per-Tenanat Multitenancy</font></h3>
<p>The <code>TABLE_PER_TENANT</code> multitenant type specifies that the table(s) (<code>Table</code> and <code>SecondaryTable</code>) for an entity are tenant-specific tables based on the tenant context.. Access to these tables is restricted to the specified tenant. Relationships within an entity that use a join or collection table are also assumed to exist within that context.</p>
<p>As with other multitenant types, table-per-tenant multitenancy can be specified at the entity or mapped superclass level. At the entity level, a tenant context property must be provided on each entity manager after a transaction has started.</p>
<p>Table-per-tenant entities can be mixed with other multitenant-type entities within the same persistence unit.</p>
<p>All read, insert, update, and delete operations for the tenant apply only to the tenant's table(s).</p>
<p>Tenants share the same server session by default. The table-per-tenant identifier must be set or updated for each entity manager. ID generation is assumed to be unique across all the tenants in a table-per-tenant strategy.</p>
<p>To configure table-per-tenant multitenancy, you must specify:</p>
<ul>
<li>
<p>A table-per-tenant property to identify the user. This can be set per entity manager, or it can be set at the entity manager factory to isolate table-per-tenant per persistence unit.)</p>
</li>
<li>
<p>A tenant table discriminator to identify and isolate the tenant's tables from other tenants' tables. The discriminator types are <code>SCHEMA</code>, <code>SUFFIX</code>, and <code>PREFIX</code>. For more information about tenant discriminator types, see <a href="a_tenanttablediscriminator.htm#CHDFJJEC">"@TenantTableDiscriminator"</a></p>
<p>.</p>
</li>
</ul>
<a id="sthref201" name="sthref201"></a>
<h4 class="refsect3"><font face="arial, helvetica, sans-serif" color="#330099">Examples</font></h4>
<p>The following example shows the <code>@Multitenant</code> annotation used to define table-per-tenant multitenancy on an entity. <code>@TenantTableDiscriminator(SCHEMA)</code> specifies that the discriminator table is identified by schema.</p>
<div class="example"><a id="sthref202" name="sthref202"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-53 Example Using @Multitenant with @TenantTableDiscriminator</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
@Entity@Table(name=&ldquo;EMP&rdquo;)@Multitenant(TABLE_PER_TENANT)@TenantTableDiscriminator(SCHEMA)public class Employee {    ...} 
</pre></div>
<!-- class="example" -->
<p>The following example shows the <code>&lt;multitenant&gt;</code> element and the <code>&lt;tenant-table-discriminator&gt;</code> elements used to define a minimal table-per-tenant multitenancy.</p>
<div class="example"><a id="sthref203" name="sthref203"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-54 Example Using &lt;multitenant&gt; with &lt;tenant-table-discriminator&gt;</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
&lt;entity class="Employee"&gt;
  &lt;multitenant type="TABLE_PER_TENANT"&gt;
    &lt;tenant-table-discriminator type="SCHEMA"/&gt;
  &lt;/multitenant&gt;
  &lt;table name="EMP"&gt;
  ...
&lt;/entity&gt;
</pre></div>
<!-- class="example" -->
<a id="CHDBFBGI" name="CHDBFBGI"></a>
<hr />
<h3 class="refsect2"><font face="arial, helvetica, sans-serif" color="#330099">VDP Multitenancy</font></h3>
<p>The <code>VPD</code> (Virtual Private Database) multitanancy type specifies that the database handles the tenant filtering on all SELECT, UPDATE and DELETE queries. To use this type, the platform used with the persistence unit must support VPD.</p>
<p>To use TopLink VPD multitenancy, you must first configure VPD in the database and then specify multitenancy on the entity or mapped superclass, using <code>@Multitenant</code> and <code>@TenantDiscriminatorColumn</code>:</p>
<a id="sthref204" name="sthref204"></a>
<h4 class="refsect3"><font face="arial, helvetica, sans-serif" color="#330099">Examples</font></h4>
<p><a href="#CHDIEFCF">Example 2-55</a> shows VPD multitenancy defined on an entity. As noted above, VPD in the database must also be configured to enable VPD multitenancy. In this case, the VPD database was configured to use the USER_ID column to restrict access to specified rows by specified clients. Therefore, <code>USER_ID</code> is also specified as the tenant discriminator column for the TopLink multitenant operations.</p>
<div class="example"><a id="CHDIEFCF" name="CHDIEFCF"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-55 Example Using @Multitenancy</font></em></strong></p>
<p>The following example shows</p>
<pre xml:space="preserve" class="oac_no_warn">
</pre></div>
<!-- class="example" -->
<pre xml:space="preserve" class="oac_no_warn">
@Entity
@Multitenant
@TenantDiscriminatorColumn(name = "USER_ID", contextProperty = "tenant.id")
@Cacheable(false)
 
public class Task implements Serializable {
...
...
</pre>
<p>The following example shows...</p>
<div class="example"><a id="sthref205" name="sthref205"></a>
<p><strong><em><font face="arial, helvetica, sans-serif">Example 2-56 Example Using &lt;multitenant&gt;</font></em></strong></p>
<pre xml:space="preserve" class="oac_no_warn">
&lt;entity class="model.Employee"&gt; 
  &lt;multitenant type="VPD"&gt;
    &lt;tenant-discriminator-column name="USER_ID" context-property="tenant.id"/&gt; 
  &lt;/multitenant&gt;
  &lt;table name="EMPLOYEE"/&gt;
  ...
&lt;/entity&gt;
</pre></div>
<!-- class="example" -->
<hr />
<a id="sthref206" name="sthref206"></a>
<h3 class="refsect2"><font face="arial, helvetica, sans-serif" color="#330099">See Also</font></h3>
<ul>
<li>
<p><a href="a_tenantdiscriminatorcolumn.htm#CHECIDGH">"@TenantDiscriminatorColumn"</a></p>
</li>
<li>
<p><a href="a_tenantdiscrim_columns.htm#CECBEBEA">"@TenantDiscriminatorColumns"</a></p>
</li>
<li>
<p>Multitenant Examples at <code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Multitenant">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Multitenant</a></code></p>
</li>
</ul>
</div>
<!-- class="refsect1" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
<div class="footer">
<hr />
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100%">
<col width="33%" />
<col width="*" />
<col width="33%" />
<tr>
<td valign="bottom">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="100">
<col width="*" />
<col width="48%" />
<col width="48%" />
<tr>
<td>&nbsp;</td>
<td align="center"><a href="a_mapkeyconvert.htm"><img src="../../../../dcommon/images/larrow.png" alt="Previous" border="0" height="16" width="16" /></a></td>
<td align="center"><a href="a_mutable.htm"><img src="../../../../dcommon/images/rarrow.png" alt="Next" border="0" height="16" width="16" /></a></td>
</tr>
</table>
</td>
<td align="center" width="34%"><img src="http://www.eclipse.org/eclipselink/images/logo.png" alt="EclipseLink" width="150" border="0" /><br /><img src="http://wiki.eclipse.org/images/b/bd/Elug_home_icon.png" style="padding-right:5px;" alt="EclipseLink logo">&nbsp;<a href="http://www.eclipse.org/eclipselink/">EclipseLink Home</a>&nbsp;&bull;&nbsp;<img src="http://wiki.eclipse.org/images/b/b6/Elug_pdf.png" style="padding-right:5px;" alt="PDF">&nbsp;PDF (coming soon)<br />
 
  
<td valign="bottom" align="right">
<table class="simple oac_no_warn" summary="" cellspacing="0" cellpadding="0" width="225">
<tr>
<td>&nbsp;</td>
<td align="center" valign="top" width="25%"><a href="../../index.htm"><img src="../../../../dcommon/images/information.png" alt="Go To Documentation Library" border="0" height="16" width="16" /><br />
Documentation</a></td><td>&nbsp;</td><td><a href="http://www.google.com/cse/home?cx=016171230611334810008:y5kxq4rqd8s&amp;hl=en" class="external text" title="http://www.google.com/cse/home?cx=016171230611334810008:y5kxq4rqd8s&amp;hl=en" rel="nofollow"><img src="../../../../dcommon/images/search.png" alt="Search" style="border:0;" /><br />Search</a>
<td align="center" valign="top"><a href="toc.htm"><img src="../../../../dcommon/images/contents.png" alt="Go To Table Of Contents" border="0" height="16" width="16" /><br />
Contents</a></td>
</tr>
</table>
</td>
</tr>
</table>
</div>
<!-- class="footer" -->
</body>
</html>
