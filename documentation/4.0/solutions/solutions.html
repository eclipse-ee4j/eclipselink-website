<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>EclipseLink Solutions Guide for EclipseLink</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#eclipselink-solutions-guide-for-eclipselink">EclipseLink Solutions Guide for EclipseLink</a>
<ul class="sectlevel1">
<li><a href="#eclipselink">EclipseLink</a></li>
<li><a href="#preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#audience">Audience</a></li>
<li><a href="#related-documents">Related Documents</a></li>
<li><a href="#conventions">Conventions</a></li>
</ul>
</li>
<li><a href="#list-of-examples">List of Examples</a></li>
<li><a href="#whats-new-in-this-guide">What&#8217;s New in This Guide</a>
<ul class="sectlevel2">
<li><a href="#new-and-changed-features-for-release-4-0-5">New and Changed Features for Release 4.0.5</a></li>
<li><a href="#other-significant-changes-in-this-document-for-release-4-0-5">Other Significant Changes in this Document for Release 4.0.5</a></li>
<li><a href="#new-and-changed-features-for-12c-12-1-2">New and Changed Features for 12c (12.1.2)</a></li>
<li><a href="#other-significant-changes-in-this-document-for-12c-12-1-2">Other Significant Changes in this Document for 12c (12.1.2)</a></li>
</ul>
</li>
<li><a href="#CHDGIDEA">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#about-this-guide">1.1. About This Guide</a></li>
<li><a href="#what-you-need-to-know-first">1.2. What You Need to Know First</a></li>
<li><a href="#the-use-cases">1.3. The Use Cases</a></li>
</ul>
</li>
<li><a href="#INSTALL">2. Installing EclipseLink</a>
<ul class="sectlevel2">
<li><a href="#INSTALL001">2.1. Prerequisites</a></li>
<li><a href="#INSTALL002">2.2. Installing EclipseLink for Java SE and Jakarta EE Development</a></li>
<li><a href="#INSTALL003">2.3. Installing EclipseLink NoSQL Support</a></li>
<li><a href="#INSTALL004">2.4. Installing EclipseLink with OSGi Support</a></li>
</ul>
</li>
<li><a href="#ELWLS">3. Using EclipseLink with WebLogic Server</a>
<ul class="sectlevel2">
<li><a href="#ELWLS001">3.1. Introduction to the Solution</a></li>
<li><a href="#ELWLS002">3.2. Implementing the Solution</a></li>
<li><a href="#ELWLS003">3.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#ELGS">4. Using EclipseLink with GlassFish Server</a>
<ul class="sectlevel2">
<li><a href="#ELGS001">4.1. Introduction to the Solution</a></li>
<li><a href="#ELGS002">4.2. Implementing the Solution</a></li>
<li><a href="#ELGS003">4.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#ELJBOSS">5. Using EclipseLink with JBoss 7 Application Server</a>
<ul class="sectlevel2">
<li><a href="#ELJBOSS001">5.1. Introduction to the Solution</a></li>
<li><a href="#ELJBOSS002">5.2. Implementing the Solution</a></li>
<li><a href="#ELJBOSS003">5.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#ELWS">6. Using EclipseLink with IBM WebSphere Application Server</a>
<ul class="sectlevel2">
<li><a href="#ELWS001">6.1. Introduction to the Solution</a></li>
<li><a href="#ELWS002">6.2. Implementing the Solution</a></li>
<li><a href="#ELWS003">6.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#MIGRATETOPLINK">7. Migrating from Native TopLink</a>
<ul class="sectlevel2">
<li><a href="#MIGRATETOPLINK000">7.1. Introduction to the Solution</a></li>
<li><a href="#MIGRATETOPLINK001">7.2. Implementing the Solution</a></li>
<li><a href="#MIGRATETOPLINK002">7.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#MIGRATEHIBERNATE">8. Migrating from Hibernate to EclipseLink</a>
<ul class="sectlevel2">
<li><a href="#MIGRATEHIBERNATE001">8.1. Introduction to the Solution</a></li>
<li><a href="#MIGRATEHIBERNATE002">8.2. Main Tasks</a></li>
<li><a href="#MIGRATEHIBERNATE003">8.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#USINGMULTIDBS">9. Using Multiple Databases with a Composite Persistence Unit</a>
<ul class="sectlevel2">
<li><a href="#USINGMULTIDBS001">9.1. Introduction to the Solution</a></li>
<li><a href="#CIHJCHAF">9.2. Composite Persistence Unit Requirements</a></li>
<li><a href="#USINGMULTIDBS002">9.3. Implementing the Solution</a></li>
<li><a href="#USINGMULTIDBS003">9.4. Additional Resources</a></li>
</ul>
</li>
<li><a href="#SCALING">10. Scaling Applications in Clusters</a>
<ul class="sectlevel2">
<li><a href="#SCALING001">10.1. Introduction to the Solution</a></li>
<li><a href="#SCALING002">10.2. Implementing the Solution</a></li>
<li><a href="#BABHHAEJ">10.3. Using Data Partitioning to Scale Data</a></li>
<li><a href="#SCALING003">10.4. Additional Resources</a></li>
</ul>
</li>
<li><a href="#SAAS">11. Providing Software as a Service</a>
<ul class="sectlevel2">
<li><a href="#SAAS001">11.1. Introduction to the Solution</a></li>
</ul>
</li>
<li><a href="#EXTENSIBLE">12. Making JPA Entities and JAXB Beans Extensible</a>
<ul class="sectlevel2">
<li><a href="#EXTENSIBLE001">12.1. Making JPA Entities Extensible</a></li>
<li><a href="#EXTENSIBLE002">12.2. Making JAXB Beans Extensible</a></li>
<li><a href="#EXTENSIBLE003">12.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#METADATASOURCE">13. Using an External MetaData Source</a>
<ul class="sectlevel2">
<li><a href="#METADATASOURCE001">13.1. Introduction to the Solution</a></li>
<li><a href="#METADATASOURCE002">13.2. Using the eclipselink-orm.xml File Externally</a></li>
<li><a href="#METADATASOURCE003">13.3. Main Tasks</a></li>
<li><a href="#METADATASOURCE004">13.4. Additional Resources</a></li>
</ul>
</li>
<li><a href="#MULTITENANCY">14. Tenant Isolation Using EclipseLink</a>
<ul class="sectlevel2">
<li><a href="#MULTITENANCY001">14.1. Introduction to the Solution</a></li>
<li><a href="#MULTITENANCY002">14.2. Using Single-Table Multi-Tenancy</a></li>
<li><a href="#MULTITENANCY003">14.3. Using Table-Per-Tenant Multi-Tenancy</a></li>
<li><a href="#MULTITENANCY004">14.4. Using VPD Multi-Tenancy</a></li>
<li><a href="#MULTITENANCY005">14.5. Additional Resources</a></li>
</ul>
</li>
<li><a href="#JPA2XML">15. Mapping JPA to XML</a>
<ul class="sectlevel2">
<li><a href="#JPA2XML001">15.1. Introduction to the Solution</a></li>
<li><a href="#JPA2XML002">15.2. Binding JPA Entities to XML</a></li>
<li><a href="#BEIIHFJG">15.3. Binding Compound Primary Keys to XML</a></li>
<li><a href="#JPA2XML003">15.4. Mapping Simple Java Values to XML Text Nodes</a></li>
<li><a href="#JPA2XML004">15.5. Using XML Metadata Representation to Override JAXB Annotations</a></li>
<li><a href="#JPA2XML005">15.6. Using XPath Predicates for Mapping</a></li>
<li><a href="#JPA2XML006">15.7. Using Dynamic JAXB/MOXy</a></li>
<li><a href="#JPA2XML007">15.8. Additional Resources</a></li>
</ul>
</li>
<li><a href="#JSON">16. Converting Objects to and from JSON Documents</a>
<ul class="sectlevel2">
<li><a href="#JSON001">16.1. Introduction to the Solution</a></li>
<li><a href="#JSON002">16.2. Implementing the Solution</a></li>
<li><a href="#JSON003">16.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#TESTINGJPA">17. Testing JPA Outside a Container</a>
<ul class="sectlevel2">
<li><a href="#TESTINGJPA001">17.1. Understanding JPA Deployment</a></li>
<li><a href="#TESTINGJPA002">17.2. Configuring the persistence.xml File</a></li>
<li><a href="#TESTINGJPA003">17.3. Using a Property Map</a></li>
<li><a href="#TESTINGJPA004">17.4. Using Weaving</a></li>
<li><a href="#TESTINGJPA005">17.5. Additional Resources</a></li>
</ul>
</li>
<li><a href="#PERFORMANCE">18. Enhancing Performance</a>
<ul class="sectlevel2">
<li><a href="#PERFORMANCE001">18.1. Performance Features</a></li>
<li><a href="#PERFORMANCE002">18.2. Monitoring and Optimizing EclipseLink-Enabled Applications</a></li>
</ul>
</li>
<li><a href="#RESTJPA">19. Exposing JPA Entities Through RESTful Data Services</a>
<ul class="sectlevel2">
<li><a href="#RESTJPA001">19.1. Introduction to the Solution</a></li>
<li><a href="#RESTJPA002">19.2. Implementing the Solution</a></li>
<li><a href="#RESTJPA003">19.3. Additional Resources</a></li>
<li><a href="#RESTJPA004">19.4. RESTful Data Services API Reference</a></li>
<li><a href="#entity-operations">19.5. Entity Operations</a></li>
<li><a href="#entity-operations-on-relationships">19.6. Entity Operations on Relationships</a></li>
<li><a href="#query-operations">19.7. Query Operations</a></li>
<li><a href="#single-result-queries">19.8. Single Result Queries</a></li>
<li><a href="#base-operations">19.9. Base Operations</a></li>
<li><a href="#metadata-operations">19.10. Metadata Operations</a></li>
</ul>
</li>
<li><a href="#QCN">20. Using Database Events to Invalidate the Cache</a>
<ul class="sectlevel2">
<li><a href="#QCN001">20.1. Introduction to the Solution</a></li>
<li><a href="#QCN002">20.2. Implementing the Solution</a></li>
<li><a href="#QCN003">20.3. Limitations on the Solution</a></li>
<li><a href="#QCN004">20.4. Additional Resources</a></li>
</ul>
</li>
<li><a href="#NOSQL">21. Using EclipseLink with NoSQL Databases</a>
<ul class="sectlevel2">
<li><a href="#NOSQL001">21.1. Introduction to the Solution</a></li>
<li><a href="#NOSQL002">21.2. Implementing the Solution</a></li>
<li><a href="#NOSQL003">21.3. Additional Resources</a></li>
</ul>
</li>
<li><a href="#ORACLEDB">22. Using EclipseLink with the Oracle Database</a>
<ul class="sectlevel2">
<li><a href="#ORACLEDB001">22.1. Introduction to the Solution</a></li>
<li><a href="#ORACLEDB002">22.2. Implementing the Solution</a></li>
<li><a href="#ORACLEDB003">22.3. Additional Resources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://wiki.eclipse.org/EclipseLink/FAQ">FAQs</a>|<a href="https://www.eclipse.org/eclipselink/documentation/">Documentation</a>|
<a href="http://wiki.eclipse.org/EclipseLink/Examples">Examples</a>|<a href="http://wiki.eclipse.org/EclipseLink/Development/">Development</a></p>
</div>
<hr>
</div>
</div>
<h1 id="eclipselink-solutions-guide-for-eclipselink" class="sect0"><a class="anchor" href="#eclipselink-solutions-guide-for-eclipselink"></a>EclipseLink Solutions Guide for EclipseLink</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><a href="solutions.pdf">PDF</a>|<a href="solutions.epub">ePub</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eclipselink"><a class="anchor" href="#eclipselink"></a>EclipseLink</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Solutions Guide for EclipseLink 4.0.5</p>
</div>
<div class="paragraph">
<p>December 2022
<strong>Solutions Guide for EclipseLink</strong></p>
</div>
<div class="paragraph">
<p>Copyright © 2022 by The Eclipse Foundation under the Eclipse Public
License (EPL)</p>
</div>
<div class="paragraph">
<p><code><a href="http://www.eclipse.org/org/documents/epl-v10.php" class="bare">http://www.eclipse.org/org/documents/epl-v10.php</a></code></p>
</div>
<div class="paragraph">
<p>The initial contribution of this content was based on work copyrighted
by Oracle and was submitted with permission.</p>
</div>
<div class="paragraph">
<p>Print date: December, 2022</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EclipseLink delivers a standards-based enterprise Java solution for all
of your relational, XML, and JSON persistence requirements, based on
high performance and scalability, developer productivity, and
flexibility in architecture and design.</p>
</div>
<div class="paragraph">
<p><a id="TLADG102"></a><a id="sthref2"></a></p>
</div>
<div class="sect2">
<h3 id="audience"><a class="anchor" href="#audience"></a>Audience</h3>
<div class="paragraph">
<p>A variety of engineers use EclipseLink. Users of EclipseLink are
expected to be proficient in the use of technologies and services
related to EclipseLink (for example, Jakarta Persistence API). This
guide does not include details about related common tasks, but focuses
on EclipseLink functionality.</p>
</div>
<div class="paragraph">
<p>Users of this guide include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Developers who want to develop applications using any of the following
technologies for persistence services:</p>
<div class="ulist">
<ul>
<li>
<p>Jakarta Persistence API (JPA) 2.<em>n</em> plus EclipseLink JPA extensions</p>
</li>
<li>
<p>Java Architecture for XML Binding 2.<em>n</em> (JAXB) plus EclipseLink
Object-XML extensions</p>
</li>
<li>
<p>EclipseLink Database Web Services (DBWS)</p>
<div class="paragraph">
<p>Developers should be familiar with the concepts and programming
practices of Java Platform, Standard Edition (Java SE platform), and
Java Platform, Enterprise Edition (Jakarta EE platform).</p>
</div>
<div class="paragraph">
<p>Developers using EclipseLink JPA should be familiar with the concepts
and programming practices of JPA 2.2, as specified in the Java
Persistence Architecture 2.2 specification at
<code><a href="http://jcp.org/en/jsr/detail?id=338" class="bare">http://jcp.org/en/jsr/detail?id=338</a></code>.</p>
</div>
<div class="paragraph">
<p>Developers using EclipseLink Object-XML should be familiar with the
concepts and programming practices of JAXB 2.0, as specified in the Java
Architecture for XML Binding 2.0 specification at
<code><a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html" class="bare">http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>Developers using EclipseLink DBWS should be familiar with the concepts
and programming practices of JAX-WS 2.0, as specified in the Java API
for XML-Based Web Services 2.0 specification at
<code><a href="http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html" class="bare">http://jcp.org/aboutJava/communityprocess/pfd/jsr222/index.html</a></code>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Administrators and deployers who want to deploy and manage
applications using EclipseLink persistence technologies. These users
should be familiar with basic operations of the chosen application
server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="TLADG105"></a><a id="sthref3"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="related-documents"><a class="anchor" href="#related-documents"></a>Related Documents</h3>
<div class="paragraph">
<p>For more information, see the following documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>EclipseLink Concepts</em></p>
</li>
<li>
<p><em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em></p>
</li>
<li>
<p><em>Developing Persistence Architectures Using EclipseLink Database Web
Services Developer&#8217;s Guide</em></p>
</li>
<li>
<p><em>Developing JAXB Applications Using EclipseLink MOXy</em></p>
</li>
<li>
<p><em>Java API Reference for EclipseLink</em></p>
</li>
<li>
<p>EclipseLink Documentation Center at
<code><a href="http://www.eclipse.org/eclipselink/documentation/" class="bare">http://www.eclipse.org/eclipselink/documentation/</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="TLADG106"></a><a id="sthref4"></a></p>
</div>
</div>
<div class="sect2">
<h3 id="conventions"><a class="anchor" href="#conventions"></a>Conventions</h3>
<div class="paragraph">
<p>The following text conventions are used in this guide:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Convention</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Meaning</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>boldface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boldface type indicates graphical user interface elements
associated with an action, or terms defined in text or the glossary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>italic</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Italic type indicates book titles, emphasis, or placeholder
variables for which you supply particular values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monospace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Monospace type indicates commands within a paragraph,
URLs, code in examples, text that appears on the screen, or text that
you enter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>bold monospace</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bold monospace type is used in code examples to
emphasize certain items.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="list-of-examples"><a class="anchor" href="#list-of-examples"></a>List of Examples</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#BABCFFHC">3-1 persistence.xml File With JNDI Data Source Using JTA</a></p>
</li>
<li>
<p><a href="#BABDAEFC">3-2 JDBC Data Source Defined in the name-jdbc.xml File</a></p>
</li>
<li>
<p><a href="#BABCJEDI">3-3 JDBC Module Defined in the weblogic-application.xml File</a></p>
</li>
<li>
<p><a href="#BABFIHHE">3-4 JTA Data Source Definition in the persistence.xml File</a></p>
</li>
<li>
<p><a href="#BABHFADF">3-5 non-JTA Data Source Definition in the persistence.xml File</a></p>
</li>
<li>
<p><a href="#CHDDDDIE">3-6 Server Domain config.xml File</a></p>
</li>
<li>
<p><a href="#CIHJGIEF">4-1 Sample persistence.xml File</a></p>
</li>
<li>
<p><a href="#CEGCBJCA">6-1 Sample persistence.xml for a container-managed persistence unit</a></p>
</li>
<li>
<p><a href="#CEGBBBJE">6-2 Sample persistence.xml for an application-managed persistence unit</a></p>
</li>
<li>
<p><a href="#BGBJIHJB">8-1 Sample Hibernate Entity Annotation</a></p>
</li>
<li>
<p><a href="#BGBHCBDG">8-2 Custom Generator for Sequence Values</a></p>
</li>
<li>
<p><a href="#BGBBIHAD">8-3 Persistence File for an Application that Uses Hibernate</a></p>
</li>
<li>
<p><a href="#BGBHEIEJ">8-4 Persistence File Modified for EclipseLink</a></p>
</li>
<li>
<p><a href="#CIHFBBDJ">9-1 Using Multiple Databases</a></p>
</li>
<li>
<p><a href="#CIHHAGCG">9-2 The persistence.xml File for a Composite Persistence Unit</a></p>
</li>
<li>
<p><a href="#BABJBFGB">12-1 Entity Class that Uses Property Access</a></p>
</li>
<li>
<p><a href="#CIADHIHE">12-2 Virtual Access Using Default get and set Method Names</a></p>
</li>
<li>
<p><a href="#CIAHGIEJ">12-3 Overriding get and set Methods</a></p>
</li>
<li>
<p><a href="#CIADJCIB">12-4 Using Property Access</a></p>
</li>
<li>
<p><a href="#CIAHDEGG">12-5 A Base Class for Extensible Classes</a></p>
</li>
<li>
<p><a href="#CIAECFAH">12-6 An Extensible Customer Class</a></p>
</li>
<li>
<p><a href="#CIAGABCC">12-7 A Nonextensible Address Class</a></p>
</li>
<li>
<p><a href="#CIAEEBIG">12-8 An Extensible PhoneNumber Class</a></p>
</li>
<li>
<p><a href="#CIAJHHAJ">12-9 Defining Virtual Properties for Tenant 1</a></p>
</li>
<li>
<p><a href="#CIAIIDAD">12-10 Tenant 1 Code to Provide the Data Associated with Virtual Properties</a></p>
</li>
<li>
<p><a href="#CIAECIAH">12-11 XML Output from the Customer Class for Tenant 1</a></p>
</li>
<li>
<p><a href="#CIAGBEGJ">12-12 Defining Virtual Properties for Tenant 2</a></p>
</li>
<li>
<p><a href="#CIACHCHF">12-13 Tenant 2 Code to Provide the Data Associated with Virtual Properties</a></p>
</li>
<li>
<p><a href="#CIAGDDIG">12-14 XML Output from the Customer Class for Tenant 2</a></p>
</li>
<li>
<p><a href="#BEIJFCEG">15-1 Employee Entity</a></p>
</li>
<li>
<p><a href="#BEIEGBBE">15-2 Address Entity</a></p>
</li>
<li>
<p><a href="#BEIEEFBA">15-3 PhoneNumber Entity</a></p>
</li>
<li>
<p><a href="#BEIHHJEA">15-4 Department Entity</a></p>
</li>
<li>
<p><a href="#BEIDFDDJ">15-5 Employee Entity with Compound Primary Keys</a></p>
</li>
<li>
<p><a href="#BEIFBGAG">15-6 PhoneNumber Entity</a></p>
</li>
<li>
<p><a href="#BEIDAGDJ">15-7 Employee Entity as Target Object</a></p>
</li>
<li>
<p><a href="#BEIGJACE">15-8 PhoneNumber Class as Source Object</a></p>
</li>
<li>
<p><a href="#BEIFCHBH">15-9 PhoneNumber Customizer with Updated Key Mappings</a></p>
</li>
<li>
<p><a href="#BEICBDBC">15-10 Example XML Schema</a></p>
</li>
<li>
<p><a href="#BEIHFEHF">15-11 Customer Object with Mapped id Property</a></p>
</li>
<li>
<p><a href="#BEICFEDE">15-12 Mapping id as an Attribute in OXM Metadata Format</a></p>
</li>
<li>
<p><a href="#BEIGFCJG">15-13 PhoneNumber Object with Mapped number Property</a></p>
</li>
<li>
<p><a href="#BEIECBDG">15-14 Mapping number as an Attribute in OXM Metadata Format</a></p>
</li>
<li>
<p><a href="#BEIFIJIH">15-15 Customer Object Mapping Values to a Simple Sequence</a></p>
</li>
<li>
<p><a href="#BEIIHFFE">15-16 Mapping Sequential Attributes in OXM Metadata Format</a></p>
</li>
<li>
<p><a href="#BEIBCIDB">15-17 Customer Object Mapping Properties to Sub-elements</a></p>
</li>
<li>
<p><a href="#BEIEADBI">15-18 Mapping Attributes as Sub-elements in OXM Metadata Format</a></p>
</li>
<li>
<p><a href="#BEICHICJ">15-19 Customer Object Mapping Values by Position</a></p>
</li>
<li>
<p><a href="#BEIDBECD">15-20 Updating XML Binding Information in the Mapping File</a></p>
</li>
<li>
<p><a href="#BEIIBGBB">15-21</a></p>
</li>
<li>
<p><a href="#BEIHAHJF">15-22 Customer Object Mapping to an Attribute Value</a></p>
</li>
<li>
<p><a href="#BEIHAIHA">15-23 Address Object Mapping to an Attribute Value</a></p>
</li>
<li>
<p><a href="#BEIDDBJA">15-24 PhoneNumber Object Mapping to an Attribute Value</a></p>
</li>
<li>
<p><a href="#BEICAHDH">15-25 XML Node with Self-Mapped Address Element</a></p>
</li>
<li>
<p><a href="#BEIJDEFA">15-26 Specifying the Input Stream and Creating the DynamicJAXBContext</a></p>
</li>
<li>
<p><a href="#BEIBCJFF">15-27 Sample XML Schema Document</a></p>
</li>
<li>
<p><a href="#BEIJBFAG">15-28 customer.xsd</a></p>
</li>
<li>
<p><a href="#BEIDIAJB">15-29 address.xsd</a></p>
</li>
<li>
<p><a href="#BEIBCJAB">15-30 Implementing an EntityResolver</a></p>
</li>
<li>
<p><a href="#BEIHGJAA">15-31 Passing in the Entityresolver</a></p>
</li>
<li>
<p><a href="#SOLEX1532">15-32 Creating the Dynamic Entity</a></p>
</li>
<li>
<p><a href="#SOLEX1533">15-33 Standard Dynamic JAXB Marshaller</a></p>
</li>
<li>
<p><a href="#BEIDBCBF">15-34 Updated XML Document Showing &lt;address&gt; Element and Its Attributes</a></p>
</li>
<li>
<p><a href="#SOLEX1535">15-35 Standard Dynamic JAXB Unmarshaller</a></p>
</li>
<li>
<p><a href="#BEIDDBCC">15-36</a></p>
</li>
<li>
<p><a href="#CHDEDEFA">16-1 Marshalling and Unmarshalling</a></p>
</li>
<li>
<p><a href="#CHDCEFJJ">16-2 Using a Map</a></p>
</li>
<li>
<p><a href="#CHDFHBDA">16-3 Using MarshallerProperties and UnarshallerProperties</a></p>
</li>
<li>
<p><a href="#CHDJCEEE">16-4 Using Basic JSON Binding</a></p>
</li>
<li>
<p><a href="#CHDEFJCC">16-5 Using External Bindings</a></p>
</li>
<li>
<p><a href="#CHDDAECA">16-6 Using JSON to Bootstrap a JAXBContext</a></p>
</li>
<li>
<p><a href="#BABEFCED">16-7 Using JSON Data Types</a></p>
</li>
<li>
<p><a href="#CHDICAHE">16-8 Using a Prefix</a></p>
</li>
<li>
<p><a href="#CHDIIHGC">16-9 Setting a Prefix in a Map</a></p>
</li>
<li>
<p><a href="#CHDEAEJA">16-10 Marshalling no Root Element Documents</a></p>
</li>
<li>
<p><a href="#CHDJAJBJ">16-11 Unmarshalling no Root Element Documents</a></p>
</li>
<li>
<p><a href="#CHDCEBBJ">16-12 Using Namesapces</a></p>
</li>
<li>
<p><a href="#CHDDJCJA">16-13 Marshalling Empty Collections</a></p>
</li>
<li>
<p><a href="#CHDBHJHF">16-14 Using @XmlAttributes</a></p>
</li>
<li>
<p><a href="#CHDFFIIH">16-15 Using a value Wrapper</a></p>
</li>
<li>
<p><a href="#CHDCFBHH">16-16 Customizing the Name of the Value Wrapper</a></p>
</li>
<li>
<p><a href="#CHDEDDAA">16-17 Using a Map</a></p>
</li>
<li>
<p><a href="#sthref138">17-1 Changing transaction type and defining connection information</a></p>
</li>
<li>
<p><a href="#CHDFFCIE">17-2 A persistence.xml File Specifying the Java SE Platform Configuration</a></p>
</li>
<li>
<p><a href="#CHDEHGEG">17-3 A persistence.xml File Specifying the Java SE Platform Configuration, for use with a Property Map</a></p>
</li>
<li>
<p><a href="#CHDDHBCC">17-4 Sample Configuration</a></p>
</li>
<li>
<p><a href="#CHDBDCBC">18-1 Using the @Cache Annotation</a></p>
</li>
<li>
<p><a href="#CHDBICAF">18-2 Enabling JoinFetching</a></p>
</li>
<li>
<p><a href="#CHDJDDFA">18-3 Enabling Change Tracking</a></p>
</li>
<li>
<p><a href="#BBAHGDFA">18-4 Enabling Serialized Object Policy Using Annotations</a></p>
</li>
<li>
<p><a href="#BBABHJJI">18-5 Enabling Serialized Object Policy Using eclipselink-orm.xml</a></p>
</li>
<li>
<p><a href="#BBAGBGFB">18-6 Enabling Serialized Object Policy in a Customizer</a></p>
</li>
<li>
<p><a href="#CHDBGFGG">18-7 Performance Profiler Output</a></p>
</li>
<li>
<p><a href="#CHDECAAF">20-1 Sample persistence.xml File</a></p>
</li>
<li>
<p><a href="#CHDJGCBF">20-2 Defining the @Version Annotation</a></p>
</li>
<li>
<p><a href="#BABBBHHD">21-1 Using @NoSql Annotation with JSON</a></p>
</li>
<li>
<p><a href="#sthref229">21-2 Sample Mappings</a></p>
</li>
<li>
<p><a href="#BABFACAI">21-3 Using @Version</a></p>
</li>
<li>
<p><a href="#sthref231">21-4 Oracle NoSQL JPQL Examples</a></p>
</li>
<li>
<p><a href="#sthref232">21-5 MongoDB JPQL Examples</a></p>
</li>
<li>
<p><a href="#sthref234">21-6 Oracle NoSQL Native Query</a></p>
</li>
<li>
<p><a href="#sthref235">21-7 MongoDB Native Query</a></p>
</li>
<li>
<p><a href="#sthref236">21-8 Oracle NoSQL persistence.xml Example</a></p>
</li>
<li>
<p><a href="#sthref237">21-9 MongoDB persistence.xml Example</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a id="TLADG611"></a> <a id="sthref5"></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="whats-new-in-this-guide"><a class="anchor" href="#whats-new-in-this-guide"></a>What&#8217;s New in This Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following topics introduce the new and changed features of
EclipseLink and other significant changes that are described in this
guide, and provides pointers to additional information.</p>
</div>
<div class="sect2">
<h3 id="new-and-changed-features-for-release-4-0-5"><a class="anchor" href="#new-and-changed-features-for-release-4-0-5"></a>New and Changed Features for Release 4.0.5</h3>
<div class="ulist">
<ul>
<li>
<p>Serialized object policy, for storing a serialized version of an
entity into a single column in the database. See
<a href="#BBAJBHBI">"Serialized Object Policy"</a>.</p>
</li>
<li>
<p>Automated tuning, for a dynamic single tuning option. See "Automated
Tuning" on page 18-8.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="other-significant-changes-in-this-document-for-release-4-0-5"><a class="anchor" href="#other-significant-changes-in-this-document-for-release-4-0-5"></a>Other Significant Changes in this Document for Release 4.0.5</h3>

</div>
<div class="sect2">
<h3 id="new-and-changed-features-for-12c-12-1-2"><a class="anchor" href="#new-and-changed-features-for-12c-12-1-2"></a>New and Changed Features for 12c (12.1.2)</h3>
<div class="paragraph">
<p>EclipseLink 2.4.2 includes the following new and changed features that
are documented in this book. This list does not necessarily include all
new or changed features in this release. It only includes the new
features that are documented in this book.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client isolation, where multiple application tenants may share
database tables and schemas. This allows applications to manage entities
for multiple tenants in the same application. See
<a href="#MULTITENANCY">Chapter 14, "Tenant Isolation Using
EclipseLink."</a></p>
</li>
<li>
<p>JSON bindings, for converting objects directly to and from JavaScript
Object Notation (JSON). This can be useful when creating RESTful
services, using JSON messages with Java API for RESTful Web Services
(JAX-RS) services. See <a href="#JSON">Chapter 16, "Converting
Objects to and from JSON Documents,"</a></p>
</li>
<li>
<p>RESTful persistence, where Jakarta Persistence API (JPA) entities can
be exposed through standards-based RESTful services such as JAX-RS,
using either JSON or XML media. See
<a href="#RESTJPA">Chapter 19, "Exposing JPA Entities Through
RESTful Data Services."</a></p>
</li>
<li>
<p>Support for TopLink Database Change Notification (DCN), which allows
the database to notify TopLink of database changes so that cached
objects can be invalidated in the shared cache. See
<a href="#QCN">Chapter 20, "Using Database Events to Invalidate
the Cache."</a></p>
</li>
<li>
<p>NoSQL database support, allowing objects to be mapped to
non-relational (NoSQL) data sources. See
<a href="#NOSQL">Chapter 21, "Using EclipseLink with
NoSQL Databases,"</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a complete list of the changes in this release, see
<code><a href="http://www.eclipse.org/eclipselink/releases/2.5.php" class="bare">http://www.eclipse.org/eclipselink/releases/2.5.php</a></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="other-significant-changes-in-this-document-for-12c-12-1-2"><a class="anchor" href="#other-significant-changes-in-this-document-for-12c-12-1-2"></a>Other Significant Changes in this Document for 12c (12.1.2)</h3>
<div class="paragraph">
<p>For this release of EclipseLink, this guide has been updated in several
ways. Following are the sections that have been added or changed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moved installation information from appendix to
<a href="#INSTALL">Chapter 2, "Installing EclipseLink,"</a>.</p>
</li>
<li>
<p>Added new chapter, <a href="#ELJBOSS">Chapter 5, "Using
EclipseLink with JBoss 7 Application Server,"</a> to describe how
EclipseLink can be used with applications deployed to JBoss Application
Server 7.1.</p>
</li>
<li>
<p>Added new chapter, <a href="#ELWS">Chapter 6, "Using
EclipseLink with IBM WebSphere Application Server,"</a> to describe how
EclipseLink can be used with applications deployed to IBM WebSphere
Application Server</p>
</li>
<li>
<p>Added new chapter, <a href="#MIGRATETOPLINK">Chapter 7,
"Migrating from Native TopLink,"</a> to describe migrate applications using
"native" TopLink object-relational mapping (ORM) APIs to the current
EclipseLink APIs.</p>
</li>
<li>
<p>Added information about data partitioning in
<a href="#SCALING">Chapter 10, "Scaling Applications in
Clusters."</a></p>
</li>
<li>
<p>Split <a href="#SAAS">Chapter 11, "Providing Software as a
Service."</a> into four chapters:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#SAAS">Chapter 11, "Providing Software as a
Service."</a> This is now just an overview of the following three chapters.</p>
</li>
<li>
<p><a href="#EXTENSIBLE">Chapter 12, "Making JPA Entities and
JAXB Beans Extensible"</a></p>
</li>
<li>
<p><a href="#METADATASOURCE">Chapter 13, "Using an External
MetaData Source"</a></p>
</li>
<li>
<p><a href="#MULTITENANCY">Chapter 14, "Tenant Isolation Using
EclipseLink"</a> and also updated this chapter with information about
Virtual Private Database (VPD) multi-tenancy and table-per-tenant
multi-tenancy</p>
</li>
</ul>
</div>
</li>
<li>
<p>Added new chapter, <a href="#JSON">Chapter 16, "Converting
Objects to and from JSON Documents,"</a> to describe how to convert objects
directly to and from JSON</p>
</li>
<li>
<p>Added information about weaving to
<a href="#TESTINGJPA">Chapter 17, "Testing JPA Outside a
Container,"</a> to describe how to use the persistence unit JAR file to
test an application outside the container (for instance, in applications
for the Java Platform, Standard Edition (Java SE platform)).</p>
</li>
<li>
<p>Added new chapter, <a href="#RESTJPA">Chapter 19, "Exposing
JPA Entities Through RESTful Data Services,"</a> to describe how to expose
JPA entities through Jakarta Persistence API-RESTful Services (JPA-RS),
using either JSON or XML media.</p>
</li>
<li>
<p>Added new chapter, <a href="#QCN">Chapter 20, "Using Database
Events to Invalidate the Cache,"</a> to describe how to use EclipseLink
Database Change Notification (DCN) for shared caching in a JPA
environment. DCN allows the database to notify EclipseLink of database
changes. The changed objects are invalidated in the EclipseLink shared
cache. Stale data can be discarded, even if other applications access
the same data in the database.</p>
</li>
<li>
<p>Added new chapter, <a href="#ORACLEDB">Chapter 22, "Using
EclipseLink with the Oracle Database,"</a> to describe how to use the
Oracle Database features that are supported by EclipseLink.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="CHDGIDEA"><a class="anchor" href="#CHDGIDEA"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EclipseLink is a powerful and flexible Java persistence framework for
storing Java objects in a data store, such as a relational database or a
NoSQL database, and for converting Java objects to XML or JSON
documents. EclipseLink provides APIs and a run-time environment for
implementing the persistence layer of Java Platform, Standard Edition
(Java SE platform), and Java Platform, Enterprise Edition (Jakarta EE
platform) applications.</p>
</div>
<div class="paragraph">
<p>EclipseLink implements Jakarta Persistence API (JPA), Java Architecture
for XML Binding (JAXB), and other standards-based persistence
technologies and also includes extensions beyond those standards. For
more information about the EclipseLink project, see "Eclipse Persistence
Services Project (EclipseLink) home" at
<code><a href="http://www.eclipse.org/eclipselink/" class="bare">http://www.eclipse.org/eclipselink/</a></code>. For the EclipseLink
Documentation, Center see
<code><a href="http://www.eclipse.org/eclipselink/documentation/" class="bare">http://www.eclipse.org/eclipselink/documentation/</a></code>.</p>
</div>
<div class="sect2">
<h3 id="about-this-guide"><a class="anchor" href="#about-this-guide"></a>About This Guide</h3>
<div class="paragraph">
<p>This guide, <em>Solutions Guide for EclipseLink</em>, documents a number of
scenarios, or use cases, that illustrate EclipseLink features and
typical EclipseLink development processes. These are not tutorials that
lead you step-by-step through every task required to complete a project.
Rather, they document general processes and key details for solving
particular problems and then provide links to other documentation for
more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-you-need-to-know-first"><a class="anchor" href="#what-you-need-to-know-first"></a>What You Need to Know First</h3>
<div class="paragraph">
<p>To make good use of this guide, you should already be familiar with the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The concepts and programming practices of the Java SE platform and the
Jakarta EE platform. In the current release, EclipseLink supports
Jakarta EE 6. For more information, see the following.</p>
<div class="paragraph">
<p><strong>Java</strong>
<strong> Java home page:
<code><a href="http://www.oracle.com/us/technologies/java/index.html" class="bare">http://www.oracle.com/us/technologies/java/index.html</a></code>
</strong> Jakarta EE 5 Tutorial:
<code><a href="http://download.oracle.com/javaee/5/tutorial/doc/bnbpy.html" class="bare">http://download.oracle.com/javaee/5/tutorial/doc/bnbpy.html</a></code>
<strong> Jakarta EE 6 Tutorial:
<code><a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbpy.html" class="bare">http://download.oracle.com/javaee/6/tutorial/doc/bnbpy.html</a></code>
</strong> Any of the thousands of books and websites devoted to Java.</p>
</div>
<div class="paragraph">
<p>+
<strong>Eclipse Integrated Development Environment</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eclipse IDE: <code><a href="http://www.eclipse.org/" class="bare">http://www.eclipse.org/</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>EclipseLink from the Eclipse Foundation</p>
<div class="ulist">
<ul>
<li>
<p>EclipseLink project home: <code><a href="http://wiki.eclipse.org/EclipseLink" class="bare">http://wiki.eclipse.org/EclipseLink</a></code></p>
</li>
<li>
<p>EclipseLink Documentation Center:
<code><a href="https://www.eclipse.org/eclipselink/documentation/" class="bare">https://www.eclipse.org/eclipselink/documentation/</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are working with EclipseLink JPA, you should be familiar with
the concepts and programming practices of JPA 2.2, as specified in the
<em>Jakarta Persistence API, Version 2.2</em> specification at
<code><a href="http://jcp.org/en/jsr/detail?id=338" class="bare">http://jcp.org/en/jsr/detail?id=338</a></code>.</p>
</li>
<li>
<p>If you are working with EclipseLink JAXB, you should be familiar with
the concepts and programming practices of JAXB 2.0, as specified in the
<em>The Java Architecture for XML Binding (JAXB) 2.0</em> specification at
<code><a href="http://jcp.org/en/jsr/detail?id=222" class="bare">http://jcp.org/en/jsr/detail?id=222</a></code>.</p>
</li>
<li>
<p>If you are using JSON data-interchange format, you should be familiar
with the concepts and programming practices of JSON, as described at
<code><a href="http://www.json.org/" class="bare">http://www.json.org/</a></code>. For XML, see <code><a href="http://www.w3.org/XML/" class="bare">http://www.w3.org/XML/</a></code></p>
</li>
<li>
<p>If you are working with EclipseLink MOXy, you should be familiar with
the concepts and programming practices of JAXB 2.0, as specified in the
<em>The Java Architecture for XML Binding (JAXB) 2.0</em> specification at
<code><a href="http://jcp.org/en/jsr/detail?id=222" class="bare">http://jcp.org/en/jsr/detail?id=222</a></code>. If you are using the JavaScript
Object Notation (JSON) data-interchange format, you should be familiar
with the concepts and programming practices of JSON, as described at
<code><a href="http://www.json.org/" class="bare">http://www.json.org/</a></code>. For XML, see <code><a href="http://www.w3.org/XML/" class="bare">http://www.w3.org/XML/</a></code></p>
</li>
<li>
<p>If you are working with EclipseLink DBWS, you should be familiar with
the concepts and programming practices of JAX-WS 2.0, as specified in
the Java <em>API for XML-Based Web Services (JAX-WS) 2.0</em> specification at
<code><a href="http://jcp.org/en/jsr/detail?id=224" class="bare">http://jcp.org/en/jsr/detail?id=224</a></code>.</p>
</li>
<li>
<p>If you are working with REpresentational State Transfer (REST)
service, you should be familiar with concepts and programming practices
of REST, as specified in "JSR 311: JAX-RS: The Java API for RESTful Web
Services" at <code><a href="http://jcp.org/en/jsr/detail?id=311" class="bare">http://jcp.org/en/jsr/detail?id=311</a></code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the-use-cases"><a class="anchor" href="#the-use-cases"></a>The Use Cases</h3>
<div class="paragraph">
<p>The use cases documented in this guide are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#INSTALL">Chapter 2, "Installing EclipseLink"</a> - How
to download and install EclipseLink.</p>
</li>
<li>
<p><a href="#ELWLS">Chapter 3, "Using EclipseLink with WebLogic
Server"</a> - How to use EclipseLink with WebLogic Server.</p>
</li>
<li>
<p><a href="#ELGS">Chapter 4, "Using EclipseLink with GlassFish
Server"</a> - How to use EclipseLink with GlassFish Server.</p>
</li>
<li>
<p><a href="#ELJBOSS">Chapter 5, "Using EclipseLink with JBoss 7
Application Server"</a> - How to use EclipseLink with JBoss 7 Application
Server.</p>
</li>
<li>
<p><a href="#ELWS">Chapter 6, "Using EclipseLink with IBM
WebSphere Application Server"</a> - How to use EclipseLink with IBM
WebSphere Application Server.</p>
</li>
<li>
<p><a href="#MIGRATETOPLINK">Chapter 7, "Migrating from Native
TopLink"</a> - How to how to migrate applications using native EclipseLink
object-relational mapping (ORM) API to the current EclipseLink API.</p>
</li>
<li>
<p><a href="#MIGRATEHIBERNATE">Migrating from Hibernate to EclipseLink</a> -
How to migrate applications from using Hibernate JPA to using
EclipseLink JPA.</p>
</li>
<li>
<p><a href="#USINGMULTIDBS">Chapter 9, "Using Multiple
Databases with a Composite Persistence Unit"</a> - How to expose multiple
persistence units (each with unique sets of entity types) as a single
persistence context.</p>
</li>
<li>
<p><a href="#SCALING">Chapter 10, "Scaling Applications in
Clusters"</a> - How to configure EclipseLink applications to ensure
scalability in clustered application server environments.</p>
</li>
<li>
<p><a href="#SAAS">Chapter 11, "Providing Software as a Service"</a></p>
<div class="ulist">
<ul>
<li>
<p>Overview of EclipseLink Software as a Service (SaaS) features..</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#EXTENSIBLE">Chapter 12, "Making JPA Entities and JAXB
Beans Extensible"</a> - How to make JPA entities or JAXB beans extensible.</p>
</li>
<li>
<p><a href="#METADATASOURCE">Chapter 13, "Using an External
MetaData Source"</a> - How to use an external metadata source.</p>
</li>
<li>
<p><a href="#MULTITENANCY">Chapter 14, "Tenant Isolation Using
EclipseLink"</a> - How to support multiple application tenants who share
data sources, including tables and schemas.</p>
</li>
<li>
<p><a href="#JPA2XML">Chapter 15, "Mapping JPA to XML"</a> - How to
map JPA entities to XML using EclipseLink MOXy.</p>
</li>
<li>
<p><a href="#TESTINGJPA">Chapter 17, "Testing JPA Outside a
Container"</a> - How to test your EclipseLink JPA application outside the
container.</p>
</li>
<li>
<p><a href="#PERFORMANCE">Chapter 18, "Enhancing Performance"</a> -
Getting the best performance out of EclipseLink.</p>
</li>
<li>
<p><a href="#RESTJPA">Chapter 19, "Exposing JPA Entities
Through RESTful Data Services"</a> - How to expose entities through RESTful
services using EclipseLink Jakarta Persistence API for RESTful Services
(JPA-RS).</p>
</li>
<li>
<p><a href="#QCN">Chapter 20, "Using Database Events to Invalidate
the Cache"</a> - How to use EclipseLink Database Change Notification (DCN)
for caching with a shared database in JPA.</p>
</li>
<li>
<p><a href="#NOSQL">Chapter 21, "Using EclipseLink with
NoSQL Databases"</a> - How to use EclipseLink to map objects to
non-relational (that is, no SQL) data sources.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="INSTALL"><a class="anchor" href="#INSTALL"></a>2. Installing EclipseLink</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter tells how to install EclipseLink.</p>
</div>
<div class="paragraph">
<p>EclipseLink is available in several distributions which are installed in
a variety of ways, as described in the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#INSTALL001">Prerequisites</a></p>
</li>
<li>
<p><a href="#INSTALL002">Installing EclipseLink for Java SE and Jakarta EE Development</a></p>
</li>
<li>
<p><a href="#INSTALL003">Installing EclipseLink NoSQL Support</a></p>
</li>
<li>
<p><a href="#INSTALL004">Installing EclipseLink with OSGi Support</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="INSTALL001"><a class="anchor" href="#INSTALL001"></a>Prerequisites</h3>
<div class="paragraph">
<p>EclipseLink requires a Java Virtual Machine (JVM) compatible with JDK
1.6.0 (or higher). EclipseLink also requires internet access to use
URL-based schemas and hosted documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="INSTALL002"><a class="anchor" href="#INSTALL002"></a>Installing EclipseLink for Java SE and Jakarta EE Development</h3>
<div class="paragraph">
<p>Use the following procedures to install EclipseLink for Java SE and EE
development. Before you proceed with the install, it is recommended that
you back up any existing project data.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the following system environment variables before installing
EclipseLink:</p>
<div class="ulist">
<ul>
<li>
<p><code>JAVA_HOME</code> - <code>Set JAVA_HOME</code> to where you installed your Java SDK
home directory. For example:</p>
<div class="ulist">
<ul>
<li>
<p>Windows example: <code>JAVA_HOME = C:\JDK</code></p>
</li>
<li>
<p>UNIX example: <code>JAVA_HOME = &#8230;&#8203;:/usr/java/jdk</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><code>PATH</code> - Set <code>PATH</code> to include <code>JDK/bin</code> directory. For example:</p>
<div class="ulist">
<ul>
<li>
<p>Windows example: <code>PATH = C:\JDK\bin</code></p>
</li>
<li>
<p>UNIX example: <code>PATH = &#8230;&#8203;:/usr/java/jdk/bin</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Download the EclipseLink install archive zip file,
<code>eclipse-`<em>`ver_no`</em></code>.zip`, from the EclipseLink downloads page at
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code></p>
</li>
<li>
<p>Unzip the downloaded file in the desired installation directory. When
you unzip the file, you will find an <code>eclipselink</code> subdirectory,
containing multiple subdirectories. This directory is your new
<em>`ECLIPSELINK_HOME`</em> directory. For example:</p>
<div class="ulist">
<ul>
<li>
<p>Windows example: <em>`ECLIPSELINK_HOME`</em> <code>= &lt;INSTALL_DIR&gt;/eclipselink</code></p>
</li>
<li>
<p>UNIX example: <em>`ECLIPSELINK_HOME`</em>
<code>= &#8230;&#8203;:/usr/el/`<em>`INSTALL_DIR`</em></code>/eclipselink`</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="INSTALL003"><a class="anchor" href="#INSTALL003"></a>Installing EclipseLink NoSQL Support</h3>
<div class="paragraph">
<p>Support for NoSQL databases was introduced in EclipseLink 2.4.</p>
</div>
<div class="paragraph">
<p>To add support for NoSQL databases to EclipseLink, download and install
<code>eclipselink-plugins-nosql-`<em>`ver_no`</em></code>.zip` file from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>. Use this bundle in
conjunction with <code>eclipselink.jar</code> or the EclipseLink JPA bundles.</p>
</div>
<div class="paragraph">
<p>For information about NoSQL support, see
<a href="#NOSQL">Chapter 21, "Using EclipseLink with
NoSQL Databases."</a></p>
</div>
</div>
<div class="sect2">
<h3 id="INSTALL004"><a class="anchor" href="#INSTALL004"></a>Installing EclipseLink with OSGi Support</h3>
<div class="paragraph">
<p>EclipseLink JPA support in OSGi is provided by the Eclipse Gemini JPA
project. For more information, including installation instructions, see
<code><a href="http://wiki.eclipse.org/Gemini/JPA/Documentation" class="bare">http://wiki.eclipse.org/Gemini/JPA/Documentation</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ELWLS"><a class="anchor" href="#ELWLS"></a>3. Using EclipseLink with WebLogic Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use EclipseLink as the persistence
provider for applications deployed to Oracle WebLogic Server.</p>
</div>
<div class="paragraph">
<p>The chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ELWLS001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#ELWLS002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#ELWLS003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>WebLogic Server developers, administrators, and user want to take
advantage of all the persistence and transformation services provided by
EclipseLink.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>While WebLogic Server can use other persistence providers and
EclipseLink can be used with other application servers, using WebLogic
Server with EclipseLink provides a number of advantages.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebLogic Server 12<em>c</em> or later. WebLogic Server includes
EclipseLink.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EclipseLink&#8217;s core functionality is provided by EclipseLink, the open
source persistence framework from the Eclipse Foundation. EclipseLink
implements Jakarta Persistence API (JPA), Java Architecture for XML
Binding (JAXB), and other standards-based persistence technologies, plus
extensions to those standards. EclipseLink includes all of EclipseLink,
plus additional functionality from Oracle.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>A compliant Java Database Connectivity (JDBC) database including
Oracle Database, Oracle Express, MySQL, and so on.</p>
</li>
<li>
<p>While it is not required, you may want to use a Jakarta EE integrated
development environment (IDE) for convenience during development.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Samples</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink samples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/WebLogic_Web_Tutorial" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/WebLogic_Web_Tutorial</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/WLS_AppScoped_DataSource" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/WLS_AppScoped_DataSource</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/Distributed" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/Distributed</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ELWLS001"><a class="anchor" href="#ELWLS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>WebLogic Server is a scalable, enterprise-ready Java Platform,
Enterprise Edition (Jakarta EE platform) application server. WebLogic
Server&#8217;s complete implementation of the Jakarta EE 6 specification
provides a standard set of APIs for creating distributed Java
applications that can access a wide variety of services, such as
databases, messaging services, and connections to external enterprise
systems. In addition to the Jakarta EE implementation, WebLogic Server
enables enterprises to deploy critical applications in a robust, secure,
highly available, and scalable environment. These features allow
enterprises to configure clusters of WebLogic Server instances to
distribute load, and provide extra capacity in case of hardware or other
failures. For more details about these and other WebLogic Server
features, see <em>Introduction to WebLogic Server</em>.</p>
</div>
<div class="paragraph">
<p>EclipseLink provides APIs and a run-time environment for implementing
the persistence layer of Jakarta EE applications (as well as Java SE
applications).</p>
</div>
<div class="sect3">
<h4 id="advantages-to-using-eclipselink-with-weblogic-server"><a class="anchor" href="#advantages-to-using-eclipselink-with-weblogic-server"></a>Advantages to Using EclipseLink with WebLogic Server</h4>
<div class="paragraph">
<p>While WebLogic Server can use other persistence providers and
EclipseLink can be used with other application servers, using WebLogic
Server with EclipseLink provides a number of advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink is the default persistence provider for WebLogic Server
domains, with support for JPA 2.1.</p>
</li>
<li>
<p>The EclipseLink implementation of Java Architecture for XML Binding
(JAXB) is the default JAXB implementation in WebLogic Server.
EclipseLink fully implements JAXB and also includes other advanced
features. By default, you can take advantage of EclipseLink JAXB in Java
API for XML Web Services (JAX-WS) and Java API for RESTful Web Services
(JAX-RS) applications.</p>
</li>
<li>
<p>EclipseLink logging integration in WebLogic Server provides a
comprehensive, integrated logging infrastructure. See
<a href="#BABIIEHD">Task 4: Use or Reconfigure the Logging
Integration.</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="data:image/png;base64,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" alt="Description of Figure 3-2 follows" title="Description of Figure 3-2 follows"></span><br>
<a href="img_text/wls_el_stack.html">Description of "Figure 3-2 WebLogic Server, EclipseLink, Coherence and
TopLink Grid integration"</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELWLS002"><a class="anchor" href="#ELWLS002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>To run EclipseLink JPA applications in WebLogic Server, you must
configure WebLogic Server and coordinate certain settings in it and in
your application, as described in the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABJHCFG">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#BABJDGGE">Task 3: Configure JMX MBean Extensions in WebLogic Server</a></p>
</li>
<li>
<p><a href="#BABIIEHD">Task 4: Use or Reconfigure the Logging Integration</a></p>
</li>
<li>
<p><a href="#BABJEFBD">Task 5: Add Persistence to Your Java Application Using EclipseLink</a></p>
</li>
<li>
<p><a href="#BABEEIFH">Task 6: Configure a Data Source</a></p>
</li>
<li>
<p><a href="#BABHICHE">Task 7: Extend the Domain to Use Advanced Oracle Database Features</a></p>
</li>
<li>
<p><a href="#BABICGHA">Task 8: Start WebLogic Server and Deploy the Application</a></p>
</li>
<li>
<p><a href="#BABEEJDE">Task 9: Run the Application</a></p>
</li>
<li>
<p><a href="#BABIJAAD">Task 10: Configure and Monitor Persistence Settings in WebLogic Server</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BABJHCFG"><a class="anchor" href="#BABJHCFG"></a>Task 1: Prerequisites</h4>
<div class="paragraph">
<p>This document is based on the following products and tools, although the
principles apply to any supported database or development environment.
It is assumed that the software is already installed, except where noted
in later sections.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebLogic Server 12<em>c</em> or later.</p>
<div class="paragraph">
<p>For more information and downloads, see
<code><a href="http://www.oracle.com/technetwork/middleware/weblogic/overview/index.html" class="bare">http://www.oracle.com/technetwork/middleware/weblogic/overview/index.html</a></code>
on the Oracle Technology Network.</p>
</div>
</li>
<li>
<p>Any compliant Java Database Connectivity (JDBC) database including
Oracle Database, Oracle Express, MySQL, and so on.</p>
<div class="paragraph">
<p>For Oracle Database, see
<code><a href="http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html</a></code>.
For Oracle Database, Express Edition, see
<code><a href="http://www.oracle.com/technetwork/database/express-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/express-edition/overview/index.html</a></code>.
For MySQL, see <code><a href="http://www.oracle.com/us/products/mysql/index.html" class="bare">http://www.oracle.com/us/products/mysql/index.html</a></code>.</p>
</div>
</li>
<li>
<p>While it is not required, you may want to use a Java development
environment (IDE) for convenience during development. For example
JDeveloper, Oracle Enterprise Pack for Eclipse, and NetBeans all provide
sophisticated Jakarta EE development tools. Both JDeveloper and Oracle
Enterprise Pack for Eclipse include embedded versions of WebLogic
Server, although this guide describes a standalone instance of WebLogic
Server.</p>
<div class="paragraph">
<p>For JDeveloper, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html</a></code>.
For Oracle Enterprise Pack for Eclipse, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html</a></code>.
For NetBeans, see <code><a href="http://www.oracle.com/us/products/tools/050845.html" class="bare">http://www.oracle.com/us/products/tools/050845.html</a></code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="BABJDGGE"><a class="anchor" href="#BABJDGGE"></a>Task 3: Configure JMX MBean Extensions in WebLogic Server</h4>
<div class="paragraph">
<p>WebLogic Server uses Java Management Extensions (JMX) MBeans to
configure, monitor, and manage WebLogic Server resources. For
EclipseLink applications, MBeans are used to monitor and configure
aspects of persistence units and are also used for logging.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When deployed to WebLogic Server, EclipseLink applications deploy MBeans
when they connect to the database, not at deployment time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about how MBeans are used in WebLogic Server, see
<em>Oracle Fusion Middleware Developing Custom Management Utilities With
JMX for Oracle WebLogic Server</em> and <em>Oracle Fusion Middleware Developing
Manageable Applications With JMX for Oracle WebLogic Server</em>.</p>
</div>
<div class="paragraph">
<p>For information about EclipseLink logging in WebLogic Server, see
<a href="#BABIIEHD">Task 4: Use or Reconfigure the Logging Integration.</a></p>
</div>
<div class="paragraph">
<p>By default, when you deploy an EclipseLink application to WebLogic
Server, the EclipseLink runtime deploys the following JMX MBeans to the
WebLogic Server JMX service for each EclipseLink session:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.eclipse.persistence.services.DevelopmentServices</code> - This class
provides facilities for managing an EclipseLink session internal to
EclipseLink over JMX.</p>
</li>
<li>
<p><code>org.eclipse.persistence.services.RuntimeServices</code> - This class
provides facilities for managing an EclipseLink session external to
EclipseLink over JMX.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Use the API that this JMX MBean exposes to access and configure your
EclipseLink sessions at runtime, using JMX code that you write, or to
integrate your EclipseLink application with a third-party JMX management
application, such as JConsole.</p>
</div>
<div class="paragraph">
<p>To find out how to access information about custom MBeans, you must
first enable anonymous lookup and then use a separate tool to access the
MBean information.</p>
</div>
<div class="paragraph">
<p>To enable anonymous lookup in the WebLogic Server Administration
Console, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, in the Change Center of the
Administration Console, click <strong>Lock &amp; Edit</strong>.</p>
</li>
<li>
<p>In the left pane, select your domain to open the Settings page for
your domain.</p>
</li>
<li>
<p>Expand <strong>Security &gt; General</strong>.</p>
</li>
<li>
<p>Select <strong>Anonymous Admin Lookup Enabled</strong>.</p>
</li>
<li>
<p>To activate these changes, in the Change Center of the Administration
Console, click <strong>Activate Changes</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For the information about accessing the MBean information using various
tools, see "Accessing Custom MBeans," in <em>Oracle Fusion Middleware
Developing Manageable Applications With JMX for Oracle WebLogic Server</em>.</p>
</div>
<div class="paragraph">
<p>For information about monitoring custom MBeans in the Administration
Console, see "Monitor Custom MBeans" in <em>Oracle Fusion Middleware Oracle
WebLogic Server Administration Console Online Help</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BABIIEHD"><a class="anchor" href="#BABIIEHD"></a>Task 4: Use or Reconfigure the Logging Integration</h4>
<div class="paragraph">
<p>By default, EclipseLink logging is integrated into the WebLogic Server
logging infrastructure. Details about how the integration works and how
to override it are described in the following sections. For detailed
information about WebLogic Server logging, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Oracle Fusion Middleware Using Logging Services for Application
Logging for Oracle WebLogic Server</em></p>
</li>
<li>
<p><em>Oracle Fusion Middleware Configuring Log Files and Filtering Log
Messages for Oracle WebLogic Server</em></p>
</li>
<li>
<p>The logging topics in <em>Oracle Fusion Middleware Oracle WebLogic Server
Administration Console Online Help</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about configuring logging for JPA persistence units, see
"How to Configure Logging" in the EclipseLink documentation at
<code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Logging" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Logging</a></code>.</p>
</div>
<div class="sect4">
<h5 id="how-the-logging-integration-works"><a class="anchor" href="#how-the-logging-integration-works"></a>How the Logging Integration Works</h5>
<div class="paragraph">
<p>By default, the WebLogic Server logging implementation is injected into
the persistence context, which results in all EclipseLink logging
messages being produced according to the WebLogic Server logging
configuration.</p>
</div>
<div class="paragraph">
<p>As a result of this integration, EclipseLink logging levels are
converted to WebLogic Server logging levels as shown in
<a href="#BABCAIDJ">Table 3-1</a>.</p>
</div>
<div id="BABCAIDJ" class="paragraph">
<p><strong><em>Table 3-1 Mapping of EclipseLink Logging Levels to WebLogic Server
Logging Levels</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EclipseLink Logging Levels</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WebLogic Server Logging Levels</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL, FINEST, FINER, FINE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEBUG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTICE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SEVERE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALERT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>WebLogic Server logging levels are mapped to EclipseLink levels as shown
in <a href="#BABHEBHF">Table 3-2</a>.</p>
</div>
<div id="BABHEBHF" class="paragraph">
<p><strong><em>Table 3-2 Mapping of WebLogic Server Logging Levels to EclipseLink
Logging Levels</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WebLogic Server Logging Levels</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EclipseLink Logging Levels</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRACE, DEBUG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FINEST</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CONFIG</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTICE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INFO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WARNING</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ERROR, CRITICAL, ALERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SEVERE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EMERGENCY, OFF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OFF</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="viewing-persistence-unit-logging-levels-in-the-administration-console"><a class="anchor" href="#viewing-persistence-unit-logging-levels-in-the-administration-console"></a>Viewing Persistence Unit Logging Levels in the Administration Console</h5>
<div class="paragraph">
<p>You can see the EclipseLink logging level defined for the persistence
unit in the Administration Console, as described in <a href="#BABIJAAD">Task
10: Configure and Monitor Persistence Settings in WebLogic Server.</a>
However, be aware that this logging level, set in the <code>persistence.xml</code>
file, is overridden when the default WebLogic Server and EclipseLink
logging integration is used. For information about overriding the
integration, see <a href="#TLADG128">Overriding the Default Logging
Integration.</a></p>
</div>
<div class="paragraph">
<p>When the default integration is used, the Enterprise JavaBeans (EJB)
logging options for persistence are mapped through and control
EclipseLink&#8217;s logging output in the Administration Console.</p>
</div>
</div>
<div class="sect4">
<h5 id="TLADG128"><a class="anchor" href="#TLADG128"></a>Overriding the Default Logging Integration</h5>
<div class="paragraph">
<p>You set EclipseLink logging levels in the <code>persistence.xml</code> file.
However, when you accept the default logging integration with WebLogic
Server, those settings are ignored, and the logging configuration set in
WebLogic Server is used. The EclipseLink logging levels are used only
when you use the native EclipseLink logging implementation.</p>
</div>
<div class="paragraph">
<p>You can override the default logging integration by setting the
<code>eclipselink.logging.logger</code> property name to a different setting. For
example, to enable the default EclipseLink logging, set the
<code>eclipselink.logging.logger</code> property as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.logging.logger" value="DefaultLogger"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use a different logging implementation for EclipseLink
messages, for example the <code>java.util.logging</code> package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.logging.logger" value="JavaLogger"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BABFGGFE"><a class="anchor" href="#BABFGGFE"></a>Configuring WebLogic Server to Expose EclipseLink Logging</h5>
<div class="paragraph">
<p>If you use the native EclipseLink logging implementation, you can still
display EclipseLink logging messages in the WebLogic Server domain&#8217;s log
files by configuring WebLogic Server to redirect Java Virtual Machine
(JVM) output to the registered log destinations.</p>
</div>
<div class="paragraph">
<p>For more information and instructions for redirecting, see "Redirecting
JVM Output" in <em>Oracle Fusion Middleware Configuring Log Files and
Filtering Log Messages for Oracle WebLogic Server</em>. To set this option
in the Administration Console, see "Redirect JVM output" in <em>Oracle
Fusion Middleware Oracle WebLogic Server Administration Console Online
Help</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="BABCAEDA"><a class="anchor" href="#BABCAEDA"></a>Other Considerations</h5>
<div class="paragraph">
<p>Other things to consider include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The message ID <code>2005000</code> is used for all EclipseLink log messages.</p>
</li>
<li>
<p>Some logging messages handled by the WebLogic Server integrated logger
may show up in the WebLogic Server console or the server log (depending
on the settings of logging levels) during deployment, even though at
runtime the application&#8217;s entity manager factory will use only the
EclipseLink logging infrastructure and only the EclipseLink logging
settings.</p>
</li>
<li>
<p>If you use a different release of EclipseLink than the release bundled
in your WebLogic Server installation (by using a filtering class
loader), then trying to use the default integrated logging can lead to
errors, due to classloading conflicts. To work around this issue,
explicitly set the <code>eclipselink.logging.logger</code> property to something
other than the integrated WebLogic Server logger.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABJEFBD"><a class="anchor" href="#BABJEFBD"></a>Task 5: Add Persistence to Your Java Application Using EclipseLink</h4>
<div class="paragraph">
<p>Using EclipseLink JPA to provide persistence for an application is the
fundamental task presumed by all the other tasks described in this
chapter; yet the actual JPA programming practice is mostly outside the
scope of this guide. WebLogic Server imposes no special requirements on
your EclipseLink application, other than the details described in this
chapter.</p>
</div>
<div class="paragraph">
<p>This chapter describes features, settings, and tasks that are specific
to using EclipseLink (runtime and API) with WebLogic Server. For
information about developing, packaging, and deploying a Java
application using JPA, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The EclipseLink project wiki at <code><a href="http://wiki.eclipse.org/EclipseLink" class="bare">http://wiki.eclipse.org/EclipseLink</a></code></p>
</li>
<li>
<p>The EclipseLink Documentation Center at
<code><a href="https://www.eclipse.org/eclipselink/documentation/" class="bare">https://www.eclipse.org/eclipselink/documentation/</a></code></p>
</li>
<li>
<p>The <em>Jakarta Persistence API, Version 2.1</em> specification at
<code><a href="http://jcp.org/en/jsr/detail?id=317" class="bare">http://jcp.org/en/jsr/detail?id=317</a></code></p>
</li>
<li>
<p>"Part V, Persistence" in "The Jakarta EE 6 Tutorial" at
<code><a href="http://download.oracle.com/javaee/6/tutorial/doc/bnbpy.html" class="bare">http://download.oracle.com/javaee/6/tutorial/doc/bnbpy.html</a></code></p>
</li>
<li>
<p>Any third-party book that describes programming Java applications
using JPA</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about EclipseLink features and concepts, see
<a href="#CHDGIDEA">Chapter 1, "Introduction"</a> and <em>EclipseLink
Concepts</em>.</p>
</div>
<div class="paragraph">
<p>For related WebLogic Server programming topics, see any book in the
WebLogic Server documentation set, in particular the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Oracle Fusion Middleware Programming Enterprise JavaBeans, Version
3.0, for Oracle WebLogic Server</em></p>
</li>
<li>
<p><em>Oracle Fusion Middleware Developing Applications for Oracle WebLogic
Server</em></p>
</li>
<li>
<p><em>Oracle Fusion Middleware Deploying Applications to Oracle WebLogic
Server</em></p>
</li>
<li>
<p><em>Oracle Fusion Middleware Programming JDBC for Oracle WebLogic Server</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="BABEEIFH"><a class="anchor" href="#BABEEIFH"></a>Task 6: Configure a Data Source</h4>
<div class="paragraph">
<p>In WebLogic Server, you configure database connectivity by adding JDBC
data sources to WebLogic Server domains. Each WebLogic data source
contains a pool of database connections. Applications look up the data
source on the Java Naming and Directory Interface (JNDI) tree or in the
local application context and then reserve a database connection with
the <code>getConnection()</code> method. Data sources and their connection pools
provide connection management processes to keep the system running
efficiently.</p>
</div>
<div class="paragraph">
<p>For information about using JDBC with WebLogic Server, see the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For complete documentation about working with JDBC in WebLogic Server,
see <em>Oracle Fusion Middleware Configuring and Managing JDBC Data Sources
for Oracle WebLogic Server</em>, in particular:</p>
<div class="ulist">
<ul>
<li>
<p>"Configuring WebLogic JDBC Resources"</p>
</li>
<li>
<p>"Configuring JDBC Data Sources"</p>
</li>
</ul>
</div>
</li>
<li>
<p>For information about working with JDBC data sources in the WebLogic
Server Administration Console, see the topics under "Configure JDBC" in
<em>Oracle Fusion Middleware Oracle WebLogic Server Administration Console
Online Help</em>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ways-to-configure-data-sources-for-jpa-applications"><a class="anchor" href="#ways-to-configure-data-sources-for-jpa-applications"></a>Ways to Configure Data Sources for JPA Applications</h5>
<div class="paragraph">
<p>You can configure data sources for JPA applications deployed to WebLogic
Server in a variety of ways, including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABEHDCG">Configure a Globally Scoped JTA Data Source</a></p>
</li>
<li>
<p><a href="#BABFIHAE">Configure an Application-Scoped JTA Data Source</a></p>
</li>
<li>
<p><a href="#BABCGGEJ">Configure a non-JTA Data Source and Manage Transactions in the Application</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="BABEHDCG"><a class="anchor" href="#BABEHDCG"></a>Configure a Globally Scoped JTA Data Source</h5>
<div class="paragraph">
<p>The most common data source configuration is a globally-scoped JNDI data
source, using Java Transaction API (JTA) for transaction management,
specified in the <code>persistence.xml</code> file. Configuration is
straightforward, as shown in the following steps, and multiple
applications can access the data source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABHCDIG">Create the Data Source in WebLogic Server</a></p>
</li>
<li>
<p><a href="#BABBHEBJ">Configure the persistence.xml File</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="BABHCDIG"><a class="anchor" href="#BABHCDIG"></a>Create the Data Source in WebLogic Server</h6>
<div class="paragraph">
<p>To set up a globally scoped JNDI data source in the WebLogic Server
Administration Console, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new data source, as described in "Configure JDBC generic data
sources" in <em>Oracle Fusion Middleware Oracle WebLogic Server
Administration Console Online Help</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EclipseLink is compatible with any WebLogic Server data source that can
be accessed using standard JNDI data source lookup by name. These
instructions describe the wizard for a generic data source.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter values in the Create a New JDBC data source wizard, according to
your requirements. For more information, see "Create a JDBC Data Source"
in <em>Oracle Fusion Middleware Oracle WebLogic Server Administration
Console Online Help</em>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The value used for <strong>JNDI Name</strong> (on the JDBC Datasource Properties page
must be the same as the value used for the <code>&lt;jta-data-source&gt;</code> element
in the <code>persistence.xml</code> file.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure connection pools, as described in "Configuring Connection
Pool Features" in <em>Oracle Fusion Middleware Configuring and Managing
JDBC Data Sources for Oracle WebLogic Server</em>. The connection pool
configuration can affect EclipseLink&#8217;s ability to handle concurrent
requests from the application. Properties should be tuned in the same
way any connection pool would be tuned to optimize resources and
application responsiveness.</p>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="BABBHEBJ"><a class="anchor" href="#BABBHEBJ"></a>Configure the persistence.xml File</h6>
<div class="paragraph">
<p>In the <code>persistence.xml</code> file, specify that <code>transaction-type</code> is <code>JTA</code>,
and provide the name of the data source in the <code>jta-data-source</code> element
(prefaced by <code>jdbc/</code> or not), as shown in <a href="#BABCFFHC">Example 3-1</a>:</p>
</div>
<div id="BABCFFHC" class="paragraph">
<p><strong><em>Example 3-1 persistence.xml File With JNDI Data Source Using JTA</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
  &lt;persistence-unit name="example" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;JDBC Data Source-1&lt;/jta-data-source&gt;
    &lt;class&gt;org.eclipse.persistence.example.jpa.server.business.Cell&lt;/class&gt;
    &lt;class&gt;org.eclipse.persistence.example.jpa.server.business.CellAttribute&lt;/class&gt;
  &lt;/persistence-unit&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BABFIHAE"><a class="anchor" href="#BABFIHAE"></a>Configure an Application-Scoped JTA Data Source</h5>
<div class="paragraph">
<p>To configure an application-scoped data source that uses JTA for
transaction management, perform the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#BABDBBAE">"Specify that the Data Source Is Application-Scoped"</a></p>
</li>
<li>
<p><a href="#BABCGDDA">"Add the JDBC Module to the WebLogic Server Application Configuration"</a></p>
</li>
<li>
<p><a href="#BABHFJED">"Configure the JPA Persistence Unit to Use the JTA Data Source"</a></p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="BABDBBAE"><a class="anchor" href="#BABDBBAE"></a>Specify that the Data Source Is Application-Scoped</h6>
<div class="paragraph">
<p>To define an application-scoped data source, create a
<em>`name`</em>`-jdbc.xml` JDBC module file and place it in the <code>META-INF</code>
folder of the application&#8217;s EAR file. In that file, add
<code>&lt;scope&gt;Application&lt;/scope&gt;</code> to the <code>jdbc-data-source-params</code> section,
as shown in <a href="#BABDAEFC">Example 3-2</a>.</p>
</div>
<div id="BABDAEFC" class="paragraph">
<p><strong><em>Example 3-2 JDBC Data Source Defined in the _name</em>-jdbc.xml File_</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;jdbc-data-source ...&gt;
...
  &lt;jdbc-data-source-params&gt;
    &lt;jndi-name&gt;SimpleAppScopedDS&lt;/jndi-name&gt;
    &lt;scope&gt;Application&lt;/scope&gt;
  &lt;/jdbc-data-source-params&gt;
&lt;/jdbc-data-source&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can create the framework for the a <em>`name`</em>`-jdbc.xml` file by
creating a globally scoped data source from the WebLogic Server
Administration Console, as described in <a href="#BABEHDCG">Configure a
Globally Scoped JTA Data Source,</a> with these differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not associate the data source with a server.</p>
</li>
<li>
<p>Add the <code>&lt;scope&gt;</code> element manually.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about JDBC module configuration files and
<code>jdbc-data-source</code> (including <code>&lt;jdbc-driver-params&gt;</code> and
<code>&lt;jdbc-connection-pool-params&gt;</code>), see "Configuring WebLogic JDBC
Resources" in <em>Oracle Fusion Middleware Configuring and Managing JDBC
Data Sources for Oracle WebLogic Server</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="BABCGDDA"><a class="anchor" href="#BABCGDDA"></a>Add the JDBC Module to the WebLogic Server Application Configuration</h6>
<div class="paragraph">
<p>Add a reference to the JDBC module in the
<code>/META-INF/weblogic-application.xml</code> application deployment descriptor
in the EAR file, as shown in <a href="#BABCJEDI">Example 3-3</a>. This registers
the data source for use in the application.</p>
</div>
<div id="BABCJEDI" class="paragraph">
<p><strong><em>Example 3-3 JDBC Module Defined in the weblogic-application.xml File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;wls:module&gt;
  &lt;wls:name&gt;SimpleAppScopedDS&lt;/wls:name&gt;
  &lt;wls:type&gt;JDBC&lt;/wls:type&gt;
  &lt;wls:path&gt;META-INF/simple-jdbc.xml&lt;/wls:path&gt;
&lt;/wls:module&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about <code>weblogic-application.xml</code> application
deployment descriptors, see "Understanding Application Deployment
Descriptors" in <em>Oracle Fusion Middleware Deploying Applications to
Oracle WebLogic Server</em> and "Enterprise Application Deployment
Descriptor Elements" in <em>Oracle Fusion Middleware Developing
Applications for Oracle WebLogic Server</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="BABHFJED"><a class="anchor" href="#BABHFJED"></a>Configure the JPA Persistence Unit to Use the JTA Data Source</h6>
<div class="paragraph">
<p>To make it possible for EclipseLink runtime to lazily look up an
application-scoped data source, you must specify an additional data
source property in the definition of the persistence unit in the
<code>persistence.xml</code> file. For a JTA data source, add a fully qualified
<code>jakarta.persistence.jtaDataSource</code> property, with the value
`java:/app/jdbc/`<em>`data_source_name`</em>, as shown in
<a href="#BABFIHHE">Example 3-4</a>.</p>
</div>
<div class="paragraph">
<p>The values of the <code>&lt;jta-data-source&gt;</code> and
<code>&lt;jakarta.persistence.jtaDataSource&gt;</code> properties must match.</p>
</div>
<div id="BABFIHHE" class="paragraph">
<p><strong><em>Example 3-4 JTA Data Source Definition in the persistence.xml File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="windows-1252" ?&gt;
&lt;persistence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"
  version="1.0" xmlns="http://java.sun.com/xml/ns/persistence"&gt;
  &lt;persistence-unit name="employee" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;java:/app/jdbc/SimpleAppScopedDS&lt;/jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="jakarta.persistence.jtaDataSource"
          value="java:/app/jdbc/SimpleAppScopedDS" /&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BABCGGEJ"><a class="anchor" href="#BABCGGEJ"></a>Configure a non-JTA Data Source and Manage Transactions in the Application</h5>
<div class="paragraph">
<p>To configure a non-JTA data source managed by the application, follow
the procedures described in <a href="#BABFIHAE">Configure an
Application-Scoped JTA Data Source,</a> but configure the JPA persistence
unit to use a non-JTA data source by specifying a not-JTA data source,
as shown in <a href="#BABHFADF">Example 3-5</a>.</p>
</div>
<div id="BABHFADF" class="paragraph">
<p><strong><em>Example 3-5 non-JTA Data Source Definition in the persistence.xml
File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="windows-1252" ?&gt;
&lt;persistence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"
  version="1.0" xmlns="http://java.sun.com/xml/ns/persistence"&gt;
  &lt;persistence-unit name="employee" transaction-type="RESOURCE_LOCAL"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;non-jta-data-source&gt;OracleDS&lt;/non-jta-data-source&gt;
    &lt;properties&gt;
      &lt;property name="jakarta.persistence.nonJtaDataSource"
          value="OracleDS" /&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Write the code in your application to handle the transactions as
described, for example, in "Transactions in EJB Applications" in <em>Oracle
Fusion Middleware Programming JTA for Oracle WebLogic Server</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="ensure-the-settings-match"><a class="anchor" href="#ensure-the-settings-match"></a>Ensure the Settings Match</h5>
<div class="paragraph">
<p>Certain settings in the data source configuration must match certain
settings in the application&#8217;s <code>ejbModule/META-INF/persistence.xml</code> file.
For the data source configuration in WebLogic Server, you can check the
settings in the configuration files or in the Administration Console.</p>
</div>
<div class="paragraph">
<p>In the Administration Console, review the settings as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Domain Structure</strong> tree, expand <strong>Services</strong>, then select <strong>Data
Sources</strong>.</p>
</li>
<li>
<p>On the Summary of JDBC Data Sources page, click the name of the data
source.</p>
</li>
<li>
<p>On the <strong>Settings for</strong> <strong><em>data_source_name</em></strong> <strong>&gt; Configuration &gt; General</strong>
page, find the value for <strong>JNDI Name</strong>, for example <strong>localDS</strong>. If you are
using JTA, then the name must match <code>&lt;jta-data-source&gt;</code> in the
<code>persistence.xml</code> file.</p>
</li>
<li>
<p>On the <strong>Settings for</strong> <strong><em>data_source_name</em></strong> <strong>&gt; Configuration &gt;
Connection Pool</strong> page, review these settings:</p>
<div class="ulist">
<ul>
<li>
<p>The value for <strong>URL</strong> must match the <code>jakarta.persistence.jdbc.url</code>
value in the <code>persistence.xml</code> file, for example,
<code>jdbc:oracle:thin:@127.0.0.1:1521:XE</code>.</p>
</li>
<li>
<p>The value for <strong>Driver Class Name</strong> must match the
<code>jakarta.persistence.jdbc.driver</code> value in the <code>persistence.xml</code> file,
for example (for a JTA data source),
<code>oracle.jdbc.xa.client.OracleXADataSource</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><a href="#CHDDDDIE">Example 3-6</a> shows the values that must be shared in the
domain&#8217;s <code>config.xml</code> file and the application&#8217;s <code>persistence.xml</code> file.</p>
</div>
<div id="CHDDDDIE" class="paragraph">
<p><strong><em>Example 3-6 Server Domain config.xml File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;domain...&gt;
  &lt;jdbc-system-resource&gt;
    &lt;name&gt;localJTA&lt;/name&gt;
    &lt;target&gt;AdminServer,ManagedServer_1,ManagedServer_2&lt;/target&gt;
    &lt;descriptor-file-name&gt;jdbc/localJTA-4636-jdbc.xml&lt;/descriptor-file-name&gt;
  &lt;/jdbc-system-resource&gt;
&lt;/domain&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABHICHE"><a class="anchor" href="#BABHICHE"></a>Task 7: Extend the Domain to Use Advanced Oracle Database Features</h4>
<div class="paragraph">
<p>To fully support Oracle Spatial and Oracle XDB mapping capabilities (in
both standalone WebLogic Server and the JDeveloper Integrated WebLogic
Server), you must use the <code>toplink-spatial-template.jar</code> file and the
<code>toplink-xdb-template.jar</code> file to extend the WebLogic Server domain to
support Oracle Spatial and Oracle XDB, respectively.</p>
</div>
<div class="paragraph">
<p>To extend your WebLogic Server domain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the <code>toplink-spatial-template.jar</code> (to support Oracle
Spatial) and <code>toplink-xdb-template.jar</code> (to support Oracle XDB) files
from:</p>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://download.oracle.com/otn/java/toplink/111110/toplink-spatial-template.jar" class="bare">http://download.oracle.com/otn/java/toplink/111110/toplink-spatial-template.jar</a></code></p>
</li>
<li>
<p><code><a href="http://download.oracle.com/otn/java/toplink/111110/toplink-xdb-template.jar" class="bare">http://download.oracle.com/otn/java/toplink/111110/toplink-xdb-template.jar</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Copy the files, as shown in <a href="#BABGIJJJ">Table 3-3</a> and
<a href="#BABGEIFF">Table 3-4</a>.</p>
<div id="BABGIJJJ" class="paragraph">
<p><strong><em>Table 3-3 File to Support Oracle Spatial</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>File</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>From&#8230;&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>To&#8230;&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sdoapi.jar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`ORACLE_DATABASE_HOME`</em>`/md/jlib`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`WL_HOME`</em>`/server/lib`</p></td>
</tr>
</tbody>
</table>
<div id="BABGEIFF" class="paragraph">
<p><strong><em>Table 3-4 Files to Support Oracle XDB</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>File</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>From&#8230;&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>To&#8230;&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xdb.jar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`ORACLE_DATABASE_HOME`</em>`/rdbms/jlib`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`WL_HOME`</em>`/server/lib`</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xml.jar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`ORACLE_DATABASE_HOME`</em>`/lib`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`WL_HOME`</em>`/server/lib`</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xmlparserv2.jar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`ORACLE_DATABASE_HOME`</em>`/lib`</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>`WL_HOME`</em>`/server/lib`</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Start the Config wizard (<em>`WL_HOME`</em>`/common/bin/config.sh` (or
<code>.bat</code>)).</p>
</li>
<li>
<p>Select <strong>Extend an existing WebLogic domain</strong>.</p>
</li>
<li>
<p>Browse and select your WebLogic Server domain.</p>
</li>
<li>
<p>Select <strong>Extend my domain using an existing extension template</strong>.</p>
</li>
<li>
<p>Browse and select the required template JAR file
(<code>toplink-spatial-template.jar</code> for Oracle Spatial,
<code>toplink-xdb-template.jar</code> for Oracle XDB).</p>
</li>
<li>
<p>Complete the remaining pages of the wizard.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For information about using WebLogic Server domain templates, see
<em>Oracle Fusion Middleware Domain Template Reference</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BABICGHA"><a class="anchor" href="#BABICGHA"></a>Task 8: Start WebLogic Server and Deploy the Application</h4>
<div class="paragraph">
<p>For information about deploying to WebLogic Server, see <em>Oracle Fusion
Middleware Deploying Applications to Oracle WebLogic Server</em>. See also
"Deploying Fusion Web Applications" in <em>Oracle Fusion Middleware Fusion
Developer&#8217;s Guide for Oracle Application Development Framework</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BABEEJDE"><a class="anchor" href="#BABEEJDE"></a>Task 9: Run the Application</h4>
<div class="paragraph">
<p>For instructions for starting a deployed application from the WebLogic
Server Administration Console, see "Start and stop a deployed Enterprise
application" in <em>Oracle Fusion Middleware Oracle WebLogic Server
Administration Console Online Help</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BABIJAAD"><a class="anchor" href="#BABIJAAD"></a>Task 10: Configure and Monitor Persistence Settings in WebLogic Server</h4>
<div class="paragraph">
<p>In the WebLogic Server Administration Console, you can configure a
persistence unit and configure JTA and non-JTA data sources of a
persistence unit, as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done so, in the Change Center of the
Administration Console, click <strong>Lock &amp; Edit</strong>.</p>
</li>
<li>
<p>In the left pane of the Administration Console, select <strong>Deployments</strong>.</p>
</li>
<li>
<p>In the right pane, select the application or module you want to
configure.</p>
</li>
<li>
<p>Select <strong>Configuration</strong>.</p>
</li>
<li>
<p>Select <strong>Persistence</strong>.</p>
</li>
<li>
<p>Select the persistence unit that you want to configure from the table.</p>
</li>
<li>
<p>Review and edit properties on the configuration pages. For help on any
page, click the <strong>Help</strong> link at the top of the Administration Console.</p>
<div class="paragraph">
<p>Properties that can be viewed include:
* Name
* Provider
* Description
* Transaction type
* Data cache time out
* Fetch batch size
* Default schema name
* Values of persistence unit properties defined in the <code>persistence.xml</code>
file, for example, <code>eclipselink.session-name</code>,
<code>eclipselink.logging.level</code>, and <code>eclipselink.target-server</code>.
You can also set attributes related to the transactional and
non-transactional data sources of a persistence unit, on the Data
Sources configuration page.</p>
</div>
</li>
<li>
<p>To activate these changes, in the Change Center of the Administration
Console, click <strong>Activate Changes</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For links to other help topics about working with persistence in the
Administration Console, search for "Persistence" in the Table of
Contents of <em>Oracle Fusion Middleware Oracle WebLogic Server
Administration Console Online Help</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELWLS003"><a class="anchor" href="#ELWLS003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uni<a href="wlshome">Oracle WebLogic Server documentation</a></p>
</li>
<li>
<p><em>Java API Reference for EclipseLink</em>, including:</p>
<div class="ulist">
<ul>
<li>
<p><code>org.eclipse.persistence</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.jpa.PersistenceProvider</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.services.mbean</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ELGS"><a class="anchor" href="#ELGS"></a>4. Using EclipseLink with GlassFish Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use EclipseLink as the persistence
provider for applications deployed to Oracle GlassFish Server.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ELGS001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#ELGS002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#ELGS003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to run applications that employ JPA on Oracle GlassFish
Server.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The Oracle GlassFish platform provides full support for EclipseLink.
Developers writing applications for the GlassFish Server platform can
achieve full Java-to-data source integration that complies with the
Jakarta Persistence API (JPA) 2.0 specification. EclipseLink allows you
to integrate Java applications with any data source, without
compromising ideal application design or data integrity.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>GlassFish Server 3.1.2.</p>
</li>
<li>
<p>EclipseLink 2.3.0 or later.</p>
</li>
<li>
<p>Any compliant JDBC database including Oracle Database, Oracle Database
Express Edition, MySQL, and so on.</p>
</li>
<li>
<p>While it is not required, you may want to use a Jakarta EE integrated
development environment (IDE) for convenience during development.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ELGS001"><a class="anchor" href="#ELGS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>Oracle GlassFish Server is the reference implementation of the Java
Platform, Enterprise Edition (Jakarta EE platform) specification. Built
using the GlassFish Server Open Source Edition, GlassFish Server
delivers a flexible, lightweight, and production-ready Jakarta EE
platform.</p>
</div>
<div class="paragraph">
<p>GlassFish Server is part of the Oracle Fusion Middleware application
grid portfolio of products and is ideally suited for applications
requiring lightweight infrastructure with the most up-to-date
implementation of the Jakarta EE platform. GlassFish Server complements
Oracle WebLogic Server, which is designed to run the broader portfolio
of Oracle Fusion Middleware and large-scale enterprise applications.</p>
</div>
<div class="sect3">
<h4 id="advantages-to-using-eclipselink-with-glassfish-server"><a class="anchor" href="#advantages-to-using-eclipselink-with-glassfish-server"></a>Advantages to Using EclipseLink with GlassFish Server</h4>
<div class="paragraph">
<p>By adding EclipseLink support, developers writing applications for the
GlassFish Server platform can achieve full Java-to-data source
integration that complies with the Jakarta Persistence API (JPA) 2.0
specification. EclipseLink allows you to integrate Java applications
with any data source, without compromising ideal application design or
data integrity. In addition, EclipseLink gives your GlassFish Server
platform applications the ability to store (that is, <em>persist</em>) and
retrieve business domain objects using a relational database or an XML
data source as a repository.</p>
</div>
<div class="paragraph">
<p>While GlassFish Server can use other persistence providers and
EclipseLink can be used with other application servers, using GlassFish
Server with EclipseLink provides a number of advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink is included in all GlassFish Server distributions and is
the default JPA provider.</p>
</li>
<li>
<p>EclipseLink logging integration in GlassFish Server provides a
comprehensive, integrated logging infrastructure.</p>
</li>
<li>
<p>EclipseLink MOXy is also included in GlassFish versions 3.1.2 and
later. Although it is not the default JAXB implementation, it can be
used in JAX-WS and JAX-RS applications. For more information, see:
<code><a href="http://blog.bdoughan.com/2012/02/glassfish-312-is-full-of-moxy.html" class="bare">http://blog.bdoughan.com/2012/02/glassfish-312-is-full-of-moxy.html</a></code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELGS002"><a class="anchor" href="#ELGS002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>To run EclipseLink JPA applications in GlassFish Server, you must
configure the server and coordinate certain server and application
settings. These are described in the following tasks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIHDCDJD">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#CIHEJFFA">Task 2: Install GlassFish Server</a></p>
</li>
<li>
<p><a href="#CIHFCJJI">Task 3: Set Up the Data Source</a></p>
</li>
<li>
<p><a href="#CIHBFDDB">Task 4: Create the persistence.xml File</a></p>
</li>
<li>
<p><a href="#CIHDDACF">Task 5: Set Up GlassFish Server for JPA</a></p>
</li>
<li>
<p><a href="#CIHHDEFE">Task 6: Create the Application</a></p>
</li>
<li>
<p><a href="#CIHCFJDE">Task 7: Deploy the Application to GlassFish Server</a></p>
</li>
<li>
<p><a href="#CIHFIGGB">Task 8: Run the Application</a></p>
</li>
<li>
<p><a href="#CIHIFGEF">Task 9: Monitor the Application</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CIHDCDJD"><a class="anchor" href="#CIHDCDJD"></a>Task 1: Prerequisites</h4>
<div class="paragraph">
<p>This document is based on the following products and tools, although the
principles apply to any supported database or development environment.
It is assumed that the software is already installed, except where noted
in later sections.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GlassFish Server 3.1.2.</p>
<div class="paragraph">
<p>For more information and downloads, see
<code><a href="http://www.oracle.com/technetwork/middleware/glassfish/overview/index.html" class="bare">http://www.oracle.com/technetwork/middleware/glassfish/overview/index.html</a></code>
on the Oracle Technology Network.</p>
</div>
</li>
<li>
<p>EclipseLink 2.4.1.</p>
<div class="paragraph">
<p>For more information and downloads, see
<code><a href="http://www.eclipse.org/eclipselink/" class="bare">http://www.eclipse.org/eclipselink/</a></code> on the EclipseLink website.</p>
</div>
</li>
<li>
<p>Any compliant JDBC database including Oracle Database, Oracle Database
Express Edition, MySQL, and so on.</p>
<div class="paragraph">
<p>For Oracle Database, see
<code><a href="http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For Oracle Database Express Edition, see
<code><a href="http://www.oracle.com/technetwork/database/express-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/express-edition/overview/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For MySQL, see <code><a href="http://www.oracle.com/us/products/mysql/index.html" class="bare">http://www.oracle.com/us/products/mysql/index.html</a></code>.</p>
</div>
</li>
<li>
<p>While it is not required, you may want to use a Jakarta EE integrated
development environment (IDE) for convenience during development. For
example, Oracle JDeveloper, Oracle Enterprise Pack for Eclipse, and
NetBeans all provide sophisticated Jakarta EE development tools.</p>
<div class="paragraph">
<p>For JDeveloper, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For Oracle Enterprise Pack for Eclipse, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html</a></code>.</p>
</div>
<div class="paragraph">
<p>For NetBeans, see <code><a href="http://www.oracle.com/us/products/tools/050845.html" class="bare">http://www.oracle.com/us/products/tools/050845.html</a></code>.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CIHEJFFA"><a class="anchor" href="#CIHEJFFA"></a>Task 2: Install GlassFish Server</h4>
<div class="paragraph">
<p>EclipseLink is included with the GlassFish Server distribution. You can
find instructions for installing and configuring GlassFish Server at
this URL:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/index.htm" class="bare">http://docs.oracle.com/cd/E26576_01/index.htm</a></code></p>
</div>
<div class="paragraph">
<p>The EclipseLink modules appear as separate JAR files in the <code>modules</code>
directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">* \glassfish\modules
      .
      .
      .
      o org.eclipse.persistence.antlr.jar
      o org.eclipse.persistence.asm.jar
      o org.eclipse.persistence.core.jar
      o org.eclipse.persistence.jpa.jar
      o org.eclipse.persistence.jpa.modelgen.jar
      o org.eclipse.persistence.moxy.jar
      o org.eclipse.persistence.oracle.jar
      .
      .
      .</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The <code>org.eclipse.persistence.oracle.jar</code> file is available with
GlassFish and provides Oracle Database-specific functionality for
EclipseLink. This file is used only for applications running against an
Oracle Database.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Object-XML (also known as JAXB support, or <em>MOXy</em>) is a component that
enables you to bind Java classes to XML schemas. This support is
provided by the <code>org.eclipse.persistence.moxy.jar</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CIHFCJJI"><a class="anchor" href="#CIHFCJJI"></a>Task 3: Set Up the Data Source</h4>
<div class="paragraph">
<p>Configuring an Oracle database as a JDBC resource for a Jakarta EE
application involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#CIHDEDEE">Integrate the JDBC Driver for Oracle Database into
GlassFish Server</a></p>
</li>
<li>
<p><a href="#CIHFIGGF">Create a JDBC Connection Pool for the Resource</a></p>
</li>
<li>
<p><a href="#CIHIDADF">Create the JDBC Resource</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="CIHDEDEE"><a class="anchor" href="#CIHDEDEE"></a>Integrate the JDBC Driver for Oracle Database into GlassFish Server</h5>
<div class="paragraph">
<p>To integrate the JDBC driver, copy its JAR file into the domain and then
restart the domain and instances to make the driver available.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the JAR file for the JDBC driver into the domain&#8217;s <code>lib</code>
subdirectory, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">cd /home/gfuser/glassfish3
cp oracle-jdbc-drivers/ojdbc6.jar glassfish/domains/domain1/lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you do not have to restart GlassFish Server; the drivers are
picked up dynamically.</p>
</div>
<div class="paragraph">
<p>If the application uses Oracle Database-specific extensions provided by
EclipseLink, then the driver must be copied to the <code>lib/ext</code> directory.
For more information, see "Oracle Database Enhancements" in the <em>Oracle
GlassFish Server Application Development Guide</em> at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm#giqbi" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm#giqbi</a></code></p>
</div>
</li>
<li>
<p>You can use the GlassFish Server Administration Console or the command
line to restart instances in the domain to make the JDBC driver
available to the instances.</p>
<div class="paragraph">
<p><strong>To use the GlassFish Server Administration Console:</strong></p>
</div>
<div class="paragraph">
<p>In the GlassFish Server Administration Console, expand the <strong>Cluster</strong>
node. Select the node for the cluster and on its General Information
page, click the <strong>Instances</strong> tab. Select the instances you want to
restart. For more information, see "To Start Clustered GlassFish Server
Instances" in <em>GlassFish Server Administration Console Online Help</em>.</p>
</div>
<div class="paragraph">
<p>To start a standalone instance, expand the <strong>Standalone</strong> <strong>Instances</strong>
node. For each instance that you are starting, select the instance in
the Server Instances table. Click Start. The status of each instance is
updated in the Server Instances table when the instance is started. For
more information, see "To Start Standalone GlassFish Server Instances"
in <em>GlassFish Server Administration Console Online Help</em>.</p>
</div>
<div class="paragraph">
<p><strong>To use the command line:</strong></p>
</div>
<div class="paragraph">
<p>Run the <code>restart-instance</code> subcommand to restart the instances. These
commands assume that your instances are named <code>pmd-i1</code> and <code>pmd-i2</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">restart-instance pmd-i1
restart-instance pmd-i2</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="CIHFIGGF"><a class="anchor" href="#CIHFIGGF"></a>Create a JDBC Connection Pool for the Resource</h5>
<div class="paragraph">
<p>You can create a JDBC connection pool from the GlassFish Server
Administration Console or from the command line.</p>
</div>
<div class="paragraph">
<p><strong>To use the GlassFish Server Administration Console:</strong></p>
</div>
<div class="paragraph">
<p>In the GlassFish Server Administration Console, expand the <strong>Common</strong>
<strong>Tasks</strong> node, then click the <strong>Create New JDBC Connection Pool</strong> button in
the Common Tasks page. Specify the name of the pool, the resource type,
the name of the database provider, the data source and driver class
names, and other details. For more information, see "To Create a JDBC
Connection Pool" in <em>GlassFish Server Administration Console Online
Help</em>.</p>
</div>
<div class="paragraph">
<p><strong>To use the command line:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>create-jdbc-connection-pool</code> subcommand to create the JDBC
connection pool, specifying the database connectivity values. In this
command, note the use of two backslashes (<code>\\</code>) preceding the colons in
the URL property value. These backslashes cause the colons to be
interpreted as part of the property value instead of as separators
between property-value pairs, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">create-jdbc-connection-pool
  --datasourceclassname oracle.jdbc.pool.OracleDataSource
  --restype javax.sql.DataSource
  --property User=smith\\:Password=password\\:url=jdbc\\:oracle\\:thin\\:@node_name.example.com\\:1521\\:smithdb
    poolbvcallbackbmt</code></pre>
</div>
</div>
</li>
<li>
<p>Verify connectivity to the database.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">ping-connection-pool pool_name</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="CIHIDADF"><a class="anchor" href="#CIHIDADF"></a>Create the JDBC Resource</h5>
<div class="paragraph">
<p>You can use the GlassFish Server Administration Console to create the
JDBC resource or you can use the command line.</p>
</div>
<div class="paragraph">
<p><strong>To use the GlassFish Server Administration Console:</strong></p>
</div>
<div class="paragraph">
<p>In the GlassFish Server Administration Console, expand the <strong>Resources</strong>
node, then the <strong>JDBC</strong> node, then the <strong>JDBC</strong> <strong>Resources</strong> node to open the
JDBC Resources page. Provide a unique JNDI resource name and associate
the resource with a connection pool. For more information, see "To
Create a JDBC Resource" in the <em>GlassFish Server Administration Console
Online Help</em>.</p>
</div>
<div class="paragraph">
<p><strong>To use the command line:</strong></p>
</div>
<div class="paragraph">
<p>Use the <code>create-jdbc-resource</code> subcommand to create the JDBC resource,
and name it so that the application can discover it using JNDI lookup,
for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">create-jdbc-resource --connectionpoolid poolbvcallbackbmt jdbc/bvcallbackbmt</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CIHBFDDB"><a class="anchor" href="#CIHBFDDB"></a>Task 4: Create the persistence.xml File</h4>
<div class="paragraph">
<p><a href="#CIHJGIEF">Example 4-1</a> illustrates a sample <code>persistence.xml</code> file
that specifies the default persistence provider for EclipseLink,
<code>org.eclipse.persistence.jpa.PersistenceProvider</code>. For more information
about this file, see "About the Persistence Unit" in <em>EclipseLink
Concepts</em>.</p>
</div>
<div class="paragraph">
<p>If you are using the default persistence provider, then you can specify
additional database properties described in <em>Jakarta Persistence API
(JPA) Extensions Reference for EclipseLink</em>.</p>
</div>
<div class="paragraph">
<p>Several of the values you enter in the file must match the values you
chose when you defined the cluster, connection, and connection pool
properties in GlassFish Server, as follows:</p>
</div>
<div class="paragraph">
<p><strong>JDBC Data Source Properties:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name</strong>: The name of the data source, which is typically the same as
the JNDI name, for example <code>jdbc/bvcallbackbmt</code>.</p>
</li>
<li>
<p><strong>JNDI</strong> <strong>Name</strong>: The JNDI path to where this data source is bound. This
must be the same name as the value for the <code>&lt;jta-data-source&gt;</code> element
in <code>persistence.xml</code>, for example <code>jdbc/bvcallbackbmt</code>.</p>
</li>
<li>
<p><strong>Database</strong> <strong>Type</strong>: <code>Oracle</code></p>
</li>
<li>
<p><strong>Database</strong> <strong>Driver</strong>: (default) Oracle&#8217;s Driver (Thin XA) for Instance
connections; Versions: 9.0.1 and later</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Connection Properties:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Database</strong> <strong>Name</strong>: The name of the database, for example, <code>XE</code> for
Oracle Database Express Edition samples.</p>
</li>
<li>
<p><strong>Host</strong> <strong>Name</strong>: The IP address of the database server, for example
<code>127.0.0.1</code> for a locally hosted database.</p>
</li>
<li>
<p><strong>Port</strong>: The port number on which your database server listens for
connection requests, for example, <code>1521</code>, the default for Oracle
Database Express Edition 11<em>g</em>.</p>
</li>
<li>
<p><strong>Database</strong> <strong>User</strong> <strong>Name</strong>: The database account user name used to
create database connections, for example <code>hr</code> for Oracle Database
Express Edition 11<em>g</em> samples.</p>
</li>
<li>
<p><strong>Password</strong>: Your password.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Select Targets:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Servers</strong> <strong>/</strong> <strong>Clusters</strong>: Select the administration server, managed
servers, or clusters to which you want to deploy the data source. You
can choose one or more.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The sample <code>persistence.xml</code> file in <a href="#CIHJGIEF">Example 4-1</a>
highlights the properties defining the persistence provider, the JTA
data source, and logging details. In this example, the logging level is
set to <code>FINE</code>. At this level, SQL code generated by EclipseLink is
logged to the <code>server.log</code> file. For more information about these
properties, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIHFFHAE">Specify the Persistence Provider.</a></p>
</li>
<li>
<p><a href="#CIHCBCIC">Specify an Oracle Database.</a></p>
</li>
<li>
<p><a href="#CIHHJIGF">Specify Logging.</a></p>
</li>
</ul>
</div>
<div id="CIHJGIEF" class="paragraph">
<p><strong><em>Example 4-1 Sample persistence.xml File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" version="2.0"&gt;
  &lt;persistence-unit name="pu1" transaction-type="JTA"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;jdbc/bvcallbackbmt&lt;/jta-data-source&gt;
    &lt;properties&gt;
       &lt;property name="eclipselink.logging.level" value="FINE"/&gt;
       &lt;property name="eclipselink.ddl-generation"
                 value="drop-and-create-tables"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="CIHFFHAE"><a class="anchor" href="#CIHFFHAE"></a>Specify the Persistence Provider</h5>
<div class="paragraph">
<p>The persistence provider defines the implementation of JPA. It is
defined in the <code>provider</code> element of the <code>persistence.xml</code> file.
Persistence providers are vendor-specific. The persistence provider for
EclipseLink is <code>org.eclipse.persistence.jpa.PersistenceProvider</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CIHCBCIC"><a class="anchor" href="#CIHCBCIC"></a>Specify an Oracle Database</h5>
<div class="paragraph">
<p>You specify the database connection details in the <code>persistence.xml</code>
file. GlassFish Server uses the bundled Java DB (Derby) database by
default, named <code>jdbc/__default</code>. To use a nondefault database, such as
the Oracle Database, either specify a value for the <code>jta-data-source</code>
element, or set the <code>transaction-type</code> element to <code>RESOURCE_LOCAL</code> and
specify a value for the <code>non-jta-data-source</code> element.</p>
</div>
<div class="paragraph">
<p>If you are using the default persistence provider,
<code>org.eclipse.persistence.jpa.PersistenceProvider</code>, then the provider
attempts to automatically detect the database type based on the
connection metadata. This database type is used to issue SQL statements
specific to the detected database type. You can specify the optional
<code>eclipselink.target-database</code> property to guarantee that the database
type is correct.</p>
</div>
<div class="paragraph">
<p>For more information about specifying database properties in a
<code>persistence.xml</code> file for GlassFish Server, see "Specifying the
Database for an Application" in the <em>Oracle GlassFish Server Application
Development Guide</em>, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm#gbwmj" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm#gbwmj</a></code></p>
</div>
</div>
<div class="sect4">
<h5 id="CIHHJIGF"><a class="anchor" href="#CIHHJIGF"></a>Specify Logging</h5>
<div class="paragraph">
<p>EclipseLink provides a logging utility even though logging is not part
of the JPA specification. Hence, the information provided by the log is
EclipseLink JPA-specific. With EclipseLink, you can enable logging to
view the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration details</p>
</li>
<li>
<p>Information to facilitate debugging</p>
</li>
<li>
<p>The SQL that is being sent to the database</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify logging in the <code>persistence.xml</code> file. EclipseLink
logging properties let you specify the level of logging and whether the
log output goes to a file or standard output. Because the logging
utility is based on <code>java.util.logging</code>, you can specify a logging level
to use.</p>
</div>
<div class="paragraph">
<p>The logging utility provides nine levels of logging control over the
amount and detail of the log output. Use <code>eclipselink.logging.level</code> to
set the logging level, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.logging.level" value="FINE"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the log output goes to <code>System.out</code> or to the console. To
configure the output to be logged to a file, set the property
<code>eclipselink.logging.file</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.logging.file" value="output.log"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>EclipseLink&#8217;s logging utility is pluggable, and several different
logging integrations are supported, including <code>java.util.logging</code>. To
enable <code>java.util.logging</code>, set the property
<code>eclipselink.logging.logger</code>, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.logging.logger" value="JavaLogger"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>While running inside GlassFish Server, EclipseLink is configured by
GlassFish Server to use <code>JavaLogger</code> by default. The log is always
redirected to the GlassFish Server <code>server.log</code> file. For more
information, see "Setting Log Levels" in <em>Oracle GlassFish Server
Administration Guide</em>, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24928/logging.htm#gklml" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24928/logging.htm#gklml</a></code></p>
</div>
<div class="paragraph">
<p>For more information about EclipseLink logging and the levels of logging
available in the logging utility, see "Persistence Property Extensions
Reference" in <em>Jakarta Persistence API (JPA) Extensions Reference for
EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CIHDDACF"><a class="anchor" href="#CIHDDACF"></a>Task 5: Set Up GlassFish Server for JPA</h4>
<div class="paragraph">
<p><em>GlassFish Server Application Development Guide</em> describes
server-specific considerations on setting up GlassFish Server to run
applications that employ JPA:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm</a></code></p>
</div>
<div class="paragraph">
<p>It provides more information about these topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Specifying the Database for an Application," for information about
database connection properties</p>
</li>
<li>
<p>"Specifying the Persistence Provider for an Application," for setting
the default or non-default persistence provider for an application</p>
</li>
<li>
<p>"Primary Key Generation Defaults," for the default persistence
provider&#8217;s primary key generation defaults</p>
</li>
<li>
<p>"Automatic Schema Generation," for information on annotations and
options to manage automatic schema generation</p>
</li>
<li>
<p>"Restrictions and Optimizations," for restrictions and performance
optimizations that affect using the Jakarta Persistence API</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CIHHDEFE"><a class="anchor" href="#CIHHDEFE"></a>Task 6: Create the Application</h4>
<div class="paragraph">
<p>To create an application that uses EclipseLink as its JPA persistence
provider, you may want to use a Jakarta EE IDE for convenience during
development. For example, JDeveloper, Oracle Enterprise Pack for
Eclipse, and NetBeans provide sophisticated Jakarta EE development
tools, including support for EclipseLink. See "Key Tools" in
<em>EclipseLink Concepts</em>.</p>
</div>
<div class="paragraph">
<p>For guidance in writing your application, see these topics from the
"Configuring the Java Persistence Provider" chapter in <em>Oracle GlassFish
Server Application Development Guide</em>, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24930/jpa.htm</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="CIHCFJDE"><a class="anchor" href="#CIHCFJDE"></a>Task 7: Deploy the Application to GlassFish Server</h4>
<div class="paragraph">
<p>For information about deploying to GlassFish Server, see "Deploy
Applications or Modules," "To Deploy an Enterprise Application," and "To
Deploy a Web Application" in <em>GlassFish Server Administration Console
Online Help</em>. See also <em>Oracle GlassFish Server Application Deployment
Guide</em>, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/index.htm" class="bare">http://docs.oracle.com/cd/E26576_01/index.htm</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="CIHFIGGB"><a class="anchor" href="#CIHFIGGB"></a>Task 8: Run the Application</h4>
<div class="paragraph">
<p>For instructions for starting a deployed application from the GlassFish
Server Administration Console, see "Application Client Launch" and "To
Launch an Application" in <em>GlassFish Server Administration Console
Online Help</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CIHIFGEF"><a class="anchor" href="#CIHIFGEF"></a>Task 9: Monitor the Application</h4>
<div class="paragraph">
<p>GlassFish Server provides a monitoring service to track the health and
performance of an application. For information about monitoring an
application from the console, see the "Monitoring" and "Monitoring Data"
topics in <em>GlassFish Server Administration Console Online Help</em>. For
information about monitoring the application from the command line, see
"Administering the Monitoring Service" in <em>Oracle GlassFish Server
Administration Guide</em>, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24928/monitoring.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24928/monitoring.htm</a></code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELGS003"><a class="anchor" href="#ELGS003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Oracle GlassFish Server Administration Guide</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24928/toc.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24928/toc.htm</a></code></p>
</div>
</li>
<li>
<p>Oracle GlassFish Server Application Deployment Guide</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24929/toc.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24929/toc.htm</a></code></p>
</div>
</li>
<li>
<p>Oracle GlassFish Server Application Development Guide</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/doc.312/e24930/toc.htm" class="bare">http://docs.oracle.com/cd/E26576_01/doc.312/e24930/toc.htm</a></code></p>
</div>
</li>
<li>
<p>Oracle GlassFish Server 3.1.2 to 3.1.2.2 Documentation Library</p>
<div class="paragraph">
<p><code><a href="http://docs.oracle.com/cd/E26576_01/index.htm" class="bare">http://docs.oracle.com/cd/E26576_01/index.htm</a></code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ELJBOSS"><a class="anchor" href="#ELJBOSS"></a>5. Using EclipseLink with JBoss 7 Application Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces and describes how to use EclipseLink as the
persistence provider for applications deployed to JBoss Application
Server 7.1.</p>
</div>
<div class="paragraph">
<p>This chapter includess the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ELJBOSS001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#ELJBOSS002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#ELJBOSS003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink can be used with a number of popular Jakarta EE application
servers, including JBoss Application Server.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Configure JBoss to use EclipseLink runtime, and deploy applications
developed using EclipseLink APIs.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>JBoss Application Server 7.x.</p>
</li>
<li>
<p>A compliant Java Database Connectivity (JDBC) database, such as Oracle
Database, Oracle Express, MySQL, the HSQL database embedded in JBoss
Application Server, etc.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ELJBOSS001"><a class="anchor" href="#ELJBOSS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>JBoss Application Server implements the Java Platform, Enterprise
Edition (Jakarta EE). JBoss 7 fully supports Jakarta EE 6, while JBoss 6
officially supports only the Jakarta EE 6 Web Profile.</p>
</div>
<div class="paragraph">
<p>By configuring JBoss to support EclipseLink, you can take advantage of
EclipseLink&#8217;s full support for Jakarta Persistence API (JPA), Java
Architecture for XML Binding (JAXB), including EclipseLink&#8217;s extensions
to those technologies, as well as EclipseLink Database Web Services
(DBWS) to access to relational database artifacts via a Web service.</p>
</div>
</div>
<div class="sect2">
<h3 id="ELJBOSS002"><a class="anchor" href="#ELJBOSS002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>To develop, deploy and run EclipseLink applications in JBoss Application
Server 7, you must create EclipseLink as a module of JBoss. You must
also create other modules, such as a JDBC driver, etc., in order to run
applications.</p>
</div>
<div class="paragraph">
<p>This section contains the following tasks for using EclipseLink with
JBoss 7.1:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIFFJAJ">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#BEIHHAHD">Task 2: Configure EclipseLink as a Module in JBoss</a></p>
</li>
<li>
<p><a href="#BEIHDIBG">Task 3: Add ojdbc6.jar as a Module in JBoss</a></p>
</li>
<li>
<p><a href="#BEIIFFGB">Task 4: Create the Driver Definition and the Datasource</a></p>
</li>
<li>
<p><a href="#BEIDFCFI">Task 5: Create Users</a></p>
</li>
<li>
<p><a href="#BEIGFJIG">Task 6: Modify JBoss Properties</a></p>
</li>
<li>
<p><a href="#BEIHGDBJ">Task 7: Other Requirements</a></p>
</li>
<li>
<p><a href="#BEIGADEE">Task 8: Start JBoss</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEIFFJAJ"><a class="anchor" href="#BEIFFJAJ"></a>Task 1: Prerequisites</h4>
<div class="paragraph">
<p>Ensure that you have installed the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JBoss, version 7 or later. These instructions are based on JBoss
release 7.1.1.</p>
<div class="paragraph">
<p>Download JBoss from <code><a href="http://www.jboss.org/jbossas/downloads/" class="bare">http://www.jboss.org/jbossas/downloads/</a></code> . The
version of JBoss must be identified as "Certified Jakarta EE6." Version
7.1.1 or later is recommended.</p>
</div>
</li>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</li>
<li>
<p>Any compliant Java Database Connectivity (JDBC) database including
Oracle Database, Oracle Express, MySQL, the HSQL database embedded in
JBoss Application Server, and so on.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Oracle XML DB (XDB) and JBoss Application Server both use port <code>8080</code> by
default. If you have both available at the same URI, for example
<code>localhost</code>, you must reconfigure one or the other to use a different
port, for example <code>8081</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the Oracle Database, see
<code><a href="http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/enterprise-edition/overview/index.html</a></code>.
For the Oracle Database, Express Edition, see
<code><a href="http://www.oracle.com/technetwork/database/express-edition/overview/index.html" class="bare">http://www.oracle.com/technetwork/database/express-edition/overview/index.html</a></code>.
For MySQL, see <code><a href="http://www.oracle.com/us/products/mysql/index.html" class="bare">http://www.oracle.com/us/products/mysql/index.html</a></code>. For
information about the embedded HSQL database, see the JBoss
documentation.
* While it is not required, you may want to use a Java development
environment (IDE) for convenience during development. For example
JDeveloper, Oracle Enterprise Pack for Eclipse, and NetBeans all provide
sophisticated Jakarta EE development tools that support EclipseLink.</p>
</div>
<div class="paragraph">
<p>For JDeveloper, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/jdev/downloads/index.html</a></code>.
For Oracle Enterprise Pack for Eclipse, see
<code><a href="http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html" class="bare">http://www.oracle.com/technetwork/developer-tools/eclipse/overview/index.html</a></code>.
For NetBeans, see <code><a href="http://www.oracle.com/us/products/tools/050845.html" class="bare">http://www.oracle.com/us/products/tools/050845.html</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BEIHHAHD"><a class="anchor" href="#BEIHHAHD"></a>Task 2: Configure EclipseLink as a Module in JBoss</h4>
<div class="paragraph">
<p>To configure EclipseLink as a module in JBoss:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a directory as follows:</p>
<div class="paragraph">
<p><em>`JBOSS_ HOME`</em>`\modules\org\eclipse\persistence\main`</p>
</div>
</li>
<li>
<p>Copy <code>eclipselink.jar</code> to the directory created in step
<a href="#BEIJEJDJ">1</a>. (The <code>eclipselink.jar</code> file is located in the
<code>eclipselink/jlib</code> directory of the <code>eclipselink-`<em>`ver_no`</em></code>.zip`
file.)</p>
</li>
<li>
<p>Create a <code>module.xml</code> file in the directory created in step
<a href="#BEIJEJDJ">1</a>, with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;module xmlns="urn:jboss:module:1.1" name="org.eclipse.persistence"&gt;
   &lt;resources&gt;
       &lt;resource-root path="eclipselink.jar"/&gt;
       &lt;!-- Insert resources here --&gt;
   &lt;/resources&gt;
   &lt;dependencies&gt;
      &lt;module name="javax.api"/&gt;
      &lt;module name="jakarta.persistence.api"/&gt;
      &lt;module name="javax.transaction.api"/&gt;
      &lt;module name="javax.validation.api"/&gt;
      &lt;module name="jakarta.xml.bind.api"/&gt;
      &lt;module name="org.antlr"/&gt;
      &lt;module name="org.apache.commons.collections"/&gt;
      &lt;module name="org.dom4j"/&gt;
      &lt;module name="org.javassist"/&gt;
      &lt;module name="org.jboss.logging"/&gt;
      &lt;module name="com.oracle.ojdbc6"/&gt;
   &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="BEIHDIBG"><a class="anchor" href="#BEIHDIBG"></a>Task 3: Add ojdbc6.jar as a Module in JBoss</h4>
<div class="paragraph">
<p>Add the Oracle thin driver <code>ojdbc6.jar</code> as a module within JBoss, as
follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the module directory:</p>
<div class="paragraph">
<p><em>`JBOSS_ HOME`</em>`\modules\com\oracle\ojdbc6\main`</p>
</div>
</li>
<li>
<p>Copy <code>ojdbc6.jar</code> to the module directory created in step
<a href="#BEIBFGCF">1</a>.</p>
</li>
<li>
<p>Create a <code>module.xml</code> file in the module directory created in step
<a href="#BEIBFGCF">1</a>, with the following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;module xmlns="urn:jboss:module:1.1" name="com.oracle.ojdbc6"&gt;
    &lt;resources&gt;
        &lt;resource-root path="ojdbc6.jar"/&gt;
        &lt;!-- Insert resources here --&gt;
    &lt;/resources&gt;
    &lt;dependencies&gt;
        &lt;module name="javax.api"/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="BEIIFFGB"><a class="anchor" href="#BEIIFFGB"></a>Task 4: Create the Driver Definition and the Datasource</h4>
<div class="paragraph">
<p>Create the driver definition and create the datasource.</p>
</div>
<div class="paragraph">
<p>The following instructions tell how to configure JBoss for running in
standalome mode, using the <code>standalone.xml</code> configuration file. For
instructions on how to use <code>domain.xml</code> to configure JBoss for running
in domain mode, see the JBoss documentation.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the standalone configuration file
<code>JBOSS_ HOME`</code>\standalone\configuration\standalone.xml`, find the
following:</p>
<div class="paragraph">
<p><code>&lt;subsystem xmlns="urn:jboss:domain:datasources:1.0"&gt;</code></p>
</div>
</li>
<li>
<p>In that section, configure the datasource. The following example shows
a configuration for the Oracle Database, using the Oracle JDBC Thin
driver. For instructions on configuring other datasources, see the JBoss
documentation.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;subsystem xmlns="urn:jboss:domain:datasources:1.0"&gt;
   &lt;datasources&gt;
      &lt;datasource jndi-name="java:/EclipseLinkDS"
            pool-name="EclipseLinkDS"
            enabled="true"
            jta="true"
            use-java-context="true"
            use-ccm="true"&gt;
         &lt;connection-url&gt;jdbc:oracle:thin:node_name.example.com:1521:TOPLINK&lt;/connection-url&gt;
         &lt;driver&gt;oracle&lt;/driver&gt;
         &lt;transaction-isolation&gt;TRANSACTION_READ_COMMITTED&lt;/transaction-isolation&gt;
         &lt;pool&gt;
            &lt;prefill&gt;true&lt;/prefill&gt;
            &lt;use-strict-min&gt;false&lt;/use-strict-min&gt;
            &lt;flush-strategy&gt;FailingConnectionOnly&lt;/flush-strategy&gt;
         &lt;/pool&gt;
         &lt;security&gt;
            &lt;user-name&gt;Smith&lt;/user-name&gt;
            &lt;password&gt;password&lt;/password&gt;
         &lt;/security&gt;
       &lt;/datasource&gt;
       &lt;driver name="oracle" module="com.oracle.ojdbc6"&gt;
         &lt;xa-datasource-class&gt;oracle.jdbc.OracleDriver&lt;/xa-datasource-class&gt;
       &lt;/driver&gt;
    &lt;/datasources&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIDFCFI"><a class="anchor" href="#BEIDFCFI"></a>Task 5: Create Users</h4>
<div class="paragraph">
<p>Starting with JBoss Application Server 7.1, you must create an
Application User to get started, because remote access to the JNDI tree
is secured by default, and you must provide login credentials.
Therefore, at a minimum, you just create an Application User to be able
to deploy an application to the server. If you want to use the JBoss
administration console for administration tasks, for example to view the
JNDI tree, you must also create an Administration User.</p>
</div>
<div class="paragraph">
<p>To create user credentials, use the JBoss <code>add-user.bat</code> utility,
located in <em>`JBOSS_HOME`</em>`\bin\`.</p>
</div>
<div class="paragraph">
<p>For more information about security in JBoss Application Server, refer
to the JBoss documentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="BEIGFJIG"><a class="anchor" href="#BEIGFJIG"></a>Task 6: Modify JBoss Properties</h4>
<div class="paragraph">
<p>Modify JBoss properties, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">## JBoss-7.x
server.factory=org.jboss.naming.remote.client.InitialContextFactory
java.naming.factory.url.pkgs=org.jboss.ejb.client.naming
server.depend=jboss-client.jar
jboss.server=${jboss.home}/standalone
server.lib=${jboss.home}/bin/client
server.url=remote://localhost:4447
server.user=usera
server.pwd=passworda
jboss.naming.client.ejb.context=true</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIHGDBJ"><a class="anchor" href="#BEIHGDBJ"></a>Task 7: Other Requirements</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>junit.jar</code> in the <code>ear</code> under the <code>\lib</code> directory.</p>
</li>
<li>
<p>Because of a classloading issue in JBoss, you must list all your
entity classes in <code>persistence.xml</code>. You can use either <code>&lt;class&gt;</code>
elements or a global
<code>&lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;</code> element.</p>
</li>
<li>
<p>Add both <code>jndi.properties</code> and <code>jboss-ejb-client.properties</code> in the
client classpath.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="BEIGADEE"><a class="anchor" href="#BEIGADEE"></a>Task 8: Start JBoss</h4>
<div class="paragraph">
<p>Start JBoss by running <code>standalone.bat</code> (for a single-server
configuration) or <code>domain.bat</code> file (in a clustered environment) in
<em>`JBOSS_ HOME`</em>`\bin\`.</p>
</div>
<div class="paragraph">
<p>For information on different ways to configure and start JBoss, see the
JBoss documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELJBOSS003"><a class="anchor" href="#ELJBOSS003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JBoss Community at <code><a href="http://www.jboss.org" class="bare">http://www.jboss.org</a></code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ELWS"><a class="anchor" href="#ELWS"></a>6. Using EclipseLink with IBM WebSphere Application Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use EclipseLink as the persistence
provider for applications deployed to IBM WebSphere Application Server.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ELWS001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#ELWS002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#ELWS003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink can be used with a number of popular Jakarta EE application
servers, including WebSphere Application Server.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Configure WebSphere to use EclipseLink runtime, and deploy applications
developed using EclipseLink APIs.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>WebSphere Application Server 7 or later. These instructions are based
on WebSphere 8.5.</p>
</li>
<li>
<p>A compliant Java Database Connectivity (JDBC) database, such as Oracle
Database, Oracle Express, MySQL, the Derby database included in
WebSphere Application Server, and so on.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ELWS001"><a class="anchor" href="#ELWS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>WebSphere Application Server implements Java Platform, Enterprise
Edition (Jakarta EE). WebSphere V8.5 fully supports Jakarta EE 6 and can
support Java Platform, Standard Edition (Java SE) 7 via a plugin.</p>
</div>
<div class="paragraph">
<p>By configuring WebSphere support EclipseLink, you can create and deploy
applications that take advantage of EclipseLink&#8217;s full support for
Jakarta Persistence API (JPA), as well as EclipseLink&#8217;s many extensions.</p>
</div>
</div>
<div class="sect2">
<h3 id="ELWS002"><a class="anchor" href="#ELWS002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>To develop, deploy, and run EclipseLink applications in IBM WebSphere,
you must add various modules including EclipseLink to WebSphere, and you
must configure various aspects of WebSphere to support EclipseLink.</p>
</div>
<div class="paragraph">
<p>This section contains the following tasks for using EclipseLink with IBM
WebSphere, Version 7 or later:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CFHIHHBB">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#CEGCHAJB">Task 2: Configure Persistence Units</a></p>
</li>
<li>
<p><a href="#CEGCGFJB">Task 3: Configure the Server and the Application to Use
EclipseLink</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CFHIHHBB"><a class="anchor" href="#CFHIHHBB"></a>Task 1: Prerequisites</h4>
<div class="paragraph">
<p>Ensure that you have installed the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IBM WebSphere, Version 7 or later. These instructions are based on
WebSphere, Version 8.5.</p>
<div class="paragraph">
<p>Obtain IBM WebSphere from
<code><a href="http://www-01.ibm.com/software/webservers/appserv/was/" class="bare">http://www-01.ibm.com/software/webservers/appserv/was/</a></code>.</p>
</div>
</li>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
<div class="paragraph">
<p>You will use the following files:
<strong> <code>eclipselink.jar</code>
</strong> <code>jakarta.persistence_`<em>`ver_no`</em></code>.jar`</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CEGCHAJB"><a class="anchor" href="#CEGCHAJB"></a>Task 2: Configure Persistence Units</h4>
<div class="paragraph">
<p>Configure persistence units to use EclipseLink as the persistence
provider and to use WebSphere as the target server.</p>
</div>
<div class="paragraph">
<p><a href="#CEGCBJCA">Example 6-1</a> shows a sample configuration for a
container-managed persistence unit.</p>
</div>
<div id="CEGCBJCA" class="paragraph">
<p><strong><em>Example 6-1 Sample persistence.xml for a container-managed persistence
unit</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_1_0.xsd"
      version="1.0"&gt;
    &lt;persistence-unit name="default" transaction-type="JTA"&gt;
        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
        &lt;jta-data-source&gt;jdbc/EclipseLinkDS&lt;/jta-data-source&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
        &lt;properties&gt;
            &lt;property name="eclipselink.target-server" value="WebSphere_7"/&gt;
            &lt;property name="eclipselink.target-database"
                value="org.eclipse.persistence.platform.database.oracle.Oracle11Platform"/&gt;
            &lt;property name="eclipselink.validate-existence" value="true"/&gt;
            &lt;property name="eclipselink.weaving" value="true"/&gt;
            &lt;property name="eclipselink.logging.level" value="FINEST"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CEGBBBJE">Example 6-2</a> shows a sample configuration for an
application-managed persistence unit.</p>
</div>
<div id="CEGBBBJE" class="paragraph">
<p><strong><em>Example 6-2 Sample persistence.xml for an application-managed
persistence unit</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_1_0.xsd" version="1.0"&gt;
    &lt;persistence-unit name="default" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
        &lt;non-jta-data-source&gt;jdbc/ELNonJTADS&lt;/non-jta-data-source&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
        &lt;properties&gt;
            &lt;property name="eclipselink.target-server" value="WebSphere_7"/&gt;
            &lt;property name="eclipselink.target-database"
                  value="org.eclipse.persistence.platform.database.oracle.Oracle11Platform"/&gt;
            &lt;property name="eclipselink.validate-existence" value="true"/&gt;
            &lt;property name="eclipselink.weaving" value="true"/&gt;
            &lt;property name="eclipselink.logging.level" value="FINEST"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the following about the two examples above:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>eclipselink.target-server</code> value <code>WebSphere_7</code> is used for
WebSphere Application Server version 7 and later.</p>
</li>
<li>
<p>Specifying <code>persistence_1_0.xsd" version="1.0"</code> for the persistence
schema version works with both JPA 1 and JPA 2. For a JPA 2.<em>n</em> -only
application, you can change the version to
<code>persistence_2_0.xsd" version="2.`<em>n</em>`"</code> (WebSphere&#8217;s support for JPA
2 began in WebSphere Application Server 7.0.0.9.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CEGCGFJB"><a class="anchor" href="#CEGCGFJB"></a>Task 3: Configure the Server and the Application to Use EclipseLink</h4>
<div class="paragraph">
<p>The following are typical scenarios for using EclipseLink with the
application server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CEGFHBBI"><strong>Modify Server to Make EclipseLink Available Globally</strong></a></p>
</li>
<li>
<p><a href="#CEGFFJEA"><strong>Package EclipseLink in the Application EAR</strong></a></p>
</li>
<li>
<p><a href="#CEGJBCHB"><strong>Package EclipseLink in the WAR</strong></a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CEGFHBBI"><a class="anchor" href="#CEGFHBBI"></a>Modify Server to Make EclipseLink Available Globally</h5>
<div class="paragraph">
<p>You can make EclipseLink available globally for both container-managed
and application-managed persistence units in either of the following
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CEGGAEGJ">Option 1: Create a Global Shared Library (Recommended)</a></p>
</li>
<li>
<p><a href="#CEGGCCFC">Option 2: Add EclipseLink as a Server Library Extension</a></p>
</li>
</ul>
</div>
<div id="CEGGAEGJ" class="paragraph">
<p><strong>Option 1: Create a Global Shared Library (Recommended)</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a global shared library containing the following files:</p>
<div class="ulist">
<ul>
<li>
<p><code>eclipselink.jar</code></p>
<div class="paragraph">
<p>Find this file in the
<em>`TOPLINK_INSTALLATION`</em>`\oracle_common\modules\oracle.toplink_`<em>`ver_no`</em>
directory created by the EclipseLink quick installer.</p>
</div>
</li>
<li>
<p><code>xmlparserv2.jar</code></p>
<div class="paragraph">
<p>Find this file in the <em>`TOPLINK_INSTALLATION`</em>`\toplink\modules`
directory created by the s quick installer.</p>
</div>
</li>
<li>
<p>If you use Oracle Database features such as <code>NCHAR</code>, <code>XMLTYPE</code>, and
<code>MDSYS.SDO_GEOMETRY</code> with JPA, you must also include <code>xdb.jar</code> and
<code>sdoapi.jar</code> in the shared library. Those files are available in your
Oracle Database distribution.</p>
<div class="paragraph">
<p>See the WebSphere documentation for instructions on how to use WebSphere
to facilitate the creation of shared libraries.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Associate the shared library with the application.</p>
<div class="paragraph">
<p>See the WebSphere documentation for instructions on how to use WebSphere
to associate the shared library with an application.</p>
</div>
</li>
</ol>
</div>
<div id="CEGGCCFC" class="paragraph">
<p><strong>Option 2: Add EclipseLink as a Server Library Extension</strong></p>
</div>
<div class="paragraph">
<p>To add EclipseLink as a server library extension, copy <code>eclipselink.jar</code>
and the other JAR file(s) listed in Option 1, above, to the
<em>`WAS_HOME`</em>`\lib\ext` directory.</p>
</div>
</div>
<div class="sect4">
<h5 id="CEGFFJEA"><a class="anchor" href="#CEGFFJEA"></a>Package EclipseLink in the Application EAR</h5>
<div class="paragraph">
<p>You can also implement container-managed persistence by adding
<code>eclipselink.jar</code> in the application EAR, without making any
modifications to the server configuration. In this case, the persistence
unit is managed by <code>@PersistenceContext</code> entity manager proxy injection
on a stateless session bean. The following instructions show a example
of this approach.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>eclipselink.jar</code> to the application EAR in the following
location:</p>
<div class="paragraph">
<p><em>`EAR_archive`</em>`/APP-INF/lib/`</p>
</div>
</li>
<li>
<p>Add the path to the <code>eclipselink.jar</code> to the
<em>`ejbModule`</em>`/META-INF/MANIFEST.MF` file(s) in your EJB JAR(s), as
shown below:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Manifest-Version: 1.0
Class-Path: APP-INF/lib/eclipselink.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the manifest at the root of the entities' location, in this case
as part of the <code>ejb.jar.</code></p>
</div>
</li>
<li>
<p>Configure the class loader to load the classes with the application
class loader first.</p>
</li>
<li>
<p>Deploy and start the application. See the IBM WebSphere documentation
for instructions.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CEGJBCHB"><a class="anchor" href="#CEGJBCHB"></a>Package EclipseLink in the WAR</h4>
<div class="paragraph">
<p>If you do not or cannot implement container-managed persistence, as
described in the previous two scenarios, you can create an application
managed entity manager. In this case, all library configuration and
classloader scope changes must be done inside the EAR itself.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>eclipselink.jar</code> and <code>jakarta.persistence_`<em>`ver_no`</em></code>.jar` to
the web application archive (WAR) file in the following location:</p>
<div class="paragraph">
<p><em>`WAR_archive`</em>`/WEB-INF/lib/`</p>
</div>
</li>
<li>
<p>Configure the class loader order for your application to load the
classes with the application class loader first. See the WebSphere
documentation for instructions on setting class loader order using the
Administrative console.</p>
</li>
<li>
<p>Deploy and start the application. See the IBM WebSphere documentation
for instructions.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ELWS003"><a class="anchor" href="#ELWS003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebSphere Application Server at
<code><a href="http://www-01.ibm.com/software/webservers/appserv/was/" class="bare">http://www-01.ibm.com/software/webservers/appserv/was/</a></code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="MIGRATETOPLINK"><a class="anchor" href="#MIGRATETOPLINK"></a>7. Migrating from Native TopLink</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to migrate applications using "native"
TopLink object-relational mapping (ORM) APIs to the current EclipseLink
APIs.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#MIGRATETOPLINK000">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#MIGRATETOPLINK001">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#MIGRATETOPLINK002">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>A developer wants to upgrade an application that uses the older TopLink
native ORM to use a current EclipseLink ORM implementation.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Follow the instructions in this chapter to upgrade the application.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>(Optional) EclipseLink Workbench.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="MIGRATETOPLINK000"><a class="anchor" href="#MIGRATETOPLINK000"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>"Native" TopLink ORM refers to the API, configuration files, and tools
for object-relational mapping that evolved in TopLink before the Jakarta
Persistence API (JPA) standardized an object-relational mapping API.
Full JPA support was introduced in Oracle TopLink 10<em>g</em> (10.1.3.1.0),
via TopLink Essentials. However, native TopLink continued to be
supported.</p>
</div>
<div class="paragraph">
<p>Prior to the TopLink 11<em>g</em> (11.1.1) release, Oracle contributed the
TopLink source code&#8212;&#8203;including TopLink JPA and native TopLink&#8212;&#8203;to the
Eclipse Foundation, where it was used to form the basis of the
open-source EclipseLink persistence services project. Then, in TopLink
11<em>g</em> Release 1 (11.1.1), Oracle started to include EclipseLink in
TopLink, providing TopLink&#8217;s core functionality.</p>
</div>
<div class="paragraph">
<p>EclipseLink developers using TopLink versions 11.1.1.0.0 though
11.1.1.6.0 have access to native TopLink ORM in either the proprietary
Oracle <code>toplink.jar</code> or in the EclipseLink <code>eclipselink.jar</code>. In
<code>toplink.jar</code>, the classes are in packages whose names start with
<code>oracle.toplink.*</code>. In <code>eclipselink.jar</code>, those package names begin
instead with <code>org.eclipselink.persistence.</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>toplink.jar</code> file was deprecated in TopLink 11<em>g</em> and is no long
shipped with TopLink 12<em>c</em>. It is recommended that you migrate off
<code>oracle.toplink.*</code> in TopLink 11<em>g</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can migrate applications that use <code>oracle.toplink.*</code> packages from
<code>toplink.jar</code> to use <code>org.eclipselink.persistence.</code> packages from
<code>eclipselink.jar</code>. The application functionality remains the same, but
migrating to <code>eclipselink.jar</code> provides the most up-to-date code base.
After migrating, you will have access to other EclipseLink features and
will be better prepared to convert your application to use JPA or one of
the other persistence services included in current versions of
EclipseLink.</p>
</div>
<div class="paragraph">
<p>This chapter explains how to use the renaming tool that is packaged with
stand-alone EclipseLink to easily change the package names in your
application and how to perform other actions necessary to migrate to the
current code base.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Following the instructions in this chapter will update your application
to use the current EclipseLink code base. Doing so retains the design
and functionality of your application as originally implemented.
However, these instructions do not describe how to convert a native
TopLink-based application to use JPA or any of the other persistence
services in current versions of EclipseLink. See the other EclipseLink
documentation sources for that information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="MIGRATETOPLINK001"><a class="anchor" href="#MIGRATETOPLINK001"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section contains the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BCGGFIGC">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#BCGFFCHI">Task 2: Replace Deprecated and Removed Native APIs</a></p>
</li>
<li>
<p><a href="#BCGJDFJB">Task 3: Rename Packages</a></p>
</li>
<li>
<p><a href="#BCGIFBHC">Task 4: Convert XML Configuration Files</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BCGGFIGC"><a class="anchor" href="#BCGGFIGC"></a>Task 1: Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</li>
<li>
<p>(Optional) EclipseLink Workbench. The EclipseLink Workbench is
available in EclipseLink downloads. See the EclipseLink download page at
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="BCGFFCHI"><a class="anchor" href="#BCGFFCHI"></a>Task 2: Replace Deprecated and Removed Native APIs</h4>
<div class="paragraph">
<p>APIs that were deprecated in releases before TopLink 11g Release 1
(11.1.1) were removed in EclipseLink. If your application uses any of
those deprecated APIs or any APIs that were already replaced or removed
from TopLink, you must update the application to use current APIs.</p>
</div>
<div class="paragraph">
<p>The following sections lists the replaced and removed APIs, with
suggested substitutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BCGDBICE">APIs Replaced,</a></p>
</li>
<li>
<p><a href="#BCGJJGEF">Deprecated APIs,</a></p>
</li>
<li>
<p><a href="#BCGGJAFJ">Removed API,</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When suggested replacements are in <code>oracle.toplink.*</code> packages, you must
also change the package names, as described in <a href="#BCGJDFJB">Task 3:
Rename Packages.</a>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="BCGDBICE"><a class="anchor" href="#BCGDBICE"></a>APIs Replaced</h5>
<div class="paragraph">
<p>The following tables list the APIs removed as of TopLink 11<em>g</em> Release
1 (11.1.1.1.). Use the replacement API listed in the tables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BCGDDHBC">Table 7-1, "changetracking (oracle.toplink.descriptors.*)"</a></p>
</li>
<li>
<p><a href="#BCGDIBCI">Table 7-2, "databaseaccess (oracle.toplink.internal*)"</a></p>
</li>
<li>
<p><a href="#BCGEIDAH">Table 7-3, "jdo (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGGCCBE">Table 7-4, "mappings (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGCAIHH">Table 7-5, "objectrelational (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGDDFAD">Table 7-6, "oraclespecific (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGFEJHH">Table 7-7, "publicinterface (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGHAAEG">Table 7-8, "sdk (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGFJCIC">Table 7-9, "entitymanager (oracle.toplink.sessions.*)"</a></p>
</li>
<li>
<p><a href="#BCGDCGAB">Table 7-10, "sessionconfiguration (oracle.toplink.tools.*)"</a></p>
</li>
<li>
<p><a href="#BCGCFHFA">Table 7-11, "xml (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGBBFIC">Table 7-12, "XMLCommandConverter (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGFFGIC">Table 7-13, "Remote Protocols (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGGBFEE">Table 7-14, "EJB Mapping for BEA WebLogic 6.1"</a></p>
</li>
<li>
<p><a href="#BCGDIBIC">Table 7-15, "mappings (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGDJEEJ">Table 7-16, "descriptors (oracle.toplink.*)"</a></p>
</li>
</ul>
</div>
<div id="BCGDDHBC" class="paragraph">
<p><strong><em>Table 7-1 changetracking (oracle.toplink.descriptors.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChangeTracker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getTopLinkPropertyChangeListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>._persistence_getPropertyChangeListener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ChangeTracker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setTopLinkPropertyChangeListener(PropertyChangeListener)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_persistence_setPropertyChangeListener(PropertyChangeListener)</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGDIBCI" class="paragraph">
<p><strong><em>Table 7-2 databaseaccess (oracle.toplink.internal</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.*Platform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oracle.toplink.platform.database.*Platform</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGEIDAH" class="paragraph">
<p><strong><em>Table 7-3 jdo (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.jdo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div id="BCGGCCBE" class="paragraph">
<p><strong><em>Table 7-4 mappings (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeConversionMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mappings.converters.TypeConversionConverter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ObjectTypeMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mappings.converters.ObjectTypeConverter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SerializedObjectMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.mappings.converters.SerializedObjectConverter</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGCAIHH" class="paragraph">
<p><strong><em>Table 7-5 objectrelational (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Oracle8Platform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oracle.toplink.platform.database.oracle.Oracle8Platform</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGDDFAD" class="paragraph">
<p><strong><em>Table 7-6 oraclespecific (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.oraclespecific.NCharacter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.platform.database.oracle.NCharacter</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.oraclespecific.NClob</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.platform.database.oracle.NClob</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.oraclespecific.NClob</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.platform.database.oracle.NClob</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.oraclespecific.Oracle8Platform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.platform.database.oracle.Oracle8Platform</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.oraclespecific.Oracle9Specific</code> <a href="#sthref29"><sup>Foot 1 </sup></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole
class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.platform.database.oracle.Oracle9Specific</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">.oraclespecific.TopLinkXMLType <a href="#sthref30"><sup>Foot 2 </sup></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>Footnote 1 </sup><code>oracle.toplink.oraclespecific.Oracle9Specific</code> was moved
to an internal package and renamed to
<code>oracle.toplink.internal.platform.database.oracle.Oracle9Specific</code>. The
replacement public API for
<code>oracle.toplink.oraclespecific.Oracle9Specific</code> is
<code>oracle.toplink.platform.database.oracle.Oracle9Specific</code>.<br>
<sup>Footnote 2 </sup><code>oracle.toplink.oraclespecific.TopLinkXMLType</code> was a
miscellaneous class, which does not have a replacement API.<br></p>
</div>
<div id="BCGFEJHH" class="paragraph">
<p><strong><em>Table 7-7 publicinterface (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatabaseRow</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.sessions.DatabaseRecord</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatabaseSession</code> <a href="#sthref32"><sup>Foot 1 </sup></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.sessions.DatabaseSession</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Descriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors - ClassDescriptor, RelationalDescriptor</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DescriptorEvent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors.DescriptorEvent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DescriptorEventListener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors</code> - new interface
will not extend old interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DescriptorEventManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DescriptorQueryManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InheritancePolicy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.descriptors</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">`Session`<a href="#sthref33"><sup>Foot 2 </sup></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.sessions.Session</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">`UnitOfWork`<a href="#sthref34"><sup>Foot 3 </sup></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.sessions.UnitOfWork</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><sup>Footnote 1 </sup><code>oracle.toplink.publicinterface.DatabaseSession</code> was moved
to an internal package and renamed to
<code>oracle.toplink.internal.sessions.DatabaseSessionImpl</code>. The replacement
public API for <code>oracle.toplink.publicinterface.DatabaseSession</code> is
<code>oracle.toplink.sessions.DatabaseSession</code>.<br>
<sup>Footnote 2 </sup><code>oracle.toplink.publicinterface.Session</code> was moved to an
internal package and renamed to
<code>oracle.toplink.internal.sessions.AbstractSessionImpl</code>. The replacement
public API for <code>oracle.toplink.publicinterface.Session</code> is
<code>oracle.toplink.sessions.Session</code>.<br>
<sup>Footnote 3 </sup><code>oracle.toplink.publicinterface.UnitOfWork</code> was moved to an
internal package and renamed to
<code>oracle.toplink.internal.sessionl.UnitOfWorkImpl</code>. The replacement
public API for <code>oracle.toplink.publicinterface.UnitOfWork</code> is
<code>oracle.toplink.sessions.UnitOfWork</code>.<br></p>
</div>
<div id="BCGHAAEG" class="paragraph">
<p><strong><em>Table 7-8 sdk (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.sdk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.eis</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGFJCIC" class="paragraph">
<p><strong><em>Table 7-9 entitymanager (oracle.toplink.sessions.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JPA: see <a href="#BCGHJGHF">JPA Persistence
Provider Implementation,</a></p></td>
</tr>
</tbody>
</table>
<div id="BCGDCGAB" class="paragraph">
<p><strong><em>Table 7-10 sessionconfiguration (oracle.toplink.tools.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>WASXMLLoader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All methods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div id="BCGCFHFA" class="paragraph">
<p><strong><em>Table 7-11 xml (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.ox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.xmlstream</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.ox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.xml.tools</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.<code>ox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.xml.xerces</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.ox</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.xml.zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.ox</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGBBFIC" class="paragraph">
<p><strong><em>Table 7-12 XMLCommandConverter (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.remotecommand.XMLCommandConverter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.transform.xml.XMLSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.transform.xml.XMLResult</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.internal.localization.i18n.ExceptionLocalizationResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"error_loading_resources"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.internal.localization.i18n.ExceptionLocalizationResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"error_parsing_resources"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.internal.localization.i18n.ExceptionLocalizationResource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"unexpect_argument"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div id="BCGFFGIC" class="paragraph">
<p><strong><em>Table 7-13 Remote Protocols (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.remote.corba.orbix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.remote.corba.visibroker</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.remote.ejb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.TopLinkSessionsFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References for
any of <code>JNDIClusteringService</code> in <code>orbix</code>, <code>visibroker</code> and <code>ejb</code>
packages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.DTD2SessionConfigLoader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References for
any of <code>JNDIClusteringService</code> in <code>orbix, visibroker</code> and <code>ejb</code>
packages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.model.clustering.VisibrokerCORBAJNDIClusteringConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.model.clustering.OrbixCORBAJNDIClusteringConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.model.clustering.EJBJNDIClusteringConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whole class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.tools.sessionconfiguration.XMLSessionConfigProject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">References for
any of <code>JNDIClusteringService</code> in <code>orbix</code>, <code>visibroker</code> and <code>ejb</code>
packages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div id="BCGGBFEE" class="paragraph">
<p><strong><em>Table 7-14 EJB Mapping for BEA WebLogic 6.1</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>toplink-cmp-bean_name.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A warning will be added at the
beginning of:
<code>internal.ejb.cmp.wls11.CMPDeployer.readTypeSpecificData()</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="BCGJJGEF"><a class="anchor" href="#BCGJJGEF"></a>Deprecated APIs</h5>
<div class="paragraph">
<p>The following tables list the APIs deprecated in the releases prior to
TopLink 11<em>g</em> Release 1 (11.1.1) and therefore removed in that
release, due to the substitution of EclipseLink libraries. Use the
replacement API indicated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because deprecated classes and moved classes have the same name, you may
get compile errors if you use <code>import *</code> to import classes from both the
old package and the new package. To avoid these errors, use <code>import</code>
with a fully qualified package name.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BCGDIBIC">Table 7-15, "mappings (oracle.toplink.*)"</a></p>
</li>
<li>
<p><a href="#BCGDJEEJ">Table 7-16, "descriptors (oracle.toplink.*)"</a></p>
</li>
</ul>
</div>
<div id="BCGDIBIC" class="paragraph">
<p><strong><em>Table 7-15 mappings (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OneToOneMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useJoining</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ForeignReferenceMapping.setJoinFetch(int)</code></p></td>
</tr>
</tbody>
</table>
<div id="BCGDJEEJ" class="paragraph">
<p><strong><em>Table 7-16 descriptors (oracle.toplink.</strong>)</em>*</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Replacement APIs</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassDescriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addMultipleTableForeignKeyField</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addForeignKeyFieldForMultipleTable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassDescriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addMultipleTablePrimaryKeyField</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addForeignKeyFieldForMultipleTable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassDescriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addMultipleTablePrimaryKeyFieldName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addForeignKeyFieldNameForMultipleTable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ClassDescriptor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addMultipleTableForeignKeyFieldName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addForeignKeyFieldNameForMultipleTable</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="BCGGJAFJ"><a class="anchor" href="#BCGGJAFJ"></a>Removed API</h5>
<div class="paragraph">
<p>The following classes were removed in the release prior to TopLink
11<em>g</em> Release 1 (11.1.1):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OTSTransactionController</code></p>
</li>
<li>
<p><code>OTSSynchronizationListener</code></p>
</li>
<li>
<p><code>OracleSequenceDefinition</code> (use <code>SequenceObjectDefinition</code> instead)</p>
</li>
<li>
<p><code>TimeTenSequenceDefinition</code> (use <code>SequenceObjectDefinition</code> instead)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="miscellaneous-api-changes"><a class="anchor" href="#miscellaneous-api-changes"></a>Miscellaneous API Changes</h5>
<div class="paragraph">
<p>Other API changes include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BCGHJGHF">JPA Persistence Provider Implementation.</a></p>
</li>
<li>
<p><a href="#BCGGABCJ">Session Finalizers Disabled by Default.</a></p>
</li>
<li>
<p><a href="#BCGJCIFE">Vector and Hashtable Return Types Changed to List or Map.</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="BCGHJGHF"><a class="anchor" href="#BCGHJGHF"></a>JPA Persistence Provider Implementation</h6>
<div class="paragraph">
<p>The persistence provider implementation in all TopLink releases since
11g (11.1.1) is packaged in <code>eclipselink.jar</code>. It replaces all previous
implementations, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>toplink.jar</code></p>
</li>
<li>
<p><code>toplink-essentials.jar</code></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="BCGGABCJ"><a class="anchor" href="#BCGGABCJ"></a>Session Finalizers Disabled by Default</h6>
<div class="paragraph">
<p>In TopLink 11<em>g</em> (11.1.1) Technology Preview 3, session finalizers
were disabled by default to improve performance. To enable session
finalizers, use Session method <code>setIsFinalizersEnabled</code>(true).</p>
</div>
</div>
<div class="sect5">
<h6 id="BCGJCIFE"><a class="anchor" href="#BCGJCIFE"></a>Vector and Hashtable Return Types Changed to List or Map</h6>
<div class="paragraph">
<p>Any <code>Session</code> or <code>ClassDescriptor</code> method that returns <code>Vector</code> or
<code>Hashtable</code> will eventually be changed to return <code>List</code> or <code>Map</code>,
respectively. To prepare for this change, cast <code>Vector</code> and <code>Hashtable</code>
return types to <code>List</code> or <code>Map</code>, respectively. For example, although the
Javadoc for <code>ClassDescriptor</code> method <code>getMappings</code> is
<code>java.util.Vector</code>, you should cast the returned value to <code>List</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">List mappings = (List) descriptor.getMappings();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other changes that now return <code>Map</code> include the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClassDescriptor.getQueryKeys()</code></p>
</li>
<li>
<p><code>ClassDescriptor.getProperties()</code></p>
</li>
<li>
<p><code>DescriptorQueryManager.getQueries()</code></p>
</li>
<li>
<p><code>EISInteraction.getProperties()</code></p>
</li>
<li>
<p><code>Session.getProperties()</code></p>
</li>
<li>
<p><code>Session.getQueries()</code></p>
</li>
<li>
<p><code>getAttributesToAlwaysInclude()</code></p>
</li>
<li>
<p><code>getSpecialOperations()</code></p>
</li>
<li>
<p><code>getValuesToExclude()s</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BCGJDFJB"><a class="anchor" href="#BCGJDFJB"></a>Task 3: Rename Packages</h4>
<div class="paragraph">
<p>EclipseLink continues to support native TopLink APIs; however, all
<code>oracle.toplink.<strong></code> packages are now renamed to
<code>org.eclipse.persistence.</strong></code>.</p>
</div>
<div class="paragraph">
<p>To migrate your application to use the new code base, you must rename
the packages in your code. To facilitate this, a package renamer tool is
included with the EclipseLink installation. Use this tool on all of the
following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>project source code</p>
</li>
<li>
<p><code>project.xml</code> file</p>
</li>
<li>
<p><code>persistence.xml</code> file</p>
</li>
<li>
<p><code>sessions.xml</code> file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The package renamer is located in the
<em>`toplink_install_directory`</em>`\toplink\utils\rename` directory.
Windows and UNIX/LINUX scripts are included.</p>
</div>
<div class="paragraph">
<p>To run the package renamer using the scripts, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the <code>packageRename.cmd</code> (Windows) and <code>packageRename.sh</code>
(UNIX/LINUX) scripts in
<em>`toplink_install_directory`</em>`\toplink\utils\rename` directory.</p>
</li>
<li>
<p>Run either <code>packageRename.cmd</code> or <code>packageRename.sh</code> with the
following arguments:</p>
<div class="ulist">
<ul>
<li>
<p><code>sourceLocation</code> - The directory containing the files to rename.</p>
</li>
<li>
<p><code>targetLocation</code> - The destination directory for the renamed files.
The package renamer removes any existing Java and XML files, so it is
advisable to specify an empty directory.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">packageRename c:/mySourceLocation c:/myDestinationLocation</code></pre>
</div>
</div>
<div class="paragraph">
<p>The package renamer performs a recursive directory search for Java and
XML files to rename. The renamed version of each file is saved in the
corresponding directory in the target location</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="BCGIFBHC"><a class="anchor" href="#BCGIFBHC"></a>Task 4: Convert XML Configuration Files</h4>
<div class="paragraph">
<p>The package renamer can rename EclipseLink XML configuration files, but
depending on the type of file, you may need to make additional changes.</p>
</div>
<div class="sect4">
<h5 id="sessions-xml"><a class="anchor" href="#sessions-xml"></a>Sessions XML</h5>
<div class="paragraph">
<p>You can continue to use <code>sessions.xml</code> files as is. For a more
forward-compatible solution, run the renamer on your <code>sessions.xml</code>
files.</p>
</div>
</div>
<div class="sect4">
<h5 id="deployment-xml"><a class="anchor" href="#deployment-xml"></a>Deployment XML</h5>
<div class="paragraph">
<p>Deployment XML files from TopLink 10.1.3 and above can be read by
TopLink 11.1.1 and later. You can continue to use those files or for a
more forward compatible solution, run the renamer on these files and
replace the version string in the "XML Header" with the following:</p>
</div>
<div class="paragraph">
<p>"Eclipse Persistence Services"</p>
</div>
</div>
<div class="sect4">
<h5 id="persistence-xml"><a class="anchor" href="#persistence-xml"></a>Persistence XML</h5>
<div class="paragraph">
<p>To use EclipseLink as a persistence provider, you must run the renamer
on your <code>persistence.xml</code> files. The renamer updates the persistence
provider to be EclipseLink and also update any native TopLink specific
properties to the EclipseLink equivalent.</p>
</div>
</div>
<div class="sect4">
<h5 id="orm-xml"><a class="anchor" href="#orm-xml"></a>ORM XML</h5>
<div class="paragraph">
<p>The Object-Relational (ORM) XML configuration file (<code>orm.xml</code>) is not
EclipseLink-dependant and does not need to be updated.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIGRATETOPLINK002"><a class="anchor" href="#MIGRATETOPLINK002"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="MIGRATEHIBERNATE"><a class="anchor" href="#MIGRATEHIBERNATE"></a>8. Migrating from Hibernate to EclipseLink</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to migrate applications from using Hibernate
JPA annotations and its native and proprietary API to using
EclipseLink&#8217;s JPA implementation, provided by EclipseLink. The migration
involves converting Hibernate annotations to EclipseLink annotations,
and converting native Hibernate API to EclipseLink JPA in the
application code. Standard JPA annotations and API are left unchanged.</p>
</div>
<div class="paragraph">
<p>This chapter describes how to migrate applications from using Hibernate
JPA annotations and its native and proprietary API to using EclipseLink
JPA. The migration involves converting Hibernate annotations to
EclipseLink annotations, and converting native Hibernate API to
EclipseLink JPA in the application code. Standard JPA annotations and
API are left unchanged.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#MIGRATEHIBERNATE001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#MIGRATEHIBERNATE002">Main Tasks</a></p>
</li>
<li>
<p><a href="#MIGRATEHIBERNATE003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>A developer wants to migrate applications using Hibernate as the
persistence provider to use EclipseLink instead.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Follow the instructions in this chapter to upgrade the application.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="MIGRATEHIBERNATE001"><a class="anchor" href="#MIGRATEHIBERNATE001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>Hibernate is an object-relational mapping (ORM) tool for Java
environments. It provides a framework for mapping Java objects to
relational database artifacts, and Java data types to SQL data types. It
also provides the ability to query the database and retrieve data.</p>
</div>
<div class="paragraph">
<p>For more information about Hibernate, see <code><a href="http://www.hibernate.org" class="bare">http://www.hibernate.org</a></code>.</p>
</div>
<div class="paragraph">
<p><strong>Reasons to Migrate</strong></p>
</div>
<div class="paragraph">
<p>Reasons why you would want to migrate from Hibernate to EclipseLink
include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Performance and scalability</strong>: EclipseLink&#8217;s caching architecture
allows you to minimize object creation and share instances.
EclipseLink&#8217;s caching supports single-node and clustered deployments.</p>
</li>
<li>
<p><strong>Support for leading relation databases</strong>: EclipseLink continues to
support all leading relational databases with extensions specific to
each. EclipseLink is also the best ORM solution for Oracle Database.</p>
</li>
<li>
<p><strong>A comprehensive persistence solution</strong>: While EclipseLink offers
industry leading object-relational support, EclipseLink also uses its
core mapping functionality to deliver Object-XML (JAXB), Service Data
Object (SDO), and Database Web Services (DBWS). Depending on your
requirements, you can use one or more of the persistence services based
on the same core persistence engine.</p>
</li>
<li>
<p><strong>JPA Support</strong>: EclipseLink is the JPA reference implementation, and it
will support future versions of JPA.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="MIGRATEHIBERNATE002"><a class="anchor" href="#MIGRATEHIBERNATE002"></a>Main Tasks</h3>
<div class="paragraph">
<p>Complete these tasks to migrate an application that uses Hibernate as
its persistence provider to EclipseLink.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BGBFIGDF">Task 1: Convert the Hibernate Entity Annotation</a></p>
</li>
<li>
<p><a href="#BGBCJCBF">Task 2: Convert the Hibernate Custom Sequence Generator Annotation</a></p>
</li>
<li>
<p><a href="#BGBDFADJ">Task 3: Convert Hibernate Mapping Annotations</a></p>
</li>
<li>
<p><a href="#BGBGAGJD">Task 4: Modify the persistence.xml File</a></p>
</li>
<li>
<p><a href="#BGBGDHBH">Task 5: Convert Hibernate API to EclipseLink API</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="task-1-prerequisites"><a class="anchor" href="#task-1-prerequisites"></a>Task 1: Prerequisites</h4>
<div class="paragraph">
<p>EclipseLink 2.4 or later.</p>
</div>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BGBFIGDF"><a class="anchor" href="#BGBFIGDF"></a>Task 2: Convert the Hibernate Entity Annotation</h4>
<div class="paragraph">
<p>The Hibernate entity annotation, defined by the
<code>org.hibernate.annotations.Entity</code> class, adds additional metadata
beyond what is defined by the JPA standard <code>@Entity</code> annotation.</p>
</div>
<div class="paragraph">
<p><a href="#BGBJIHJB">Example 8-1</a> illustrates a sample Hibernate entity
annotation. The example uses the <code>selectBeforeUpdate</code>, <code>dynamicInsert</code>,
<code>dynamicUpdate</code>, <code>optimisticLock</code>, and <code>polymophism</code> attributes. Note
that the Hibernate entity annotation also defines <code>mutable</code> and
<code>persister</code> attributes, which are not used in this example.</p>
</div>
<div id="BGBJIHJB" class="paragraph">
<p><strong><em>Example 8-1 Sample Hibernate Entity Annotation</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@org.hibernate.annotations.Entity(
     selectBeforeUpdate = true,
     dynamicInsert = true,
     dynamicUpdate = true,
     optimisticLock = OptimisticLockType.ALL,
     polymorphism = PolymorphismType.EXPLICIT)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections describe how EclipseLink handles selects, locks,
polymorphism, and dynamic updates and inserts. For more information, see
"EclipseLink/Examples/JPA/Migration/Hibernate/V3Annotations" in the
Eclipselink documentation, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Migration/Hibernate/V3Annotations" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Migration/Hibernate/V3Annotations</a></code></p>
</div>
<div class="sect4">
<h5 id="convert-the-selectbeforeupdate-dynamicinsert-and-dynamicupdate-attributes"><a class="anchor" href="#convert-the-selectbeforeupdate-dynamicinsert-and-dynamicupdate-attributes"></a>Convert the SelectBeforeUpdate, dynamicInsert and dynamicUpdate Attributes</h5>
<div class="paragraph">
<p>In Hibernate, the <code>selectBeforeUpdate</code> attribute specifies that
Hibernate should never perform a SQL update unless it is certain that an
object is actually modified. The <code>dynamicInsert</code> attribute specifies
that the <code>INSERT</code> <code>SQL</code> statement should be generated at runtime and
contain only the columns whose values are not null. The <code>dynamicUpdate</code>
attribute specifies that the <code>UPDATE</code> <code>SQL</code> statement should be
generated at runtime and can contain only those columns whose values
have changed.</p>
</div>
<div class="paragraph">
<p>By default, EclipseLink will always insert all mapped columns and will
update only the columns that have changed. If alternative operations are
required, then the queries used for these operations can be customized
by using Java code, SQL, or stored procedures.</p>
</div>
</div>
<div class="sect4">
<h5 id="convert-the-optimisticlock-attribute"><a class="anchor" href="#convert-the-optimisticlock-attribute"></a>Convert the OptimisticLock Attribute</h5>
<div class="paragraph">
<p>In Hibernate, the <code>optimisticLock</code> attribute determines the optimistic
locking strategy.</p>
</div>
<div class="paragraph">
<p>EclipseLink&#8217;s optimistic locking functionality supports all of the
Hibernate locking types and more. <a href="#BGBFBBCE">Table 8-1</a> translates
locking types from Hibernate&#8217;s <code>@Entity(optimisticLock)</code> attributes into
EclipseLink locking policies. These policies can be configured either
with the EclipseLink <code>@OptimisticLocking</code> annotation or in the
EclipseLink <code>orm.xml</code> file. For more information, see
@OptimisticLocking.</p>
</div>
<div id="BGBFBBCE" class="paragraph">
<p><strong><em>Table 8-1 Translating Hibernate&#8217;s OptimisticLock to EclipseLink&#8217;s
OptimisticLocking</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hibernate&#8217;s OptimisticLock Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EclipseLink
OptimisticLocking</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NONE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No optimistic locking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EclipseLink defaults to no optimistic
locking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>VERSION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a column version</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use the JPA <code>@Version</code> annotation or the EclipseLink annotation:</p>
</div>
<div class="paragraph">
<p><code>@OptimisticLocking(type = OptimisticLockingType.VERSION_COLUMN)</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DIRTY</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changed columns are compared</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use the JPA <code>@Version</code> annotation or the EclipseLink annotation:</p>
</div>
<div class="paragraph">
<p><code>@OptimisticLocking(type = OptimisticLockingType.CHANGED_COLUMNS)</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All columns are compared</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Use the EclipseLink annotation:</p>
</div>
<div class="paragraph">
<p><code>@OptimisticLocking(type = OptimisticLockingType.ALL_COLUMNS)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additionally, EclipseLink allows you to compare a specific set of
selected columns using the <code>OptimisticLockingType.SELECTED_COLUMNS</code>
annotation. This allows you to select the critical columns that should
be compared if the <code>CHANGED</code> or <code>ALL</code> strategies do not meet your needs.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BGBCJCBF"><a class="anchor" href="#BGBCJCBF"></a>Task 3: Convert the Hibernate Custom Sequence Generator Annotation</h4>
<div class="paragraph">
<p>In Hibernate, the <code>@GeneratedValue</code> annotation defines the identifier
generation strategy. The <code>@GenericGenerator</code> allows you to define a
Hibernate-specific ID generator. <a href="#BGBHCBDG">Example 8-2</a> illustrates
a custom generator for sequence values.</p>
</div>
<div id="BGBHCBDG" class="paragraph">
<p><strong><em>Example 8-2 Custom Generator for Sequence Values</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">.
.
.
@Id
   @GeneratedValue(generator = "system-uuid")
   @GenericGenerator(name = "system-uuid", strategy = "mypackage.UUIDGenerator")
   public String getTransactionGuid()
.
.
.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In EclipseLink, a custom sequence generator can be implemented and
registered by using the <code>@GeneratedValue</code> annotation. For more
information, see
<a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/CustomSequencing">"How
to use Custom Sequencing"</a> in the EclipseLink documentation, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/CustomSequencing" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/CustomSequencing</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="BGBDFADJ"><a class="anchor" href="#BGBDFADJ"></a>Task 4: Convert Hibernate Mapping Annotations</h4>
<div class="paragraph">
<p>The following sections describe how to convert various Hibernate
annotations to EclipseLink annotations.</p>
</div>
<div class="sect4">
<h5 id="convert-the-foreignkey-annotation"><a class="anchor" href="#convert-the-foreignkey-annotation"></a>Convert the @ForeignKey Annotation</h5>
<div class="paragraph">
<p>In Hibernate, the <code>@ForeignKey</code> annotation allows you to define the name
of the foreign key to be used during schema generation.</p>
</div>
<div class="paragraph">
<p>EclipseLink does generate reasonable names for foreign keys, but does
not provide an annotation or <code>eclipselink-orm.xml</code> support for
specifying the name to use. When migrating, the recommended solution is
to have EclipseLink generate the schema (DDL) commands to a script file
instead of directly on the database. The script can then be customized
to use different names prior to being executed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The foreign key name is not used by EclipseLink at runtime, but is
required if EclipseLink attempts to drop the schema. In this case, the
drop script should be generated to a file and customized to match the
foreign key names used during creation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="convert-the-cache-annotation"><a class="anchor" href="#convert-the-cache-annotation"></a>Convert the @Cache Annotation</h5>
<div class="paragraph">
<p>In Hibernate, the <code>@Cache</code> annotation configures the caching of entities
and relationships. Because EclipseLink uses an entity cache instead of a
data cache, the relationships are automatically cached. In these cases,
the <code>@Cache</code> annotation should be removed during migration.When the
<code>@Cache</code> annotation is used on an entity, its behavior is similar to the
EclipseLink <code>@Cache</code> annotation. For more information about the <code>@Cache</code>
annotation and equivalent <code>eclipselink-orm.xml</code> configuration values,
see Jakarta Persistence API (JPA) Extensions Reference for EclipseLink.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BGBGAGJD"><a class="anchor" href="#BGBGAGJD"></a>Task 5: Modify the persistence.xml File</h4>
<div class="paragraph">
<p>The <code>persistence.xml</code> file is the deployment descriptor file for JPA
persistence. It specifies the persistence units, and declares the
managed persistence classes, the object-relational mapping, and the
database connection details. <a href="#BGBBIHAD">Example 8-3</a> illustrates a
<code>persistence.xml</code> file for an application that uses Hibernate.
Hibernate-specific values appear in bold font.</p>
</div>
<div id="BGBBIHAD" class="paragraph">
<p><strong><em>Example 8-3 Persistence File for an Application that Uses Hibernate</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence&gt;
   &lt;persistence-unit name="helloworld"&gt;
      &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
      &lt;jta-data-source&gt;java:/DefaultDS&lt;/jta-data-source&gt;
      &lt;properties&gt;
         &lt;property name="hibernate.dialect" value="org.hibernate.dialect.HSQLDialect"/&gt;
         &lt;property name="hibernate.hbm2ddl.auto" value="create-drop"/&gt;
      &lt;/properties&gt;
   &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="modified-persistence-xml-file"><a class="anchor" href="#modified-persistence-xml-file"></a>Modified persistence.xml File</h5>
<div class="paragraph">
<p><a href="#BGBHEIEJ">Example 8-4</a> illustrates a <code>persistence.xml</code> file
modified for an application that uses EclipseLink. Key differences
include the value for the persistence provider. For EclipseLink, this
value is <code>org.eclipse.persistence.jpa.PersistenceProvider</code>. The names of
EclipseLink-specific properties are typically be prefixed by
<code>eclipselink</code>, for example, <code>eclipselink.target-database</code>.
EclipseLink-specific values appear in bold font.</p>
</div>
<div id="BGBHEIEJ" class="paragraph">
<p><strong><em>Example 8-4 Persistence File Modified for EclipseLink</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence version="1.0" xmlns="http://java.sun.com/xml/ns/persistence"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd"&gt;
  &lt;persistence-unit name="helloworld"&gt;
    &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
    &lt;jta-data-source&gt;java:/DefaultDS&lt;/jta-data-source&gt;
    &lt;!-- For Java SE applications, entity classes must be specified for EclipseLink weaving. For Jakarta EE applications, the classes are found automatically. --&gt;
    &lt;class&gt;Todo&lt;/class&gt;
    &lt;properties&gt;
      &lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;
      &lt;property name="eclipselink.ddl-generation.output-mode" value="database"/&gt;
      &lt;property name="eclipselink.logging.level" value="FINE"/&gt;
    &lt;/properties&gt;
  &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="drop-and-create-the-database-tables"><a class="anchor" href="#drop-and-create-the-database-tables"></a>Drop and Create the Database Tables</h5>
<div class="paragraph">
<p>For production environments, you would usually have the schema set up on
the database. The following properties defined in the persistence unit
are more suitable for examples and demonstrations. These properties will
instruct EclipseLink to automatically drop and create database tables.
Any previously existing tables will be removed.</p>
</div>
<div class="paragraph">
<p>To use the Drop and Create Database Tables feature, add the following
properties to the <code>persistence.xml</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.ddl-generation" value="drop-and-create-tables"/&gt;
 &lt;property name="eclipselink.ddl-generation.output-mode" value="database"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on this feature, see the <code>drop-and-create-tables</code>
entry in "ddl-generation" in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="create-or-extend-database-tables"><a class="anchor" href="#create-or-extend-database-tables"></a>Create or Extend Database Tables</h5>
<div class="paragraph">
<p>The Create or Extend Database Tables feature allows you match the
database schema to the object model by creating new database tables or
by modifying existing tables. You can modify existing tables by
specifying field name changes and by add and removing fields.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the current release, the Create or Extend Database Tables feature
will not rename or delete existing columns. It will only add missing
table columns.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Create or Extend Database Tables feature reduces the need to
repopulate test data. You avoid the need to use the Drop and Create
Database Tables feature when the schema changes, due to changes in the
object model. The Create or Extend Database Tables feature can also be
used with extensibility to add table columns.</p>
</div>
<div class="paragraph">
<p>To use the Create or Extend Database Tables feature, add the following
properties to the <code>persistence.xml</code> file. When the context is loaded,
EclipseLink will query the database for each table required in the
persistence unit and use the results to determine if the table needs to
be created or extended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.ddl-generation" value="create-or-extend-tables" /&gt;
 &lt;property name="eclipselink.ddl-generation.output-mode" value="database" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on this feature, see the <code>create-or-extend-tables</code>
entry in "ddl-generation" in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BGBGDHBH"><a class="anchor" href="#BGBGDHBH"></a>Task 6: Convert Hibernate API to EclipseLink API</h4>
<div class="paragraph">
<p><a href="#BGBDAHCF">Table 8-2</a> describes the Hibernate classes that are
commonly used in a JPA project and their equivalent EclipseLink (JPA)
interfaces. All of the Hibernate classes are in the <code>org.hibernate</code>
package. All of the JPA interfaces (and the <code>Persistence</code> class) are in
the <code>jakarta.persistence</code> package.</p>
</div>
<div class="paragraph">
<p>For information about the EclipseLink API, see <em>Java API Reference for
EclipseLink</em>.</p>
</div>
<div id="BGBDAHCF" class="paragraph">
<p><strong><em>Table 8-2 Hibernate Classes and Equivalent JPA Interfaces</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>org.hibernate</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>jakarta.persistence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfg.Configuration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Persistence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides a bootstrap class that
configures the session factory (in Hibernate) or the entity manager
factory (in JPA). It is generally used to create a single session (or
entity manager) factory for the JVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SessionFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EntityManagerFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides APIs to open
Hibernate sessions (or JPA entity managers) to process a user request.
Generally, a session (or entity manager) is opened per thread processing
client requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EntityManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides APIs to store and load entities to
and from the database. It also provides APIs to get a transaction and
create a query.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Transaction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EntityTransaction</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides APIs to manage
transactions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides APIs to execute queries.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="MIGRATEHIBERNATE003"><a class="anchor" href="#MIGRATEHIBERNATE003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hibernate at <code><a href="http://www.hibernate.org" class="bare">http://www.hibernate.org</a></code>.</p>
</li>
<li>
<p>"EclipseLink/Examples/JPA/Migration/Hibernate" in the EclipseLink
documentation, at
<code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Migration/Hibernate" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Migration/Hibernate</a></code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="USINGMULTIDBS"><a class="anchor" href="#USINGMULTIDBS"></a>9. Using Multiple Databases with a Composite Persistence Unit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With EclipseLink, you can expose multiple persistence units (each with
unique sets of entity types) as a single persistence context by using a
<em>composite persistence unit</em>. Individual persistence units that are part
of this composite persistence unit are called <em>composite member
persistence units</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EclipseLink also supports multiple databases through partitioning. See
<a href="#SCALING">Chapter 10, "Scaling Applications in
Clusters"</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#USINGMULTIDBS001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#USINGMULTIDBS002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#USINGMULTIDBS003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users need to map expose multiple persistence units as a single
persistence context within an application.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink supports a "composite" persistence unit which can include
multiple member persistence units.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4.2 or later.</p>
</li>
<li>
<p>Multiple databases.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink examples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Composite" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Composite</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="USINGMULTIDBS001"><a class="anchor" href="#USINGMULTIDBS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>With a composite persistence unit, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Map relationships among any of the entities in multiple persistence
units</p>
</li>
<li>
<p>Access entities stored in multiple databases and different data
sources</p>
</li>
<li>
<p>Easily perform queries and transactions across the complete set of
entities</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#CIHFBBDJ">Example 9-1</a> shows how you can persist data from a single
persistence context into two different databases:</p>
</div>
<div id="CIHFBBDJ" class="paragraph">
<p><strong><em>Example 9-1 Using Multiple Databases</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">em.persist(new A(..));
em.persist(new B(..));
// You can insert A into database1 and insert B into database2.
// The two databases can be from different vendors.

em.flush();</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#BABJAABI">Figure 9-1</a> illustrates a simple composite persistence
unit. EclipseLink processes the <code>persistence.xml</code> file and detects the
composite persistence unit, which contains two composite member
persistence units:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class <strong>A</strong> is mapped by a persistence unit named <strong>memberPu1</strong> located in
the <code>member1.jar</code> file.</p>
</li>
<li>
<p>Class <strong>B</strong> is mapped by a persistence unit named <strong>memberPu2</strong> located in
the <code>member2.jar</code> file.</p>
</li>
</ul>
</div>
<div id="BABJAABI" class="paragraph">
<p><strong><em>Figure 9-1 A Simple Composite Persistence Unit</em></strong></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="data:image/png;base64,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" alt="Description of Figure 9-1 follows" title="Description of Figure 9-1 follows"></span><br>
<a href="img_text/composite_persistence_units.html">Description of "Figure 9-1 A Simple Composite Persistence Unit"</a></p>
</div>
</div>
<div class="sect2">
<h3 id="CIHJCHAF"><a class="anchor" href="#CIHJCHAF"></a>Composite Persistence Unit Requirements</h3>
<div class="paragraph">
<p>When using composite persistence units, note the following requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of each composite member persistence unit must be unique
within the composite.</p>
</li>
<li>
<p>The <code>transaction-type</code> and other properties that correspond to the
entire persistence unit (such as target server, logging, transactions,
and so on) should be defined in the composite persistence unit. If not,
the transaction types, target server information, and logging properties
defined with composite members will be ignored.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="USINGMULTIDBS002"><a class="anchor" href="#USINGMULTIDBS002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section includes the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIHJIFHA">Task 1: Configure the Composite Persistence Unit</a></p>
</li>
<li>
<p><a href="#CIHEIBDH">Task 2: Use Composite Persistence Units</a></p>
</li>
<li>
<p><a href="#CIHFIAJH">Task 3: Deploy Composite Persistence Units</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CIHJIFHA"><a class="anchor" href="#CIHJIFHA"></a>Task 1: Configure the Composite Persistence Unit</h4>
<div class="paragraph">
<p>Because the composite persistence unit is a regular persistence element,
it requires a <code>persistence.xml</code> file. <a href="#CIHHAGCG">Example 9-2</a>
illustrates a sample <code>persistence.xml</code> file. Notice that there are no
<code>datasource</code> or <code>jdbc</code> properties.</p>
</div>
<div id="CIHHAGCG" class="paragraph">
<p><strong><em>Example 9-2 The persistence.xml File for a Composite Persistence
Unit</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_1_0.xsd" version="1.0"&gt;
    &lt;persistence-unit name="compositePu" transaction-type="JTA"&gt;
        &lt;provider&gt;
            org.eclipse.persistence.jpa.PersistenceProvider
        &lt;/provider&gt;

        &lt;jar-file&gt;member1.jar&lt;/jar-file&gt;
        &lt;jar-file&gt;member2.jar&lt;/jar-file&gt;
        &lt;properties&gt;
            &lt;property name="eclipselink.composite-unit" value="true"/&gt;
            &lt;property name="eclipselink.target-server" value="WebLogic_10"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can optionally use the
<code>&lt;property name="eclipselink.composite-unit" value="true"/&gt;</code> property to
identify a persistence unit as a composite persistence unit.</p>
</div>
<div class="paragraph">
<p>Use the <code>&lt;jar-file&gt;</code> element to specify the JAR files containing the
composite member persistence units. The composite persistence unit will
contain all the composite member persistence units found in the JAR
files specified.</p>
</div>
</div>
<div class="sect3">
<h4 id="CIHEIBDH"><a class="anchor" href="#CIHEIBDH"></a>Task 2: Use Composite Persistence Units</h4>
<div class="paragraph">
<p>You can use a composite persistence unit as you would any other
persistence unit; the <code>EntityManager</code> could be injected, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@PersistenceContext(unitName="compositePu")
EntityManagerFactory entityManagerFactory;

@PersistenceContext(unitName="compositePu")
EntityManager entityManager;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or create it manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">EntityManagerFactory entityManagerFactory = Persistence.createEntityManagerFactory("compositePu", properties);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CIHFIAJH"><a class="anchor" href="#CIHFIAJH"></a>Task 3: Deploy Composite Persistence Units</h4>
<div class="paragraph">
<p>To deploy multiple persistence units, deploy all of the JAR files (the
composite persistence unit and its members) on the same class loader.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When deploying to Oracle WebLogic Server, package the JAR files in an
EAR file or the <code>WEB-INF/lib</code> folder of a WAR file.</p>
</li>
<li>
<p>When running as a standalone application, add the JAR files to the
class path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For important requirements, see
<a href="#CIHJCHAF">Composite Persistence Unit
Requirements.</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="USINGMULTIDBS003"><a class="anchor" href="#USINGMULTIDBS003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="paragraph">
<p>For the following additional information about composite persistence
units, see &#8220;@CompositeMember`," "`composite.unit`," and
"`composite-unit.member&#8221; in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Limitations of composite persistence units.</p>
</li>
<li>
<p>Configuring composite member persistence units that contain
dependencies.</p>
</li>
<li>
<p>All persistence unit properties used by composite persistence units
and composite member persistence units</p>
</li>
<li>
<p>How to pass persistence unit properties to composite member
persistence units with the <code>Persistence.createEntityManagerFactory</code>
method, while creating a composite persistence unit
<code>EntityManagerFactory</code></p>
</li>
<li>
<p>All entity manager properties used by composite persistence unit and
composite member persistence units</p>
</li>
<li>
<p>How to pass entity manager properties to composite member persistence
units with the <code>emf.createEntityManager</code> method for the composite
persistence unit <code>EntityManagerFactory</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="related-javadoc"><a class="anchor" href="#related-javadoc"></a>Related Javadoc</h4>
<div class="paragraph">
<p>For more information, see the following APIs in <em>Java API Reference for
EclipseLink</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PersistenceUnitProperties</code> class</p>
</li>
<li>
<p><code>Persistence.createEntityManger</code> class</p>
</li>
<li>
<p><code>EntityManagerFactory</code> interface</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SCALING"><a class="anchor" href="#SCALING"></a>10. Scaling Applications in Clusters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions for configuring EclipseLink
applications to ensure scalability in an application server cluster. The
instructions are generic and can be applied to any application server
cluster; however, additional content is provided for Oracle WebLogic
Server and Oracle GlassFish Server. Consult your vendor&#8217;s documentation
as required.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#SCALING001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#SCALING002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#SCALING003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Applications must scale to meet client demand.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The implementation is achieved by using a cache, configuring cache
coordination, and using data partitioning.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>Application Server that supports clustering.</p>
</li>
<li>
<p>Any compliant JDBC database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See <a href="#SCALING003">Additional Resources,</a> for links to
samples.</p>
</div>
<div class="sect2">
<h3 id="SCALING001"><a class="anchor" href="#SCALING001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink applications that are deployed to an application server
cluster benefit from cluster scalability, load balancing, and failover.
These capabilities ensure that EclipseLink applications are highly
available and scale as application demand increases. EclipseLink
applications are deployed the same way in application server clusters as
they are in standalone server environments. However, additional planning
and configuration is required to ensure cache consistency in an
application server cluster.</p>
</div>
<div class="paragraph">
<p>EclipseLink uses a shared (L2) object cache that avoids database access
for objects and their relationships. The cache is enabled by default and
enhances application performance. In an application server cluster,
caching can result in consistency issues (such as stale data) because
changes made on one server are not reflected on objects cached in other
servers. Cache consistency is problematic only for objects that are
frequently updated. Read-only objects are not affected by cache
consistency. For more details about caching, see:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Caching/Caching_Overview" class="bare">http://wiki.eclipse.org/EclipseLink/UserGuide/JPA/Basic_JPA_Development/Caching/Caching_Overview</a></code></p>
</div>
<div class="paragraph">
<p>Various options are available for addressing cache consistency:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use cache coordination. Cache coordination is a feature that
broadcasts changes between the servers in the cluster to update or
invalidate changed objects.</p>
</li>
<li>
<p>Use distributed caching. EclipseLink Grid is an integration between
EclipseLink and Oracle Coherence that addresses many cache consistency
issues that result from operating in a distributed environment. For
details on EclipseLink Grid, see</p>
</li>
<li>
<p>Use optimistic locking. Optimistic locking is a feature that prevents
updates to stale objects, and triggers the objects to be invalidated in
the cache.</p>
</li>
<li>
<p>Refresh the cache. Refreshing a cache loads that latest data in the
cache.</p>
</li>
<li>
<p>Disable the shared cache for highly volatile entities or limit the
cache to read-only objects.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="SCALING002"><a class="anchor" href="#SCALING002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>These tasks provide general instructions for ensuring that a EclipseLink
application scales in an application server cluster. Complete the tasks
prior to deploying an application.</p>
</div>
<div class="paragraph">
<p>This section contains the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CEGBHAEA">Task 1: Configure Cache Consistency</a></p>
</li>
<li>
<p><a href="#CEGEHGCF">Task 2: Ensure EclipseLink Is Enabled</a></p>
</li>
<li>
<p><a href="#CEGJHBBG">Task 3: Ensure All Application Servers Are Part of the Cluster</a></p>
</li>
<li>
<p><a href="#BABHHAEJ">Using Data Partitioning to Scale Data</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CEGBHAEA"><a class="anchor" href="#CEGBHAEA"></a>Task 1: Configure Cache Consistency</h4>
<div class="paragraph">
<p>This task includes different configuration options that mitigate the
possibility that an application might use stale data when deployed to an
application server cluster. The cache coordination option is
specifically designed for applications that are clustered; however,
evaluate all the options and use them together (if applicable) to create
a solution that results in the best application performance. Properly
configuring a cache can, in some cases, eliminate the need to use cache
coordination. For additional details on these options, see:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/Introduction_to_Cache_%28ELUG%29#Handling_Stale_Data" class="bare">http://wiki.eclipse.org/Introduction_to_Cache_%28ELUG%29#Handling_Stale_Data</a></code></p>
</div>
<div class="paragraph">
<p>The following are the configuration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CEGEDHAB">Disabling Entity Caching</a></p>
</li>
<li>
<p><a href="#CEGBGIFB">Refreshing the Cache</a></p>
</li>
<li>
<p><a href="#CEGCABII">Setting Entity Caching Expiration</a></p>
</li>
<li>
<p><a href="#CEGCHFCD">Setting Optimistic Locking</a></p>
</li>
<li>
<p><a href="#CEGBAIIH">Using Cache Coordination</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Oracle provides a EclipseLink and Coherence integration that allows
EclipseLink to use Coherence as the L2 cache. For details on EclipseLink
Grid, see
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="CEGEDHAB"><a class="anchor" href="#CEGEDHAB"></a>Disabling Entity Caching</h5>
<div class="paragraph">
<p>Disable the shared cache for highly volatile entities or for all
entities as required. To disable the shared cache for all objects, use
the <code>&lt;shared-cache-mode&gt;</code> element in the <code>persistence.xml</code> file. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;shared-cache-mode&gt;NONE&lt;/shared-cache-mode&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration is <code>DISABLE_SELECTIVE</code> and allows caching to
be disabled per entity. To selectively enable or disable the shared
cache, use the <code>shared</code> attribute of the <code>@Cache</code> annotation when
defining an entity. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Cache(shared=false)
public class Employee {
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CEGBGIFB"><a class="anchor" href="#CEGBGIFB"></a>Refreshing the Cache</h5>
<div class="paragraph">
<p>Refreshing a cache reloads the cache from the database to ensure that an
application is using current data. There are different ways to refresh a
cache.</p>
</div>
<div class="paragraph">
<p>The <code>@Cache</code> annotation provides the <code>alwaysRefresh</code> and
<code>refreshOnlyIfNewer</code> attributes which force all queries that go to the
database to refresh the cache. The cache is only actually refreshed if
the optimistic lock value in the database is newer than in the cache.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Cache(
   alwaysRefresh=true,
   refreshOnlyIfNewer=true)
public class Employee {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>jakarta.persistence.Cache</code> interface includes methods that remove
stale objects if the cache is out of date:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>evictAll</code> method invalidates all of the objects in the cache.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">em.getEntityManagerFactory().getCache().evictAll();</code></pre>
</div>
</div>
</li>
<li>
<p>The <code>evict</code> method invalidates specific classes.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">em.getEntityManagerFactory().getCache().evict(MyClass);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The preceding methods are passive and refresh objects only the next time
the cache is accessed. To actively refresh an object, use the
<code>EntityManager.``refresh</code> method. The method refreshes a single object
at a time.</p>
</div>
<div class="paragraph">
<p>Another possibility is to use the <code>setHint</code> method to set a query hint
that triggers the query to refresh the cache. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("Select e from Employee e");
query.setHint("jakarta.persistence.cache.storeMode", "REFRESH");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lastly, native API methods are also available. For details, see the
<code>ClassDescriptor</code> documentation in <em>Java API Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CEGCABII"><a class="anchor" href="#CEGCABII"></a>Setting Entity Caching Expiration</h5>
<div class="paragraph">
<p>Cache expiration makes a cached object instance invalid after a
specified amount of time. Any attempt to use the object causes the most
up-to-date version of the object to be reloaded from the data source.
Expiration can help ensure that an application is always using the most
recent data. There are different ways to set expiration.</p>
</div>
<div class="paragraph">
<p>The <code>@Cache</code> annotation provides the <code>expiry</code> and <code>expiryTimeOfDay</code>
attributes, which remove cache instances after a specific amount of
time. The <code>expiry</code> attribute is entered in milliseconds. The default
value if no value is specified is <code>-1</code>, which indicates that expiry is
disabled. The <code>expiryTimeOfDay</code> attribute is an instance of the
<code>org.eclipse.persistence.annotations.TimeOfDay</code> interface. The following
example sets the object to expire after 5 minutes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Cache(expiry=300000)
public class Employee {
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CEGCHFCD"><a class="anchor" href="#CEGCHFCD"></a>Setting Optimistic Locking</h5>
<div class="paragraph">
<p>Optimistic locking prevents one user from writing over another user&#8217;s
work. Locking is important when multiple servers or multiple
applications access the same data and is relevant in both single-server
and multiple-server environments. In a multiple-server environment,
locking is still required if an application uses cache refreshing or
cache coordination. There are different ways to set optimistic locking.</p>
</div>
<div class="paragraph">
<p>The standard JPA <code>@Version</code> annotation is used for single valued value
and timestamp based locking. However, for advanced locking features use
the <code>@OptimisticLocking</code> annotation. The <code>@OptimisticLocking</code> annotation
specifies the type of optimistic locking to use when updating or
deleting entities. Optimistic locking is supported on an <code>@Entity</code> or
<code>@MappedSuperclass</code> annotation. The following policies are available and
are set within the <code>type</code> attribute:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ALL_COLUMNS</code>: This policy compares every field in the table in the
<code>WHERE</code> clause when performing an update or delete operation.</p>
</li>
<li>
<p><code>CHANGED_COLUMNS</code>: This policy compares only the changed fields in the
<code>WHERE</code> clause when performing an update operation. A delete operation
compares only the primary key.</p>
</li>
<li>
<p><code>SELECTED_COLUMNS</code>: This policy compares selected fields in the
<code>WHERE</code> clause when performing an update or delete operation. The fields
that are specified must be mapped and not be primary keys.</p>
</li>
<li>
<p><code>VERSION_COLUMN</code>: (Default) This policy allows a single version number
to be used for optimistic locking. The version field must be mapped and
not be the primary key. To automatically force a version field update on
a parent object when its privately owned child object&#8217;s version field
changes, use the <code>cascaded</code> method set to <code>true</code>. The method is set to
<code>false</code> by default.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="CEGBAIIH"><a class="anchor" href="#CEGBAIIH"></a>Using Cache Coordination</h5>
<div class="paragraph">
<p>Cache coordination synchronizes changes among distributed sessions.
Cache coordination is most useful in application server clusters where
maintaining consistent data for all applications is challenging.
Moreover, cache consistency becomes increasingly more difficult as the
number of servers within an environment increases.</p>
</div>
<div class="paragraph">
<p>Cache coordination works by broadcasting notifications of transactional
object changes among sessions (<code>EntityManagerFactory</code> or persistence
unit) in the cluster. Cache coordination is most useful for applications
that are primarily read-based and when changes are performed by the same
application operating with multiple, distributed sessions.</p>
</div>
<div class="paragraph">
<p>Cache coordination significantly minimizes stale data, but does not
completely eliminate the possibility that stale data might occur because
of latency. In addition, cache coordination reduces the number of
optimistic lock exceptions encountered in distributed architectures, and
reduces the number of failed or repeated transactions in an application.
However, cache coordination in no way eliminates the need for an
effective locking policy. To ensure the most current data, use cache
coordination with optimistic or pessimistic locking; optimistic locking
is preferred.</p>
</div>
<div class="paragraph">
<p>Cache coordination is supported over the Remote Method Invocation (RMI)
and Java Message Service (JMS) protocols and is configured either
declaratively by using persistence properties in a <code>persistence.xml</code>
file or by using the cache coordination API. System properties that
match the persistence properties are available as well.</p>
</div>
<div class="paragraph">
<p>For additional details on cache coordination see:</p>
</div>
<div class="paragraph">
<p><em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em></p>
</div>
<div class="sect5">
<h6 id="setting-cache-synchronization"><a class="anchor" href="#setting-cache-synchronization"></a>Setting Cache Synchronization</h6>
<div class="paragraph">
<p>Cache synchronization determines how notifications of object changes are
broadcast among session members. The following synchronization options
are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SEND_OBJECT_CHANGES</code>: (Default) This option broadcasts a list of
changed objects including data about the changes. This data is merged
into the receiving cache.</p>
</li>
<li>
<p><code>INVALIDATE_CHANGED_OBJECTS</code>: This option broadcasts a list of the
identities of the objects that have changed. The receiving cache
invalidates the objects rather than changing any of the data. This
option is the lightest in terms of data sent and processing done in
other cluster members.</p>
</li>
<li>
<p><code>SEND_NEW_OBJECTS_WITH_CHANGES</code>: This option is the same as the
<code>SEND_OBJECT_CHANGES</code> option except it also includes any newly created
objects from the transaction.</p>
</li>
<li>
<p><code>NONE</code>: This option does no cache coordination.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>@Cache</code> annotation <code>coordinationType</code> attribute is used to specify
synchronization. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Cache(CacheCoordinationType.SEND_NEW_OBJECTS_CHANGES)
public class Employee {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ClassDescriptor.setCacheSynchronizationType</code> native API method can
also be used to specify synchronization. For details, see the
<code>ClassDescriptor</code> documentation in <em>Java API Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect5">
<h6 id="configuring-jms-cache-coordination-using-persistence-properties"><a class="anchor" href="#configuring-jms-cache-coordination-using-persistence-properties"></a>Configuring JMS Cache Coordination Using Persistence Properties</h6>
<div class="paragraph">
<p>The following example demonstrates how to configure cache coordination
in the <code>persistence.xml</code> file and uses JMS for broadcast notification.
For JMS, provide a JMS topic JNDI name and topic connection factory JNDI
name. The JMS topic should not be JTA-enabled and should not have
persistent messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.protocol" value="jms" /&gt;
&lt;property name="eclipselink.cache.coordination.jms.topic"
   value="jms/EmployeeTopic" /&gt;
&lt;property name="eclipselink.cache.coordination.jms.factory"
   value="jms/EmployeeTopicConnectionFactory" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications that run in a cluster generally do not require a URL
because the topic provides enough to locate and use the resource. For
applications that run outside the cluster, a URL is required. The
following example is a URL for a WebLogic Server cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.jms.host"
   value="t3://myserver:7001/" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A user name and password for accessing the servers can also be set if
required. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.jndi.user" value="user" /&gt;
&lt;property name="eclipselink.cache.coordination.jndi.password" value="password" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configuring-rmi-cache-coordination-using-persistence-properties"><a class="anchor" href="#configuring-rmi-cache-coordination-using-persistence-properties"></a>Configuring RMI Cache Coordination Using Persistence Properties</h6>
<div class="paragraph">
<p>The following example demonstrates how to configure cache coordination
in the <code>persistence.xml</code> file and uses RMI for broadcast notification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.protocol" value="rmi" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications that run in a cluster generally do not require a URL
because JNDI is replicated and servers can look up each other. If an
application runs outside of a cluster, or if JNDI is not replicated,
then each server must provide its URL. This could be done through the
<code>persistence.xml</code> file; however, different <code>persistence.xml</code> files (thus
JAR or EAR) for each server is required, which is usually not desirable.
A second option is to set the URL programmatically using the cache
coordination API. For more details, see <a href="#CEGBJIFB">"Configuring
Cache Coordination Using the Cache Coordination API"</a>. The final option
is to set the URL as a system property on each application server. The
following example sets the URL for a WebLogic Server cluster using a
system property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">-Declipselink.cache.coordination.jms.host=t3://myserver:7001/</code></pre>
</div>
</div>
<div class="paragraph">
<p>A user name and password for accessing the servers can also be set if
required; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.jndi.user" value="user" /&gt;&lt;property name="eclipselink.cache.coordination.jndi.password" value="password" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>RMI cache coordination can use either asynchronous or synchronous
broadcasting notification; asynchronous is the default. Synchronous
broadcasting ensures that all of the servers are updated before a
request returns. The following example configures synchronous
broadcasting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.propagate-asynchronously"
   value="false" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If multiple applications on the same server or network use cache
coordination, then a separate channel can be used for each application.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.channel" value="EmployeeChannel" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Last, if required, change the default RMI multicast socket address that
allows servers to find each other. The following example explicitly
configures the multicast settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.coordination.rmi.announcement-delay"
   value="1000" /&gt;
&lt;property name="eclipselink.cache.coordination.rmi.multicast-group"
   value="239.192.0.0" /&gt;
&lt;property name="eclipselink.cache.coordination.rmi.multicast-group.port"
   value="3121" /&gt;
&lt;property name="eclipselink.cache.coordination.packet-time-to-live" value="2" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cache-coordination-and-oracle-weblogic"><a class="anchor" href="#cache-coordination-and-oracle-weblogic"></a>Cache Coordination and Oracle WebLogic</h6>
<div class="paragraph">
<p>Both RMI and JMS cache coordination work with Oracle WebLogic Server.
When a WebLogic cluster is used JNDI is replicated among the cluster
servers, so a <code>cache.coordination.rmi.url</code> or a
<code>cache.coordination.jms.host</code> option is not required. For JMS cache
coordination, the JMS topic should only be deployed to only one of the
servers (as of Oracle WebLogic 10.3.6). It may be desirable to have a
dedicated JMS server if the JMS messaging traffic is heavy.</p>
</div>
<div class="paragraph">
<p>Use of other JMS services in WebLogic may have other requirements.</p>
</div>
</div>
<div class="sect5">
<h6 id="cache-coordination-and-glassfish"><a class="anchor" href="#cache-coordination-and-glassfish"></a>Cache Coordination and Glassfish</h6>
<div class="paragraph">
<p>JMS cache coordination works with Glassfish Server. When a Glassfish
cluster is used, JNDI is replicated among the cluster servers, so a
<code>cache.coordination.jms.host</code> option is not required.</p>
</div>
<div class="paragraph">
<p>Use of other JMS services in Glassfish may have other requirements.</p>
</div>
<div class="paragraph">
<p>RMI cache coordination does not work when the JNDI naming service option
is used in a Glassfish cluster. RMI will work if the
<code>eclipselink.cache.coordination.naming-service</code> option is set to <code>rmi</code>.
Each server must provide its own
<code>eclipselink.cache.coordination.rmi.url</code> option, either by having a
different <code>persistence.xml</code> file for each server, or by setting the URL
as a System property in the server, or through a customizer.</p>
</div>
</div>
<div class="sect5">
<h6 id="cache-coordination-and-ibm-websphere"><a class="anchor" href="#cache-coordination-and-ibm-websphere"></a>Cache Coordination and IBM WebSphere</h6>
<div class="paragraph">
<p>JMS cache coordination may have issues on IBM WebSphere. Use of a
Message Driven Bean (MDB) may be required to allow access to JMS. To use
an MDB with cache coordination, set the
<code>eclipselink.cache.coordination.protocol</code> option to the value
<code>jms-publishing</code>. The application will also have to deploy an MDB that
processes cache coordination messages in its EAR file.</p>
</div>
</div>
<div class="sect5">
<h6 id="CEGBJIFB"><a class="anchor" href="#CEGBJIFB"></a>Configuring Cache Coordination Using the Cache Coordination API</h6>
<div class="paragraph">
<p>The <code>CommandManager</code> interface allows you to programmatically configure
cache coordination for a session. The interface is accessed using the
<code>getCommandManager</code> method from the <code>DatabaseSession</code> interface.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CEGEHGCF"><a class="anchor" href="#CEGEHGCF"></a>Task 2: Ensure EclipseLink Is Enabled</h4>
<div class="paragraph">
<p>Ensure that the EclipseLink JAR files are included on the classpath of
each application server in the cluster to which the EclipseLink
application is deployed and configure EclipseLink as the persistence
provider. For detailed instructions about setting up EclipseLink with
WebLogic Server and GlassFish Server, see
<a href="#ELWLS">Chapter 3, "Using EclipseLink with WebLogic
Server,"</a> and <a href="#ELGS">Chapter 4, "Using EclipseLink
with GlassFish Server,"</a> respectively.</p>
</div>
</div>
<div class="sect3">
<h4 id="CEGJHBBG"><a class="anchor" href="#CEGJHBBG"></a>Task 3: Ensure All Application Servers Are Part of the Cluster</h4>
<div class="paragraph">
<p>Configure an application server cluster that includes each application
server that hosts the EclipseLink application:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TopLink relies on JMS and RMI and does not use the application server&#8217;s
cluster communication.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For WebLogic Server clustering see <em>Oracle Fusion Middleware Using
Clusters for Oracle WebLogic Server</em>.</p>
</li>
<li>
<p>For GlassFish Server clustering, see:</p>
<div class="paragraph">
<p><code><a href="http://download.oracle.com/docs/cd/E18930_01/html/821-2426/index.html" class="bare">http://download.oracle.com/docs/cd/E18930_01/html/821-2426/index.html</a></code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BABHHAEJ"><a class="anchor" href="#BABHHAEJ"></a>Using Data Partitioning to Scale Data</h3>
<div class="paragraph">
<p>Data partitioning allows an application to scale its data across more
than one database machine. Data partitioning is supported at the entity
level to allow a different set of entity instances for the same class to
be stored in a different physical database or different node within a
database cluster. Both regular databases and clustered databases are
supported. Data can be partitioned both horizontally and vertically.</p>
</div>
<div class="paragraph">
<p>Partitioning can be enabled on an entity, a relationship, a query, or a
persistence unit. To configure data partitioning, use the <code>@Partitioned</code>
annotation and one or more partitioning policy annotations.
<a href="#BABBIJCD">Table 10-1</a> describes the partitioning policies</p>
</div>
<div id="BABBIJCD" class="paragraph">
<p><strong><em>Table 10-1 Partitioning Policies</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Annotation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@HashPartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partitions access to a database cluster by the
hash of a field value from the object, such as the object&#8217;s ID,
location, or tenant. The hash indexes into the list of connection
pools/nodes. All write or read request for objects with that hash value
are sent to the same server. If a query does not include the hash field
as a parameter, it can be sent to all servers and unioned, or it can be
left to the session&#8217;s default behavior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@PinnedPartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pins requests to a single connection pool/node.
This allows for vertical partitioning.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RangePartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partitions access to a database cluster by a
field value from the object, such as the object&#8217;s ID, location, or
tenant. Each server is assigned a range of values. All write or read
requests for objects with that value are sent to the same server. If a
query does not include the field as a parameter, then it can either be
sent to all servers and unioned, or left to the session&#8217;s default
behavior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ReplicationPartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends requests to a set of connection
pools/nodes. This policy is for replicating data across a cluster of
database machines. Only modification queries are replicated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@RoundRobinPartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends requests in a round-robin fashion to
the set of connection pools/nodes. This policy is used for load
balancing read queries across a cluster of database machines. It
requires that the full database be replicated on each machine, so it
does not support partitioning. The data should either be read-only, or
writes should be replicated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@UnionPartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sends queries to all connection pools and unions
the results. This is for queries or relationships that span partitions
when partitioning is used, such as on a ManyToMany cross partition
relationship.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@ValuePartitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partitions access to a database cluster by a
field value from the object, such as the object&#8217;s location or tenant.
Each value is assigned a specific server. All write or read requests for
objects with that value are sent to the same server. If a query does not
include the field as a parameter, then it can be sent to all servers and
unioned, or it can be left to the session&#8217;s default behavior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@Partitioning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Partitions access to a database cluster by a custom
partitioning policy. A class that extends the <code>PartitioningPolicy</code> class
must be provided.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Partitioning policies are globally-named objects in a persistence unit
and are reusable across multiple descriptors or queries. This improves
the usability of the configuration, specifically with JPA annotations
and XML.</p>
</div>
<div class="paragraph">
<p>The persistence unit properties support adding named connection pools in
addition to the existing configuration for read/write/sequence.
Connection pools are defined in the <code>persistence.xml</code> file for each
participating database. Partition policies select the appropriate
connection based on their particular algorithm.</p>
</div>
<div class="paragraph">
<p>If a transaction modifies data from multiple partitions, JTA should be
used to ensure 2-phase commit of the data. An exclusive connection can
also be configured in an <code>EntityManager</code> implementation to ensure only a
single node is used for a single transaction.</p>
</div>
<div class="paragraph">
<p>The following example partitions the <code>Employee</code> data by location. The
two primary sites, Ottawa and Toronto, are each stored on a separate
database. All other locations are stored on the default database.
Project is range partitioned by its ID. Each range of ID values are
stored on a different database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@IdClass(EmployeePK.class)
@UnionPartitioning(
        name="UnionPartitioningAllNodes",
        replicateWrites=true)
@ValuePartitioning(
        name="ValuePartitioningByLOCATION",
        partitionColumn=@Column(name="LOCATION"),
        unionUnpartitionableQueries=true,
        defaultConnectionPool="default",
        partitions={
            @ValuePartition(connectionPool="node2", value="Ottawa"),
            @ValuePartition(connectionPool="node3", value="Toronto")
        })
@Partitioned("ValuePartitioningByLOCATION")
public class Employee {
    @Id
    @Column(name = "EMP_ID")
    private Integer id;
     @Id
    private String location;
    ...

    @ManyToMany(cascade = { PERSIST, MERGE })
    @Partitioned("UnionPartitioningAllNodes")
    private Collection&lt;Project&gt; projects;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The employee/project relationship is an example of a cross partition
relationship. To allow the employees and projects to be stored on
different databases a union policy is used and the join table is
replicated to each database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@RangePartitioning(
        name="RangePartitioningByPROJ_ID",
        partitionColumn=@Column(name="PROJ_ID"),
        partitionValueType=Integer.class,
        unionUnpartitionableQueries=true,
        partitions={
            @RangePartition(connectionPool="default", startValue="0",
               endValue="1000"),
            @RangePartition(connectionPool="node2", startValue="1000",
               endValue="2000"),
            @RangePartition(connectionPool="node3", startValue="2000")
        })
@Partitioned("RangePartitioningByPROJ_ID")
public class Project {
    @Id
    @Column(name="PROJ_ID")
    private Integer id;
    ...
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="clustered-databases-and-oracle-rac"><a class="anchor" href="#clustered-databases-and-oracle-rac"></a>Clustered Databases and Oracle RAC</h4>
<div class="paragraph">
<p>Some databases support clustering the database across multiple servers.
Oracle Real Application Clusters (RAC) allows for a single database to
span multiple different server nodes. Oracle RAC also supports table and
node partitioning of data. A database cluster allows for any of the data
to be accessed from any node in the cluster. However, it is generally
more efficient to partition the data access to specific nodes, to reduce
cross node communication. Partitioning can be used in conjunction with a
clustered database to reduce cross node communication, and improve
scalability. For details on using EclipseLink with Oracle RAC, see
<a href="#CHDIEBBB">Using EclipseLink with Oracle RAC.</a></p>
</div>
<div class="paragraph">
<p>Adhere to the following requirements when using data partitioning with a
database cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Partition policy should not enable replication, as database cluster
makes data available to all nodes.</p>
</li>
<li>
<p>Partition policy should not use unions, as database cluster returns
the complete query result from any node.</p>
</li>
<li>
<p>A <code>DataSource</code> and connection pool should be defined for each node in
the cluster.</p>
</li>
<li>
<p>The application&#8217;s data access and data partitioning should be designed
to have each transaction only require access to a single node.</p>
</li>
<li>
<p>Usage of an exclusive connection for an <code>EntityManager</code> is recommended
to avoid having multiple nodes in a single transaction and avoid 2-phase
commit.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="SCALING003"><a class="anchor" href="#SCALING003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="paragraph">
<p>The following code sample and JavaDoc resources are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code Samples</p>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/CacheCoordination" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/CacheCoordination</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>See the following APIs in <em>Java API Reference for EclipseLink</em>.</p>
<div class="ulist">
<ul>
<li>
<p><code>org.eclipse.persistence.annotations.OptimisticLocking</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.annotations.Cache</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.annotations.Partitioned</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.descriptors.ClassDescriptor</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.sessions.coordination</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="SAAS"><a class="anchor" href="#SAAS"></a>11. Providing Software as a Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter introduces EclipseLink features available for developing
shared applications that run in Software-as-a-Service (SaaS)
environments.</p>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to establish an SaaS environment, where applications and data
are shared by multiple clients.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Use EclipseLink SaaS features, such as extensibility, client isolation,
and external metadata sources.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="SAAS001"><a class="anchor" href="#SAAS001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>With EclipseLink, you can manage persistence in cloud-enabled
applications and services. EclipseLink provides flexible SaaS solutions
that address multi-tenancy and extensibility while still maintaining
high performance and scalability, making the persistence layer of these
applications a critical component.</p>
</div>
<div class="paragraph">
<p>These features are discussed in the following chapters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#EXTENSIBLE">Chapter 12, "Making JPA Entities and JAXB Beans Extensible"</a></p>
</li>
<li>
<p><a href="#METADATASOURCE">Chapter 13, "Using an External MetaData Source"</a></p>
</li>
<li>
<p><a href="#MULTITENANCY">Chapter 14, "Tenant Isolation Using EclipseLink"</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXTENSIBLE"><a class="anchor" href="#EXTENSIBLE"></a>12. Making JPA Entities and JAXB Beans Extensible</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions for making JPA entities and JAXB
beans extensible. Mappings can be added or modified externally, without
modifying the entity or bean source file and without redeploying the
persistence unit. This feature is useful in a Software-as-a-Service
environment where multiple clients can share applications and
datasources. It is also useful for customizing an application during
installation rather than during development.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#EXTENSIBLE001">Making JPA Entities Extensible</a></p>
</li>
<li>
<p><a href="#EXTENSIBLE002">Making JAXB Beans Extensible</a></p>
</li>
<li>
<p><a href="#EXTENSIBLE003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to establish a SaaS environment, where applications and
datasources are shared by multiple clients.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Use the EclipseLink extensibility feature to extend JPA entities and
JAXB beans by using external mappings.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="EXTENSIBLE001"><a class="anchor" href="#EXTENSIBLE001"></a>Making JPA Entities Extensible</h3>
<div class="paragraph">
<p>Use the <code>@VirtualAccessMethods</code> annotation to specify that an entity is
extensible. By using virtual properties in an extensible entity, you can
specify mappings external to the entity. This allows you to modify the
mappings without modifying the entity source file and without
redeploying the entity&#8217;s persistence unit.</p>
</div>
<div class="paragraph">
<p>Extensible entities are useful in a multi-tenant (or SaaS) architecture
where a shared, generic application can be used by multiple clients
(tenants). Tenants have private access to their own data, and to data
shared with other tenants.</p>
</div>
<div class="paragraph">
<p>Using extensible entities, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Build an application where some mappings are common to all users and
some mappings are user-specific.</p>
</li>
<li>
<p>Add mappings to an application after it is made available to a
customer (even post-deployment).</p>
</li>
<li>
<p>Use the same <code>EntityManagerFactory</code> interface to work with data after
mappings have changed.</p>
</li>
<li>
<p>Provide an additional source of metadata to be used by an application.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="main-tasks-for-creating-and-supporting-an-extensible-jpa-entity"><a class="anchor" href="#main-tasks-for-creating-and-supporting-an-extensible-jpa-entity"></a>Main Tasks for Creating and Supporting an Extensible JPA Entity</h4>
<div class="paragraph">
<p>To create and support an extensible JPA entity:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIAHBEAJ">Task 1: Configure the Entity</a></p>
</li>
<li>
<p><a href="#CIAIJJDH">Task 2: Design the Schema</a></p>
</li>
<li>
<p><a href="#CIAECEAE">Task 3: Provide Additional Mappings</a></p>
</li>
<li>
<p><a href="#CIAIJHAG">Task 4: Externalizing Extensions Using a
MetaDataSource</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CIAHBEAJ"><a class="anchor" href="#CIAHBEAJ"></a>Task 1: Configure the Entity</h5>
<div class="paragraph">
<p>Configure the entity by annotating the entity class with
<code>@VirtualAccessMethods</code> (or using the XML <code>&lt;access-methods&gt;</code>), adding
<code>get</code> and <code>set</code> methods for the property values, and adding a data
structure to store the extended attributes and values, as described in
the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIAGGIHJ">Annotate the Entity Class with @VirtualAccessMethods</a></p>
</li>
<li>
<p><a href="#CIAJFEFA">Add get and set Methods to the Entity</a></p>
</li>
<li>
<p><a href="#CIAHBEBF">Define Virtual Attribute Storage</a></p>
</li>
<li>
<p><a href="#CIAIFCJE">Use XML</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="CIAGGIHJ"><a class="anchor" href="#CIAGGIHJ"></a>Annotate the Entity Class with @VirtualAccessMethods</h6>
<div class="paragraph">
<p>Annotate the entity with <code>@VirtualAccessMethods</code> to specify that it is
extensible and to define virtual properties.</p>
</div>
<div class="paragraph">
<p><a href="#CIAHBGHB">Table 12-1</a> describes the attributes available to the
<code>@VirtualAccessMethods</code> annotation.</p>
</div>
<div id="CIAHBGHB" class="paragraph">
<p><strong><em>Table 12-1 Attributes for the @VirtualAccessMethods Annotation</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Attribute</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the <code>get`ter method to use for the virtual property. This
method must take a single `java.lang.String</code> parameter and return a
<code>java.lang.Object</code> parameter.</p>
</div>
<div class="paragraph">
<p>Default: <code>get</code></p>
</div>
<div class="paragraph">
<p>Required? No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>set</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the <code>set`ter method to use for the virtual property. This
method must take a `java.lang.String</code> and a <code>java.lang.Object</code> parameter
and return a <code>java.lang.Object</code> parameter.</p>
</div>
<div class="paragraph">
<p>Default: <code>set</code></p>
</div>
<div class="paragraph">
<p>Required? No</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="CIAJFEFA"><a class="anchor" href="#CIAJFEFA"></a>Add get and set Methods to the Entity</h6>
<div class="paragraph">
<p>Add <code>get(String)</code> and <code>set(String, Object)</code> methods to the entity. The
<code>get()</code> method returns a value by property name and the <code>set()</code> method
stores a value by property name. The default names for these methods are
<code>get</code> and <code>set</code>, and they can be overridden with the
<code>@VirtualAccessMethods</code> annotation.</p>
</div>
<div class="paragraph">
<p>EclipseLink weaves these methods if weaving is enabled, which provides
support for lazy loading, change tracking, fetch groups, and internal
optimizations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Weaving is not supported when using virtual access methods with
<code>OneToOne</code> mappings. If attempted, an exception will be thrown.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="CIAHBEBF"><a class="anchor" href="#CIAHBEBF"></a>Define Virtual Attribute Storage</h6>
<div class="paragraph">
<p>Add a data structure to store the extended attributes and values, that
is, the virtual mappings. These can then be mapped to the database. See
<a href="#CIAECEAE">Task 3: Provide Additional Mappings.</a></p>
</div>
<div class="paragraph">
<p>A common way to store the virtual mappings is in a <code>Map</code> object (as
shown in <a href="#BABJBFGB">Example 12-1</a>), but you can also use other
strategies.</p>
</div>
<div class="paragraph">
<p>When using field-based access, annotate the data structure with
<code>@Transient</code> so the structure cannot be used for another mapping. When
using property-based access, <code>@Transient</code> is unnecessary.</p>
</div>
<div class="paragraph">
<p><a href="#BABJBFGB">Example 12-1</a> illustrates an entity class that uses
property access.</p>
</div>
<div id="BABJBFGB" class="paragraph">
<p><strong><em>Example 12-1 Entity Class that Uses Property Access</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@VirtualAccessMethods
public class Customer{

    @Id
    private int id;
    ...

    @Transient
    private Map&lt;String, Object&gt; extensions;

    public &lt;T&gt; T get(String name) {
        return (T) extentions.get(name);
    }

    public Object set(String name, Object value) {
        return extensions.put(name, value);
    }</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CIAIFCJE"><a class="anchor" href="#CIAIFCJE"></a>Use XML</h6>
<div class="paragraph">
<p>As an alternative to, or in addition to, using the
<code>@VirtualAccessMethods</code> annotation, you can use an <code>access="VIRTUAL"</code>
attribute on a mapping element (such as <code>&lt;basic&gt;</code>), for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;basic name="idNumber" access="VIRTUAL" attribute-type="String"&gt;
    &lt;column name="FLEX_COL1"/&gt;
&lt;/basic&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To set virtual access methods as the defaults for the persistence unit,
use the <code>&lt;access&gt;</code> and <code>&lt;access-methods&gt;</code> elements, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit-metadata&gt;
           &lt;xml-mapping-metadata-complete/&gt;
           &lt;exclude-default-mappings/&gt;
           &lt;persistence-unit-defaults&gt;
                &lt;access&gt;VIRTUAL&lt;/access&gt;
                &lt;access-methods set-method="get" get-method="set"/&gt;
              &lt;/persistence-unit-defaults&gt;
   &lt;/persistence-unit-metadata&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CIAIJJDH"><a class="anchor" href="#CIAIJJDH"></a>Task 2: Design the Schema</h5>
<div class="paragraph">
<p>Provide database tables with extra columns to store virtual attribute
values. For example, the following <code>Customer</code> table includes two
predefined columns, <code>ID</code> and <code>NAME</code>, and three columns for storing the
attribute values, <code>EXT_1</code>, <code>EXT_2</code>, <code>EXT_3</code>:</p>
</div>
<div class="paragraph">
<p><code>CUSTOMER</code> table</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>INTEGER</code> <code>ID</code></p>
</li>
<li>
<p><code>VARCHAR</code> <code>NAME</code></p>
</li>
<li>
<p><code>VARCHAR</code> <code>EXT_1</code></p>
</li>
<li>
<p><code>VARCHAR</code> <code>EXT_2</code></p>
</li>
<li>
<p><code>VARCHAR</code> <code>EXT_3</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can then specify which of the <code>FLEX</code> columns should be used to
persist an extended attribute, as described in <a href="#CIAECEAE">"Task 3:
Provide Additional Mappings"</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CIAECEAE"><a class="anchor" href="#CIAECEAE"></a>Task 3: Provide Additional Mappings</h5>
<div class="paragraph">
<p>To provide additional mappings, add the mappings with the <code>column</code> and
<code>access-methods</code> attributes to the <code>eclipselink-orm.xml</code> file, for
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;basic name="idNumber" access="VIRTUAL" attribute-type="String"&gt;
  &lt;column name="FLEX_COL1"/&gt;
&lt;/basic&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CIAIJHAG"><a class="anchor" href="#CIAIJHAG"></a>Task 4: Externalizing Extensions Using a MetaDataSource</h5>
<div class="paragraph">
<p>Configure persistence unit properties to indicate that the application
should retrieve the flexible mappings from the <code>eclipselink-orm.xml</code>
file. You can set persistence unit properties using the
<code>persistence.xml</code> file or by setting properties on the
<code>EntityManagerFactory</code> interface, as described in the following
sections.</p>
</div>
<div class="paragraph">
<p>For more information about external mappings, see
<a href="//metadatasource.htm#METADATASOURCE">Chapter 13, "Using an External MetaData Source."</a></p>
</div>
<div class="sect5">
<h6 id="configure-the-persistence-xml-file"><a class="anchor" href="#configure-the-persistence-xml-file"></a>Configure the persistence.xml File</h6>
<div class="paragraph">
<p>In the <code>persistence.xml</code> file, use the <code>eclipselink.metadata-source</code>
property to use the default <code>eclipselink-orm.xml</code> file. Use the
<code>eclipselink.metadata-source.xml.url</code> property to use a different file
at the specified location, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.metadata-source" value="XML"/&gt;
&lt;property name="eclipselink.metadata-source.xml.url" value="foo://bar"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-entitymanagerfactory-and-the-metadata-repository"><a class="anchor" href="#configure-entitymanagerfactory-and-the-metadata-repository"></a>Configure EntityManagerFactory and the Metadata Repository</h6>
<div class="paragraph">
<p>Extensions are added at bootstrap time through access to a metadata
repository. The metadata repository is accessed through a class that
provides methods to retrieve the metadata it holds. EclipseLink includes
a metadata repository implementation that supports XML repositories.</p>
</div>
<div class="paragraph">
<p>Specify the class to use and any configuration information for the
metadata repository through persistence unit properties. The
<code>EntityManagerFactory</code> interface integrates additional mapping
information from the metadata repository into the metadata it uses to
bootstrap.</p>
</div>
<div class="paragraph">
<p>You can provide your own implementation of the class to access the
metadata repository. Each metadata repository access class must specify
an individual set of properties to use to connect to the repository.</p>
</div>
<div class="paragraph">
<p>You can subclass either of the following classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.eclipse.persistence.internal.jpa.extensions.MetadataRepository</code></p>
</li>
<li>
<p><code>org.eclipse.persistence.internal.jpa.extensions.XMLMetadataRepository</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example, the properties that begin with <code>com.foo</code> are
subclasses defined by the developer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.metadata-source" value="com.foo.MetadataRepository"/&gt;
&lt;property name="com.foo.MetadataRepository.location" value="foo://bar"/&gt;
&lt;property name="com.foo.MetadataRepository.extra-data" value="foo-bar"/&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="refresh-the-metadata-repository"><a class="anchor" href="#refresh-the-metadata-repository"></a>Refresh the Metadata Repository</h6>
<div class="paragraph">
<p>If you change the metadata and you want an <code>EntityManager</code> instance
based on the new metadata, you must call the <code>refreshMetadata()</code> method
on the <code>EntityManagerFactory</code> interface to refresh the data. The next
<code>EntityManager</code> instance will be based on the new metadata.</p>
</div>
<div class="paragraph">
<p>The <code>refreshMetadata()</code> method takes a map of properties that can be
used to override the properties previously defined for the
<code>metadata-source</code> element.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="code-examples"><a class="anchor" href="#code-examples"></a>Code Examples</h4>
<div class="paragraph">
<p><a href="#CIADHIHE">Example 12-2</a> illustrates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Field access is used for non-extension fields.</p>
</li>
<li>
<p>Virtual access is used for extension fields, using defaults
(<code>get(String)</code> and <code>set(String, Object)</code>).</p>
</li>
<li>
<p>The <code>get(String)</code> and <code>set(String, Object)</code> methods will be woven,
even if no mappings use them, because of the presence of
<code>@VirtualAccessMethods</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These items are illustrated in bold font.</p>
</div>
<div id="CIADHIHE" class="paragraph">
<p><strong><em>Example 12-2 Virtual Access Using Default get and set Method Names</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@VirtualAccessMethods
public class Address {

    @Id
    private int id;

    @Transient
    private Map&lt;String, Object&gt; extensions;

    public int getId(){
        return id;
    }

    public &lt;T&gt; T get(String name) {
        return (T) extentions.get(name);
    }

    public Object set(String name, Object value) {
        return extensions.put(name, value);
    }
.
.
.</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAHGIEJ">Example 12-3</a> illustrates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Field access is used for non-extension fields.</p>
</li>
<li>
<p>The <code>@VirtualAccessMethods</code> annotation overrides methods to be used
for getting and setting.</p>
</li>
<li>
<p>The <code>get(String)</code> and <code>set(String, Object)</code> methods will be woven,
even if no mappings use them, because of the presence of
<code>@VirtualAccessMethods</code>.</p>
</li>
<li>
<p>The XML for extended mapping indicates which <code>get()</code> and <code>set()</code>
method to use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These items are illustrated in bold font.</p>
</div>
<div id="CIAHGIEJ" class="paragraph">
<p><strong><em>Example 12-3 Overriding get and set Methods</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@VirtualAccessMethods(get="getExtension", set="setExtension")
public class Address {

    @Id
    private int id;

    @Transient
    private Map&lt;String, Object&gt; extensions;

    public int getId(){
        return id;
    }

    public &lt;T&gt; T getExtension(String name) {
        return (T) extensions.get(name);
    }

    public Object setExtension(String name, Object value) {
        return extensions.put(name, value);
    }

    ...

    &lt;basic name="name"  access="VIRTUAL" attribute-type="String"&gt;
      &lt;column name="FLEX_1"/&gt;
    &lt;/basic&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIADJCIB">Example 12-4</a> illustrates the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Property access is used for non-extension fields.</p>
</li>
<li>
<p>Virtual access is used for extension fields, using defaults
(<code>get(String)</code> and <code>set(String, Object)</code>).</p>
</li>
<li>
<p>The extensions are mapped in a portable way. <code>@Transient</code> is not
required, because property access is used.</p>
</li>
<li>
<p>The <code>get(String)</code> and <code>set(String, Object)</code> methods will be woven,
even if no mappings use them, because of the presence of
<code>@VirtualAccessMethods</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These items are illustrated in bold font.</p>
</div>
<div id="CIADJCIB" class="paragraph">
<p><strong><em>Example 12-4 Using Property Access</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@VirtualAccessMethods
public class Address {

    private int id;

    private Map&lt;String, Object&gt; extensions;

    @Id
    public int getId(){
        return id;
    }

    public &lt;T&gt; T get(String name) {
        return (T) extensions.get(name);
    }

    public Object set(String name, Object value) {
        return extensions.put(name, value);
    }

...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="EXTENSIBLE002"><a class="anchor" href="#EXTENSIBLE002"></a>Making JAXB Beans Extensible</h3>
<div class="paragraph">
<p>Use the <code>@XmlVirtualAccessMethods</code> annotation to specify that a JAXB
bean is extensible. By using virtual properties in an extensible bean,
you can specify mappings external to the bean. This allows you to modify
the mappings without modifying the bean source file and without
redeploying the bean&#8217;s persistence unit.</p>
</div>
<div class="paragraph">
<p>In a multi-tenant (or SaaS) architecture, a single application runs on a
server, serving multiple client organizations (tenants). Good
multi-tenant applications allow per-tenant customizations. When these
customizations are made to data, it can be difficult for the binding
layer to handle them. JAXB is designed to work with domain models that
have real fields and properties. EclipseLink extensions to JAXB
introduce the concept of virtual properties which can easily handle this
use case. Virtual properties are defined by the Object-XML metadata
file, and provide a way to extend a class without modifying the source.</p>
</div>
<div class="paragraph">
<p>This section has the following subsections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIAFIAAF">Main Steps</a></p>
</li>
<li>
<p><a href="#CIAEDJHB">Code Examples</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CIAFIAAF"><a class="anchor" href="#CIAFIAAF"></a>Main Steps</h4>
<div class="paragraph">
<p>To create and support an extensible JAXB bean:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CIAEGGCB">Task 1: Configure the Bean</a></p>
</li>
<li>
<p><a href="#CIAIDAED">Task 2: Provide Additional Mappings</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CIAEGGCB"><a class="anchor" href="#CIAEGGCB"></a>Task 1: Configure the Bean</h5>
<div class="paragraph">
<p>Configure the bean by annotating the bean class with the
<code>@XmlVirtualAccessMethods</code>, adding <code>get</code> and <code>set</code> methods for the
property values, and adding a data structure to store the extended
attributes and values. Alternatively, you can use the
<code>&lt;xml-virtual-access-methods&gt;</code> element in <code>eclipselink-orm.xml</code>.</p>
</div>
<div class="sect5">
<h6 id="annotate-the-bean-class-with-xml-virtualaccessmethods"><a class="anchor" href="#annotate-the-bean-class-with-xml-virtualaccessmethods"></a>Annotate the Bean Class with @Xml VirtualAccessMethods</h6>
<div class="paragraph">
<p>Annotate the bean with <code>@XmlVirtualAccessMethods</code> to specify that it is
extensible and to define virtual properties.</p>
</div>
<div class="paragraph">
<p><a href="#CIAFAFCH">Table 12-2</a> describes the attributes available to the
<code>@XmlVirtualAccessMethods</code> annotation.</p>
</div>
<div id="CIAFAFCH" class="paragraph">
<p><strong><em>Table 12-2 Attributes for the @XmlVirtualAccessMethods Annotation</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Attribute</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the getter method to use for the virtual property. This
method must take a single <code>java.lang.String</code> parameter and return a
<code>java.lang.Object</code>.</p>
</div>
<div class="paragraph">
<p>Default: <code>get</code></p>
</div>
<div class="paragraph">
<p>Required? No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>set</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the setter method to use for the virtual property. This
method must take a <code>java.lang.String</code> and a <code>java.lang.Object</code> parameter
and return a <code>java.lang.Object</code> parameter.</p>
</div>
<div class="paragraph">
<p>Default: <code>set</code></p>
</div>
<div class="paragraph">
<p>Required? No</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect5">
<h6 id="add-get-and-set-methods-to-the-bean"><a class="anchor" href="#add-get-and-set-methods-to-the-bean"></a>Add get and set Methods to the Bean</h6>
<div class="paragraph">
<p>Add <code>get(String)</code> and <code>set(String, Object)</code> methods to the bean. The
<code>get()</code> method returns a value by property name and the <code>set()</code> method
stores a value by property name. The default names for these methods are
<code>get</code> and <code>set</code>, and they can be overridden with the
<code>@XmlVirtualAccessMethods</code> annotation.</p>
</div>
</div>
<div class="sect5">
<h6 id="define-virtual-attribute-storage"><a class="anchor" href="#define-virtual-attribute-storage"></a>Define Virtual Attribute Storage</h6>
<div class="paragraph">
<p>Add a data structure to store the extended attributes and values, that
is, the virtual mappings. These can then be mapped to the database. See
<a href="#CIAIDAED">"Task 2: Provide Additional Mappings"</a>.</p>
</div>
<div class="paragraph">
<p>A common way to store the virtual mappings is in a <code>Map</code>, but you can
use other ways, as well. For example you could store the virtual
mappings in a directory system.</p>
</div>
<div class="paragraph">
<p>When using field-based access, annotate the data structure with
<code>@XmlTransient</code> so it cannot use it for another mapping. When using
property-based access, <code>@XmlTransient</code> is unnecessary.</p>
</div>
</div>
<div class="sect5">
<h6 id="use-xml"><a class="anchor" href="#use-xml"></a>Use XML</h6>
<div class="paragraph">
<p>As an alternative to, or in addition to, using
<code>@XmlVirtualAccessMethods</code>, you can use the XML equivalents, for
example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XML to enable virtual access methods using <code>get</code> and <code>set</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml-virtual-access-methods/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>XML to enable virtual access methods using <code>put</code> instead of <code>set</code>
(default):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml-virtual-access-methods set-method="put"/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>XML to enable virtual access methods using <code>retrieve</code> instead of <code>get</code>
(default):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml-virtual-access-methods get-method="retrieve"/&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>XML to enable virtual access methods using <code>retrieve</code> and <code>put</code>
instead of <code>get</code> and <code>set</code> (default):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml-virtual-access-methods get-method="retrieve" set-method="put"/&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CIAIDAED"><a class="anchor" href="#CIAIDAED"></a>Task 2: Provide Additional Mappings</h5>
<div class="paragraph">
<p>To provide additional mappings, add the mappings to the
<code>eclipselink-oxm.xml</code> file, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xml-element java-attribute="idNumber"/&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CIAEDJHB"><a class="anchor" href="#CIAEDJHB"></a>Code Examples</h4>
<div class="paragraph">
<p>The examples in this section illustrate how to use extensible JAXB
beans. The example begins with the creation of a base class that other
classes can extend. In this case the extensible classes are for
<code>Customers</code> and <code>PhoneNumbers</code>. Mapping files are created for two
separate tenants. Even though both tenants share several real
properties, they will define virtual properties that are unique to their
requirements.</p>
</div>
<div class="sect4">
<h5 id="basic-setup"><a class="anchor" href="#basic-setup"></a>Basic Setup</h5>
<div class="paragraph">
<p><a href="#CIAHDEGG">Example 12-5</a> illustrates a base class, <code>ExtensibleBase</code>,
which other extensible classes can extend. In the example, the use of
the <code>@XmlTransient</code> annotation prevents <code>ExtensibleBase</code> from being
mapped as an inheritance relationship. The real properties represent the
parts of the model that will be common to all tenants. The per-tenant
extensions will be represented as virtual properties.</p>
</div>
<div id="CIAHDEGG" class="paragraph">
<p><strong><em>Example 12-5 A Base Class for Extensible Classes</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package examples.virtual;

import java.util.HashMap;
import java.util.Map;

import jakarta.xml.bind.annotation.XmlTransient;

import org.eclipse.persistence.oxm.annotations.XmlVirtualAccessMethods;

@XmlTransient
@XmlVirtualAccessMethods(setMethod="put")
public class ExtensibleBase {

    private Map&lt;String, Object&gt; extensions = new HashMap&lt;String, Object&gt;();

    public &lt;T&gt; T get(String property) {
        return (T) extensions.get(property);
    }

    public void put(String property, Object value) {
        extensions.put(property, value);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAECFAH">Example 12-6</a> illustrates the definition of a <code>Customer</code>
class. The <code>Customer</code> class is extensible because it inherits from a
domain class that has been annotated with <code>@XmlVirtualAccessMethods</code>.</p>
</div>
<div id="CIAECFAH" class="paragraph">
<p><strong><em>Example 12-6 An Extensible Customer Class</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package examples.virtual;

import jakarta.xml.bind.annotation.XmlRootElement;

@XmlRootElement
public class Customer extends ExtensibleBase {

    private String firstName;
    private String lastName;
    private Address billingAddress;

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }

    public Address getBillingAddress() {
        return billingAddress;
    }

    public void setBillingAddress(Address billingAddress) {
        this.billingAddress = billingAddress;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAGABCC">Example 12-7</a> illustrates an <code>Address</code> class. It is not
necessary for every class in your model to be extensible. In this
example, the <code>Address</code> class does not have any virtual properties.</p>
</div>
<div id="CIAGABCC" class="paragraph">
<p><strong><em>Example 12-7 A Nonextensible Address Class</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package examples.virtual;

public class Address {

    private String street;

    public String getStreet() {
        return street;
    }

    public void setStreet(String street) {
        this.street = street;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAEEBIG">Example 12-8</a> illustrates a <code>PhoneNumber</code> class. Like
<code>Customer</code>, <code>PhoneNumber</code> will be an extensible class.</p>
</div>
<div id="CIAEEBIG" class="paragraph">
<p><strong><em>Example 12-8 An Extensible PhoneNumber Class</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package examples.virtual;

import jakarta.xml.bind.annotation.XmlValue;

public class PhoneNumber extends ExtensibleBase {

    private String number;

    @XmlValue
    public String getNumber() {
        return number;
    }

    public void setNumber(String number) {
        this.number = number;
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="define-the-tenants"><a class="anchor" href="#define-the-tenants"></a>Define the Tenants</h5>
<div class="paragraph">
<p>The examples in this section define two separate tenants. Even though
both tenants share several real properties, the corresponding XML
representation can be quite different due to virtual properties.</p>
</div>
<div class="paragraph">
<p><strong>Tenant 1</strong></p>
</div>
<div class="paragraph">
<p>The first tenant is an online sporting goods store that requires the
following extensions to its model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Customer ID</p>
</li>
<li>
<p>Customer&#8217;s middle name</p>
</li>
<li>
<p>Shipping address</p>
</li>
<li>
<p>A collection of contact phone numbers</p>
</li>
<li>
<p>Type of phone number (that is, home, work, or cell)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The metadata for the virtual properties is captured in the
<code>eclipselink-oxm.xml</code> mapping file or in files using the
<code>eclipselink-orm.xml</code> schema.. Virtual properties are mapped in the same
way as real properties. Some additional information is required,
including type (since this cannot be determined through reflection), and
for collection properties, a container type. The virtual properties
defined below for <code>Customer</code> are <code>middleName</code>, <code>shippingAddress</code>, and
<code>phoneNumbers</code>. For <code>PhoneNumber</code>, the virtual property is the <code>type</code>
property.</p>
</div>
<div class="paragraph">
<p><a href="#CIAJHHAJ">Example 12-9</a> illustrates the <code>binding-tenant1.xml</code>
mapping file.</p>
</div>
<div id="CIAJHHAJ" class="paragraph">
<p><strong><em>Example 12-9 Defining Virtual Properties for Tenant 1</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0"?&gt;
&lt;xml-bindings
    xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/oxm"
    package-name="examples.virtual"&gt;
    &lt;java-types&gt;
        &lt;java-type name="Customer"&gt;
            &lt;xml-type prop-order="firstName middleName lastName billingAddress shippingAddress phoneNumbers"/&gt;
            &lt;java-attributes&gt;
                &lt;xml-attribute
                    java-attribute="id"
                    type="java.lang.Integer"/&gt;
                &lt;xml-element
                    java-attribute="middleName"
                    type="java.lang.String"/&gt;
                &lt;xml-element
                    java-attribute="shippingAddress"
                    type="examples.virtual.Address"/&gt;
                &lt;xml-element
                    java-attribute="phoneNumbers"
                    name="phoneNumber"
                    type="examples.virtual.PhoneNumber"
                    container-type="java.util.List"/&gt;
            &lt;/java-attributes&gt;
        &lt;/java-type&gt;
        &lt;java-type name="PhoneNumber"&gt;
            &lt;java-attributes&gt;
                &lt;xml-attribute
                    java-attribute="type"
                    type="java.lang.String"/&gt;
            &lt;/java-attributes&gt;
        &lt;/java-type&gt;
    &lt;/java-types&gt;
&lt;/xml-bindings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>get</code> and <code>set</code> methods are used on the domain model to interact
with the real properties and the accessors defined on the
<code>@XmlVirtualAccessMethods</code> annotation are used to interact with the
virtual properties. The normal JAXB mechanisms are used for marshal and
unmarshal operations. <a href="#CIAIIDAD">Example 12-10</a> illustrates the
<code>Customer</code> class code for tenant 1 to obtain the data associated with
virtual properties.</p>
</div>
<div id="CIAIIDAD" class="paragraph">
<p><strong><em>Example 12-10 Tenant 1 Code to Provide the Data Associated with
Virtual Properties</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
Customer customer = new Customer();

//Set Customer's real properties
customer.setFirstName("Jane");
customer.setLastName("Doe");

Address billingAddress = new Address();
billingAddress.setStreet("1 Billing Street");
customer.setBillingAddress(billingAddress);

//Set Customer's virtual 'middleName' property
customer.put("middleName", "Anne");

//Set Customer's virtual 'shippingAddress' property
Address shippingAddress = new Address();
shippingAddress.setStreet("2 Shipping Road");
customer.put("shippingAddress", shippingAddress);

List&lt;PhoneNumber&gt; phoneNumbers = new ArrayList&lt;PhoneNumber&gt;();
customer.put("phoneNumbers", phoneNumbers);

PhoneNumber workPhoneNumber = new PhoneNumber();
workPhoneNumber.setNumber("555-WORK");
//Set the PhoneNumber's virtual 'type' property
workPhoneNumber.put("type", "WORK");
phoneNumbers.add(workPhoneNumber);

PhoneNumber homePhoneNumber = new PhoneNumber();
homePhoneNumber.setNumber("555-HOME");
//Set the PhoneNumber's virtual 'type' property
homePhoneNumber.put("type", "HOME");
phoneNumbers.add(homePhoneNumber);

Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put(JAXBContextFactory.ECLIPSELINK_OXM_XML_KEY, "examples/virtual/binding-tenant1.xml");
JAXBContext jc = JAXBContext.newInstance(new Class[] {Customer.class, Address.class}, properties);

Marshaller marshaller = jc.createMarshaller();
marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
marshaller.marshal(customer, System.out);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAECIAH">Example 12-11</a> illustrates the XML output from the
<code>Customer</code> class for tenant 1.</p>
</div>
<div id="CIAECIAH" class="paragraph">
<p><strong><em>Example 12-11 XML Output from the Customer Class for Tenant 1</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;customer&gt;
   &lt;firstName&gt;Jane&lt;/firstName&gt;
   &lt;middleName&gt;Anne&lt;/middleName&gt;
   &lt;lastName&gt;Doe&lt;/lastName&gt;
   &lt;billingAddress&gt;
      &lt;street&gt;1 Billing Street&lt;/street&gt;
   &lt;/billingAddress&gt;
   &lt;shippingAddress&gt;
      &lt;street&gt;2 Shipping Road&lt;/street&gt;
   &lt;/shippingAddress&gt;
   &lt;phoneNumber type="WORK"&gt;555-WORK&lt;/phoneNumber&gt;
   &lt;phoneNumber type="HOME"&gt;555-HOME&lt;/phoneNumber&gt;
&lt;/customer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Tenant 2</strong></p>
</div>
<div class="paragraph">
<p>The second tenant is a streaming media provider that offers on-demand
movies and music to its subscribers. It requires a different set of
extensions to the core model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A single contact phone number</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For this tenant, the mapping file is also used to customize the mapping
of the real properties.</p>
</div>
<div class="paragraph">
<p><a href="#CIAGBEGJ">Example 12-12</a> illustrates the <code>binding-tenant2.xml</code>
mapping file.</p>
</div>
<div id="CIAGBEGJ" class="paragraph">
<p><strong><em>Example 12-12 Defining Virtual Properties for Tenant 2</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0"?&gt;
&lt;xml-bindings
    xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/oxm"
    package-name="examples.virtual"&gt;
    &lt;xml-schema namespace="urn:tenant1" element-form-default="QUALIFIED"/&gt;
    &lt;java-types&gt;
        &lt;java-type name="Customer"&gt;
            &lt;xml-type prop-order="firstName lastName billingAddress phoneNumber"/&gt;
            &lt;java-attributes&gt;
                &lt;xml-attribute java-attribute="firstName"/&gt;
                &lt;xml-attribute java-attribute="lastName"/&gt;
                &lt;xml-element java-attribute="billingAddress" name="address"/&gt;
                &lt;xml-element
                    java-attribute="phoneNumber"
                    type="examples.virtual.PhoneNumber"/&gt;
            &lt;/java-attributes&gt;
        &lt;/java-type&gt;
    &lt;/java-types&gt;
&lt;/xml-bindings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIACHCHF">Example 12-13</a> illustrates the tenant 2 <code>Customer</code> class
code to obtain the data associated with virtual properties.</p>
</div>
<div id="CIACHCHF" class="paragraph">
<p><strong><em>Example 12-13 Tenant 2 Code to Provide the Data Associated with
Virtual Properties</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
Customer customer = new Customer();
customer.setFirstName("Jane");
customer.setLastName("Doe");

Address billingAddress = new Address();
billingAddress.setStreet("1 Billing Street");
customer.setBillingAddress(billingAddress);

PhoneNumber phoneNumber = new PhoneNumber();
phoneNumber.setNumber("555-WORK");
customer.put("phoneNumber", phoneNumber);

Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put(JAXBContextFactory.ECLIPSELINK_OXM_XML_KEY, "examples/virtual/binding-tenant2.xml");
JAXBContext jc = JAXBContext.newInstance(new Class[] {Customer.class, Address.class}, properties);

Marshaller marshaller = jc.createMarshaller();
marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
marshaller.marshal(customer, System.out);
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CIAGDDIG">Example 12-14</a> illustrates the XML output from the
<code>Customer</code> class for tenant 2.</p>
</div>
<div id="CIAGDDIG" class="paragraph">
<p><strong><em>Example 12-14 XML Output from the Customer Class for Tenant 2</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;customer xmlns="urn:tenant1" firstName="Jane" lastName="Doe"&gt;
   &lt;address&gt;
      &lt;street&gt;1 Billing Street&lt;/street&gt;
   &lt;/address&gt;
   &lt;phoneNumber&gt;555-WORK&lt;/phoneNumber&gt;
&lt;/customer&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="EXTENSIBLE003"><a class="anchor" href="#EXTENSIBLE003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code Sample</p>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MySports" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MySports</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>&#8220;@VirtualAccessMethods&#8221; in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.)</p>
</li>
<li>
<p>"Configuring Virtual Access Methods" in <em>Developing JAXB Applications
Using EclipseLink MOXy</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="METADATASOURCE"><a class="anchor" href="#METADATASOURCE"></a>13. Using an External MetaData Source</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions for storing mapping information in a
metadata source that is external to the running application, so you can
dynamically override or extend mappings in a deployed application.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#METADATASOURCE001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#METADATASOURCE002">Using the eclipselink-orm.xml File Externally</a></p>
</li>
<li>
<p><a href="#METADATASOURCE003">Main Tasks</a></p>
</li>
<li>
<p><a href="#METADATASOURCE004">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to establish a SaaS environment, where applications are
shared by multiple clients.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Employ EclipseLink SaaS features, such as extensibility, multi-tenancy,
and external metadata sources.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="METADATASOURCE001"><a class="anchor" href="#METADATASOURCE001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>You can store your mapping information in a metadata source that is
external to the running application. Because the mapping information is
retrieved when the application creates the persistence unit, you can
dynamically override or extend mappings in a deployed application.</p>
</div>
</div>
<div class="sect2">
<h3 id="METADATASOURCE002"><a class="anchor" href="#METADATASOURCE002"></a>Using the eclipselink-orm.xml File Externally</h3>
<div class="paragraph">
<p>With EclipseLink, you can use the <code>eclipselink-orm.xml</code> file to support
advanced mapping types and options. This file can override the standard
JPA <code>orm.xml</code> mapping configuration file.</p>
</div>
</div>
<div class="sect2">
<h3 id="METADATASOURCE003"><a class="anchor" href="#METADATASOURCE003"></a>Main Tasks</h3>
<div class="paragraph">
<p>To use an external metadata source for your mapping information, perform
the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABEIJIG">Task 1: Configure the Persistence Unit</a></p>
</li>
<li>
<p><a href="#BABIGAGE">Task 2: Configure the Server</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BABEIJIG"><a class="anchor" href="#BABEIJIG"></a>Task 1: Configure the Persistence Unit</h4>
<div class="paragraph">
<p>In your persistence unit, specify the external metadata source by
defining an <code>eclipselink.metadata.source</code> property and assign as its
value a class that implements
<code>org.eclipse.persistence.jpa.metadata.MetadataSource</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.metadata-source" value="mypackage.MyMetadataSource"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free to provide the metadata location in your class as you
choose, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class AdminMetadataSource extends XMLMetadataSource {

    @Override
    public XMLEntityMappings getEntityMappings(Map&lt;String, Object&gt; properties, ClassLoader classLoader, SessionLog log) {
        String leagueId = (String) properties.get(LEAGUE_CONTEXT);
        properties.put(PersistenceUnitProperties.METADATA_SOURCE_XML_URL, "http://myserverlocation/rest/" + leagueId + "/orm");
        return super.getEntityMappings(properties, classLoader, log);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABIGAGE"><a class="anchor" href="#BABIGAGE"></a>Task 2: Configure the Server</h4>
<div class="paragraph">
<p>To access the metadata file, the server must provide URL access to the
mapping file by using any of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Static file serving</p>
</li>
<li>
<p>A server-based solution with its own mapping file or a mapping file
built on-demand from stored mapping information</p>
</li>
<li>
<p>Some other web technology.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="METADATASOURCE004"><a class="anchor" href="#METADATASOURCE004"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For additional information about JPA deployment, see the following
sections of the JPA Specification
(<code><a href="http://jcp.org/en/jsr/detail?id=317" class="bare">http://jcp.org/en/jsr/detail?id=317</a></code>):</p>
<div class="ulist">
<ul>
<li>
<p>Section 7.2, "Bootstrapping in Java SE Environments"</p>
</li>
<li>
<p>Chapter 7, "Container and Provider Contracts for Deployment and
Bootstrapping"</p>
</li>
</ul>
</div>
</li>
<li>
<p>For more information about persistence unit properties, see
<code>PersistenceUnitProperties</code> class in <em>Oracle Fusion Middleware Java API
Reference for EclipseLink</em>.</p>
</li>
<li>
<p>For more information about the APIs, see the following in <em>Jakarta
Persistence API (JPA) Extensions Reference for EclipseLink</em>:</p>
<div class="ulist">
<ul>
<li>
<p>&#8220;metadata-source&#8221;</p>
</li>
<li>
<p>&#8220;metadata-source.properties.file&#8221;</p>
</li>
<li>
<p>&#8220;metadata-source.send-refresh-command&#8221;</p>
</li>
<li>
<p>&#8220;metadata-source.xml.file&#8221;</p>
</li>
<li>
<p>&#8220;metadata-source.xml.url&#8221;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="MULTITENANCY"><a class="anchor" href="#MULTITENANCY"></a>14. Tenant Isolation Using EclipseLink</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With EclipseLink, you can develop a single application and then deploy
it for different clients, or "tenants," with varying degrees of
application and data isolation and of tenant-specific functionality. For
example, a large company may develop a single payroll application to be
used by multiple divisions. Each division has access to its own data and
to shared data, but they cannot see any other division&#8217;s data.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#MULTITENANCY001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#MULTITENANCY002">Using Single-Table Multi-Tenancy</a></p>
</li>
<li>
<p><a href="#MULTITENANCY003">Using Table-Per-Tenant Multi-Tenancy</a></p>
</li>
<li>
<p><a href="#MULTITENANCY004">Using VPD Multi-Tenancy</a></p>
</li>
<li>
<p><a href="#MULTITENANCY005">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Multiple application clients must share data sources, with private
access to their data, for example in a Software as a Service (SaaS)
environment.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Decide on a strategy for tenant isolation; then use EclipseLink&#8217;s tenant
isolation features to implement the strategy.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>A compliant Java Database Connectivity (JDBC) database, such as Oracle
Database, Oracle Express, or MySQL.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="MULTITENANCY001"><a class="anchor" href="#MULTITENANCY001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink offers considerable flexibility in how you can design and
implement features for isolating tenants. Possibilities include the
following:</p>
</div>
<div class="paragraph">
<p><strong>Application Isolation options</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Separate container/server</p>
</li>
<li>
<p>Separate application within the same container/server</p>
</li>
<li>
<p>Separate entity manager factory and shared cache within the same
application</p>
</li>
<li>
<p>Shared entity manager factory with tenant isolation per entity manager</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Data isolation options</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Separate database</p>
</li>
<li>
<p>Separate schema/tablespace</p>
</li>
<li>
<p>Separate tables</p>
</li>
<li>
<p>Shared table with row isolation</p>
</li>
<li>
<p>Query filtering</p>
</li>
<li>
<p>Oracle Virtual Private Database (VPD)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EclipseLink includes the following options for providing multi-tenancy
in the data source:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Single-table multi-tenancy</strong> allows tenants to share tables. Each
tenant has its own rows, identified by discriminator columns, and those
rows are invisible to other tenants. See
<a href="#MULTITENANCY002">Using Single-Table Multi-Tenancy</a>.</p>
</li>
<li>
<p>With <strong>table-per-tenant</strong> multi-tenancy, each tenant has its own table
or tables, identified by table tenant discriminators, and those tables
are invisible to other users. See
<a href="#MULTITENANCY003">Using Table-Per-Tenant Multi-Tenancy</a>.</p>
</li>
<li>
<p>With (<strong>VDP</strong>) multi-tenancy, tenants use a VDP database, which provides
the functionality to support multiple tenants sharing the same table.
See <a href="#MULTITENANCY004">Using VPD Multi-Tenancy</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EclipseLink further provides tenant-specific extensions through
extensible entities using extensible entities and <code>MetadataSource</code>. For
information about those features, see
<a href="#EXTENSIBLE">Chapter 12, "Making JPA Entities and JAXB
Beans Extensible,"</a> and <a href="#METADATASOURCE">Chapter 13,
"Using an External MetaData Source."</a></p>
</div>
</div>
<div class="sect2">
<h3 id="MULTITENANCY002"><a class="anchor" href="#MULTITENANCY002"></a>Using Single-Table Multi-Tenancy</h3>
<div class="paragraph">
<p>With single-table multi-tenancy, any table (<code>Table</code> or <code>SecondaryTable</code>)
to which an entity or mapped superclass maps can include rows for
multiple tenants. Access to tenant-specific rows is restricted to the
specified tenant.</p>
</div>
<div class="paragraph">
<p>Tenant-specific rows are associated with the tenant by using one or more
tenant discriminator columns. Discriminator columns are used with
application context values to limit what a persistence context can
access.</p>
</div>
<div class="paragraph">
<p>The results of queries on the mapped tables are limited to the tenant
discriminator value(s) provided as property values. This applies to all
insert, update, and delete operations on the table. When multi-tenant
metadata is applied at the mapped superclass level, it is applied to all
subentities unless they specify their own multi-tenant metadata.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the context of single-table multi-tenancy, ”single-table” means
multiple tenants can share a single table, and each tenant&#8217;s data is
distinguished from other tenants' data via the discriminator column(s).
It is possible to use multiple tables with single-table multi-tenancy;
but in that case, an entity&#8217;s persisted data is stored in multiple
tables, and multiple tenants can share all the tables.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="BABIFFCI"><a class="anchor" href="#BABIFFCI"></a>Main Tasks for Using Single-Table Multi-Tenancy</h4>
<div class="paragraph">
<p>The following tasks provide instructions for using single-table
multi-tenancy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDBADCI">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#BABDFFJD">Task 2: Enable Single-Table Multi-Tenancy</a></p>
</li>
<li>
<p><a href="#BABFGJAJ">Task 3: Specify Tenant Discriminator Columns</a></p>
</li>
<li>
<p><a href="#BABHIDCG">Task 4: Perform Operations and Queries</a></p>
</li>
<li>
<p><a href="#CHDIHGID">Task 5: Use Single-Table Multi-Tenancy in an Inheritance Hierarchy</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDBADCI"><a class="anchor" href="#CHDBADCI"></a>Task 1: Prerequisites</h5>
<div class="paragraph">
<p>To implement and use single-table multi-tenancy, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</li>
<li>
<p>Any compliant Java Database Connectivity (JDBC) database, including
Oracle Database, Oracle Database Express Edition (Oracle Database XE),
or MySQL. These instructions are based on Oracle Database XE 11g Release
2.</p>
<div class="paragraph">
<p>For the certification matrix, see</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="BABDFFJD"><a class="anchor" href="#BABDFFJD"></a>Task 2: Enable Single-Table Multi-Tenancy</h5>
<div class="paragraph">
<p>Single-table multi-tenancy can be enabled declaratively using the
<code>@Multitenant</code> annotation, in an Object Relational Mapping (ORM) XML
file using the <code>&lt;multitenant&gt;</code> element, or by using annotations and XML
together.</p>
</div>
<div class="sect5">
<h6 id="using-the-multitenant-annotation"><a class="anchor" href="#using-the-multitenant-annotation"></a>Using the @Multitenant Annotation</h6>
<div class="paragraph">
<p>To use the <code>@Multitenant</code> annotation, include it with an <code>@Entity</code> or
<code>@MappedSuperclass</code> annotation. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name=”EMP”)
@Multitenant(SINGLE_TABLE)
public class Employee {
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Single-table is the default multi-tenancy type, so <code>SINGLE_TABLE</code> does
not have to be included in <code>@Multitenant</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>@Table</code> annotation is not required, because the discriminator
column is assumed to be on the primary table. However, if the
discriminator column is defined on a secondary table, you must identify
that table using <code>@SecondaryTable</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="using-the-multitenant-element"><a class="anchor" href="#using-the-multitenant-element"></a>Using the &lt;multitenant&gt; Element</h6>
<div class="paragraph">
<p>To use the <code>&lt;multitenant&gt;</code> element, include the element within an
<code>&lt;entity&gt;</code> element. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Employee"&gt;
   &lt;multitenant type="SINGLE_TABLE"&gt;
   ...
   &lt;/multitenant&gt;
   ...
&lt;/entity&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABFGJAJ"><a class="anchor" href="#BABFGJAJ"></a>Task 3: Specify Tenant Discriminator Columns</h4>
<div class="paragraph">
<p>Discriminator columns are used together with an associated application
context to indicate which rows in a table an application tenant can
access.</p>
</div>
<div class="paragraph">
<p>Tenant discriminator columns can be specified declaratively using the
<code>@TenantDiscriminatorColumn</code> annotation or in an object-relational (ORM)
XML file using the <code>&lt;tenant-discriminator-column&gt;</code> element.</p>
</div>
<div class="paragraph">
<p>The following characteristics apply to discriminator columns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tenant discriminator column(s) must always be used with <code>@Multitenant</code>
(or <code>&lt;multitenant&gt;</code> in the ORM XML file). You cannot specify the tenant
discriminator column(s) only.</p>
</li>
<li>
<p>The tenant discriminator column is assumed to be on the primary table
unless another table is explicitly specified.</p>
</li>
<li>
<p>On persist, the values of tenant discriminator columns are populated
from their associated context properties.</p>
</li>
<li>
<p>When a multi-tenant entity is specified, the tenant discriminator
column can default. Its default values are:</p>
<div class="ulist">
<ul>
<li>
<p>Name = <code>TENANT_ID</code> (the database column name)</p>
</li>
<li>
<p>Context property = <code>eclipselink.tenant.id</code> (the context property used
to populate the database column)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Tenant discriminator columns are application definable. That is, the
discriminator column is not tied to a specific column for each shared
entity table. You can use <code>TENANT_ID</code>, <code>T_ID</code>, etc.</p>
</li>
<li>
<p>There is no limit on the number of tenant discriminator columns an
application can define.</p>
</li>
<li>
<p>Any name can be used for a discriminator column.</p>
</li>
<li>
<p>Generated schemas include specified tenant discriminator columns.</p>
</li>
<li>
<p>Tenant discriminator columns can be mapped or unmapped:</p>
<div class="ulist">
<ul>
<li>
<p>When a tenant discriminator column is mapped, its associated mapping
attribute must be marked as read only.</p>
</li>
<li>
<p>Both mapped and unmapped properties are used to form the additional
criteria when issuing a SELECT query.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="use-the-tenantdiscriminatorcolumn-annotation"><a class="anchor" href="#use-the-tenantdiscriminatorcolumn-annotation"></a>Use the @TenantDiscriminatorColumn Annotation</h5>
<div class="paragraph">
<p>To use the <code>@TenantDiscriminatorColumn</code> annotation, include it with
<code>@Multitenant</code> annotation on an entity or mapped superclass, and
optionally include the <code>name</code> and <code>contextProperty</code> attributes. If you
do not specify these attributes, the defaults <code>name = "TENANT-ID"</code> and
<code>contextProperty = "eclipselink.tenant-id"</code> are used.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Multitenant(SINGLE_TABLE)
@TenantDiscriminatorColumn(name = "TENANT", contextProperty = "multitenant.id")
public class Employee {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify multiple tenant discriminator columns, include multiple
<code>@TenantDiscriminatorColumn</code> annotations within the
<code>@TenantDiscriminatorColumns</code> annotation, and include the table where
the column is located if it is not located on the primary table. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name = "EMPLOYEE")
@SecondaryTable(name = "RESPONSIBILITIES")
@Multitenant(SINGLE_TABLE)
@TenantDiscriminatorColumns({
   @TenantDiscriminatorColumn(name = "TENANT_ID",
      contextProperty = "employee-tenant.id", length = 20)
   @TenantDiscriminatorColumn(name = "TENANT_CODE",
      contextProperty = "employee-tenant.code", discriminatorType = STRING,
      table = "RESPONSIBILITIES")
  }
)
public Employee() {
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-the-tenant-discriminator-column-element"><a class="anchor" href="#use-the-tenant-discriminator-column-element"></a>Use the &lt;tenant-discriminator-column&gt; Element</h5>
<div class="paragraph">
<p>To use the <code>&lt;tenant-discriminator-column&gt;</code> element, include the element
within a <code>&lt;multitenant&gt;</code> element and optionally include the <code>name</code> and
<code>context-property</code> attributes. If you do not specify these attributes,
the defaults <code>name = "TENANT-ID"</code> and
<code>contextProperty = "eclipselink.tenant-id"</code> are used.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Employee"&gt;
   &lt;multitenant&gt;
      &lt;tenant-discriminator-column name="TENANT"
         context-property="multitenant.id"/&gt;
   &lt;/multitenant&gt;
   ...
&lt;/entity&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify multiple columns, include additional
<code>&lt;tenant-discriminator-column&gt;</code> elements, and include the table where
the column is located if it is not located on the primary table. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Employee"&gt;
   &lt;multitenant type="SINGLE_TABLE"&gt;
      &lt;tenant-discriminator-column name="TENANT_ID"
         context-property="employee-tenant.id" length="20"/&gt;
      &lt;tenant-discriminator-column name="TENANT_CODE"
         context-property="employee-tenant.id" discriminator-type="STRING"
         table="RESPONSIBILITIES"/&gt;
   &lt;/multitenant&gt;
   &lt;table name="EMPLOYEE"/&gt;
   &lt;secondary-table name="RESPONSIBILITIES"/&gt;
   ...
&lt;/entity&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="map-tenant-discriminator-columns"><a class="anchor" href="#map-tenant-discriminator-columns"></a>Map Tenant Discriminator Columns</h5>
<div class="paragraph">
<p>Tenant discriminator columns can be mapped to a primary key or to
another column. The following example maps the tenant discriminator
column to the primary key on the table during DDL generation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name = "ADDRESS")
@Multitenant
@TenantDiscriminatorColumn(name = "TENANT", contextProperty = "tenant.id",
   primaryKey = true)
public Address() {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example uses the ORM XML file to map the tenant
discriminator column to a primary key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Address"&gt;
   &lt;multitenant&gt;
      &lt;tenant-discriminator-column name="TENANT"
         context-property="multitenant.id" primary-key="true"/&gt;
   &lt;/multitenant&gt;
   &lt;table name="ADDRESS"/&gt;
   ...
&lt;/entity&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example maps the tenant discriminator column to another
column named <code>AGE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name = "Player")
@Multitenant
@TenantDiscriminatorColumn(name = "AGE", contextProperty = "tenant.age")
public Player() {
  ...

  @Basic
  @Column(name="AGE", insertable="false", updatable="false")
  public int age;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example uses the ORM XML file to map the tenant
discriminator column to another column named <code>AGE</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Player"&gt;
  &lt;multitenant&gt;
    &lt;tenant-discriminator-column name="AGE" context-property="tenant.age"/&gt;
  &lt;/multitenant&gt;
  &lt;table name="PLAYER"/&gt;
  ...
  &lt;attributes&gt;
    &lt;basic name="age" insertable="false" updatable="false"&gt;
      &lt;column name="AGE"/&gt;
    &lt;/basic&gt;
    ...
  &lt;/attributes&gt;
  ...
&lt;/entity&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDIIAAF"><a class="anchor" href="#CHDIIAAF"></a>Define Persistence Unit and Entity Mappings Defaults</h5>
<div class="paragraph">
<p>In addition to configuring discriminator columns at the entity and
mapped superclass levels, you can also configure them at the
<code>persistence-unit-defaults</code> and <code>entity-mappings</code> levels to provide
defaults. Defining the metadata at the these levels follows similar JPA
metadata defaulting and overriding rules.</p>
</div>
<div class="paragraph">
<p>Specify default tenant discriminator column metadata at the
<code>persistence-unit-defaults</code> level in the ORM XML file. When defined at
this level, the defaults apply to all entities of the persistence unit
that have specified a multi-tenant type of <code>SINGLE_TABLE</code> minus those
that specify their own tenant discriminator metadata. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit-metadata&gt;
  &lt;persistence-unit-defaults&gt;
    &lt;tenant-discriminator-column name="TENANT_ID" context-property="tenant.id"/&gt;
  &lt;/persistence-unit-defaults&gt;
&lt;/persistence-unit-metadata&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify tenant discriminator column metadata at the
<code>entity-mappings</code> level in the ORM XML file. A setting at this level
overrides a persistence unit default and applies to all entities with a
multi-tenant type of <code>SINGLE_TABLE</code> of the mapping file, minus those
that specify their own tenant discriminator metadata. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity-mappings&gt;
  ...
      ...
      &lt;tenant-discriminator-column name="TENANT_ID" context-property="tenant.id"/&gt;
      ...
&lt;/entity-mappings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="configure-context-properties-and-caching-scope"><a class="anchor" href="#configure-context-properties-and-caching-scope"></a>Configure Context Properties and Caching Scope</h5>
<div class="paragraph">
<p>Runtime context properties are used in conjunction with the
multi-tenancy configuration on an entity (or mapped superclass) to
implement the multi-tenancy strategy. For example, the tenant ID
assigned to a tenant discriminator column for an entity is used at
runtime (via an entity manager) to restrict access to data, based on
that tenant&#8217;s ownership of (or access to) the rows and tables of the
database.</p>
</div>
<div class="paragraph">
<p>At runtime, multi-tenancy properties can be specified in a persistence
unit definition or passed to a create entity manager factory call.</p>
</div>
<div class="paragraph">
<p>The order of precedence for tenant discriminator column properties is as
follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>EntityManager</code></p>
</li>
<li>
<p><code>EntityManagerFactory</code></p>
</li>
<li>
<p>Application context (when in a Jakarta EE container)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to set the configuration on a persistence unit in
<code>persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit name="multitenant"&gt;
   ...
   &lt;properties&gt;
      &lt;property name="tenant.id" value="707"/&gt;
      ...
   &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, to set the properties programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">HashMap properties = new HashMap();
properties.put("tenant.id", "707");
...
EntityManager em = Persistence.createEntityManagerFactory("multi-tenant",
      properties).createEntityManager();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Swapping tenant IDs during a live <code>EntityManager</code> is not allowed.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="CHDBHBIG"><a class="anchor" href="#CHDBHBIG"></a>Configure a Shared Entity Manager</h6>
<div class="paragraph">
<p>By default, tenants share the entity manager factory. A single
application instance with a shared <code>EntityManagerFactory</code> for a
persistence unit can be responsible for handling requests from multiple
tenants.</p>
</div>
<div class="paragraph">
<p>The following example shows a shared entity manager factory
configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">EntityManager em = createEntityManager(MULTI_TENANT_PU);
em.getTransaction().begin();
em.setProperty(EntityManagerProperties.MULTITENANT_PROPERTY_DEFAULT, "my_id");</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using a shared entity manager factory, the L2 cache is by default
not shared, and therefore multi-tenant entities have an <code>ISOLATED</code> cache
setting.</p>
</div>
<div class="paragraph">
<p>To share the cache, set the
<code>eclipselink.multitenant.tenants-share-cache</code> property to <code>true</code>. This
results in multi-tenant entities having a PROTECTED cache setting.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Queries that use the cache may return data from other tenants when using
the <code>PROTECTED</code> setting.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="configure-a-non-shared-entity-manager"><a class="anchor" href="#configure-a-non-shared-entity-manager"></a>Configure a Non-Shared Entity Manager</h6>
<div class="paragraph">
<p>To create an entity manager factory that is not shared, set the
<code>eclipselink.multitenant.tenants-share-emf</code> property to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>When the entity manager factory is not shared, you must use the
<code>eclipselink.session-name</code> property to provide a unique session name, as
shown in the following example. This ensures that a unique server
session and cache are provided for each tenant. This provides full
caching capabilities. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">HashMap properties = new HashMap();
properties.put("tenant.id", "707");
properties.put("eclipselink.session-name", "multi-tenant-707");
...
EntityManager em = Persistence.createEntityManagerFactory("multitenant",
                      properties).createEntityManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">HashMap properties = new HashMap();
properties.put(PersistenceUnitProperties.MULTITENANT_SHARED_EMF, "false");
properties.put(PersistenceUnitProperties.SESSION_NAME, "non-shared-emf-for-this-emp");
properties.put(PersistenceUnitProperties.MULTITENANT_PROPERTY_DEFAULT, "this-emp");
...
EntityManager em = Persistence.createEntityManagerFactory("multi-tenant-pu", properties).createEntityManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example in the persistence unit definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit name="multi-tenant-pu"&gt;
  ...
  &lt;properties&gt;
    &lt;property name="eclipselink.multitenant.tenants-share-emf" value="false"/&gt;
    &lt;property name="eclipselink.session-name"
         value="non-shared-emf-for-this-emp"/&gt;
    &lt;property name="eclipselink.tenant-id" value="this-emp"/&gt;
    ...
  &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="configure-an-entity-manager"><a class="anchor" href="#configure-an-entity-manager"></a>Configure an Entity Manager</h6>
<div class="paragraph">
<p>When configuring properties at the level of the entity manager, you must
specify the caching strategies, because the same server session can be
used for each tenant. For example, you can set up an isolation level (L1
cache) to ensure no shared tenant information exists in the L2 cache.
These settings are set when creating the entity manager factory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">HashMap tenantProperties = new HashMap();
properties.put("tenant.id", "707");

HashMap cacheProperties = new HashMap();
properties.put("eclipselink.cache.shared.Employee", "false");
properties.put("eclipselink.cache.size.Address", "10");
properties.put("eclipselink.cache.type.Contract", "NONE");
...
EntityManager em = Persistence.createEntityManagerFactory("multitenant",
                      cacheProperties).createEntityManager(tenantProperties);
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABHIDCG"><a class="anchor" href="#BABHIDCG"></a>Task 4: Perform Operations and Queries</h4>
<div class="paragraph">
<p>The tenant discriminator column is used at runtime through entity
manager operations and querying. The tenant discriminator column and
value are supported through the following entity manager operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>persist()</code></p>
</li>
<li>
<p><code>find()</code></p>
</li>
<li>
<p><code>refresh()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tenant discriminator column and value are supported through the
following queries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Named queries</p>
</li>
<li>
<p>Update all</p>
</li>
<li>
<p>Delete all</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Multi-tenancy is not supported through named native queries. To use
named native queries in a multi-tenant environment, manually handle any
multi-tenancy issues directly in the query. In general, it is best to
avoid named native queries in a multi-tenant environment.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="CHDIHGID"><a class="anchor" href="#CHDIHGID"></a>Task 5: Use Single-Table Multi-Tenancy in an Inheritance Hierarchy</h5>
<div class="paragraph">
<p>Inheritance strategies are configured by specifying the inheritance type
(<code>@jakarta.persistence.Inheritance</code>). Single-table multi-tenancy can be
used in an inheritance hierarchy, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multi-tenant metadata can be applied only at the root level of the
inheritance hierarchy when using a <code>SINGLE_TABLE</code> or <code>JOINED</code>
inheritance strategy.</p>
</li>
<li>
<p>You can also specify multi-tenant metadata within a <code>TABLE_PER_CLASS</code>
inheritance hierarchy. In this case, every entity has its own table,
with all its mapping data (which is not the case with <code>SINGLE_TABLE</code> or
<code>JOINED</code> strategies). Consequently, in the <code>TABLE_PER_CLASS</code> strategy,
some entities of the hierarchy may be multi-tenant, while others may not
be. The other inheritance strategies can only specify multi-tenancy at
the root level, because you cannot isolate an entity to a single table
to build only its type.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MULTITENANCY003"><a class="anchor" href="#MULTITENANCY003"></a>Using Table-Per-Tenant Multi-Tenancy</h3>
<div class="paragraph">
<p>Table-per-tenant multi-tenancy allows multiple tenants of an application
to isolate their data in one or more tenant-specific tables. Multiple
tenants' tables can be in a shared schema, identified using a prefix or
suffix naming pattern; or they can be in separate, tenant-specific
schemas. Table-per-tenant entities can be mixed with other multi-tenant
type entities within the same persistence unit.</p>
</div>
<div class="paragraph">
<p>The table-per-tenant multi-tenant type is used in conjunction with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A tenant table discriminator that specifies the type of discriminator
(schema or name with prefix or suffix)</p>
</li>
<li>
<p>A tenant ID to identify the user (configured per entity manager or at
the entity manager factory, if isolating the table-per-tenant per
persistence unit.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A single application instance with a shared <code>EntityManagerFactory</code> for a
persistence unit can be responsible for handling requests from multiple
tenants.</p>
</div>
<div class="paragraph">
<p>Alternatively, separate <code>EntityManagerFactory</code> instances can be used for
each tenant. (This is required when using extensions per tenant.) In
this case, tenant-specific schema and table names are defined in an
<code>eclipselink-orm.xml</code> configuration file. A <code>MetadataSource</code> must be
registered with a persistence unit. The <code>MetadataSource</code> is used to
support additional persistence unit metadata provided from outside the
application.</p>
</div>
<div class="paragraph">
<p>For information about <code>MetadataSource</code>, see
<a href="//metadatasource.htm#METADATASOURCE">Chapter 13, "Using an External MetaData
Source."</a> See also <code>metadata-source</code> in <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>.</p>
</div>
<div class="paragraph">
<p>The table-per-tenant multi-tenant type enables individual tenant
table(s) to be used at the entity level. A tenant context property must
be provided on each entity manager after a transaction has started.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The table(s) (<code>Table</code> and <code>SecondaryTable</code>) for the entity are
individual tenant tables based on the tenant context. Relationships
within an entity that uses a join or a collection table are also assumed
to exist within the table-per-tenant context.</p>
</li>
<li>
<p>Multi-tenant metadata can only be applied at the root level of the
inheritance hierarchy when using a <code>SINGLE_TABLE</code> or <code>JOINED</code>
inheritance strategy. Multi-tenant metadata can be specified in a
<code>TABLE_PER_CLASS</code> inheritance hierarchy</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="main-tasks-for-using-table-per-tenant-multi-tenancy"><a class="anchor" href="#main-tasks-for-using-table-per-tenant-multi-tenancy"></a>Main Tasks for Using Table-Per-Tenant Multi-Tenancy</h4>
<div class="paragraph">
<p>The following tasks provide instructions for using table-per-tenant
multi-tenancy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDIGFFI">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#CHDGCIGF">Task 2: Enable Table-Per-Tenant Multi-Tenancy</a></p>
</li>
<li>
<p><a href="#CHDGBJBE">Task 3: Specify Tenant Table Discriminator</a></p>
</li>
<li>
<p><a href="#CHDDCDHI">Task 4: Specify a Context Property at Runtime</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDIGFFI"><a class="anchor" href="#CHDIGFFI"></a>Task 1: Prerequisites</h5>
<div class="paragraph">
<p>To implement and use table-per-tenant multi-tenancy, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</li>
<li>
<p>Any compliant Java Database Connectivity (JDBC) database, including
Oracle Database, Oracle Database Express Edition (Oracle Database XE),
or MySQL. These instructions are based on Oracle Database XE 11g Release
2.</p>
<div class="paragraph">
<p>For the certification matrix, see</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="CHDGCIGF"><a class="anchor" href="#CHDGCIGF"></a>Task 2: Enable Table-Per-Tenant Multi-Tenancy</h5>
<div class="paragraph">
<p>Table-per-tenant multi-tenancy can be enabled declaratively using the
<code>@Multitenant</code> annotation; or in an Object Relational Mapping (ORM) XML
file using the <code>&lt;multitenant&gt;</code> element, or using annotations and XML
together.</p>
</div>
<div class="sect5">
<h6 id="using-the-multitenant-and-tenanttablediscriminator-annotations"><a class="anchor" href="#using-the-multitenant-and-tenanttablediscriminator-annotations"></a>Using the @Multitenant and @TenantTableDiscriminator Annotations</h6>
<div class="paragraph">
<p>To use the <code>@Multitenant</code> annotation, include the annotation with an
<code>@Entity</code> or <code>@MappedSuperclass</code> annotation and include the
<code>TABLE_PER_TENANT</code> attribute.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Multitenant(TABLE_PER_TENANT
...)
public class Employee {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>TABLE_PER_TENANT</code> attribute states that clients have a dedicated
table or tables (<code>Table</code> and <code>SecondaryTable</code>) associated with the
entity.</p>
</div>
</div>
<div class="sect5">
<h6 id="using-the-multitenant-element-2"><a class="anchor" href="#using-the-multitenant-element-2"></a>Using the &lt;multitenant&gt; Element</h6>
<div class="paragraph">
<p>To use the <code>&lt;multitenant&gt;</code> element, include the element within an
<code>&lt;entity&gt;</code> element. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="model.Employee"&gt;
   &lt;multitenant type="TABLE_PER_TENANT"&gt;
   ...
   &lt;/multitenant&gt;
   ...
&lt;/entity&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDGBJBE"><a class="anchor" href="#CHDGBJBE"></a>Task 3: Specify Tenant Table Discriminator</h5>
<div class="paragraph">
<p>The tenant table discriminator describes the type of table discriminator
to use in a table-per-tenant multi-tenancy strategy. The tenant table
discriminator is identified by a property. You can define your own
identifier or use the default property:
<code>org.eclipse.persistence.config.PersistenceUnitProperties.MULTITENANT_PROPERTY_DEFAULT = "eclipselink.tenant-id"</code></p>
</div>
<div class="paragraph">
<p>The tenant table discriminator can be specified at the entity or mapped
superclass level, and it must always be accompanied with a
<code>Multitenant(TABLE_PER_TENANT)</code> specification. It is not sufficient to
specify only a tenant table discriminator.</p>
</div>
<div class="paragraph">
<p>The tenant table discriminator is used together with an associated
application context to indicate which table or tables an application
tenant can access.</p>
</div>
<div class="sect5">
<h6 id="using-the-tenanttablediscriminator-annotation"><a class="anchor" href="#using-the-tenanttablediscriminator-annotation"></a>Using the @TenantTableDiscriminator Annotation</h6>
<div class="paragraph">
<p>Use the <code>@TenantTableDiscriminator</code> annotation to specify which tables
are associated with which tenants. The tenant table discriminator must
include a type and a context property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>type</code> attribute to identify what type of discriminator to
use:</p>
<div class="ulist">
<ul>
<li>
<p>Use <code>PREFIX</code> to apply the tenant table discriminator as a prefix to
all multi-tenant tables.</p>
</li>
<li>
<p>Use <code>SUFFIX</code> to apply the tenant table discriminator as a suffix to
all multi-tenant tables.</p>
</li>
<li>
<p>Use <code>SCHEMA</code> to apply the tenant table discriminator as a schema to
all multi-tenant tables. This strategy requires appropriate database
provisioning.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use the <code>contextProperty</code> attributes to identify the user. The value
of the context property is a tenant ID that identifies the user. This
can be configured for an entity manager or, if you want to isolate the
table-per-tenant per persistence unit, an entity manager factory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name=”EMP”)
@Multitenant(TABLE_PER_TENANT)
@TenantTableDiscriminator(type=SCHEMA, contextProperty="eclipselink-tenant.id")
public class Employee {
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="using-the-tenant-table-discriminator-element"><a class="anchor" href="#using-the-tenant-table-discriminator-element"></a>Using the &lt;tenant-table-discriminator&gt; Element</h6>
<div class="paragraph">
<p>To use the <code>&lt;tenant-table-discriminator&gt;</code> element, include the element
within a <code>&lt;multitenant&gt;</code> element and include the <code>name</code> and
<code>context-property</code> attributes. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="Employee"&gt;
  &lt;multitenant type="TABLE_PER_TENANT"&gt;
    &lt;tenant-table-discriminator type="SCHEMA"
        context-property="eclipselink-tenant.id"/&gt;
  &lt;/multitenant&gt;
  &lt;table name="EMP"&gt;
  ...
&lt;/entity&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDDCDHI"><a class="anchor" href="#CHDDCDHI"></a>Task 4: Specify a Context Property at Runtime</h5>
<div class="paragraph">
<p>At runtime, specify the context property using a persistence unit
definition passed to an entity manager factory or set on an individual
entity manager. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit name="multitenant"&gt;
   ...
   &lt;properties&gt;
      &lt;property name="tenant.id" value="707"/&gt;
      ...
   &lt;/properties&gt;
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify a context property at runtime programmatically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">HashMap properties = new HashMap();
properties.put(PersistenceUnitProperties.MULTITENANT_PROPERTY_DEFAULT, "707");
EntityManager em = Persistence.createEntityManagerFactory("multitenant-pu",
   properties).createEntityManager();</code></pre>
</div>
</div>
<div class="paragraph">
<p>An entity manager property definition follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">EntityManager em =
  Persistence.createEntityManagerFactory("multitenant-pu").createEntityManager();
em.beginTransaction();
em.setProperty("other.tenant.id.property", "707");
em.setProperty(EntityManagerProperties.MULTITENANT_PROPERTY_DEFAULT, "707");
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-5-perform-operations-and-queries"><a class="anchor" href="#task-5-perform-operations-and-queries"></a>Task 5: Perform Operations and Queries</h5>
<div class="paragraph">
<p>The tenant discriminator column is used at runtime through entity
manager operations and querying. The tenant discriminator column and
value are supported through the following entity manager operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>persist()</code></p>
</li>
<li>
<p><code>find()</code></p>
</li>
<li>
<p><code>refresh()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The tenant discriminator column and value are supported through the
following queries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Named queries</p>
</li>
<li>
<p>Update all</p>
</li>
<li>
<p>Delete all</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Multi-tenancy is not supported through named native queries. To use
named native queries in a multi-tenant environment, manually handle any
multi-tenancy issues directly in the query. In general, it is best to
avoid named native queries in a multi-tenant environment.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MULTITENANCY004"><a class="anchor" href="#MULTITENANCY004"></a>Using VPD Multi-Tenancy</h3>
<div class="paragraph">
<p>A Virtual Private Database (VPD) uses security controls to restrict
access to database objects based on various parameters.</p>
</div>
<div class="paragraph">
<p>For example, the Oracle Virtual Private Database supports security
policies that control database access at the row and column level.
Oracle VPD adds a dynamic <code>WHERE</code> clause to SQL statements issued
against the table, view, or synonym to which the security policy was
applied.</p>
</div>
<div class="paragraph">
<p>Oracle Virtual Private Database enforces security directly on the
database tables, views, or synonyms. Because security policies are
attached directly to these database objects, and the policies are
automatically applied whenever a user accesses data, there is no way to
bypass security.</p>
</div>
<div class="paragraph">
<p>When a user directly or indirectly accesses a table, view, or synonym
that is protected with an Oracle Virtual Private Database policy, Oracle
Database dynamically modifies the SQL statement of the user. This
modification creates a WHERE condition (called a predicate) returned by
a function implementing the security policy. Oracle Virtual Private
Database modifies the statement dynamically, transparently to the user,
using any condition that can be expressed in or returned by a function.
Oracle Virtual Private Database policies can be applied to SELECT,
INSERT, UPDATE, INDEX, and DELETE statements.</p>
</div>
<div class="paragraph">
<p>When using EclipseLink VPD Multitenancy, the database handles the tenant
filtering on all SELECT, INSERT, UPDATE, INDEX and DELETE queries.</p>
</div>
<div class="paragraph">
<p>To use EclipseLink VPD multi-tenancy, you must first configure VPD in
the database and then specify multi-tenancy on the entity or mapped
superclass, as shown in the following example, using <code>@Multitenant</code> and
<code>@TenantDiscriminatorColumn</code>:</p>
</div>
<div class="sect3">
<h4 id="main-tasks-for-using-vpd-multi-tenancy"><a class="anchor" href="#main-tasks-for-using-vpd-multi-tenancy"></a>Main Tasks for Using VPD Multi-Tenancy</h4>
<div class="paragraph">
<p>The following tasks provide instructions for using VPD multi-tenancy
with Oracle Virtual Private Database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDDEDCJ">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#CHDDFBFC">Task 2: Configure the Virtual Private Database</a></p>
</li>
<li>
<p><a href="#CHDICCHE">Task 3: Configure the Entity or Mapped Superclass</a></p>
</li>
<li>
<p><a href="#CHDDJIAE">Task 4: Disable Criteria Generation</a></p>
</li>
<li>
<p><a href="#CHDIIJEB">Task 5: Configure persistence.xml</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDDEDCJ"><a class="anchor" href="#CHDDEDCJ"></a>Task 1: Prerequisites</h5>
<div class="paragraph">
<p>To implement and use VPD multi-tenancy, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="paragraph">
<p>Download EclipseLink from
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>.</p>
</div>
</li>
<li>
<p>Any compliant Java Database Connectivity (JDBC) database that supports
VDP, for example, Oracle Virtual Private Database.</p>
<div class="paragraph">
<p>For the certification matrix, see</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="CHDDFBFC"><a class="anchor" href="#CHDDFBFC"></a>Task 2: Configure the Virtual Private Database</h5>
<div class="paragraph">
<p>In this example, an Oracle Virtual Private Database is configured with a
policy and a stored procedure. The policy is a call to the database that
tells the database to use a stored function to limit the results of a
query. In this example, the function is called <code>ident_func</code>, and it is
run whenever a <code>SELECT</code>, <code>UPDATE</code> or <code>DELETE</code> is performed on the
<code>SCOTT.TASK</code> table. The policy is created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">CALL DBMS_RLS.ADD_POLICY ('SCOTT', 'TASK', 'todo_list_policy', 'SCOTT', 'ident_func', 'select, update, delete'));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function defined below is used by VPD to limit the data based on the
identifier that is passed in to the connection. The function uses the
<code>USER_ID</code> column in the table to limit the rows. The rows are limited,
based on what is set in the <code>client_identifier</code> variable in the
<code>userenv</code> context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">CREATE OR REPLACE FUNCTION ident_func (p_schema IN VARCHAR2 DEFAULT NULL, p_object IN VARCHAR2 DEFAULT NULL)
    RETURN VARCHAR2
    AS
    BEGIN
       RETURN 'USER_ID = sys_context(''userenv'', ''client_identifier'')';
    END;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDICCHE"><a class="anchor" href="#CHDICCHE"></a>Task 3: Configure the Entity or Mapped Superclass</h5>
<div class="paragraph">
<p>As described above, VPD is configured to use the <code>USER_ID</code> column to
limit access to rows. Therefore, you must tell EclipseLink to
auto-populate the <code>USER_ID</code> column on inserts. The following code uses
EclipseLink multi-tenancy and specifies that the client identifier is
passed in to the entity managers using a property called <code>tenant.id</code>.
Because the filtering is done by VPD on the database, you must turn off
caching on this entity to avoid leakage across users.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Multitenant(VPD)
@TenantDiscriminatorColumn(name = "USER_ID", contextProperty = "tenant.id")
@Cacheable(false)

public class Task implements Serializable {
...
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDDJIAE"><a class="anchor" href="#CHDDJIAE"></a>Task 4: Disable Criteria Generation</h5>
<div class="paragraph">
<p>When single-table and table-per-tenant multi-tenancy are enabled, a
client identifier is auto appended to any generated SQL. However, when
VPD is used to limit the access to data, the auto-appending of the
identifier should be turned off.</p>
</div>
<div class="paragraph">
<p>Beginning with EclipseLink 2.4, disable criteria generation as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Multitenant(includeCriteria=false)
@TenantDiscriminatorColumn(name = "USER_ID", contextProperty = "tenant.id")</code></pre>
</div>
</div>
<div class="paragraph">
<p>In EclipseLink 2.3.1, you must run the following codefrom a
<code>SessionCustomizer</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">session.getDescriptor(Task.class).getQueryManager().setIncludeTenantCriteria(false);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDIIJEB"><a class="anchor" href="#CHDIIJEB"></a>Task 5: Configure persistence.xml</h5>
<div class="paragraph">
<p>Add the following properties to <code>persistence.xml</code>.</p>
</div>
<div class="paragraph">
<p>Include the following to set and clear the VPD identifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.session-event-listener" value="example.VPDSessionEventAdapter" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Include the following to provide one connection per entity manager:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.exclusive-connection.mode" value="Always" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Include the following to allow native queries to be runnable from
EclipseLink. This is required for creating VPD artifacts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.allow-native-sql-queries" value="true" /&gt;
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"> &lt;properties&gt;
   &lt;property name="eclipselink.session-event-listener" value="example.VPDSessionEventAdapter" /&gt;
   &lt;property name="eclipselink.jdbc.exclusive-connection.mode" value="Always" /&gt;
   &lt;property name="eclipselink.jdbc.allow-native-sql-queries" value="true" /&gt;
  ...
&lt;/properties&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MULTITENANCY005"><a class="anchor" href="#MULTITENANCY005"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Code Sample</p>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MySports" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MySports</a></code></p>
</li>
</ul>
</div>
</li>
<li>
<p>See the following in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.)</p>
<div class="ulist">
<ul>
<li>
<p>&#8220;@Multitenant&#8221;</p>
</li>
<li>
<p>&#8220;@TenantDiscriminatorColumn&#8221;</p>
</li>
<li>
<p>&#8220;@TenantDiscriminatorColumns&#8221;</p>
</li>
<li>
<p>&#8220;@TenantTableDiscriminator&#8221;</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JPA2XML"><a class="anchor" href="#JPA2XML"></a>15. Mapping JPA to XML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to use JPA with the Java Architecture for XML
Binding (JAXB)—the Jakarta EE standard for mapping POJOs (Plain Old Java
Objects) to XML—and its Mapping Objects to XML (MOXy) extensions to map
JPA entities to XML. Mapping JPA entities to XML is useful when you want
to create a data access service with Java API for Restful Web Services
(JAX-RS), Java API for XML Web Services (JAX-WS), or Spring.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#JPA2XML001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#JPA2XML002">Binding JPA Entities to XML</a></p>
</li>
<li>
<p><a href="#JPA2XML003">Mapping Simple Java Values to XML Text Nodes</a></p>
</li>
<li>
<p><a href="#JPA2XML004">Using XML Metadata Representation to Override JAXB Annotations</a></p>
</li>
<li>
<p><a href="#JPA2XML005">Using XPath Predicates for Mapping</a></p>
</li>
<li>
<p><a href="#JPA2XML006">Using Dynamic JAXB/MOXy</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users need to map JPA entities to XML.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink provides support for the JAXB standard through EclipseLink
MOXy extensions.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>XML document</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink and JAXB examples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MOXy" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MOXy</a></code></p>
</li>
<li>
<p><code><a href="http://java.sun.com/developer/technicalArticles/WebServices/jaxb/index.html" class="bare">http://java.sun.com/developer/technicalArticles/WebServices/jaxb/index.html</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="JPA2XML001"><a class="anchor" href="#JPA2XML001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>This chapter demonstrates some typical techniques for mapping JPA
entities to XML. Working with the examples that follow requires some
understanding of such high-level JPA-to-XML mapping concepts, such as
JAXB, MOXy, XML binding, and how to override JAXB annotations. The
following sections will give you a basic understanding of these
concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIEHDIH">Understanding XML Binding</a></p>
</li>
<li>
<p><a href="#BEIJHDEG">Understanding JAXB</a></p>
</li>
<li>
<p><a href="#BEIGAIEH">Understanding MOXy</a></p>
</li>
<li>
<p><a href="#BEIHEGED">Understanding an XML Data Representation</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEIEHDIH"><a class="anchor" href="#BEIEHDIH"></a>Understanding XML Binding</h4>
<div class="paragraph">
<p>XML binding is how you represent information in an XML document as an
object in computer memory. This allows applications to access the data
in the XML from the object rather than using the Domain Object Model
(DOM), the Simple API for XML (SAX) or the Streaming API for XML (StAX)
to retrieve the data from a direct representation of the XML itself.
When binding, JAXB applies a tree structure to the graph of JPA
entities. Multiple tree representations of a graph are possible and will
depend on the root object chosen and the direction the relationships are
traversed.</p>
</div>
<div class="paragraph">
<p>You can find examples of XML binding with JAXB in
<a href="#JPA2XML">Binding JPA Entities to XML</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BEIJHDEG"><a class="anchor" href="#BEIJHDEG"></a>Understanding JAXB</h4>
<div class="paragraph">
<p>JAXB is a Java API that allows a Java program to access an XML document
by presenting that document to the program in a Java format. This
process, called binding, represents information in an XML document as an
object in computer memory. In this way, applications can access the data
in the XML from the object rather than using the Domain Object Model
(DOM) or the Streaming API for XML (SAX) to retrieve the data from a
direct representation of the XML itself. Usually, an XML binding is used
with JPA entities to create a data access service by leveraging a JAX-WS
or JAX-RS implementation. Both of these Web Service standards use JAXB
as the default binding layer. This service provides a means to access
data exposed by JPA across computers, where the client computer might or
might not be using Java.</p>
</div>
<div class="paragraph">
<p>JAXB uses an extended set of annotations to define the binding rules for
Java-to-XML mapping. These annotations are subclasses of the
<code>jakarta.xml.bind.`<em></code>*`</em> packages in the EclipseLink API. For more
information about these annotations, see <em>Java API Reference for
EclipseLink</em>.</p>
</div>
<div class="paragraph">
<p>For more information about JAXB, see "Java Architecture for XML Binding
(JAXB)" at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://www.eclipse.org/eclipselink/moxy.php" class="bare">http://www.eclipse.org/eclipselink/moxy.php</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="BEIGAIEH"><a class="anchor" href="#BEIGAIEH"></a>Understanding MOXy</h4>
<div class="paragraph">
<p>MOXy is EclipseLink&#8217;s JAXB implementation. It allows you to map a POJO
model to an XML schema, greatly enhancing your ability to create
JPA-to-XML mappings. MOXy supports all the standard JAXB annotations in
the <code>jakarta.xml.bind.annotation</code> package plus has its own extensions in
the <code>org.eclipse.persistence.oxm.annotations</code> package. You can use these
latter annotations in conjunction with the standard annotations to
extend the utility of JAXB. Because MOXy represents the optimal JAXB
implementation, you still implement it whether or not you explicitly use
any of its extensions. MOXy offers these benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It allows you to map your own classes to your own XML schema, a
process called "Meet in the Middle Mapping". This avoids static coupling
of your mapped classes with a single XML schema,</p>
</li>
<li>
<p>It offers specific features, such as Xpath-based mapping, JSON
binding, and compound key mapping and mapping relationships with
back-pointers to address critical JPA-to-XML mapping issues.</p>
</li>
<li>
<p>It allows you to map your existing JPA models to industry standard
schema.</p>
</li>
<li>
<p>It allows you to combine MOXy mappings and EclipseLink&#8217;s persistence
framework to interact with your data through JCA.</p>
</li>
<li>
<p>It offers superior performance in several scenarios.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about MOXy, see the MOXy FAQ at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/FAQ/WhatIsMOXy" class="bare">http://wiki.eclipse.org/EclipseLink/FAQ/WhatIsMOXy</a></code></p>
</div>
</div>
<div class="sect3">
<h4 id="BEIHEGED"><a class="anchor" href="#BEIHEGED"></a>Understanding an XML Data Representation</h4>
<div class="paragraph">
<p>Annotations are not always the most effective way to map JPA to XML. For
example, you would not use JAXB if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You want to specify metadata for a third-party class but do not have
access to the source.</p>
</li>
<li>
<p>You want to map an object model to multiple XML schemas, because JAXB
rules preclude applying more than one mapping by using annotations.</p>
</li>
<li>
<p>Your object model already contains too many annotations—for example,
from such services as JPA, Spring, JSR-303, and so on—and you want to
specify the metadata elsewhere.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Under these and similar circumstances, you can use an XML data
representation by exposing the <code>eclipselink_oxm.xml</code> file.</p>
</div>
<div class="paragraph">
<p>XML metadata works in two modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It adds to the metadata supplied by annotations. This is useful when:</p>
<div class="ulist">
<ul>
<li>
<p>Annotations define version one of the XML representation, and you use
XML metadata to tweak the metadata for future versions.</p>
</li>
<li>
<p>You use the standard JAXB annotations, and use the XML metadata for
the MOXy extensions. In this way you don&#8217;t introduce new compile time
dependencies in the object model.</p>
</li>
</ul>
</div>
</li>
<li>
<p>It completely replaces the annotation metadata, which is useful when
you want to map to different XML representations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To see how to use XML data representation, see
<a href="#JPA2XML">Using XML Metadata Representation to
Override JAXB Annotations</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML002"><a class="anchor" href="#JPA2XML002"></a>Binding JPA Entities to XML</h3>
<div class="paragraph">
<p>The following examples demonstrate how to bind JPA entities to XML by
using JAXB annotations. For more information about binding, see
<a href="#BEIEHDIH">Understanding XML Binding</a> for more
information about JAXB, see <a href="#BEIJHDEG">Understanding
JAXB</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEICADBF">Binding JPA Relationships to XML</a></p>
</li>
<li>
<p><a href="#BEIIHFJG">Binding Compound Primary Keys to XML</a></p>
</li>
<li>
<p><a href="#BEIECBGA">Binding Embedded ID Classes to XML</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEICADBF"><a class="anchor" href="#BEICADBF"></a>Binding JPA Relationships to XML</h4>
<div class="paragraph">
<p>The following exercise demonstrate show to use JAXB to derive an XML
representation from a set of JPA entities, a process called "binding"
(read about XML binding in <a href="#BEIGDBHI">Binding JPA Entities to XML</a>).
These examples will show how to bind two common JPA relationships:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Privately-owned relationships</p>
</li>
<li>
<p>Shared reference relationships</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>to map an Employee entity to that employee&#8217;s phone number, address, and
department.</p>
</div>
<div class="sect4">
<h5 id="BEIBJCIJ"><a class="anchor" href="#BEIBJCIJ"></a>Task 1: Define the Accessor Type and Import Classes</h5>
<div class="paragraph">
<p>Since all of the following examples use the same accessor type, <code>FIELD</code>,
define it at the package level by using the JAXB annotation
<code>@XmlAccessorType</code>. At this point, you would also import the necessary
classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlAccessorType(XmlAccessType.FIELD)
package com.example.model;

import jakarta.xml.bind.annotation.XmlAccessType;
import jakarta.xml.bind.annotation.XmlAccessorType;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-2-map-privately-owned-relationships"><a class="anchor" href="#task-2-map-privately-owned-relationships"></a>Task 2: Map Privately-Owned Relationships</h5>
<div class="paragraph">
<p>A "privately-owned" relationship occurs when the target object is only
referenced by a single source object. This type of relationship can be
either one-to-one and embedded or one-to-many.</p>
</div>
<div class="paragraph">
<p>This Task shows how to create bi-directional mappings for both of these
types of relationships between the <code>Employee</code> entity and the <code>Address</code>
and <code>PhoneNumber</code> entities.</p>
</div>
<div class="sect5">
<h6 id="BEIJCIBI"><a class="anchor" href="#BEIJCIBI"></a>Mapping a One-to-One and Embedded Relationship</h6>
<div class="paragraph">
<p>The JPA <code>@OneToOne</code> and <code>@Embedded</code> annotations indicate that only one
instance of the source entity is able to refer to the same target entity
instance. This example shows how to map the <code>Employee</code> entity to the
<code>Address</code> entity and back. This is considered a one-to-one mapping
because the employee can be associated with only one address. Since this
relationship is bi-directional—that is, <code>Employee</code> points to <code>Address</code>,
which must point back to <code>Employee</code>—it uses the EclipseLink extension
<code>@XmlInverseReference</code> to represent the back-pointer.</p>
</div>
<div class="paragraph">
<p>To create the one-to-one and embedded mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the accessor type <code>FIELD</code> has been defined at the package
level, as described in <a href="#BEIBJCIJ">Task 1: Define the Accessor Type
and Import Classes</a>.</p>
</li>
<li>
<p>Map one direction of the relationship, in this case, the <code>employee</code>
property on <code>Address</code>, by inserting the <code>@OneToOne</code> annotation in the
<code>Employee</code> entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToOne(mappedBy="resident")
    private Address residence;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mappedBy</code> argument indicates that the relationship is owned by the
<code>resident</code> field.</p>
</div>
</li>
<li>
<p>Map the return direction—that is, the <code>address</code> property on
<code>Employee</code>—by inserting the <code>@OneToOne</code> and <code>@XmlInverseMapping</code>
annotations into the Address entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToOne
    @JoinColumn(name="E_ID")
    @XmlInverseReference(mappedBy="residence")
    private Employee resident;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mappedBy</code> field indicates that this relationship is owned by the
<code>residence</code> field. <code>@JoinColumn</code> identifies the column that will contain
the foreign key.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The entities should look like those shown in <a href="#BEIJFCEG">Example
15-1</a> and <a href="#BEIEGBBE">Example 15-2</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="mapping-a-one-to-many-relationship"><a class="anchor" href="#mapping-a-one-to-many-relationship"></a>Mapping a One-to-Many Relationship</h6>
<div class="paragraph">
<p>The JPA <code>@OneToMany</code> annotation indicates that a single instance of the
source entity can refer to multiple instances of the same target entity.
For example, one employee can have multiple phone numbers, such as a
land line, a mobile number, a desired contact number, and an alternative
workplace number. Each different number would be an instance of the
<code>PhoneNumber</code> entity and a single <code>Employee</code> entity could point to each
instance.</p>
</div>
<div class="paragraph">
<p>This Task maps the employee to one of that employee&#8217;s phone numbers and
back. Since the relationship between <code>Employee</code> and <code>PhoneNumber</code> is
bi-directional, the example again uses the EclipseLink extension
<code>@XmlInverseReference</code> to map the back-pointer.</p>
</div>
<div class="paragraph">
<p>To create a one-to-many mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the accessor type <code>FIELD</code> has been defined at the package
level, as described in <a href="#BEIBJCIJ">Task 1: Define the Accessor Type
and Import Classes</a>.</p>
</li>
<li>
<p>Map one direction of the relationship, in this case, the employee
property on <code>PhoneNumber</code>, by inserting the <code>@OneToMany</code> annotation in
the <code>Employee</code> entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToMany(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mappedBy</code> field indicates that this relationship is owned by the
<code>contact</code> field.</p>
</div>
</li>
<li>
<p>Map the return direction—that is, the phone number property on
<code>Employee</code>—by inserting the <code>@ManyToOne</code> and <code>@XmlInverseMapping</code>
annotations into the <code>PhoneNumber</code> entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @ManyToOne
    @JoinColumn(name="E_ID", referencedColumnName = "E_ID")
    @XmlInverseReference(mappedBy="contactNumber")
    private Employee contact;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mappedBy</code> field indicates that this relationship is owned by the
<code>contactNumber</code> field. The <code>@JoinColumn</code> annotation identifies the
column that will contain the foreign key (<code>name="E_ID"</code>) and the column
referenced by the foreign key (<code>referencedColumnName = "E_ID"</code>).</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The entities should look like those shown in <a href="#BEIJFCEG">Example
15-1</a> and <a href="#BEIEEFBA">Example 15-3</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BEIEEFII"><a class="anchor" href="#BEIEEFII"></a>Task 3: Map the Shared Reference Relationship</h5>
<div class="paragraph">
<p>A shared reference relationship occurs when target objects are
referenced by multiple source objects. For example, a business might be
segregated into multiple departments, such as IT, human resources,
finance, and so on. Each of these departments has multiple employees of
differing job descriptions, pay grades, locations, and so on. Managing
departments and employees requires shared reference relationships.</p>
</div>
<div class="paragraph">
<p>Since a shared reference relationship cannot be safely represented as
nesting in XML, we use key relationships. In order to leverage the ID
fields on JPA entities, you need to use the EclipseLink JAXB <code>@XmlID</code>
annotation on non-String fields and properties and <code>@XmlIDREF</code> on string
fields and properties.</p>
</div>
<div class="paragraph">
<p>This section contains examples that show how to map a many-to-one shared
reference relationship and a many-to-many shared reference relationship.</p>
</div>
<div class="sect5">
<h6 id="mapping-a-many-to-one-shared-reference-relationship"><a class="anchor" href="#mapping-a-many-to-one-shared-reference-relationship"></a>Mapping a Many-to-One Shared Reference Relationship</h6>
<div class="paragraph">
<p>In a many-to-one mapping, one or more instances of the source entity are
able to refer to the same target entity instance. This example
demonstrates how to map an employee to one of that employee&#8217;s multiple
phone numbers.</p>
</div>
<div class="paragraph">
<p>To map a many-to-one shared reference relationship:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the accessor type <code>FIELD</code> has been defined at the package
level, as described in <a href="#BEIBJCIJ">Task 1: Define the Accessor Type
and Import Classes</a>.</p>
</li>
<li>
<p>Map one direction of the relationship, in this case the phone number
property on <code>Employee</code>, by inserting the <code>@ManyToOne</code> annotation in the
<code>PhoneNumber</code> entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @ManyToOne
    @JoinColumn(name="E_ID", referencedColumnName = "E_ID")
    @XmlIDREF
    private Employee contact;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@JoinColumn</code> annotation identifies the column that will contain the
foreign key (<code>name="E_ID"</code>) and the column referenced by the foreign key
(<code>referencedColumnName = "E_ID"</code>). The <code>@XmlIDREF</code> annotation indicates
that this will be the primary key for the corresponding table.</p>
</div>
</li>
<li>
<p>Map the return direction—that is, the employee property on PhoneNumber
—by inserting the <code>@OneToMany</code> and <code>@XmlInverseMapping</code> annotations into
the Address entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mappedBy</code> field for both annotations indicates that this
relationship is owned by the <code>contact</code> field.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The entities should look like those shown in <a href="#BEIJFCEG">Example
15-1</a> and <a href="#BEIEEFBA">Example 15-3</a>.</p>
</div>
</div>
<div class="sect5">
<h6 id="mapping-a-many-to-many-shared-reference-relationship"><a class="anchor" href="#mapping-a-many-to-many-shared-reference-relationship"></a>Mapping a Many-to-Many Shared Reference Relationship</h6>
<div class="paragraph">
<p>The <code>@ManyToMany</code> annotation indicates that one or more instances of the
source entity are able to refer to one or more target entity instances.
Since the relationship between <code>Department</code> and <code>Employee</code> is
bi-directional, this example again uses the EclipseLink&#8217;s
<code>@XmlInverseReference</code> annotation to represent the back-pointer.</p>
</div>
<div class="paragraph">
<p>To map a many-to-many shared reference relationship, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that the accessor type <code>FIELD</code> has been defined at the package
level, as described in <a href="#BEIBJCIJ">Task 1: Define the Accessor Type
and Import Classes</a>.</p>
</li>
<li>
<p>Create a <code>Department</code> entity by inserting the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class Department {</code></pre>
</div>
</div>
</li>
<li>
<p>Under this entity define the many-to-many relationship and the
entity&#8217;s join table by inserting the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @ManyToMany
    @JoinTable(name="DEPT_EMP", joinColumns =
        @JoinColumn(name="D_ID", referencedColumnName = "D_ID"),
            inverseJoinColumns = @JoinColumn(name="E_ID",
                referencedColumnName = "E_ID"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code creates a join table called <code>DEPT_EMP</code> and identifies the
column that will contain the foreign key (<code>name="E_ID"</code>) and the column
referenced by the foreign key (<code>referencedColumnName = "E_ID"</code>).
Additionally, it identifies the primary table on the inverse side of the
association.</p>
</div>
</li>
<li>
<p>Complete the initial mapping—in this case, the <code>Department</code> property
<code>employee</code>—and make it a foreign key for this entity by inserting the
following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @XmlIDREF
    private List&lt;Employee&gt; member;</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>Employee</code> entity created in <a href="#BEIJCIBI">Mapping a
One-to-One and Embedded Relationship</a>, specifying that <code>eId</code> is the
primary key for JPA (<code>@Id</code> annotation), and for JAXB (<code>@XmlID</code>
annotation) by inserting the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @Id
    @Column(name="E_ID")
    @XmlID
    private BigDecimal eId;</code></pre>
</div>
</div>
</li>
<li>
<p>Still within the <code>Employee</code> entity, complete the return mapping by
inserting the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @ManyToMany(mappedBy="member")
    @XmlInverseReference(mappedBy="member")
    private List&lt;Department&gt; team;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The entities should look like those shown in <a href="#BEIJFCEG">Example
15-1</a> and <a href="#BEIHHJEA">Example 15-4</a>.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="jpa-entities"><a class="anchor" href="#jpa-entities"></a>JPA Entities</h5>
<div class="paragraph">
<p>Once the mappings are created, the entities should look like those in
the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIJFCEG">Example 15-1, "Employee Entity"</a></p>
</li>
<li>
<p><a href="#BEIEGBBE">Example 15-2, "Address Entity"</a></p>
</li>
<li>
<p><a href="#BEIEEFBA">Example 15-3, "PhoneNumber Entity"</a></p>
</li>
<li>
<p><a href="#BEIHHJEA">Example 15-4, "Department Entity"</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to save space, package names, import statements, and the
get/set methods have been omitted from the code examples. All examples
use standard JPA annotations.
</td>
</tr>
</table>
</div>
<div id="BEIJFCEG" class="paragraph">
<p><strong><em>Example 15-1 Employee Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class Employee {

    @Id
    @Column(name="E_ID")
    private BigDecimal eId;

    private String name;

    @OneToOne(mappedBy="resident")
    private Address residence;

    @OneToMany(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;

    @ManyToMany(mappedBy="member")
    private List&lt;Department&gt; team;

}</code></pre>
</div>
</div>
<div id="BEIEGBBE" class="paragraph">
<p><strong><em>Example 15-2 Address Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class Address {

    @Id
    @Column(name="E_ID", insertable=false, updatable=false)
    private BigDecimal eId;

    private String city;

    private String street;

    @OneToOne
    @JoinColumn(name="E_ID")
    private Employee resident;

}</code></pre>
</div>
</div>
<div id="BEIEEFBA" class="paragraph">
<p><strong><em>Example 15-3 PhoneNumber Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name="PHONE_NUMBER")
public class PhoneNumber {

    @Id
    @Column(name="P_ID")
    private BigDecimal pId;

    @ManyToOne
    @JoinColumn(name="E_ID", referencedColumnName = "E_ID")
    private Employee contact;

    private String num;

}</code></pre>
</div>
</div>
<div id="BEIHHJEA" class="paragraph">
<p><strong><em>Example 15-4 Department Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class Department {

    @Id
    @Column(name="D_ID")
    private BigDecimal dId;

    private String name;

    @ManyToMany
    @JoinTable(name="DEPT_EMP", joinColumns =
        @JoinColumn(name="D_ID", referencedColumnName = "D_ID"),
            inverseJoinColumns = @JoinColumn(name="E_ID",
                referencedColumnName = "E_ID"))
    private List&lt;Employee&gt; member;

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="BEIIHFJG"><a class="anchor" href="#BEIIHFJG"></a>Binding Compound Primary Keys to XML</h3>
<div class="paragraph">
<p>When a JPA entity has compound primary keys, you can bind it by using
JAXB annotations and certain EclipseLink extensions, as shown in the
following example.</p>
</div>
<div class="sect3">
<h4 id="task1-define-the-xml-accessor-type"><a class="anchor" href="#task1-define-the-xml-accessor-type"></a>Task1: Define the XML Accessor Type</h4>
<div class="paragraph">
<p>Define the accessor type as <code>FIELD</code>, as described in <a href="#BEIBJCIJ">Task
1: Define the Accessor Type and Import Classes</a></p>
</div>
</div>
<div class="sect3">
<h4 id="task-2-create-the-target-object"><a class="anchor" href="#task-2-create-the-target-object"></a>Task 2: Create the Target Object</h4>
<div class="paragraph">
<p>To create the target object, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an <code>Employee</code> entity with a composite primary key class called
<code>EmployeeID</code> to map to multiple fields or properties of the entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@IdClass(EmployeeId.class)
public class Employee {</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the first primary key, eId, of the entity and map it to a
column:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @Id
    @Column(name="E_ID")
    @XmlID
    private BigDecimal eId;</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the second primary key, country. In this instance, you need to
use <code>@XmlKey</code> to identify the primary key because only one property—
<code>eId</code>—can be annotated with the <code>@XmlID</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @Id
    @XmlKey
    private String country;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@XmlKey</code> annotation marks a property as a key that will be
referenced by using a key-based mapping via the <code>@XmlJoinNode</code>
annotation in the source object. This is similar to the <code>@XmlKey</code>
annotation except it doesn&#8217;t require the property be bound to the schema
type ID. This is a typical application of the <code>@XmlKey</code> annotation.</p>
</div>
</li>
<li>
<p>Create a many-to-one mapping of the <code>Employee</code> property on
<code>PhoneNumber</code> by inserting the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Employee entity should look like <a href="#BEIDFDDJ">Example 15-5</a></p>
</div>
<div id="BEIDFDDJ" class="paragraph">
<p><strong><em>Example 15-5 Employee Entity with Compound Primary Keys</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@IdClass(EmployeeId.class)
public class Employee {

    @Id
    @Column(name="E_ID")
    @XmlID
    private BigDecimal eId;

    @Id
    @XmlKey
    private String country;

    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;

}

public class EmployeeId {
    public BigDecimal eId;
    public String country;

    public EmployeeId(BigDecimal eId, String country) {
        this.id = id;
        this.country = country;;
    }

    public boolean equals(Object other) {
        if (other instanceof EmployeeId) {
            final EmployeeId otherEmployeeId = (EmployeeId) other;
            return (otherEmployeeId.eId.equals(eId) &amp;&amp; otherEmployeeId.country.equals(country));
        }

    return false;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task-3-create-the-source-object"><a class="anchor" href="#task-3-create-the-source-object"></a>Task 3: Create the Source Object</h4>
<div class="paragraph">
<p>This Task creates the source object, the <code>PhoneNumber</code> entity. Because
the target object has a compound key, we need to use the EclipseLink&#8217;s
<code>@XmlJoinNodes</code> annotation to set up the mapping.</p>
</div>
<div class="paragraph">
<p>To create the source object:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>PhoneNumber</code> entity:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class PhoneNumber {</code></pre>
</div>
</div>
</li>
<li>
<p>Create a many-to-one relationship and define the join columns:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"> @ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
   })</code></pre>
</div>
</div>
</li>
<li>
<p>Set up the mapping by using the EclipseLink&#8217;s <code>@XmlJoinNodes</code>
annotation</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlJoinNodes( {
        @XmlJoinNode(xmlPath="contact/id/text()", referencedXmlPath="id/text()"),
        @XmlJoinNode(xmlPath="contact/country/text()", referencedXmlPath="country/text()")
    })</code></pre>
</div>
</div>
</li>
<li>
<p>Define the <code>contact</code> property:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">private Employee contact;

}</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The target object should look like <a href="#BEIFBGAG">Example 15-6</a>.</p>
</div>
<div id="BEIFBGAG" class="paragraph">
<p><strong><em>Example 15-6 PhoneNumber Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class PhoneNumber {

    @ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
    })
    @XmlJoinNodes( {
        @XmlJoinNode(xmlPath="contact/id/text()", referencedXmlPath="id/text()"),
        @XmlJoinNode(xmlPath="contact/country/text()", referencedXmlPath="country/text()")
    })
    private Employee contact;

}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIECBGA"><a class="anchor" href="#BEIECBGA"></a>Binding Embedded ID Classes to XML</h4>
<div class="paragraph">
<p>An embedded ID defines a separate <code>Embeddable</code> Java class to contain the
entity&#8217;s primary key. It is defined through the <code>@EmbeddedId</code>
annotation.The embedded ID&#8217;s <code>Embeddable</code> class must define each id
attribute for the entity using basic mappings. All attributes in the
embedded Id&#8217;s <code>Embeddable</code> are assumed to be part of the primary key.
This exercise shows how to derive an XML representation from a set of
JPA entities using JAXB when a JPA entity has an embedded ID class.</p>
</div>
<div class="sect4">
<h5 id="task1-define-the-xml-accessor-type-2"><a class="anchor" href="#task1-define-the-xml-accessor-type-2"></a>Task1: Define the XML Accessor Type</h5>
<div class="paragraph">
<p>Define the XML accessor type as <code>FIELD</code>, as described in
<a href="#BEIBJCIJ">Task 1: Define the Accessor Type and Import Classes</a></p>
</div>
</div>
<div class="sect4">
<h5 id="BEIDGBIA"><a class="anchor" href="#BEIDGBIA"></a>Task 2: Create the Target Object</h5>
<div class="paragraph">
<p>The target object is an entity called <code>Employee</code> and contains the
mapping for an employee&#8217;s contact phone number. Creating this target
object requires implementing a <code>DescriptorCustomizer</code> interface, so you
must include EclipseLink&#8217;s <code>@XmlCustomizer</code> annotation Also, since the
relationship is bidirectional, you must also implement the
<code>@XmlInverseReference</code>. annotation.</p>
</div>
<div class="paragraph">
<p>To create the target object:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>Employee</code> entity. Use the <code>@IdClass</code> annotation to specify
that the <code>EmployeeID</code> class will be mapped to multiple properties of the
entity.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@IdClass(EmployeeId.class)
public class Employee {
}</code></pre>
</div>
</div>
</li>
<li>
<p>Define the <code>id</code> property and make it embeddable.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @EmbeddedId
    @XmlPath(".");
    private EmployeeId id;</code></pre>
</div>
</div>
</li>
<li>
<p>Define a one-to-many mapping—in this case, the <code>employee</code> property on
<code>PhoneNumber</code>. Because the relationship is bi-directional, use
<code>@XmlInverseReference</code> to define the return mapping. Both of these
relationships will be owned by the contact field, as indicated by the
<code>mappedBy</code> argument.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The completed target object should look like <a href="#BEIDAGDJ">Example
15-7</a>.</p>
</div>
<div id="BEIDAGDJ" class="paragraph">
<p><strong><em>Example 15-7 Employee Entity as Target Object</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@IdClass(EmployeeId.class)
@XmlCustomizer(EmployeeCustomizer.class)
public class Employee {

    @EmbeddedId
    private EmployeeId id;

    @OneToMany(mappedBy="contact")
    @XmlInverseReference(mappedBy="contact")
    private List&lt;PhoneNumber&gt; contactNumber;

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-3-create-the-source-object-2"><a class="anchor" href="#task-3-create-the-source-object-2"></a>Task 3: Create the Source Object</h5>
<div class="paragraph">
<p>The source object in this example has a compound key, so you must mark
the field <code>@XmlTransient</code> to prevent a key from being mapped by itself.
Use EclipseLink&#8217;s <code>@XmlCustomizer</code> annotation to set up the mapping.</p>
</div>
<div class="paragraph">
<p>To create the source object, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>PhoneNumber</code> entity.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class PhoneNumber {
}</code></pre>
</div>
</div>
</li>
<li>
<p>Create a many-to-one mapping and define the join columns.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
    })</code></pre>
</div>
</div>
</li>
<li>
<p>Define the XML nodes for the mapping, using the EclipseLink
<code>@XmlJoinNodes</code> annotation extension. If the target object had a
<em>single</em> ID, you would use the <code>@XmlIDREF</code> annotation.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @XmlJoinNodes( {        @XmlJoinNode(xmlPath="contact/id/text()", referencedXmlPath="id/text()"),        @XmlJoinNode(xmlPath="contact/country/text()", referencedXmlPath="country/text()")    })
    private Employee contact;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The completed <code>PhoneNumber</code> class should look like
<a href="#BEIGJACE">Example 15-8</a>.</p>
</div>
<div id="BEIGJACE" class="paragraph">
<p><strong><em>Example 15-8 PhoneNumber Class as Source Object</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
public class PhoneNumber {

    @ManyToOne
    @JoinColumns({
        @JoinColumn(name="E_ID", referencedColumnName = "E_ID"),
        @JoinColumn(name="E_COUNTRY", referencedColumnName = "COUNTRY")
    })
    @XmlJoinNodes( {
        @XmlJoinNode(xmlPath="contact/id/text()", referencedXmlPath="id/text()"),
        @XmlJoinNode(xmlPath="contact/country/text()", referencedXmlPath="country/text()")
    })
    private Employee contact;

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-5-implement-the-descriptorcustomizer-as-phonenumbercustomizer-class"><a class="anchor" href="#task-5-implement-the-descriptorcustomizer-as-phonenumbercustomizer-class"></a>Task 5: Implement the DescriptorCustomizer as PhoneNumberCustomizer Class</h5>
<div class="paragraph">
<p>Code added in Task 4 indicated the need to create the
XMLObjectReferenceMappings to the new values. This requires to
implementing the <code>DescriptorCustomizer</code> as the <code>PhoneNumberCustomizer</code>
and adding the multiple key mappings. To do this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement <code>DescriptorCustomizer</code> as <code>PhoneNumberCustomizer</code>. Be sure
to import
<code>org.eclipse.persistence.oxm.mappings.XMLObjectReferenceMapping</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.eclipse.persistence.oxm.mappings.XMLObjectReferenceMapping;

public class PhoneNumberCustomizer implements DescriptorCustomizer {</code></pre>
</div>
</div>
</li>
<li>
<p>In the <code>customize</code> method, update the following mappings:</p>
<div class="ulist">
<ul>
<li>
<p><code>contactMapping.setAttributeName</code> to <code>"contact"</code>.</p>
</li>
<li>
<p><code>contactMapping.addSourceToTargetKeyFieldAssociation</code> to
<code>"contact/@eID", "eId/text()"</code>.</p>
</li>
<li>
<p><code>contactMapping.addSourceToTargetKeyFieldAssociation</code> to
<code>"contact/@country", "country/text()"</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>PhoneNumberCustomizer</code> should look like <a href="#BEIFCHBH">Example 15-9</a>.</p>
</div>
<div id="BEIFCHBH" class="paragraph">
<p><strong><em>Example 15-9 PhoneNumber Customizer with Updated Key Mappings</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.eclipse.persistence.descriptors.DescriptorCustomizer;
import org.eclipse.persistence.descriptors.ClassDescriptor;
import org.eclipse.persistence.oxm.mappings.XMLObjectReferenceMapping;

public class PhoneNumberCustomizer implements DescriptorCustomizer {

    public void customize(ClassDescriptor descriptor) throws Exception {
        XMLObjectReferenceMapping contactMapping = new XMLObjectReferenceMapping();
        contactMapping.setAttributeName("contact");
        contactMapping.setReferenceClass(Employee.class);
        contactMapping.addSourceToTargetKeyFieldAssociation("contact/@eID", "eId/text()");
        contactMapping.addSourceToTargetKeyFieldAssociation("contact/@country", "country/text()");
        descriptor.addMapping(contactMapping);
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BEIBJBFA"><a class="anchor" href="#BEIBJBFA"></a>Using the EclipseLink XML Binding Document</h5>
<div class="paragraph">
<p>As demonstrated in the preceding examples, EclipseLink implements the
standard JAXB annotations to map JPA entities to an XML representation.
You can also express metadata by using the EclipseLink XML Bindings
document. Not only can you use XML bindings to separate your mapping
information from your actual Java class but you can also use it for more
advanced metadata tasks such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Augmenting or overriding existing annotations with additional mapping
information.</p>
</li>
<li>
<p>Specifying all mapping information externally, without using any Java
annotations.</p>
</li>
<li>
<p>Defining your mappings across multiple Bindings documents.</p>
</li>
<li>
<p>Specifying "virtual" mappings that do not correspond to concrete Java
fields</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about using the XML Bindings document, see XML
Bindings in the JAXB/MOXy documentation at
<code><a href="http://wiki.eclipse.org/EclipseLink/UserGuide/MOXy/Runtime/XML_Bindings" class="bare">http://wiki.eclipse.org/EclipseLink/UserGuide/MOXy/Runtime/XML_Bindings</a></code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML003"><a class="anchor" href="#JPA2XML003"></a>Mapping Simple Java Values to XML Text Nodes</h3>
<div class="paragraph">
<p>This section demonstrates several ways to map simple Java values
directly to XML text nodes. It includes the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIJIEGC">Mapping a Value to an Attribute</a></p>
</li>
<li>
<p><a href="#BEIDFEIC">Mapping a Value to a Text Node</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEIJIEGC"><a class="anchor" href="#BEIJIEGC"></a>Mapping a Value to an Attribute</h4>
<div class="paragraph">
<p>This example maps the <code>id</code> property in the Java object <code>Customer</code> to its
XML representation as an attribute of the <code>&lt;customer&gt;</code> element. The XML
will be based on the schema in <a href="#BEICBDBC">Example 15-10</a>.</p>
</div>
<div id="BEICBDBC" class="paragraph">
<p><strong><em>Example 15-10 Example XML Schema</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;

   &lt;xsd:element name="customer" type="customer-type"/&gt;

   &lt;xsd:complexType name="customer-type"&gt;
      &lt;xsd:attribute name="id" type="xsd:integer"/&gt;
   &lt;/xsd:complexType&gt;

&lt;/xsd:schema&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following procedures demonstrate how to map the <code>id</code> property from
the Java object and, alternately, how to represent the value in
EclipseLink&#8217;s Object-to-XML Mapping (OXM) metadata format.</p>
</div>
<div class="sect4">
<h5 id="mapping-from-the-java-object"><a class="anchor" href="#mapping-from-the-java-object"></a>Mapping from the Java Object</h5>
<div class="paragraph">
<p>The key to creating this mapping from a Java object is the
<code>@XmlAttribute</code> JAXB annotation, which maps the field to the XML
attribute. To create this mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the object and import <code>jakarta.xml.bind.annotation.*</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Customer</code> class and use the <code>@XmlRootElement</code> annotation
to make it the root element. Set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Map the <code>id</code> property in the <code>Customer</code> class as an attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">   @XmlAttribute
   private Integer id;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The object should look like <a href="#BEIHFEHF">Example 15-11</a>.</p>
</div>
<div id="BEIHFEHF" class="paragraph">
<p><strong><em>Example 15-11 Customer Object with Mapped id Property</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {
   @XmlAttribute
   private Integer id;

   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="defining-the-mapping-in-oxm-metadata-format"><a class="anchor" href="#defining-the-mapping-in-oxm-metadata-format"></a>Defining the Mapping in OXM Metadata Format</h5>
<div class="paragraph">
<p>If you want to represent the mapping in EclipseLink&#8217;s OXM metadata
format, you need to use the XML tags defined in the
<code>eclipselink-oxm.xml</code> file and populate them with the appropriate
values, as shown in <a href="#BEICFEDE">Example 15-12</a>.</p>
</div>
<div id="BEICFEDE" class="paragraph">
<p><strong><em>Example 15-12 Mapping id as an Attribute in OXM Metadata Format</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;java-type name="Customer"&gt;
   &lt;xml-root-element name="customer"/&gt;
   &lt;java-attributes&gt;
      &lt;xml-attribute java-attribute="id"/&gt;
   &lt;/java-attributes&gt;
&lt;/java-type&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about the OXM metadata format, see
<a href="#JPA2XML004">Using XML Metadata Representation to
Override JAXB Annotations</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIDFEIC"><a class="anchor" href="#BEIDFEIC"></a>Mapping a Value to a Text Node</h4>
<div class="paragraph">
<p>EclipseLink makes it easy for you to map values from a Java object to
various kinds of XML text nodes; for example, to simple text nodes, text
nodes in a simple sequence, in a subset, or by position. These mappings
are demonstrated in the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIFAICJ">Mapping a Value to a Simple Text Node</a></p>
</li>
<li>
<p><a href="#BEIBEFEJ">Mapping Values to a Text Node in a Simple Sequence</a></p>
</li>
<li>
<p><a href="#BEICIFCI">Mapping a Value to a Text Node in a Sub-element</a></p>
</li>
<li>
<p><a href="#BEIDCEHD">Mapping Values to a Text Node by Position</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="BEIFAICJ"><a class="anchor" href="#BEIFAICJ"></a>Mapping a Value to a Simple Text Node</h5>
<div class="paragraph">
<p>You can map a value from a Java object either by using JAXB annotations
in the Java object or, alternately, by representing the mapping in
EclipseLink&#8217;s OXM metadata format.</p>
</div>
<div class="sect5">
<h6 id="mapping-by-using-jaxb-annotations"><a class="anchor" href="#mapping-by-using-jaxb-annotations"></a>Mapping by Using JAXB Annotations</h6>
<div class="paragraph">
<p>Assuming the associated schema defines an element called
<code>&lt;phone-number&gt;</code> which accepts a string value, you can use the
<code>@XmlValue</code> annotation to map a string to the <code>&lt;phone-number&gt;</code> node. Do
the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the object and import <code>jakarta.xml.bind.annotation.*</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>PhoneNumber</code> class and use the <code>@XmlRootElement</code>
annotation to make it the root element with the name phone-number. Set
the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement(name="phone-number")
@XmlAccessorType(XmlAccessType.FIELD)
public class PhoneNumber {</code></pre>
</div>
</div>
</li>
<li>
<p>Insert the <code>@XmlValue</code> annotation on the line before the <code>number</code>
property in the Customer class to map this value as an attribute:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">   @XmlValue
   private String number;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The object should look like <a href="#BEIGFCJG">Example 15-13</a>.</p>
</div>
<div id="BEIGFCJG" class="paragraph">
<p><strong><em>Example 15-13 PhoneNumber Object with Mapped number Property</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

@XmlRootElement(name="phone-number")
@XmlAccessorType(XmlAccessType.FIELD)
public class PhoneNumber {
   @XmlValue
   private String number;

   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="defining-the-mapping-in-oxm-metadata-format-2"><a class="anchor" href="#defining-the-mapping-in-oxm-metadata-format-2"></a>Defining the Mapping in OXM Metadata Format</h6>
<div class="paragraph">
<p>If you want to represent the mapping in EclipseLink&#8217;s OXM metadata
format, you need to use the XML tags defined in the
<code>eclipselink-oxm.xml</code> file and populate them with the appropriate
values, as shown in <a href="#BEIECBDG">Example 15-14</a>.</p>
</div>
<div id="BEIECBDG" class="paragraph">
<p><strong><em>Example 15-14 Mapping number as an Attribute in OXM Metadata Format</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;java-type name="PhoneNumber"&gt;
   &lt;xml-root-element name="phone-number"/&gt;
   &lt;java-attributes&gt;
      &lt;xml-value java-attribute="number"/&gt;
   &lt;/java-attributes&gt;
&lt;/java-type&gt;
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BEIBEFEJ"><a class="anchor" href="#BEIBEFEJ"></a>Mapping Values to a Text Node in a Simple Sequence</h5>
<div class="paragraph">
<p>You can map a sequence of values, for example a customer&#8217;s first and
last name, as separate elements either by using JAXB annotations or by
representing the mapping in EclipseLink&#8217;s OXM metadata format. The
following procedures illustrate how to map values for a customers' first
names and last names</p>
</div>
<div class="sect5">
<h6 id="mapping-by-using-jaxb-annotations-2"><a class="anchor" href="#mapping-by-using-jaxb-annotations-2"></a>Mapping by Using JAXB Annotations</h6>
<div class="paragraph">
<p>Assuming the associated schema defines the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;customer&gt;</code> of the type customer-type, which itself is defined as a
<code>complexType</code>.</p>
</li>
<li>
<p>Sequential elements called <code>&lt;first-name&gt;</code> and <code>&lt;last-name&gt;</code>, both of
the type <code>string</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>you can use the <code>@XmlElement</code> annotation to map values for a customer&#8217;s
first and last name to the appropriate XML nodes. To do so:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the object and import <code>jakarta.xml.bind.annotation.*</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Customer</code> class and use the <code>@XmlRootElement</code> annotation
to make it the root element. Set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Define the <code>firstname</code> and <code>lastname</code> properties and annotate them
with the <code>@XmlElement</code> annotation. Use the <code>name=</code> argument to customize
the XML element name (if you do not explicitly set the name with
<code>name=</code>, the XML element will match the Java attribute name; for
example, here the <code>&lt;first-name&gt;</code> element combination would be specified
<code>&lt;firstName&gt; &lt;/firstName&gt;</code> in XML).</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">   @XmlElement(name="first-name")
   private String firstName;

   @XmlElement(name="last-name")
   private String lastName;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The object should look like <a href="#BEIFIJIH">Example 15-15</a>.</p>
</div>
<div id="BEIFIJIH" class="paragraph">
<p><strong><em>Example 15-15 Customer Object Mapping Values to a Simple Sequence</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {
   @XmlElement(name="first-name")
   private String firstName;

   @XmlElement(name="last-name")
   private String lastName;

   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="defining-the-mapping-in-oxm-metadata-format-3"><a class="anchor" href="#defining-the-mapping-in-oxm-metadata-format-3"></a>Defining the Mapping in OXM Metadata Format</h6>
<div class="paragraph">
<p>If you want to represent the mapping in EclipseLink&#8217;s OXM metadata
format, you need to use the XML tags defined in the
<code>eclipselink-oxm.xml</code> file and populate them with the appropriate
values, as shown in <a href="#BEIIHFFE">Example 15-16</a>.</p>
</div>
<div id="BEIIHFFE" class="paragraph">
<p><strong><em>Example 15-16 Mapping Sequential Attributes in OXM Metadata Format</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;java-type name="Customer"&gt;
   &lt;xml-root-element name="customer"/&gt;
   &lt;java-attributes&gt;
      &lt;xml-element java-attribute="firstName" name="first-name"/&gt;
      &lt;xml-element java-attribute="lastName" name="last-name"/&gt;
   &lt;/java-attributes&gt;
&lt;/java-type&gt;
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BEICIFCI"><a class="anchor" href="#BEICIFCI"></a>Mapping a Value to a Text Node in a Sub-element</h5>
<div class="paragraph">
<p>You can map values from a Java object to text nodes that are nested as a
subelement in the XML document by using JAXB annotations or by
representing the mapping in EclipseLink&#8217;s OXM metadata format. For
example, if you want to populate <code>&lt;first-name&gt;</code> and <code>&lt;last-name&gt;</code>
elements, which are sub-elements of a <code>&lt;personal-info&gt;</code> element under a
<code>&lt;customer&gt;</code> root, you could use the following procedures to achieve
these mappings.</p>
</div>
<div class="sect5">
<h6 id="mapping-by-using-jaxb-annotations-3"><a class="anchor" href="#mapping-by-using-jaxb-annotations-3"></a>Mapping by Using JAXB Annotations</h6>
<div class="paragraph">
<p>Assuming the associated schema defines the following elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;customer&gt;</code> of the type customer-type, which itself is defined as a
complexTpe.</p>
</li>
<li>
<p><code>&lt;personal-info&gt;</code></p>
</li>
<li>
<p>Sub-elements of <code>&lt;personal-info&gt;</code> called <code>&lt;first-name&gt;</code> and
<code>&lt;last-name&gt;</code>, both of the type string</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>you can use JAXB annotations to map values for a customer&#8217;s first and
last name to the appropriate XML sub-element nodes. Because this example
goes beyond a simple element name customization and actually introduces
new XML structure, it uses EclipseLink&#8217;s <code>@XmlPath</code> annotation. To
achieve this mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the object and import <code>jakarta.xml.bind.annotation.<strong></code> and
<code>org.eclipse.persistence.oxm.annotations.</strong></code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;
import org.eclipse.persistence.oxm.annotations.*;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Customer</code> class and use the <code>@XmlRootElement</code> annotation
to make it the root element. Set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Define the <code>firstName</code> and <code>lastName</code> properties.</p>
</li>
<li>
<p>Map the <code>firstName</code> and <code>lastName</code> properties to the sub-elements
defined by the XML schema by inserting the <code>@XmlPath</code> annotation on the
line immediately preceding the property declaration. For each
annotation, define the mapping by specifying the appropriate XPath
predicate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">   @XmlPath("personal-info/first-name/text()")
   private String firstName;

   @XmlPath("personal-info/last-name/text()")
   private String lastName;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The object should look like <a href="#BEIBCIDB">Example 15-17</a>.</p>
</div>
<div id="BEIBCIDB" class="paragraph">
<p><strong><em>Example 15-17 Customer Object Mapping Properties to Sub-elements</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;
import org.eclipse.persistence.oxm.annotations.*;

@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {
   @XmlPath("personal-info/first-name/text()")
   private String firstName;

   @XmlPath("personal-info/last-name/text()")
   private String lastName;

   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="defining-the-mapping-in-oxm-metadata-format-4"><a class="anchor" href="#defining-the-mapping-in-oxm-metadata-format-4"></a>Defining the Mapping in OXM Metadata Format</h6>
<div class="paragraph">
<p>If you want to represent the mapping in EclipseLink&#8217;s OXM metadata
format, you need to use the XML tags defined in the
<code>eclipselink-oxm.xml</code> file and populate them with the appropriate
values, as shown in <a href="#BEIEADBI">Example 15-18</a>.</p>
</div>
<div id="BEIEADBI" class="paragraph">
<p><strong><em>Example 15-18 Mapping Attributes as Sub-elements in OXM Metadata
Format</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;java-type name="Customer"&gt;
   &lt;xml-root-element name="customer"/&gt;
   &lt;java-attributes&gt;
      &lt;xml-element java-attribute="firstName" xml-path="personal-info/first-name/text()"/&gt;
      &lt;xml-element java-attribute="lastName" xml-path="personal-info/last-name/text()"/&gt;
   &lt;/java-attributes&gt;
&lt;/java-type&gt;
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="BEIDCEHD"><a class="anchor" href="#BEIDCEHD"></a>Mapping Values to a Text Node by Position</h5>
<div class="paragraph">
<p>When multiple nodes have the same name, map their values from the Java
object by specifying their position in the XML document. Do this by
using mapping the values to the <em>position</em> of the attribute rather than
the attribute&#8217;s name. You can do this either by using JAXB annotations
or by or by representing the mapping in EclipseLink&#8217;s OXM metadata
format. In the following example, XML contains two <code>&lt;name&gt;</code> elements;
the first occurrence of name should represent the Customer&#8217;s first name,
the second name their last name.</p>
</div>
<div class="sect5">
<h6 id="mapping-by-using-jaxb-annotations-4"><a class="anchor" href="#mapping-by-using-jaxb-annotations-4"></a>Mapping by Using JAXB Annotations</h6>
<div class="paragraph">
<p>Assuming an XML schema that defines the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;customer&gt;</code> of the type customer-type, which itself is specified as a
<code>complexType</code></p>
</li>
<li>
<p><code>&lt;name&gt;</code> of the type <code>String</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>this example again uses the JAXB <code>@XmlPath</code> annotation to map a
customer&#8217;s first and last names to the appropriate <code>&lt;name&gt;</code> element. It
also uses the <code>@XmlType(propOrder)</code> annotation to ensure that the
elements are always in the proper positions. To achieve this mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the object and import <code>jakarta.xml.bind.annotation.*</code> and
<code>org.eclipse.persistence.oxm.annotations.XmlPath</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;
import org.eclipse.persistence.oxm.annotations.XmlPath;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Customer</code> class and insert the <code>@XmlType(propOrder)</code>
annotation with the arguments <code>"firstName"</code> followed by <code>"lastName"</code>.
Insert the <code>@XmlRootElement</code> annotation to make <code>Customer</code> the root
element and set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlType(propOrder={"firstName", "lastName"})
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Define the properties <code>firstName</code> and <code>lastName</code> with the type
<code>String</code>.</p>
</li>
<li>
<p>Map the properties <code>firstName</code> and <code>lastName</code> to the appropriate
position in the XML document by inserting the <code>@XmlPath</code> annotation with
the appropriate XPath predicates.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @XmlPath("name[1]/text()")
    private String firstName;

    @XmlPath("name[2]/text()")
    private String lastName;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The predicates, <code>"name[1]/text()"</code> and <code>"name[2]/text()"</code> indicate the
<code>&lt;name&gt;</code> element to which that specific property will be mapped; for
example, <code>"name[1]/text"</code> will map the <code>firstName</code> property to the first
<code>&lt;name&gt;</code> element.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The object should look like <a href="#BEICHICJ">Example 15-19</a>.</p>
</div>
<div id="BEICHICJ" class="paragraph">
<p><strong><em>Example 15-19 Customer Object Mapping Values by Position</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;

@XmlRootElement
@XmlType(propOrder={"firstName", "lastName"})
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {
    @XmlPath("name[1]/text()")
    private String firstName;

    @XmlPath("name[2]/text()")
    private String lastName;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about using XPath predicates, see
<a href="#JPA2XML005">Using XPath Predicates for Mapping</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML004"><a class="anchor" href="#JPA2XML004"></a>Using XML Metadata Representation to Override JAXB Annotations</h3>
<div class="paragraph">
<p>In addition to using Java annotations, EclipseLink provides an XML
mapping configuration file called <code>eclipselink-oxm.xml</code> that you can use
in place of or to override JAXB annotations in the source with an XML
representation of the metadata. In addition to allowing all of the
standard JAXB mapping capabilities it also includes advanced mapping
types and options.</p>
</div>
<div class="paragraph">
<p>An XML metadata representation is useful when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You cannot modify the domain model because, for example, it come from
a third party).</p>
</li>
<li>
<p>You do not want to introduce compile dependencies on JAXB APIs (if you
are using a version of Java that predates Java SE 6).</p>
</li>
<li>
<p>You want to apply multiple JAXB mappings to a domain model (you are
limited to one representation with annotations).</p>
</li>
<li>
<p>Your object model already contains so many annotations from other
technologies that adding more would make the class unreadable.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section demonstrates how to use <code>eclipselink-oxm.xml</code> to override
JAXB annotations</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While using this mapping file enables many advanced features, it might
prevent you from porting it to other JAXB implementations
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="task-1-define-advanced-mappings-in-the-xml"><a class="anchor" href="#task-1-define-advanced-mappings-in-the-xml"></a>Task 1: Define Advanced Mappings in the XML</h4>
<div class="paragraph">
<p>First, update the XML mapping file to expose the
<code>eclipselink_oxm_2_3.xsd</code>. schema. <a href="#BEIDBECD">Example 15-20</a> shows
how to modify the <code>&lt;xml-bindings&gt;</code> element in the mapping file to point
to the correct namespace and leverage the schema. Each Java package can
have one mapping file.</p>
</div>
<div id="BEIDBECD" class="paragraph">
<p><strong><em>Example 15-20 Updating XML Binding Information in the Mapping File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0"?&gt;
&lt;xml-bindings
        xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/oxm"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.eclipse.org/eclipselink/xsds/persistence/oxm  http://www.eclipse.org/eclipselink/xsds/eclipselink_oxm_2_4.xsd"
       version="2.4"&gt;
&lt;/xml-bindings&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="task-2-configure-usage-in-jaxbcontext"><a class="anchor" href="#task-2-configure-usage-in-jaxbcontext"></a>Task 2: Configure Usage in JAXBContext</h4>
<div class="paragraph">
<p>Next, pass the mapping file to <code>JAXBContext</code> in your object:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the externalized metadata by inserting this code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;(1);
properties.put(JAXBContextProperties.OXM_METADATA_SOURCE, "org/example/oxm.xml);
JAXBContext.newInstance("org.example', aClassLoader, properties);</code></pre>
</div>
</div>
</li>
<li>
<p>Create the properties object to pass to the <code>JAXBContext</code>. For this
example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String,Object&gt; properties = new HashMap&lt;String,Object&gt;();
properties.put(JAXBContextFactory.ECLIPSELINK_OXM_XML_KEY, metadata);</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>JAXBContext</code>. For this example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">JAXBContext.newInstance("example.order:example.customer", aClassLoader, properties);</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="task-3-specify-the-moxy-as-the-jaxb-implementation"><a class="anchor" href="#task-3-specify-the-moxy-as-the-jaxb-implementation"></a>Task 3: Specify the MOXy as the JAXB Implementation</h4>
<div class="paragraph">
<p>You must use MOXy as your JAXB implementation. To do so, do the
following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open a <code>jaxb.properties</code> file and add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">jakarta.xml.bind.context.factory=org.eclipse.persistence.jaxb.JAXBContextFactory</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>jaxb.properties</code> file to the package that contains your
domain classes.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML005"><a class="anchor" href="#JPA2XML005"></a>Using XPath Predicates for Mapping</h3>
<div class="paragraph">
<p>This section demonstrates how the EclipseLink MOXy API uses XPath
predicates to define an expression that specifiers the XML element&#8217;s
name. An XPath predicate is an expression that defines a specific
object-to-XML mapping. As shown in previous examples, by default, JAXB
will use the Java field name as the XML element name.</p>
</div>
<div class="paragraph">
<p>This section contains the following subsections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIHJHCJ">Understanding XPath Predicates</a></p>
</li>
<li>
<p><a href="#BEIIBJHE">Mapping Based on Position</a></p>
</li>
<li>
<p><a href="#BEIJIHCI">Mapping Based on an Attribute Value</a></p>
</li>
<li>
<p><a href="#BEIDJHFD">"Self" Mappings</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEIHJHCJ"><a class="anchor" href="#BEIHJHCJ"></a>Understanding XPath Predicates</h4>
<div class="paragraph">
<p>As described above, an XPath predicate is an expression that defines a
specific object-to-XML mapping when standard annotations</p>
</div>
<div class="paragraph">
<p>re not sufficient. For example, the following snippet of XML shows a
<code>&lt;data&gt;</code> element with two <code>&lt;node&gt;</code> sub-elements. If you wanted to create
this mapping in a Java object, you would need to specify an XPath
predicate for each <code>&lt;node&gt;</code> sub-element; for example, <code>Node[2]</code> in the
following Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">   &lt;java-attributes&gt;
      &lt;xml-element java-attribute="node" xml-path="node[1]/ABC"/&gt;
      &lt;xml-element java-attribute="node" xml-path="node[2]/DEF"/&gt;
   &lt;/java-attributes&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>would match the second occurrence of the node element (<code>"DEF"</code>) in the
following XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;data&gt;
   &lt;node&gt;ABC&lt;/node&gt;
   &lt;node&gt;DEF&lt;/node&gt;
&lt;/data&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, by using the XPath predicate, you can use the same attribute name
for a different attribute value.</p>
</div>
</div>
<div class="sect3">
<h4 id="BEIIBJHE"><a class="anchor" href="#BEIIBJHE"></a>Mapping Based on Position</h4>
<div class="paragraph">
<p>This mapping technique is described in
<a href="#BEIDCEHD">Mapping Values to a Text Node by
Position</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="BEIJIHCI"><a class="anchor" href="#BEIJIHCI"></a>Mapping Based on an Attribute Value</h4>
<div class="paragraph">
<p>Beginning with EclipseLink MOXy 2.3, you can also map to an XML element
based on an Attribute value. In this exercise, you will annotate the JPA
entity to render the XML document shown in <a href="#BEIIBGBB">Example
15-21</a>. Note that all of the XML elements are named node but are
differentiated by the value of their name attribute.</p>
</div>
<div id="BEIIBGBB" class="paragraph">
<p><strong><em>Example 15-21</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;node&gt;
   &lt;node name="first-name"&gt;Bob&lt;/node&gt;
   &lt;node name="last-name"&gt;Smith&lt;/node&gt;
   &lt;node name="address"&gt;
      &lt;node name="street"&gt;123 A Street&lt;/node&gt;
   &lt;/node&gt;
   &lt;node name="phone-number" type="work"&gt;555-1111&lt;/node&gt;
   &lt;node name="phone-number" type="cell"&gt;555-2222&lt;/node&gt;
&lt;/node&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To attain this mapping, you need to declare three classes, <code>Name</code>,
<code>Address</code>, and <code>PhoneNumber</code> and then use an XPath in the form of
<em>`element-name`</em>`[@<code><em>`attribute-name`</code>=&#8216;`value`</em>&#8217;]` to map each
Java field.</p>
</div>
<div class="sect4">
<h5 id="BEIEIFGA"><a class="anchor" href="#BEIEIFGA"></a>Task 1: Create the Customer Entity</h5>
<div class="paragraph">
<p>To create the <code>Customer</code> class entity:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the necessary JPA packages by adding the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Customer</code> class and use the <code>@XmlRootElement</code> annotation
to make it the root element. Set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Declare local to the <code>Customer</code> class these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>firstName</code> (String type)</p>
</li>
<li>
<p><code>lastName</code> (String)</p>
</li>
<li>
<p><code>Address</code> (Address)</p>
<div class="paragraph">
<p>For each property, set the Xpath predicate by preceding the property
declaration with the annotation
<code>@XmlPath(`<em>`element-name`</em></code>[@<code><em>`attribute-name`</em></code>=&#8216;<em>`value`&#8217;])<code></em>;
for example, for `firstName</code>, you would set the XPath predicate with
this statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlPath("node[@name='first-name']/text()")</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Also local to the <code>Customer</code> class, declare the <code>phoneNumber</code> property
as a <code>List&lt;PhoneNumber&gt;</code> type and assign it the value
<code>new ArrayList&lt;PhoneNumber&gt;()</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Customer</code> class should look like the snippet in
<a href="#BEIHAHJF">Example 15-22</a>.</p>
</div>
<div id="BEIHAHJF" class="paragraph">
<p><strong><em>Example 15-22 Customer Object Mapping to an Attribute Value</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;

@XmlRootElement(name="node")
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {

    @XmlPath("node[@name='first-name']/text()")
    private String firstName;

    @XmlPath("node[@name='last-name']/text()")
    private String lastName;

    @XmlPath("node[@name='address']")
    private Address address;

    @XmlPath("node[@name='phone-number']")
    private List&lt;PhoneNumber&gt; phoneNumbers = new ArrayList&lt;PhoneNumber&gt;();

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-2-create-the-address-entity"><a class="anchor" href="#task-2-create-the-address-entity"></a>Task 2: Create the Address Entity</h5>
<div class="paragraph">
<p>To create the <code>Address</code> class, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the necessary JPA packages by adding the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>Address</code> class and set the XML accessor type to <code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlAccessorType(XmlAccessType.FIELD)
public class Address {</code></pre>
</div>
</div>
<div class="paragraph">
<p>This instance does not require the <code>@XmlRootElement</code> annotation as in
the previous Tasks because the <code>Address</code> class is root not a root
element in the XML document.</p>
</div>
</li>
<li>
<p>Declare local to the <code>Address</code> class the <code>String</code> property <code>street</code>.
Set the XPath predicate by preceding the property declaration with the
annotation <code>@XmlPath("node[@name='street']/text()")</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>Address</code> class should look like <a href="#BEIHAIHA">Example 15-23</a>.</p>
</div>
<div id="BEIHAIHA" class="paragraph">
<p><strong><em>Example 15-23 Address Object Mapping to an Attribute Value</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;

@XmlAccessorType(XmlAccessType.FIELD)
public class Address {

    @XmlPath("node[@name='street']/text()")
    private String street;

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="task-3-create-the-phonenumber-entity"><a class="anchor" href="#task-3-create-the-phonenumber-entity"></a>Task 3: Create the PhoneNumber Entity</h5>
<div class="paragraph">
<p>To create the <code>PhoneNumber</code> entity:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Import the necessary JPA packages by adding the following code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import jakarta.xml.bind.annotation.*;

import org.eclipse.persistence.oxm.annotations.XmlPath;</code></pre>
</div>
</div>
</li>
<li>
<p>Declare the <code>PhoneNumber</code> class and use the <code>@XmlRootElement</code>
annotation to make it the root element. Set the XML accessor type to
<code>FIELD</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {</code></pre>
</div>
</div>
</li>
<li>
<p>Create the type and string properties and define their mapping as
attributes under the PhoneNumber root element by using the
<code>@XmlAttribute</code>. annotation.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @XmlAttribute
    private String type;

    @XmlValue
    private String number;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>PhoneNumber</code> object should look like <a href="#BEIDDBJA">Example 15-24</a>.</p>
</div>
<div id="BEIDDBJA" class="paragraph">
<p><strong><em>Example 15-24 PhoneNumber Object Mapping to an Attribute Value</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package example;

import jakarta.xml.bind.annotation.*;

@XmlAccessorType(XmlAccessType.FIELD)
public class PhoneNumber {

    @XmlAttribute
    private String type;

    @XmlValue
    private String number;

    ...
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIDJHFD"><a class="anchor" href="#BEIDJHFD"></a>"Self" Mappings</h4>
<div class="paragraph">
<p>A "self" mapping occurs on one-to-one mappings when you set the target
object&#8217;s XPath to "." (dot) so the data from the target object appears
inside the source object&#8217;s XML element. This exercise uses the example
in <a href="#BEIJIHCI">Mapping Based on an Attribute Value</a> to map the
Address information to appear directly under the customer element and
not wrapped in its own element.</p>
</div>
<div class="paragraph">
<p>To create the self mapping:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Repeat Tasks 1 and 2 in <a href="#BEIEIFGA">Task 1: Create the Customer
Entity</a>.</p>
</li>
<li>
<p>Declare local to the <code>Customer</code> class these properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>firstName</code> (String type)</p>
</li>
<li>
<p><code>lastName</code> (String)</p>
</li>
<li>
<p><code>Address</code> (Address)</p>
</li>
</ul>
</div>
</li>
<li>
<p>For the <code>firstName</code> and <code>lastName</code> properties, set the XmlPath
annotation by preceding the property declaration with the annotation
<code>@XmlPath(`<em>`element-name`</em></code>[@<code><em>`attribute-name`</em></code>=&#8216;<em>`value`&#8217;])<code></em>;
for example, for `firstName</code>, you would set the XPath predicate with
this statement:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@XmlPath("node[@name='first-name']/text()")</code></pre>
</div>
</div>
</li>
<li>
<p>For the <code>address</code> property, set <code>@XmlPath</code> to "." (dot):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">    @XmlPath(".")
    private Address address;</code></pre>
</div>
</div>
</li>
<li>
<p>Also local to the <code>Customer</code> class, declare the <code>phoneNumber</code> property
as a <code>List&lt;PhoneNumber&gt;</code> type and assign it the value
<code>new ArrayList&lt;PhoneNumber&gt;()</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The rendered XML for the Customer entity would look like
<a href="#BEICAHDH">Example 15-25</a>.</p>
</div>
<div id="BEICAHDH" class="paragraph">
<p><strong><em>Example 15-25 XML Node with Self-Mapped Address Element</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;node&gt;
   &lt;node name="first-name"&gt;Bob&lt;/node&gt;
   &lt;node name="last-name"&gt;Smith&lt;/node&gt;
   &lt;node name="street"&gt;123 A Street&lt;/node&gt;
   &lt;node name="phone-number" type="work"&gt;555-1111&lt;/node&gt;
   &lt;node name="phone-number" type="cell"&gt;555-2222&lt;/node&gt;
&lt;/node&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML006"><a class="anchor" href="#JPA2XML006"></a>Using Dynamic JAXB/MOXy</h3>
<div class="paragraph">
<p>Dynamic JAXB/MOXy allows you to bootstrap a <code>JAXBContext</code> from a variety
of metadata sources and use familiar JAXB APIs to marshal and unmarshal
data, without requiring compiled domain classes. This is an enhancement
over static JAXB, because now you can update the metadata without having
to update and recompile the previously-generated Java source code.</p>
</div>
<div class="paragraph">
<p>The benefits of using dynamic JAXB/MOXy entities are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Instead of using actual Java classes (for example, <code>Customer.class</code>,
<code>Address.class</code>, and so on), the domain objects are subclasses of the
<code>DynamicEntity</code>.</p>
</li>
<li>
<p>Dynamic entities offer a simple
<code>get(propertyName)</code>/<code>set(propertyName propertyValue)</code> API to manipulate
their data.</p>
</li>
<li>
<p>Dynamic entities have an associated <code>DynamicType</code>, which is generated
in-memory, when the metadata is parsed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following Tasks demonstrate how to use dynamic JAXB:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BEIFDBCA">Task 1: Bootstrap a Dynamic JAXBContext from an XML Schema</a></p>
</li>
<li>
<p><a href="#BEIDHGHI">Task 2: Create Dynamic Entities and Marshal Them to XML</a></p>
</li>
<li>
<p><a href="#BEIGCBBH">Task 3: Unmarshal the Dynamic Entities from XML</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BEIFDBCA"><a class="anchor" href="#BEIFDBCA"></a>Task 1: Bootstrap a Dynamic JAXBContext from an XML Schema</h4>
<div class="paragraph">
<p>This example demonstrates how to bootstrap a dynamic <code>JAXBContext</code> from
an XML Schema.</p>
</div>
<div class="sect4">
<h5 id="bootstrapping-from-an-xml-schema"><a class="anchor" href="#bootstrapping-from-an-xml-schema"></a>Bootstrapping from an XML Schema</h5>
<div class="paragraph">
<p>Use the <code>DynamicJAXBContextFactory</code> to create a dynamic <code>JAXBContext</code>.
<a href="#BEIJDEFA">Example 15-26</a> to bootstrap a <code>DynamicJAXBContext</code> from
the <code>customer.xsd</code> schema (<a href="#BEIBCJFF">Example 15-27</a>) by using
<code>createContextFromXSD()</code>.</p>
</div>
<div id="BEIJDEFA" class="paragraph">
<p><strong><em>Example 15-26 Specifying the Input Stream and Creating the
DynamicJAXBContext</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import java.io.FileInputStream;

import org.eclipse.persistence.jaxb.dynamic.DynamicJAXBContext;
import org.eclipse.persistence.jaxb.dynamic.DynamicJAXBContextFactory;

public class Demo {

    public static void main(String[] args) throws Exception {
        FileInputStream xsdInputStream = new FileInputStream("src/example/customer.xsd");
        DynamicJAXBContext jaxbContext =
            DynamicJAXBContextFactory.createContextFromXSD(xsdInputStream, null, null, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first parameter represents the XML schema itself and must be in one
of the following forms: <code>java.io.InputStream</code>, <code>org.w3c.dom.Node</code>, or
<code>javax.xml.transform.Source</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-xml-schema"><a class="anchor" href="#the-xml-schema"></a>The XML Schema</h5>
<div class="paragraph">
<p><a href="#BEIBCJFF">Example 15-27</a> shows the <code>customer.xsd</code> schema that
represents the metadata for the dynamic JAXBContext you are
bootstrapping.</p>
</div>
<div id="BEIBCJFF" class="paragraph">
<p><strong><em>Example 15-27 Sample XML Schema Document</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xsd:schema
   xmlns:xsd="http://www.w3.org/2001/XMLSchema"
   xmlns="http://www.example.org"
   targetNamespace="http://www.example.org"
   elementFormDefault="qualified"&gt;

   &lt;xsd:complexType name="address"&gt;
      &lt;xsd:sequence&gt;
         &lt;xsd:element name="street" type="xsd:string" minOccurs="0"/&gt;
         &lt;xsd:element name="city" type="xsd:string" minOccurs="0"/&gt;
      &lt;/xsd:sequence&gt;
   &lt;/xsd:complexType&gt;

   &lt;xsd:element name="customer"&gt;
      &lt;xsd:complexType&gt;
         &lt;xsd:sequence&gt;
            &lt;xsd:element name="name" type="xsd:string" minOccurs="0"/&gt;
            &lt;xsd:element name="address" type="address" minOccurs="0"/&gt;
         &lt;/xsd:sequence&gt;
      &lt;/xsd:complexType&gt;
   &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="handling-schema-importincludes"><a class="anchor" href="#handling-schema-importincludes"></a>Handling Schema Import/Includes</h5>
<div class="paragraph">
<p>To bootstrap <code>DynamicJAXBContext</code> from an XML schema that contains
imports of other schemas, you need to configure an
<code>org.xml.sax.EntityResolver</code> to resolve the locations of the imported
schemas and pass the <code>EntityResolver</code> to <code>DynamicJAXBContextFactory</code>.</p>
</div>
<div class="paragraph">
<p>The following example shows two schema documents, <code>customer.xsd</code>
(<a href="#BEIJBFAG">Example 15-28</a>) and <code>address.xsd</code> <a href="#BEIDIAJB">Example
15-29</a>). You can see that <code>customer.xsd</code> imports <code>address.xsd</code> by using
the statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;xsd:import namespace="http://www.example.org/address" schemaLocation="address.xsd"/&gt;</code></pre>
</div>
</div>
<div id="BEIJBFAG" class="paragraph">
<p><strong><em>Example 15-28 customer.xsd</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   xmlns:xsd="http://www.w3.org/2001/XMLSchema"
   xmlns:add="http://www.example.org/address"
   xmlns="http://www.example.org/customer"
   targetNamespace="http://www.example.org/customer"
   elementFormDefault="qualified"&gt;

   &lt;xsd:import namespace="http://www.example.org/address" schemaLocation="address.xsd"/&gt;

   &lt;xsd:element name="customer"&gt;
      &lt;xsd:complexType&gt;
         &lt;xsd:sequence&gt;
            &lt;xsd:element name="name" type="xsd:string" minOccurs="0"/&gt;
            &lt;xsd:element name="address" type="add:address" minOccurs="0"/&gt;
         &lt;/xsd:sequence&gt;
      &lt;/xsd:complexType&gt;
   &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;</code></pre>
</div>
</div>
<div id="BEIDIAJB" class="paragraph">
<p><strong><em>Example 15-29 address.xsd</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://www.example.org/address"
    targetNamespace="http://www.example.org/address"
    elementFormDefault="qualified"&gt;

    &lt;xsd:complexType name="address"&gt;
        &lt;xs:sequence&gt;
            &lt;xs:element name="street" type="xs:string"/&gt;
            &lt;xs:element name="city" type="xs:string"/&gt;
        &lt;/xs:sequence&gt;
    &lt;/xsd:complexType&gt;

&lt;/xsd:schema&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="implementing-and-passing-an-entityresolver"><a class="anchor" href="#implementing-and-passing-an-entityresolver"></a>Implementing and Passing an EntityResolver</h5>
<div class="paragraph">
<p>If you want to bootstrap <code>DynamicJAXBContext</code> from the <code>customer.xsd</code>
schema, you need to pass an entity resolver. Do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To resolve the locations of the imported schemas, you need to
implement an <code>entityResolver</code> by supplying the code shown in
<a href="#BEIBCJAB">Example 15-30</a>.</p>
<div id="BEIBCJAB" class="paragraph">
<p><strong><em>Example 15-30 Implementing an EntityResolver</em></strong></p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">class MyEntityResolver implements EntityResolver {

    public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException {
      // Imported schemas are located in ext\appdata\xsd\

       // Grab only the filename part from the full path
      String filename = new File(systemId).getName();

      // Now prepend the correct path
      String correctedId = "ext/appdata/xsd/" + filename;

      InputSource is = new InputSource(ClassLoader.getSystemResourceAsStream(correctedId));
      is.setSystemId(correctedId);

      return is;
   }

}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>After you implement your <code>DynamicJAXBContext</code>, pass the
<code>EntityResolver</code>, as shown in <a href="#BEIHGJAA">Example 15-31</a>.</p>
<div id="BEIHGJAA" class="paragraph">
<p><strong><em>Example 15-31 Passing in the Entityresolver</em></strong></p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">FileInputStream xsdInputStream = new FileInputStream("src/example/customer.xsd");
DynamicJAXBContext jaxbContext =
    DynamicJAXBContextFactory.createContextFromXSD(xsdInputStream, new MyEntityResolver(), null, null);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="error-handling"><a class="anchor" href="#error-handling"></a>Error Handling</h5>
<div class="paragraph">
<p>You might see the following exception when importing another schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Internal Exception: org.xml.sax.SAXParseException: schema_reference.4: Failed to read schemadocument '&lt;imported-schema-name&gt;', because 1) could not find the document; 2) the document couldnot be read; 3) the root element of the document is not &lt;xsd:schema&gt;.</code></pre>
</div>
</div>
<div class="paragraph">
<p>To work around this exception, disable XJC&#8217;s schema correctness check by
setting the <code>noCorrectnessCheck</code> Java property. You can set this
property one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From within the code, by adding this line:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">System.setProperty("com.sun.tools.xjc.api.impl.s2j.SchemaCompilerImpl.noCorrectnessCheck", "true")</code></pre>
</div>
</div>
</li>
<li>
<p>From the command line, by using this command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">-Dcom.sun.tools.xjc.api.impl.s2j.SchemaCompilerImpl.noCorrectnessCheck=true</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="specifying-a-classloader"><a class="anchor" href="#specifying-a-classloader"></a>Specifying a ClassLoader</h5>
<div class="paragraph">
<p>Use your application&#8217;s current class loader as the <code>classLoader</code>
parameter. This parameter verifies that specified classes exist before
new <code>DynamicTypes</code> are generated. In most cases you can pass <code>null</code> for
this parameter and use <code>Thread.currentThread().getContextClassLoader()</code>
instead.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIDHGHI"><a class="anchor" href="#BEIDHGHI"></a>Task 2: Create Dynamic Entities and Marshal Them to XML</h4>
<div class="paragraph">
<p>This example shows how to create dynamic entities and marshal then to
XML.</p>
</div>
<div class="sect4">
<h5 id="creating-the-dynamic-entities"><a class="anchor" href="#creating-the-dynamic-entities"></a>Creating the Dynamic Entities</h5>
<div class="paragraph">
<p>Use the <code>DynamicJAXBContext</code> to create instances of <code>DynamicEntity</code>. The
entity and property names correspond to the class and property names—in
this case, the <code>customer</code> and <code>address</code>—that would have been generated
if you had used static JAXB.</p>
</div>
<div id="SOLEX1532" class="paragraph">
<p><strong><em>Example 15-32 Creating the Dynamic Entity</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">DynamicEntity customer = jaxbContext.newDynamicEntity("org.example.Customer");
customer.set("name", "Jane Doe");

DynamicEntity address = jaxbContext.newDynamicEntity("org.example.Address");
address.set("street", "1 Any Street").set("city", "Any Town");
customer.set("address", address);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="marshalling-the-dynamic-entities-to-xml"><a class="anchor" href="#marshalling-the-dynamic-entities-to-xml"></a>Marshalling the Dynamic Entities to XML</h5>
<div class="paragraph">
<p>The marshaller obtained from the <code>DynamicJAXBContext</code> is a standard
marshaller and can be used normally to marshal instances of
DynamicEntity.</p>
</div>
<div id="SOLEX1533" class="paragraph">
<p><strong><em>Example 15-33 Standard Dynamic JAXB Marshaller</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Marshaller marshaller = jaxbContext.createMarshaller();
marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);marshaller.marshal(customer, System.out);</code></pre>
</div>
</div>
<div id="BEIDBCBF" class="paragraph">
<p><strong><em>Example 15-34 Updated XML Document Showing &lt;address&gt; Element and Its
Attributes</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;customer xmlns="www.example.org"&gt;
   &lt;name&gt;Jane Doe&lt;/name&gt;
   &lt;address&gt;
      &lt;street&gt;1 Any Street&lt;/street&gt;
      &lt;city&gt;Any Town&lt;/city&gt;
   &lt;/address&gt;
&lt;/customer&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BEIGCBBH"><a class="anchor" href="#BEIGCBBH"></a>Task 3: Unmarshal the Dynamic Entities from XML</h4>
<div class="paragraph">
<p>In this example shows how to unmarshal from XML the dynamic entities you
created in <a href="#BEIDHGHI">Task 2: Create Dynamic Entities and Marshal
Them to XML</a>. The XML in reference is shown in <a href="#BEIDBCBF">Example
15-34</a>.</p>
</div>
<div class="sect4">
<h5 id="unmarshal-dynamicentities-from-xml"><a class="anchor" href="#unmarshal-dynamicentities-from-xml"></a>Unmarshal DynamicEntities from XML</h5>
<div class="paragraph">
<p>The Unmarshaller obtained from the <code>DynamicJAXBContext</code> is a standard
unmarshaller, and can be used normally to unmarshal instances of
<code>DynamicEntity</code>.</p>
</div>
<div id="SOLEX1535" class="paragraph">
<p><strong><em>Example 15-35 Standard Dynamic JAXB Unmarshaller</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">FileInputStream xmlInputStream = new FileInputStream("src/example/dynamic/customer.xml");
Unmarshaller unmarshaller = jaxbContext.createUnmarshaller();
DynamicEntity customer = (DynamicEntity) unmarshaller.unmarshal(xmlInputStream);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="get-data-from-the-dynamic-entity"><a class="anchor" href="#get-data-from-the-dynamic-entity"></a>Get Data from the Dynamic Entity</h5>
<div class="paragraph">
<p>Next, specify which data in the dynamic entity to obtain. Specify this
value by using <code>System.out.println()</code> and passing in the entity name.
<code>DynamicEntity</code> offers property-based data access; for example,
<code>get("name")</code> instead of <code>getName()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">System.out.println(customer.&lt;String&gt;get("name"));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="use-dynamictype-to-introspect-dynamic-entity"><a class="anchor" href="#use-dynamictype-to-introspect-dynamic-entity"></a>Use DynamicType to Introspect Dynamic Entity</h5>
<div class="paragraph">
<p>Instances of <code>DynamicEntity</code> have a corresponding <code>DynamicType</code>, which
you can use to introspect the <code>DynamicEntity</code>, as shown in
<a href="#BEIDDBCC">Example 15-36</a>.</p>
</div>
<div id="BEIDDBCC" class="paragraph">
<p><strong><em>Example 15-36</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">DynamicType addressType = jaxbContext.getDynamicType("org.example.Address");

DynamicEntity address = customer.&lt;DynamicEntity&gt;get("address");
for(String propertyName: addressType.getPropertiesNames()) {
    System.out.println(address.get(propertyName));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JPA2XML007"><a class="anchor" href="#JPA2XML007"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Developing JAXB Applications Using EclipseLink MOXy</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="JSON"><a class="anchor" href="#JSON"></a>16. Converting Objects to and from JSON Documents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how EclipseLink MOXy supports the ability to
convert objects to and from JSON (JavaScript Object Notation). This
feature is useful when creating RESTful services; JAX-RS services can
accept both XML and JSON messages.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#JSON001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#JSON002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#JSON003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users need to convert objects to and from JSON documents.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink provides JSON support through the EclipseLink MOXy
implementation.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>JSON documents.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink samples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MOXy" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MOXy</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MOXy/JSON_Metadata" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MOXy/JSON_Metadata</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/MOXy/MOXy_JSON_Provider" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/MOXy/MOXy_JSON_Provider</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="JSON001"><a class="anchor" href="#JSON001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink supports all MOXy object-to-XML options when reading and
writing JSON, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink&#8217;s advanced and extended mapping features (in addition to
the JAXB specification)</p>
</li>
<li>
<p>Storing mappings in external bindings files</p>
</li>
<li>
<p>Creating dynamic models with Dynamic JAXB</p>
</li>
<li>
<p>Building extensible models that support multitenant applications</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="JSON002"><a class="anchor" href="#JSON002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section contains the following tasks for converting objects to and
from JSON documents.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDHHDEH">Task 1: Marshalling and Unmarshalling JSON Documents</a></p>
</li>
<li>
<p><a href="#CHDCBAIG">Task 2: Specifying JSON Bindings</a></p>
</li>
<li>
<p><a href="#CHDDIFFD">Task 3: Specifying JSON Data Types</a></p>
</li>
<li>
<p><a href="#CHDBFEDC">Task 4: Supporting Attributes</a></p>
</li>
<li>
<p><a href="#CHDJEHFB">Task 5: Supporting no Root Element</a></p>
</li>
<li>
<p><a href="#CHDJIGDDA">Task 6: Using Namespaces</a></p>
</li>
<li>
<p><a href="#CHDJIGDD">Task 7: Using Collections</a></p>
</li>
<li>
<p><a href="#CHDHHFIB">Task 8: Mapping Root-Level Collections</a></p>
</li>
<li>
<p><a href="#CHDIHBIF">Task 9: Wrapping Text Values</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDHHDEH"><a class="anchor" href="#CHDHHDEH"></a>Task 1: Marshalling and Unmarshalling JSON Documents</h4>
<div class="paragraph">
<p>Use the <strong>eclipselink.media-type</strong> property on your JAXB Marshaller or
Unmarsaller to produce and use JSON documents with your application, as
shown in <a href="#CHDEDEFA">Example 16-1</a>.</p>
</div>
<div id="CHDEDEFA" class="paragraph">
<p><strong><em>Example 16-1 Marshalling and Unmarshalling</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...

Marshaller m = jaxbContext.createMarshaller();
m.setProperty("eclipselink.media-type", "application/json");

Unmarshaller u = jaxbContext.createUnmarshaller();
u.setProperty("eclipselink.media-type", "application/json");

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the <code>eclipselink.media-type</code> property in the <code>Map</code>
of the properties used when you create the <code>JAXBContext</code>, as shown in
<a href="#CHDCEFJJ">Example 16-2</a>.</p>
</div>
<div id="CHDCEFJJ" class="paragraph">
<p><strong><em>Example 16-2 Using a Map</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.eclipse.persistence.jaxb.JAXBContextProperties;
import org.eclipse.persistence.oxm.MediaType;

Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put("eclipselink.media-type", "application/json");

JAXBContext ctx = JAXBContext.newInstance(new Class[] { Employee.class }, properties);
Marshaller jsonMarshaller = ctx.createMarshaller();
Unmarshaller jsonUnmarshaller = ctx.createUnmarshaller();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When specified in a Map, the Marshallers and Unmarshallers created from
the <code>JAXBContent</code> will automatically use the specified media type.</p>
</div>
<div class="paragraph">
<p>You can also configure your application to use JSON documents by using
the <code>MarshallerProperties</code>, <code>UnmarshallerProperties</code>, and <code>MediaType</code>
constants, as shown in <a href="#CHDFHBDA">Example 16-3</a>.</p>
</div>
<div id="CHDFHBDA" class="paragraph">
<p><strong><em>Example 16-3 Using MarshallerProperties and UnarshallerProperties</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.eclipse.persistence.jaxb.MarshallerProperties;
import org.eclipse.persistence.jaxb.UnarshallerProperties;
import org.eclipse.persistence.oxm.MediaType;

m.setProperty(MarshallerProperties.MEDIA_TYPE, MediaType.APPLICATION_JSON);
u.setProperty(UnmarshallerProperties.MEDIA_TYPE, MediaType.APPLICATION_JSON);
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDCBAIG"><a class="anchor" href="#CHDCBAIG"></a>Task 2: Specifying JSON Bindings</h4>
<div class="paragraph">
<p><a href="#CHDJCEEE">Example 16-4</a> shows a basic JSON binding that does not
require compile time dependencies in addition to those required for
normal JAXB usage. This example shows how to unmarshal JSON from a
<code>StreamSource</code> into the user object <code>SearchResults</code>, add a new <code>Result</code>
to the collection, and then marshal the new collection to <code>System.out</code>.</p>
</div>
<div id="CHDJCEEE" class="paragraph">
<p><strong><em>Example 16-4 Using Basic JSON Binding</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">package org.example;

import org.example.model.Result;
import org.example.model.SearchResults;

import java.util.Date;

import jakarta.xml.bind.JAXBContext;
import jakarta.xml.bind.JAXBElement;
import jakarta.xml.bind.Marshaller;
import jakarta.xml.bind.Unmarshaller;
import javax.xml.transform.stream.StreamSource;

public class Demo {

    public static void main(String[] args) throws Exception {
        JAXBContext jc = JAXBContext.newInstance(SearchResults.class);

        Unmarshaller unmarshaller = jc.createUnmarshaller();
        unmarshaller.setProperty("eclipselink.media-type", "application/json");
        StreamSource source = new StreamSource("http://search.twitter.com/search.json?q=jaxb");
        JAXBElement&lt;SearchResults&gt; jaxbElement = unmarshaller.unmarshal(source, SearchResults.class);

        Result result = new Result();
        result.setCreatedAt(new Date());
        result.setFromUser("bsmith");
        result.setText("You can now use EclipseLink JAXB (MOXy) with JSON :)");
        jaxbElement.getValue().getResults().add(result);

        Marshaller marshaller = jc.createMarshaller();
        marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, true);
        marshaller.setProperty("eclipselink.media-type", "application/json");
        marshaller.marshal(jaxbElement, System.out);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also write MOXy External Bindings files as JSON documents.
<a href="#CHDEFJCC">Example 16-5</a> shows how to use <code>bindings.json</code> to map
<strong>Customer</strong> and <strong>PhoneNumber</strong> classes to JSON.</p>
</div>
<div id="CHDEFJCC" class="paragraph">
<p><strong><em>Example 16-5 Using External Bindings</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "package-name" : "org.example",
   "xml-schema" : {
      "element-form-default" : "QUALIFIED",
      "namespace" : "http://www.example.com/customer"
   },
   "java-types" : {
      "java-type" : [ {
         "name" : "Customer",
         "xml-type" : {
            "prop-order" : "firstName lastName address phoneNumbers"
         },
         "xml-root-element" : {},
         "java-attributes" : {
            "xml-element" : [
                {"java-attribute" : "firstName","name" : "first-name"},
                {"java-attribute" : "lastName", "name" : "last-name"},
                {"java-attribute" : "phoneNumbers","name" : "phone-number"}
            ]
         }
      }, {
         "name" : "PhoneNumber",
         "java-attributes" : {
            "xml-attribute" : [
                {"java-attribute" : "type"}
            ],
            "xml-value" : [
                {"java-attribute" : "number"}
            ]
         }
      } ]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CHDDAECA">Example 16-6</a> shows how to use the JSON file (created in
<a href="#CHDEFJCC">Example 16-5</a>) when bootstrapping a <code>JAXBContext</code>.</p>
</div>
<div id="CHDDAECA" class="paragraph">
<p><strong><em>Example 16-6 Using JSON to Bootstrap a JAXBContext</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;(2);
properties.put("eclipselink.oxm.metadata-source", "org/example/binding.json");
properties.put("eclipselink.media-type", "application/json");
JAXBContext context = JAXBContext.newInstance("org.example", Customer.class.getClassLoader() , properties);

Unmarshaller unmarshaller = context.createUnmarshaller();
StreamSource json = new StreamSource(new File("src/org/example/input.json"));
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDDIFFD"><a class="anchor" href="#CHDDIFFD"></a>Task 3: Specifying JSON Data Types</h4>
<div class="paragraph">
<p>Although XML has a single datatype, JSON differentiates between strings,
numbers, and booleans. EclipseLink supports these datatypes
automatically, as shown in <a href="#BABEFCED">Example 16-7</a></p>
</div>
<div id="BABEFCED" class="paragraph">
<p><strong><em>Example 16-7 Using JSON Data Types</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class Address {

   private int id;
   private String city;
   private boolean isMailingAddress;

}

{
   "id" : 1,
   "city" : "Ottawa",
   "isMailingAddress" : true
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDBFEDC"><a class="anchor" href="#CHDBFEDC"></a>Task 4: Supporting Attributes</h4>
<div class="paragraph">
<p>JSON does not use attributes; anything mapped with a <code>@XmlAttribute</code>
annotation will be marshalled as an element. By default, EclipseLink
triggers <em>both</em> the attribute and element events, thereby allowing
either the mapped attribute or element to handle the value.</p>
</div>
<div class="paragraph">
<p>You can override this behavior by using the <code>JSON_ATTRIBUTE_PREFIX</code>
property to specify an attribute prefix, as shown in
<a href="#CHDICAHE">Example 16-8</a>. EclipseLink prepends the prefix to the
attribute name during marshal and will recognize it during unmarshal.</p>
</div>
<div class="paragraph">
<p>In the example below the <code>number</code> field is mapped as an attribute with
the prefix <strong>@</strong>.</p>
</div>
<div id="CHDICAHE" class="paragraph">
<p><strong><em>Example 16-8 Using a Prefix</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">jsonUnmarshaller.setProperty(UnmarshallerProperties.JSON_ATTRIBUTE_PREFIX, "@");
jsonMarshaller.setProperty(MarshallerProperties.JSON_ATTRIBUTE_PREFIX, "@") ;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "phone" : {
      "area-code" : "613",
      "@number" : "1234567"
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the <code>JSON_ATTRIBUTE_PREFIX</code> property in the Map used
when creating the <code>JAXBContext</code>, as shown in <a href="#CHDIIHGC">Example
16-9</a>. All marshallers and unmarshalers created from the context will
use the specified prefix.</p>
</div>
<div id="CHDIIHGC" class="paragraph">
<p><strong><em>Example 16-9 Setting a Prefix in a Map</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put(JAXBContextProperties.JSON_ATTRIBUTE_PREFIX, "@");

JAXBContext ctx = JAXBContext.newInstance(new Class[] { Phone.class }, properties);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDJEHFB"><a class="anchor" href="#CHDJEHFB"></a>Task 5: Supporting no Root Element</h4>
<div class="paragraph">
<p>EclipseLink supports JSON documents without a root element. By default,
if no <code>@XmlRootElement</code> annotation exists, the marshalled JSON document
will not have a root element. You can override this behavior (that is
omit the root element from the JSON output, even if the
<code>@XmlRootElement</code> <em>is</em> specified) by setting the <code>JSON_INCLUDE_ROOT</code>
property when marshalling a document, as shown in <a href="#CHDEAEJA">Example
16-10</a>.</p>
</div>
<div id="CHDEAEJA" class="paragraph">
<p><strong><em>Example 16-10 Marshalling no Root Element Documents</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">marshaller.setProperty(MarshallerProperties.JSON_INCLUDE_ROOT, false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When unmarshaling a document with no root elements, you should specify
the class to which to unmarshal, as shown in <a href="#CHDJAJBJ">Example
16-11</a>.</p>
</div>
<div id="CHDJAJBJ" class="paragraph">
<p><strong><em>Example 16-11 Unmarshalling no Root Element Documents</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">unmarshaller.setProperty(UnmarshallerProperties.JSON_INCLUDE_ROOT, false);
JAXBElement&lt;SearchResults&gt; jaxbElement = unmarshaller.unmarshal(source, SearchResults.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the document has no root element, you must specify the class to
unmarshal to.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="CHDJIGDDA"><a class="anchor" href="#CHDJIGDDA"></a>Task 6 Using Namespaces</h4>
<div class="paragraph">
<p>Because JSON does not use namespces, by default all namespaces and
prefixes are ignored when marshaling and unmarshaling. In some cases,
this may be an issue if you have multiple mappings with the same local
name – there will be no way to distinguish between the mappings.</p>
</div>
<div class="paragraph">
<p>With EclipseLink, you can supply a Map of namespace-to-prefix (or an
instance of <code>NamespacePrefixMapper</code>) to the Marshaller and Unmarshaller.
The namespace prefix will appear in the marshalled document prepended to
the element name. EclipseLink will recognize the prefix during an
unmarshal operation and the resulting Java objects will be placed in the
proper namespaces.</p>
</div>
<div class="paragraph">
<p><a href="#CHDCEBBJ">Example 16-12</a> shows how to use the
<code>NAMESPACE_PREFIX_MAPPER</code> property.</p>
</div>
<div id="CHDCEBBJ" class="paragraph">
<p><strong><em>Example 16-12 Using Namesapces</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String, String&gt; namespaces = new HashMap&lt;String, String&gt;();
namespaces.put("namespace1", "ns1");
namespaces.put("namespace2", "ns2");
jsonMarshaller.setProperty(MarshallerProperties.NAMESPACE_PREFIX_MAPPER, namespaces);
jsonUnmarshaller.setProperty(UnmarshallerProperties.JSON_NAMESPACE_PREFIX_MAPPER, namespaces);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>MarshallerProperties.NAMESPACE_PREFIX_MAPPER</code> applies to <em>both</em> XML
and JSON; <code>UnmarshallerProperties.JSON_NAMESPACE_PREFIX_MAPPER</code> is a
<em>JSON-only</em> property. XML unmarshalling can obtain the namespace
information directly from the document.</p>
</div>
<div class="paragraph">
<p>When JSON is marshalled, the namespaces will be given the prefix from
the Map separated by a dot ( <strong>.</strong> ):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "ns1.employee : {
      "ns2.id" : 123
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The dot separator can be set to any custom character by using the
<code>JSON_NAMESPACE_SEPARATOR</code> property. Here, a colon ( <strong>:</strong> ) will be used
instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">jsonMarshaller.setProperty(MarshallerProperties.JSON_NAMESPACE_SEPARATOR, ':');
jsonUnmarshaller.setProperty(UnmarshallerProperties.JSON_NAMESPACE_SEPARATOR, ':');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDJIGDD"><a class="anchor" href="#CHDJIGDD"></a>Task 7: Using Collections</h4>
<div class="paragraph">
<p>By default, when marshalling to JSON, EclipseLink marshals empty
collections as <code>[ ]</code>, as shown in <a href="#CHDDJCJA">Example 16-13</a>.</p>
</div>
<div id="CHDDJCJA" class="paragraph">
<p><strong><em>Example 16-13 Marshalling Empty Collections</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "phone" : {
      "myList" : [ ]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <code>JSON_MARSHAL_EMPTY_COLLECTIONS</code> property to override this
behavior (so that empty collections are not marshalled at all).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">jsonMarshaller.setProperty(MarshallerProperties.JSON_MARSHAL_EMPTY_COLLECTIONS, Boolean.FALSE) ;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "phone" : {
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDHHFIB"><a class="anchor" href="#CHDHHFIB"></a>Task 8: Mapping Root-Level Collections</h4>
<div class="paragraph">
<p>If you use the <code>@XmlRootElement(name="root")</code> annotation to specify a
root level, the JSON document can be marshaled as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">marshaller.marshal(myListOfRoots, System.out);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[ {
   "root" : {
      "name" : "aaa"
   }
}, {
   "root" : {
      "name" : "bbb"
   }
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the root element <em>is</em> present in the document, you can unmarsal
it using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">unmarshaller.unmarshal(json);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the class <em>does not</em> have an <code>@XmlRootElement</code> (or if
<code>JSON_INCLUDE_ROOT</code> = false), the marshal would produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[ {
   "name":"aaa"
}, {
   "name":"bbb"
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the root element <em>is not</em> present, you must indicate the class
to unmarshal to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">unmarshaller.unmarshal(json, Root.class);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDIHBIF"><a class="anchor" href="#CHDIHBIF"></a>Task 9: Wrapping Text Values</h4>
<div class="paragraph">
<p>JAXB supports one or more <code>@XmlAttributes</code> on <code>@XmlValue classes</code>, as
shown in <a href="#CHDBHJHF">Example 16-14</a>.</p>
</div>
<div id="CHDBHJHF" class="paragraph">
<p><strong><em>Example 16-14 Using @XmlAttributes</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class Phone {

   @XmlValue
   public String number;

   @XmlAttribute
   public String areaCode;

   public Phone() {
      this("", "");
   }

   public Phone(String num, String code) {
      this.number = num;
      this.areaCode = code;
   }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To produce a valid JSON document, EclipseLink uses a <code>value</code> wrapper, as
shown in <a href="#CHDFFIIH">Example 16-15</a>.</p>
</div>
<div id="CHDFFIIH" class="paragraph">
<p><strong><em>Example 16-15 Using a value Wrapper</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "employee" : {
      "name" : "Bob Smith",
      "mainPhone" : {
         "areaCode" : "613",
         "value" : "555-5555"
      },
      "otherPhones" : [ {
         "areaCode" : "613",
         "value" : "123-1234"
      }, {
         "areaCode" : "613",
         "value" : "345-3456"
      } ]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, EclipseLink uses <strong>value</strong> as the name of the wrapper. Use the
<code>JSON_VALUE_WRAPPER</code> property to customize the name of the value
wrapper, as shown in <a href="#CHDCFBHH">Example 16-16</a>.</p>
</div>
<div id="CHDCFBHH" class="paragraph">
<p><strong><em>Example 16-16 Customizing the Name of the Value Wrapper</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">jsonMarshaller.setProperty(MarshallerProperties.JSON_VALUE_WRAPPER, "$");
jsonUnmarshaller.setProperty(UnmarshallerProperties.JSON_VALUE_WRAPPER, "$");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Would produce:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "employee" : {
      "name" : "Bob Smith",
      "mainPhone" : {
         "areaCode" : "613",
         "$" : "555-5555"
      },
      "otherPhones" : [ {
         "areaCode" : "613",
         "$" : "123-1234"
      }, {
         "areaCode" : "613",
         "$" : "345-3456"
      } ]
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify the <code>JSON_VALUE_WRAPPER</code> property in the <code>Map</code> of
the properties used when you create the <code>JAXBContext</code>, as shown in
<a href="#CHDEDDAA">Example 16-17</a>.</p>
</div>
<div id="CHDEDDAA" class="paragraph">
<p><strong><em>Example 16-17 Using a Map</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map&lt;String, Object&gt; properties = new HashMap&lt;String, Object&gt;();
properties.put(JAXBContextProperties.JSON_VALUE_WRAPPER, "$");

JAXBContext ctx = JAXBContext.newInstance(new Class[] { Employee.class }, properties);
Marshaller jsonMarshaller = ctx.createMarshaller();
Unmarshaller jsonUnmarshaller = ctx.createUnmarshaller();</code></pre>
</div>
</div>
<div class="paragraph">
<p>When specified in a Map, the Marshallers and Unmarshallers created from
the <code>JAXBContent</code> will automatically use the specified value wrapper.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="JSON003"><a class="anchor" href="#JSON003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Developing JAXB Applications Using EclipseLink MOXy</em></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="TESTINGJPA"><a class="anchor" href="#TESTINGJPA"></a>17. Testing JPA Outside a Container</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how, with EclipseLink, you can use the
persistence unit JAR file to test your application outside the container
(for instance, in applications for the Java Platform, Standard Edition
(Java SE platform)).</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#TESTINGJPA001">Understanding JPA Deployment</a></p>
</li>
<li>
<p><a href="#TESTINGJPA002">Configuring the persistence.xml File</a></p>
</li>
<li>
<p><a href="#TESTINGJPA003">Using a Property Map</a></p>
</li>
<li>
<p><a href="#TESTINGJPA004">Using Weaving</a></p>
</li>
<li>
<p><a href="#TESTINGJPA005">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users need to use EclipseLink both inside and outside the container
(such as applications for the Java SE platform).</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>This solution highlights the primary differences when using EclipseLink
outside a container.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>An application server (such as Oracle WebLogic Server, IBM WebSphere,
or Glassfish)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="TESTINGJPA001"><a class="anchor" href="#TESTINGJPA001"></a>Understanding JPA Deployment</h3>
<div class="paragraph">
<p>When deploying outside of a container, use the
<code>createEntityManagerFactory</code> method of the
<code>jakarta.persistence.Persistence</code> class to create an entity manager
factory. This method accepts a <code>Map</code> of properties and the name of the
persistence unit. The properties that you pass to this method are
combined with those specified in the <code>persistence.xml</code> file. They may be
additional properties or they may override the value of a property that
you specified previously in the <code>persistence.xml</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a convenient way to set properties obtained from program input,
such as the command line.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="using-entitymanager"><a class="anchor" href="#using-entitymanager"></a>Using EntityManager</h4>
<div class="paragraph">
<p>The <code>EntityManager</code> is the access point for persisting an entity bean,
loading it from the database. Usually, the Jakarta Persistence API (JPA)
container manages interaction with the data source. However, if you are
using a JTA data source for your JPA persistence unit, you can access
the JDBC connection from the Jakarta EE program container&#8217;s data source.
Because the managed data source is unavailable, you can pass properties
to <code>createEntityManagerFactory</code> to change the transaction type from
<code>JTA</code> to <code>RESOURCE_LOCAL</code> and to define JDBC connection information, as
shown here:</p>
</div>
<div id="sthref138" class="paragraph">
<p><strong><em>Example 17-1 Changing transaction type and defining connection
information</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import static org.eclipse.persistence.jpa.config.PersistenceUnitProperties.*;

...

Map properties = new HashMap();

// Ensure RESOURCE_LOCAL transactions is used.
properties.put(TRANSACTION_TYPE,
  PersistenceUnitTransactionType.RESOURCE_LOCAL.name());

// Configure the internal EclipseLink connection pool
properties.put(JDBC_DRIVER, "oracle.jdbc.OracleDriver");
properties.put(JDBC_URL, "jdbc:oracle:thin:@localhost:1521:ORCL");
properties.put(JDBC_USER, "user-name");
properties.put(JDBC_PASSWORD, "password");
properties.put(JDBC_READ_CONNECTIONS_MIN, "1");
properties.put(JDBC_WRITE_CONNECTIONS_MIN, "1");

// Configure logging. FINE ensures all SQL is shown
properties.put(LOGGING_LEVEL, "FINE");

// Ensure that no server-platform is configured
properties.put(TARGET_SERVER, TargetServer.None);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You also have access to the EclipseLink extensions to the
<code>EntityManager</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="TESTINGJPA002"><a class="anchor" href="#TESTINGJPA002"></a>Configuring the persistence.xml File</h3>
<div class="paragraph">
<p>The <code>persistence.xml</code> file is the deployment descriptor file for
persistence using JPA. It specifies the persistence units and declares
the managed persistence classes, the object/relation mapping, and the
database connection details.</p>
</div>
<div class="sect3">
<h4 id="main-tasks"><a class="anchor" href="#main-tasks"></a>Main Tasks</h4>
<div class="paragraph">
<p>To configure the <code>persistence.xml</code> file, the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDBEAJF">Task 1: Use the persistence.xml File</a></p>
</li>
<li>
<p><a href="#CHDFFBDI">Task 2: Instantiate EntityManagerFactory</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDBEAJF"><a class="anchor" href="#CHDBEAJF"></a>Task 1: Use the persistence.xml File</h5>
<div class="paragraph">
<p><a href="#CHDFFCIE">Example 17-2</a> illustrates a <code>persistence.xml</code> file for a
Java SE platform configuration (that is, outside a container).</p>
</div>
<div id="CHDFFCIE" class="paragraph">
<p><strong><em>Example 17-2 A persistence.xml File Specifying the Java SE Platform
Configuration</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_1_0.xsd" version="1.0"&gt;
    &lt;persistence-unit name="my-app" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
        &lt;properties&gt;
            &lt;property name="jakarta.persistence.jdbc.driver" value="oracle.jdbc.OracleDriver"/&gt;
            &lt;property name="jakarta.persistence.jdbc.url" value="jdbc:oracle:thin:@localhost:1521:orcl"/&gt;
            &lt;property name="jakarta.persistence.jdbc.user" value="scott"/&gt;
            &lt;property name="jakarta.persistence.jdbc.password" value="tiger"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDFFBDI"><a class="anchor" href="#CHDFFBDI"></a>Task 2: Instantiate EntityManagerFactory</h5>
<div class="paragraph">
<p>An <code>EntityManagerFactory</code> provides an efficient way to construct
<code>EntityManager</code> instances for a database. You can instantiate the
<code>EntityManagerFactory</code> for the application (illustrated in
<a href="#CHDFFCIE">Example 17-2</a>) by using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Persistence.createEntityManagerFactory("my-app");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="TESTINGJPA003"><a class="anchor" href="#TESTINGJPA003"></a>Using a Property Map</h3>
<div class="paragraph">
<p>You can use a property map to override the default persistence
properties and use container deployment.</p>
</div>
<div class="sect3">
<h4 id="main-tasks-2"><a class="anchor" href="#main-tasks-2"></a>Main Tasks</h4>
<div class="paragraph">
<p>To use a property map, perform the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDHHIIJ">Task 1: Configure the persistence.xml File</a></p>
</li>
<li>
<p><a href="#CHDCAFIA">Task 2: Configure the Bootstrapping API</a></p>
</li>
<li>
<p><a href="#CHDGCFBH">Task 3: Instantiate the EntityManagerFactory</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDHHIIJ"><a class="anchor" href="#CHDHHIIJ"></a>Task 1: Configure the persistence.xml File</h5>
<div class="paragraph">
<p><a href="#CHDEHGEG">Example 17-3</a> illustrates a <code>persistence.xml</code> file that
uses container deployment.</p>
</div>
<div id="CHDEHGEG" class="paragraph">
<p><strong><em>Example 17-3 A persistence.xml File Specifying the Java SE Platform
Configuration, for use with a Property Map</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_1_0.xsd" version="1.0"&gt;
    &lt;persistence-unit name="employee" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;non-jta-data-source&gt;jdbc/MyDS&lt;/non-jta-data-source&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no data source available when tested outside a container.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="CHDCAFIA"><a class="anchor" href="#CHDCAFIA"></a>Task 2: Configure the Bootstrapping API</h5>
<div class="paragraph">
<p>To test the persistence unit shown in <a href="#CHDEHGEG">Example 17-3</a>
outside the container, you must use the Java SE platform bootstrapping
API. <a href="#CHDDHBCC">Example 17-4</a> contains sample code that illustrates
this bootstrapping.</p>
</div>
<div id="CHDDHBCC" class="paragraph">
<p><strong><em>Example 17-4 Sample Configuration</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import static org.eclipse.persistence.config.PersistenceUnitProperties.*;

...

  Map properties = new HashMap();

  // Ensure RESOURCE_LOCAL transactions is used.
  properties.put(TRANSACTION_TYPE,
    PersistenceUnitTransactionType.RESOURCE_LOCAL.name());

  // Configure the internal connection pool
  properties.put(JDBC_DRIVER, "oracle.jdbc.OracleDriver");
  properties.put(JDBC_URL, "jdbc:oracle:thin:@localhost:1521:ORCL");
  properties.put(JDBC_USER, "scott");
  properties.put(JDBC_PASSWORD, "tiger");

  // Configure logging. FINE ensures all SQL is shown
  properties.put(LOGGING_LEVEL, "FINE");
  properties.put(LOGGING_TIMESTAMP, "false");
  properties.put(LOGGING_THREAD, "false");
  properties.put(LOGGING_SESSION, "false");

  // Ensure that no server-platform is configured
  properties.put(TARGET_SERVER, TargetServer.None);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDGCFBH"><a class="anchor" href="#CHDGCFBH"></a>Task 3: Instantiate the EntityManagerFactory</h5>
<div class="paragraph">
<p>An <code>EntityManagerFactory</code> provides an efficient way to construct
<code>EntityManager</code> instances for a database. You can instantiate the
<code>EntityManagerFactory</code> for the application (illustrated in
<a href="#CHDDHBCC">Example 17-4</a>) by using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Persistence.
createEntityManagerFactory("unitName", "properties");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="TESTINGJPA004"><a class="anchor" href="#TESTINGJPA004"></a>Using Weaving</h3>
<div class="paragraph">
<p>Weaving is a technique of manipulating the byte-code of compiled Java
classes.</p>
</div>
<div class="paragraph">
<p>EclipseLink uses weaving to enhance Plain Old Java Object (POJO) classes
and JPA entities with many features such lazy loading, change tracking,
fetch groups, and internal optimizations.</p>
</div>
<div class="sect3">
<h4 id="how-to-disable-or-enable-weaving-in-a-java-se-environment"><a class="anchor" href="#how-to-disable-or-enable-weaving-in-a-java-se-environment"></a>How to Disable or Enable Weaving in a Java SE Environment</h4>
<div class="paragraph">
<p>In a Java SE environment weaving is not enabled by default. This can
affect LAZY One-To-One, Many-To-One and Basic relationships. It also has
a major effect on performance and disable attribute change tracking.</p>
</div>
<div class="paragraph">
<p>To enable weaving in Java SE, the EclipseLink agent must be used when
starting the Java VM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">java -javaagent:eclipselink.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring could also be used to allow JPA weaving in Java SE. See
<code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/JPASpring" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/JPASpring</a></code> for more
information.</p>
</div>
<div class="paragraph">
<p>Static weaving can also be used, by including the following persistence
property,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.weaving" value="static"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>See "weaving" in <em>Jakarta Persistence API (JPA) Extensions Reference for
EclipseLink</em> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-to-disable-or-enable-weaving-in-a-jakarta-ee-environment"><a class="anchor" href="#how-to-disable-or-enable-weaving-in-a-jakarta-ee-environment"></a>How to Disable or Enable Weaving in a Jakarta EE Environment</h4>
<div class="paragraph">
<p>In a Jakarta EE environment weaving is enabled by default (on any
Jakarta EE 5 or greater fully compliant application server, such as
Weblogic, Webspehere, and Glassfish. JBoss does not allow weaving so you
must use static weaving or Spring).</p>
</div>
<div class="paragraph">
<p>To disable weaving the weaving persistence unit property can be used,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.weaving" value="false"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on weaving see "weaving" in <em>Jakarta Persistence
API (JPA) Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="TESTINGJPA005"><a class="anchor" href="#TESTINGJPA005"></a>Additional Resources</h3>
<div class="paragraph">
<p>For additional information about JPA deployment, see the following
sections of the JPA Specification
(<code><a href="http://jcp.org/en/jsr/detail?id=317" class="bare">http://jcp.org/en/jsr/detail?id=317</a></code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Section 7.2, "Bootstrapping in Java SE Environments"</p>
</li>
<li>
<p>Chapter 7, "Container and Provider Contracts for Deployment and
Bootstrapping"</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="related-javadoc-2"><a class="anchor" href="#related-javadoc-2"></a>Related Javadoc</h4>
<div class="paragraph">
<p>For more information, see the following APIs in <em>Java API Reference for
EclipseLink</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PersistenceUnitProperties</code> class</p>
</li>
<li>
<p><code>EntityManagerFactory</code> interface</p>
</li>
<li>
<p><code>JpaEntityManager</code> interface</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="PERFORMANCE"><a class="anchor" href="#PERFORMANCE"></a>18. Enhancing Performance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes EclipseLink performance features, provided by
EclipseLink, and how to monitor and optimize EclipseLink-enabled
applications.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#PERFORMANCE001">Performance Features</a></p>
</li>
<li>
<p><a href="#PERFORMANCE002">Monitoring and Optimizing EclipseLink-Enabled Applications</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to improve the performance of their EclipseLink-enabled
application.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink provides many configuration options that can improve
performance, such as caching. In addition, there are ways to improve the
performance of specific functions, such as using Join Fetching for
queries.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink samples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Performance" class="bare">http://wiki.eclipse.org/EclipseLink/Performance</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Performance" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Performance</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Monitoring" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Monitoring</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="PERFORMANCE001"><a class="anchor" href="#PERFORMANCE001"></a>Performance Features</h3>
<div class="paragraph">
<p>EclipseLink includes a number of performance features that make it the
industry&#8217;s best performing and most scalable JPA implementation. These
features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDCGIHF">Object Caching</a></p>
</li>
<li>
<p><a href="#CHDJFFEJ">Querying</a></p>
</li>
<li>
<p><a href="#CHDDGGFI">Mapping</a></p>
</li>
<li>
<p><a href="#CHDBIBAI">Transactions</a></p>
</li>
<li>
<p><a href="#CHDHFDEJ">Database</a></p>
</li>
<li>
<p><a href="#BBAFFHDD">Automated Tuning</a></p>
</li>
<li>
<p><a href="#CHDIICEJ">Tools</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDCGIHF"><a class="anchor" href="#CHDCGIHF"></a>Object Caching</h4>
<div class="paragraph">
<p>The EclipseLink cache is an in-memory repository that stores recently
read or written objects based on class and primary key values. The cache
helps improve performance by holding recently read or written objects
and accessing them in-memory to minimize database access.</p>
</div>
<div class="paragraph">
<p>Caching allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set how long the cache lives and the time of day, a process called
cache invalidation.</p>
</li>
<li>
<p>Configure cache types (Weak, Soft, SoftCache, HardCache, Full) on a
per entity basis.</p>
</li>
<li>
<p>Configure cache size on a per entity basis.</p>
</li>
<li>
<p>Coordinate clustered caches.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="caching-annotations"><a class="anchor" href="#caching-annotations"></a>Caching Annotations</h5>
<div class="paragraph">
<p>EclipseLink defines these entity caching annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Cache</code></p>
</li>
<li>
<p><code>@TimeOfDay</code></p>
</li>
<li>
<p><code>@ExistenceChecking</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>EclipseLink also provides a number of persistence unit properties that
you can specify to configure the EclipseLink cache (see "Persistence
Property Extensions Reference" in <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>). These properties might
compliment or provide an alternative to the usage of annotations.</p>
</div>
</div>
<div class="sect4">
<h5 id="using-the-cache-annotation"><a class="anchor" href="#using-the-cache-annotation"></a>Using the @Cache Annotation</h5>
<div class="paragraph">
<p>EclipseLink uses identity maps to cache objects in order to enhance
performance, as well as maintain object identity. You can control the
cache and its behavior by using the <code>@Cache</code> annotation in your entity
classes. <a href="#CHDBDCBC">Example 18-1</a> shows how to implement this
annotation.</p>
</div>
<div id="CHDBDCBC" class="paragraph">
<p><strong><em>Example 18-1 Using the @Cache Annotation</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
 @Table(name="EMPLOYEE")
 @Cache (
     type=CacheType.WEAK,
     isolated=false,
     expiry=600000,
     alwaysRefresh=true,
     disableHits=true,
     coordinationType=INVALIDATE_CHANGED_OBJECTS
     )
 public class Employee implements Serializable {
     ...
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about object caching and using the <code>@Cache</code>
annotation, see "@Cache" in the <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDJFFEJ"><a class="anchor" href="#CHDJFFEJ"></a>Querying</h4>
<div class="paragraph">
<p>The scope of a query, the amount of data returned, and how that data is
returned can all affect the performance of a EclipseLink-enabled
application. EclipseLink query mechanisms enhance query performance by
providing these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDEHHHD">Read-only Queries</a></p>
</li>
<li>
<p><a href="#CHDEGCHH">Join Fetching</a></p>
</li>
<li>
<p><a href="#CHDFHFEB">Batch Reading</a></p>
</li>
<li>
<p><a href="#CHDDJCAC">Fetch Size</a></p>
</li>
<li>
<p><a href="#CHDIEBJE">Pagination</a></p>
</li>
<li>
<p><a href="#CHDBGFAI">Cache Usage</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes how these features improve performance.</p>
</div>
<div class="sect4">
<h5 id="CHDEHHHD"><a class="anchor" href="#CHDEHHHD"></a>Read-only Queries</h5>
<div class="paragraph">
<p>EclipseLink uses the <code>eclipselink.read-only</code> hint, <code>QueryHint</code>
(<code>@QueryHint</code>) to retrieve read-only results back from a query. On
nontransactional read operations, where the requested entity types are
stored in the shared cache, you can request that the shared instance be
returned instead of a detached copy.</p>
</div>
<div class="paragraph">
<p>For more information about read-only queries, see the documentation for
the read-only hint in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CHDEGCHH"><a class="anchor" href="#CHDEGCHH"></a>Join Fetching</h5>
<div class="paragraph">
<p>Join Fetching enhances performance by enabling the joining and reading
of the related objects in the same query as the source object. Enable
Join Fetching by using the <code>@JoinFetch</code> annotation, as shown in
<a href="#CHDBICAF">Example 18-2</a>. This example shows how the <code>@JoinFetch</code>
annotation specifies the <code>Employee</code> field <code>managedEmployees</code>.</p>
</div>
<div id="CHDBICAF" class="paragraph">
<p><strong><em>Example 18-2 Enabling JoinFetching</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
 public class Employee implements Serializable {
     ...
     @OneToMany(cascade=ALL, mappedBy="owner")
     @JoinFetch(value=OUTER)
     public Collection&lt;Employee&gt; getManagedEmployees() {
         return managedEmployees;
     }
     ...
 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on Join Fetching, see "@JoinFetch" in <em>Jakarta
Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CHDFHFEB"><a class="anchor" href="#CHDFHFEB"></a>Batch Reading</h5>
<div class="paragraph">
<p>The <code>eclipselink.batch</code> hint supplies EclipseLink with batching
information so subsequent queries of related objects can be optimized in
batches instead of being retrieved one-by-one or in one large joined
read. Batch reading is more efficient than joining because it avoids
reading duplicate data. Batching is only allowed on queries that have a
single object in their select clause.</p>
</div>
</div>
<div class="sect4">
<h5 id="CHDDJCAC"><a class="anchor" href="#CHDDJCAC"></a>Fetch Size</h5>
<div class="paragraph">
<p>If you have large queries that return a large number of objects you can
improve performance by reducing the number database hits required to
satisfy the selection criteria. To do this, use the The
<code>eclipselink.jdbc.fetch-size</code> hint. This hint specifies the number of
rows that should be fetched from the database when more rows are
required (depending on the JDBC driver support level). Most JDBC drivers
default to a fetch size of 10, so if you are reading 1000 objects,
increasing the fetch size to 256 can significantly reduce the time
required to fetch the query&#8217;s results. The optimal fetch size is not
always obvious. Usually, a fetch size of one half or one quarter of the
total expected result size is optimal. Note that if you are unsure of
the result set size, incorrectly setting a fetch size too large or too
small can decrease performance.</p>
</div>
</div>
<div class="sect4">
<h5 id="CHDIEBJE"><a class="anchor" href="#CHDIEBJE"></a>Pagination</h5>
<div class="paragraph">
<p>Slow paging can result in significant application overhead; however,
EclipseLink includes a variety of solutions for improving paging
results; for example, you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the first and maximum number of rows to retrieve when
executing a query.</p>
</li>
<li>
<p>Perform a query on the database for all of the ID values that match
the criteria and then use these values to retrieve specific sets.</p>
</li>
<li>
<p>Configure EclipseLink to return a <code>ScrollableCursor</code> object from a
query by using query hints. This returns a database cursor on the
query&#8217;s result set and allows the client to scroll through the results
page by page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For details on improving paging performance, see "How to use EclipseLink
Pagination" in the EclipseLink online documentation, at:</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Pagination#How_to_use_EclipseLink_Pagination" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Pagination#How_to_use_EclipseLink_Pagination</a></code></p>
</div>
</div>
<div class="sect4">
<h5 id="CHDBGFAI"><a class="anchor" href="#CHDBGFAI"></a>Cache Usage</h5>
<div class="paragraph">
<p>EclipseLink uses a shared cache mechanism that is scoped to the entire
persistence unit. When operations are completed in a particular
persistence context, the results are merged back into the shared cache
so that other persistence contexts can use them. This happens regardless
of whether the entity manager and persistence context are created in
Java SE or Jakarta EE. Any entity persisted or removed using the entity
manager will always be kept consistent with the cache.</p>
</div>
<div class="paragraph">
<p>You can specify how the query should interact with the EclipseLink cache
by using the <code>eclipselink.cache-usage</code> hint. For more information, see
"cache usage" in t<em>Jakarta Persistence API (JPA) Extensions Reference
for EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDDGGFI"><a class="anchor" href="#CHDDGGFI"></a>Mapping</h4>
<div class="paragraph">
<p>Mapping performance is enhanced by these features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDDJHCG">Read-Only Objects</a></p>
</li>
<li>
<p><a href="#CHDIJAAH">Weaving</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes these features.</p>
</div>
<div class="sect4">
<h5 id="CHDDJHCG"><a class="anchor" href="#CHDDJHCG"></a>Read-Only Objects</h5>
<div class="paragraph">
<p>When you declare a class read-only, clones of that class are neither
created nor merged greatly improving performance. You can declare a
class as read-only within the context of a unit of work by using the
<code>addReadOnlyClass()</code> method.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To configure a read-only class for a single unit of work, specify that
class as the argument to <code>addReadOnlyClass()</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">myUnitofWork.addReadOnlyClass(B.class);</code></pre>
</div>
</div>
</li>
<li>
<p>To configure multiple classes as read-only, add them to a vector and
specify that vector as the argument to <code>addReadOnlyClass()</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">myUnitOfWork.addReadOnlyClasses(myVectorOfClasses);</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about using read-only objects to enhance
performance, see "@ReadOnly" in <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDIJAAH"><a class="anchor" href="#CHDIJAAH"></a>Weaving</h4>
<div class="paragraph">
<p>Weaving is a technique of manipulating the byte-code of compiled Java
classes. The EclipseLink JPA persistence provider uses weaving to
enhance both JPA entities and Plain Old Java Object (POJO) classes for
such things as lazy loading, change tracking, fetch groups, and internal
optimizations.Weaving can be performed either dynamically at runtime,
when entities are loaded, or statically at compile time by
post-processing the entity <code>.class</code> files. By default, EclipseLink uses
dynamic weaving whenever possible. This includes inside an Jakarta EE
5/6 application server and in Java SE when the EclipseLink agent is
configured. Dynamic weaving is recommended as it is easy to configure
and does not require any changes to a project&#8217;s build process</p>
</div>
<div class="paragraph">
<p>For details on how to use weaving to enhance application performance,
see "weaving" in <em>Jakarta Persistence API (JPA) Extensions Reference for
EclipseLink</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDBIBAI"><a class="anchor" href="#CHDBIBAI"></a>Transactions</h4>
<div class="paragraph">
<p>To optimize performance during data transactions, use change tracking,.
Change tracking allows you to tune the way EclipseLink detects changes
that occur during a transaction. You should choose the strategy based on
the usage and data modification patterns of the entity type as different
types may have different access patterns and hence different settings,
and so on.</p>
</div>
<div class="paragraph">
<p>Enable change tracking by using the <code>@ChangeTracking</code> annotation, as
shown in <a href="#CHDJDDFA">Example 18-3</a>.</p>
</div>
<div id="CHDJDDFA" class="paragraph">
<p><strong><em>Example 18-3 Enabling Change Tracking</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@Table(name="EMPLOYEE")
@ChangeTracking(OBJECT) (
public class Employee implements Serializable {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more details on change tracking, see "@ChangeTracking" in <em>Jakarta
Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDHFDEJ"><a class="anchor" href="#CHDHFDEJ"></a>Database</h4>
<div class="paragraph">
<p>Database performance features in EclipseLink include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDJFFHG">Connection Pooling</a></p>
</li>
<li>
<p><a href="#CHDHECDD">Parameterized SQL and Statement Caching</a></p>
</li>
<li>
<p><a href="#CHDHDFAD">Batch Writing</a></p>
</li>
<li>
<p><a href="#BBAJBHBI">Serialized Object Policy</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes these features.</p>
</div>
<div class="sect4">
<h5 id="CHDJFFHG"><a class="anchor" href="#CHDJFFHG"></a>Connection Pooling</h5>
<div class="paragraph">
<p>Establishing a connection to a data source can be time-consuming, so
reusing such connections in a connection pool can improve performance.
EclipseLink uses connection pools to manage and share the connections
used by server and client sessions. This feature reduces the number of
connections required and allows your application to support many
clients.</p>
</div>
<div class="paragraph">
<p>By default, EclipseLink sessions use internal connection pools. These
pools allow you to optimize the creation of read connections for
applications that read data only to display it and only infrequently
modify data. The also allow you to use Workbench to configure the
default (write) and read connection pools and to create additional
connection pools for object identity or any other purpose.</p>
</div>
<div class="paragraph">
<p>In addition to internal connection pools, you can also configure
EclipseLink to use any of these types of connection pools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External connection pools; you must use this type of connection pool
to integrate with external transaction controller (JTA).</p>
</li>
<li>
<p>Default (write) and read connection pools;</p>
</li>
<li>
<p>Sequence connection pools; Use these types of pools when your
application requires table sequencing (that is, non-native sequencing)
and you are using an external transaction controller.
Application-specific connection pools; These are connection pools that
you can create and use for any application purpose, provided you are
using internal EclipseLink connection pools in a session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about using connection pools with EclipseLink, see
the following topics in <em>EclipseLink Concepts</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Understanding Connections"</p>
</li>
<li>
<p>"Understanding Connection Pools"</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="CHDHECDD"><a class="anchor" href="#CHDHECDD"></a>Parameterized SQL and Statement Caching</h5>
<div class="paragraph">
<p>Parameterized SQL can prevent the overall length of an SQL query from
exceeding the statement length limit that your JDBC driver or database
server imposes. Using parameterized SQL along with prepared statement
caching can improve performance by reducing the number of times the
database SQL engine parses and prepares SQL for a frequently called
query</p>
</div>
<div class="paragraph">
<p>By default, EclipseLink enables parameterized SQL but not prepared
statement caching. You should enable statement caching either in
EclipseLink when using an internal connection pool or in the data source
when using an external connection pool and want to specify a statement
cache size appropriate for your application.</p>
</div>
<div class="paragraph">
<p>To enable parameterized SQL, add this line to the <code>persistence.xml</code> file
that is in the same path as your domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.bind-parameters" value="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To disable parameterized SQL, change <code>value=</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>EclipseLink determines binding behavior based on the database platform&#8217;s
support for binding. If the database does not support untyped parameter
markers in specific SQL expressions, EclipseLink will disable parameter
binding for the whole query.</p>
</div>
<div class="paragraph">
<p>To enable EclipseLink to restrict parameter binding decisions per
expression, instead of per query, add this line to the persistence.xml
file that is in the same path as your domain classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.allow-partial-bind-parameters" value="true"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about using parameterized SQL and statement
caching, see "jdbc.bind-parameters" in <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="CHDHDFAD"><a class="anchor" href="#CHDHDFAD"></a>Batch Writing</h5>
<div class="paragraph">
<p>Heterogeneous batch writing is an optimization that allows EclipseLink
to send multiple heterogeneous dynamic SQL statements to the database to
be executed as a single batch. Batch writing is best used for
applications that perform multiples writes in each transaction.</p>
</div>
<div class="paragraph">
<p>To configure batch writing, include the <code>eclipselink.jdbc.batch-writing</code>
and <code>eclipselink.jdbc.batch-writing.size</code> properties in the
<code>persistence.xml</code> file. The following example enables Oracle&#8217;s native
batch writing feature that is available with the Oracle JDBC driver and
configures the batch size to 150 statements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.batch-writing" value="Oracle-JDBC"/&gt;
&lt;property name="eclipselink.jdbc.batch-writing.size" value="150"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Different batch options are supported and custom batch implementations
can also be used. For a detailed reference of the batch writing
properties, see the <code>batch-writing</code> and <code>batch-writing.size</code>
documentation in <em>Jakarta Persistence API (JPA) Extensions Reference for
EclipseLink</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="BBAJBHBI"><a class="anchor" href="#BBAJBHBI"></a>Serialized Object Policy</h5>
<div class="paragraph">
<p>Serialized object policy is an optimization that allows EclipseLink to
write out the whole entity object with its privately owned (and nested
privately owned) entities and element collections into an additional
field in the database. Serialized object policy optimizes fetching from
the database, provides faster database reads, and reduces middle tier
CPU and network access in certain situations.</p>
</div>
<div class="paragraph">
<p>Serialized object policy is best for read-only or read-mostly
applications and should only be used for entities that load all their
dependent entities or element collections. When using serialized object
policy, database write operations (insert and update) are slower and
queries for objects without private-owned data are slower. See
<a href="#BBAHIFAF">"A Simple Serialized Object Policy Example"</a> that
demonstrates when serialized object policy is best used to increase
performance.</p>
</div>
<div class="paragraph">
<p>Consider using serialized object policy only for complex objects with
numerous aggregation as characterized by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multiple database rows mapped to a single Java object</p>
</li>
<li>
<p>When the object is read from the database all these rows are read at
once (no indirection, or all indirection always triggered). There may be
un-triggered indirection for other fields that are not included in the
serialized object policy field</p>
</li>
<li>
<p>If versionning is used, then updating or deleting any mapped row (or
inserting of a new one) should result in incrementing of the object&#8217;s
version</p>
</li>
<li>
<p>Object deletion causes all the rows to be deleted.</p>
</li>
<li>
<p>Irregular structure of the aggregation makes it less possible to use
other common optimizations (such as join fetching and batch reading).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Serialized Object Policy Configuration</strong></p>
</div>
<div class="paragraph">
<p>Serialized object policy is enabled by using the <code>@SerializedObject</code>
annotation on an entity or mapped superclass and passing in an
implementation of the <code>SerializedObjectPolicy</code> interface. You must
provide an implementation of this interface; there is no default
implementation. The annotations also includes a field to define the
column name for the object in the database. The default column name is
<code>SOP</code>.</p>
</div>
<div class="paragraph">
<p><a href="#BBAHGDFA">Example 18-4</a> enables serialized object policy, overrides
the default column name, and sets optimistic locking to <code>cascade</code>, which
can increase performance by keeping the serialized object policy field
in the database up-to-date.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If serialized object policy is set on an entity, then policies with the
same fields are set on all inheriting entities.
</td>
</tr>
</table>
</div>
<div id="BBAHGDFA" class="paragraph">
<p><strong><em>Example 18-4 Enabling Serialized Object Policy Using Annotations</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@SerializedObject(MySerializedObjectPolicy.class)
@OptimisticLocking(cascade = true)
public class Employee implements Serializable {
...

@Entity
@SerializedObject(MySerializedObjectPolicy.class, column = @Column(name="ADDR_SOP"))
@OptimisticLocking(cascade = true)
public class Address implements Serializable {
...</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#BBABHJJI">Example 18-5</a> enables serialized object policy in the
<code>eclipselink-orm.xml</code> file</p>
</div>
<div id="BBABHJJI" class="paragraph">
<p><strong><em>Example 18-5 Enabling Serialized Object Policy Using
eclipselink-orm.xml</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;entity class="Employee"&gt;
    &lt;optimistic-locking cascade="true"&gt;
    &lt;serialized-object class="MySerializedObjectPolicy"&gt;
&lt;/entity&gt;

&lt;entity class="Address"&gt;
    &lt;optimistic-locking cascade="true"&gt;
    &lt;serialized-object class="MySerializedObjectPolicy"&gt;
        &lt;column name="ADDR_SOP"/&gt;
    &lt;/serialized-object&gt;
&lt;/entity&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#BBAGBGFB">Example 18-6</a> enables serialized object policy in a
customizer (either session or descriptor):</p>
</div>
<div id="BBAGBGFB" class="paragraph">
<p><strong><em>Example 18-6 Enabling Serialized Object Policy in a Customizer</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">if (descriptor.hasSerializedObjectPolicy()) {

    MySerializedObjectPolicy sop = (MySerializedObjectPolicy)descriptor.
       getSerializedObjectPolicy();

    // to compare pk cached in SOP Object with pk read directly from the row from
    //pk field(s) (false by default):

    sop.setShouldVerifyPrimaryKey(true);

    // to NOT compare version cached in SOP Object with version read directly from
    // the row from version field (true by default):

    sop.setShouldVerifyVersion(false);

    // to define recoverable SOP (false by default):

    sop.setIsRecoverable(true);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a descriptor customizer, define the class and specify it using
the <code>@Customizer</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class MyDescriptorCustomizer implements
   org.eclipse.persistence.config.DescriptorCustomizer {
    public void customize(ClassDescriptor descriptor) throws Exception
    {
         ...
    }
}
...
@Customizer(MyDescriptorCustomizer.class)
public class Employee implements Serializable {...</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use a session customizer to reach all descriptors at once, specify it
in a persistence unit property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">public class MySessionCustomizer implements
   org.eclipse.persistence.config.SessionCustomizer {
    public void customize(Session session) throws Exception
    {
        for (ClassDescriptor descriptor : session.getDescriptors().values()) {
            ...
        }
    }
}

&lt;property name="eclipselink.session.customizer" value="MySessionCustomizer"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Read queries (including find and refresh) automatically use a serialized
object if serialized object policy is enabled. If the serialized object
column contains <code>null</code>, or an obsolete version of the object, then a
query using a serialized object policy would either throw an exception
or, if all other fields have been read as well, build the object using
these fields (exactly as in the case where a serialized object policy is
not used).</p>
</div>
<div class="paragraph">
<p>To disable querying the serialized object, set the <code>SERIALIZED_OBJECT</code>
property to <code>false</code> as part of a query hint. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("SELECT e FROM Employee e")
   .setHint(QueryHints.SERIALIZED_OBJECT, "false");</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following example demonstrates disabling searching for a serialized
object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map hints = new HashMap();
hints.put("eclipselink.serialized-object", "false");
Employee emp = em.find(Employee.class, id, hints);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications that use serialized object policy should also consider
using the result set access optimization. Use the optimization when
querying to avoid the costly reading of the serialized object policy
field (which can be large) if it is already cached and the query is not
a refresh query. The optimization ensures that only the primary key is
retrieved from the result set and only gets additional values if the
cached object cannot be used. To enable the result set access
optimization, set the <code>eclipselink.jdbc.result-set-access-optimization</code>
persistent unit property to <code>true</code> in the <code>persistence.xml</code> file. For
example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.jdbc.result-set-access-optimization" value="true"/&gt;</code></pre>
</div>
</div>
<div id="BBAHIFAF" class="paragraph">
<p><strong>A Simple Serialized Object Policy Example</strong></p>
</div>
<div class="paragraph">
<p>Consider the following example object model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity(name="SOP_PartOrWhole")
@Table(name="SOP_PART_OR_WHOLE")
@Inheritance(strategy=InheritanceType.SINGLE_TABLE)
@Index(columnNames={"LEFTPART_ID", "RIGHTPART_ID"})
public abstract class PartOrWhole implements Serializable {
    @Id
    @GeneratedValue(strategy=GenerationType.TABLE)
    public long id;

    protected String description = "";

    @OneToOne(cascade=CascadeType.ALL, orphanRemoval=true)
    protected Part leftPart;
    @OneToOne(cascade=CascadeType.ALL, orphanRemoval=true)
    protected Part rightPart;
}

@Entity(name="SOP_Whole")
@DiscriminatorValue("W")
@SerializedObject(MySerializedObjectPolicy.class)
@NamedQueries({
    @NamedQuery(name="findWhole", query="Select w from SOP_Whole w where w.id =
    :id", hints= @QueryHint(name="eclipselink.serialized-object", value="false")),
    @NamedQuery(name="findWholeSOP", query="Select w from SOP_Whole w where w.id =
    :id"),
})
public class Whole extends PartOrWhole {
}

@Entity(name="SOP_Part")
@DiscriminatorValue("P")
public class Part extends PartOrWhole {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above data model allows the construction of a <code>Whole</code> object with
any number of (nested) <code>Part</code> objects. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 level – A <code>Whole</code> object contains left and right <code>Part</code> objects (3
objects all together)</p>
</li>
<li>
<p>2 levels – A <code>Whole</code> object contains left and right <code>Part</code> objects;
each of the <code>Part</code> objects has left and right <code>Part</code> objects (7 objects
all together)</p>
</li>
<li>
<p>3 levels – A <code>Whole</code> object contains left and right <code>Part</code> object;
each of the <code>Part</code> objects has a left and right <code>Part</code> objects; which
each have a left and right <code>Part</code> objects (15 objects all together)</p>
</li>
<li>
<p><em>`n`</em> levels – (2<em>`n`</em>+1 - 1 objects all together)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Performance for the above data model increases as the number of levels
in the model increases. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 level – performance is slower than without serialized object policy.</p>
</li>
<li>
<p>2 levels – performance is only slightly faster than without serialized
object policy.</p>
</li>
<li>
<p>5 levels – performance is 7 times faster than without serialized
object policy.</p>
</li>
<li>
<p>10 levels – performance is more than 25 times faster than without
serialized object policy.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BBAFFHDD"><a class="anchor" href="#BBAFFHDD"></a>Automated Tuning</h4>
<div class="paragraph">
<p>Automated tuning is an optimization that allows applications to
automatically tune JPA and session configuration for a specific purpose.
Multiple configuration options can be configured by a single tuner and
different configurations can be specified before and after application
deployment and after application metadata has been processed but before
connecting the session. Automated tuning simplifies configuration and
allows a dynamic single tuning option.</p>
</div>
<div class="paragraph">
<p>Tuners are created by implementing the
<code>org.eclipse.persistence.tools.tuning.SessionTuner</code> interface. Two tuner
implementations are provided and custom tuners can be created as
required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standard (<code>StandardTuner</code>) – The standard tuner is enabled by default
and does not change any of the default configuration settings.</p>
</li>
<li>
<p>Safe (<code>SafeModeTuner</code>) – The safe tuner configures the persistence
unit for debugging. It disables caching and several performance
optimizations to provide a simplified debugging and development
configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">WEAVING_INTERNAL = false
WEAVING_CHANGE_TRACKING = false
CACHE_SHARED_DEFAULT = false
JDBC_BIND_PARAMETERS = false
ORM_SCHEMA_VALIDATION = true
TEMPORAL_MUTABLE = true
ORDER_UPDATES = true</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable a tuner, specify a predefined tuner or enter the fully
qualified name of a <code>SessionTuner</code> implementation as the value of the
<code>eclipselink.tuning</code> property in the <code>persistence.xml</code> file. The
following example enables the safe tuner.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.tuning" value="Safe"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a detailed reference of the <code>tuning</code> property, see <em>Jakarta
Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDIICEJ"><a class="anchor" href="#CHDIICEJ"></a>Tools</h4>
<div class="paragraph">
<p>EclipseLink provides monitoring and optimization tools, as described in
<a href="#PERFORMANCE002">Monitoring and Optimizing
EclipseLink-Enabled Applications</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="PERFORMANCE002"><a class="anchor" href="#PERFORMANCE002"></a>Monitoring and Optimizing EclipseLink-Enabled Applications</h3>
<div class="paragraph">
<p>The most important challenge to performance tuning is knowing what to
optimize. To improve the performance of your application, identify the
areas of your application that do not operate at peak efficiency. This
section contains information about these subjects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDJJDDH">Performance Optimization Recommendations and Tips</a></p>
</li>
<li>
<p><a href="#CHDIAFJI">Task 1: Measure EclipseLink Performance with the EclipseLink Profiler</a></p>
</li>
<li>
<p><a href="#CIAFFAIF">Task 2: Measure EclipseLink Performance in the Server Environment</a></p>
</li>
<li>
<p><a href="#CIAFGJHI">Task 3: Measure Fetch Group Field Usage</a></p>
</li>
<li>
<p><a href="#CHDICBBA">Task 4: Identify Sources of Application Performance Problems</a></p>
</li>
<li>
<p><a href="#CHDDCABJ">Task 5: Modify Poorly-Performing Application Components</a></p>
</li>
<li>
<p><a href="#CHDHGFDI">Task 6: Measure Performance Again</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDJJDDH"><a class="anchor" href="#CHDJJDDH"></a>Performance Optimization Recommendations and Tips</h4>
<div class="paragraph">
<p>EclipseLink provides a diverse set of features to measure and optimize
application performance. You can enable or disable most features in the
descriptors or session, making any resulting performance gains
global.Performance considerations are present at every step of the
development cycle. Although this implies an awareness of performance
issues in your design and implementation, it does not mean that you
should expect to achieve the best possible performance in your first
pass.</p>
</div>
<div class="paragraph">
<p>For example, if optimization complicates the design, leave it until the
final development phase. You should still plan for these optimizations
from your first iteration, to make them easier to integrate later.</p>
</div>
<div class="paragraph">
<p>The most important concept associated with tuning your EclipseLink
application is the idea of an iterative approach. The most effective way
to tune your application is to do the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDIAFJI">Task 1: Measure EclipseLink Performance with the
EclipseLink Profiler</a>.</p>
</li>
<li>
<p><a href="#CIAFFAIF">Task 2: Measure EclipseLink Performance in the Server
Environment</a></p>
</li>
<li>
<p><a href="#CIAFGJHI">Task 3: Measure Fetch Group Field Usage</a></p>
</li>
<li>
<p><a href="#CHDICBBA">Task 4: Identify Sources of Application Performance
Problems</a>.</p>
</li>
<li>
<p><a href="#CHDDCABJ">Task 5: Modify Poorly-Performing Application
Components</a>.</p>
</li>
<li>
<p><a href="#CHDHGFDI">Task 6: Measure Performance Again</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CHDIAFJI"><a class="anchor" href="#CHDIAFJI"></a>Task 1: Measure EclipseLink Performance with the EclipseLink Profiler</h4>
<div class="paragraph">
<p>The EclipseLink performance profiler helps you identify performance
problems by logging performance statistics for every executed query in a
given session. Use the performance profiler to monitor a single query,
or simple single-threaded use case.</p>
</div>
<div class="paragraph">
<p>The EclipseLink performance profiler logs the following information to
the log file.</p>
</div>
<div class="paragraph">
<p><strong><em>Table 18-1 Information Logged by the EclipseLink Performance
Profiler</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Information Logged</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Query class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain class name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total execution time of the query, including any nested
queries (in milliseconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution time of the query, excluding any nested queries
(in milliseconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Objects</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total number of objects affected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Objects Handled per Second</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How many objects were handled per
second of transaction time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the amount of time spent printing logging messages (in
milliseconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL Prepare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time spent preparing the SQL script (in
milliseconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL Execute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time spent executing the SQL script (in
milliseconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Row Fetch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time spent fetching rows from the database (in
milliseconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time spent searching or updating the object cache
(in milliseconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object Build</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time spent building the domain object (in
milliseconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">query Prepare</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the amount of time spent to prepare the query prior to
execution (in milliseconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL Generation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the amount of time spent to generate the SQL script
before it is sent to the database (in milliseconds)</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="CHDDAEHF"><a class="anchor" href="#CHDDAEHF"></a>Enabling the EclipseLink Profiler</h5>
<div class="paragraph">
<p>The EclipseLink performance profiler is an instance of
<code>org.eclipse.persistence.tools.profiler.PerformanceProfiler</code> class. To
enable it, add the following line to the <code>persistence.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.profiler" value="PerformanceProfiler.logProfiler"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to enabling the EclipseLink profiler, The
<code>PerformanceProfiler</code> class public API also provides the functionality
described in <a href="#CHDGBGGC">Table 18-2</a>:</p>
</div>
<div id="CHDGBGGC" class="paragraph">
<p><strong><em>Table 18-2 Additional PerformanceProfiler Functionality</em></strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>To&#8230;&#8203;</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use&#8230;&#8203;</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable the profiler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dontLogProfile</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organize the profiler log into a summary of all the individual
operation profiles including operation statistics like the shortest time
of all the operations that were profiled, the total time of all the
operations, the number of objects returned by profiled queries, and the
total time that was spent in each kind of operation that was profiled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logProfileSummary</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organize the profiler log into a summary of all the individual
operation profiles by query</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logProfileSummaryByQuery</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organize the profiler log into a summary of all the individual
operation profiles by class.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logProfileSummaryByClass</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="accessing-and-interpreting-profiler-results"><a class="anchor" href="#accessing-and-interpreting-profiler-results"></a>Accessing and Interpreting Profiler Results</h5>
<div class="paragraph">
<p>You can see profiling results by opening the profile log in a text
reader, such as Notepad.</p>
</div>
<div class="paragraph">
<p>The profiler output file indicates the health of a EclipseLink-enabled
application.</p>
</div>
<div class="paragraph">
<p><a href="#CHDBGFGG">Example 18-7</a> shows an sample of the EclipseLink profiler
output.</p>
</div>
<div id="CHDBGFGG" class="paragraph">
<p><strong><em>Example 18-7 Performance Profiler Output</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Begin Profile of{
ReadAllQuery(com.demos.employee.domain.Employee)
Profile(ReadAllQuery,# of obj=12, time=139923809,sql execute=21723809,
prepare=49523809, row fetch=39023809, time/obj=11623809,obj/sec=8)
} End Profile</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CHDBGFGG">Example 18-7</a> shows the following information about the
query:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ReadAllQuery(com.demos.employee.domain.Employee)</code>: specific query
profiled, and its arguments.</p>
</li>
<li>
<p><code>Profile(ReadAllQuery</code>: start of the profile and the type of query.</p>
</li>
<li>
<p><code># of obj=12</code>: number of objects involved in the query.</p>
</li>
<li>
<p><code>time=139923809</code>: total execution time of the query (in milliseconds).</p>
</li>
<li>
<p><code>sql execute=21723809</code>: total time spent executing the SQL statement.</p>
</li>
<li>
<p><code>prepare=49523809</code>: total time spent preparing the SQL statement.</p>
</li>
<li>
<p><code>row fetch=39023809</code>: total time spent fetching rows from the
database.</p>
</li>
<li>
<p><code>time/obj=116123809</code>: number of nanoseconds spent on each object.</p>
</li>
<li>
<p><code>obj/sec=8</code>: number of objects handled per second.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CIAFFAIF"><a class="anchor" href="#CIAFFAIF"></a>Task 2: Measure EclipseLink Performance in the Server Environment</h4>
<div class="paragraph">
<p>Use the Performance Monitor to provide detailed profiling and monitoring
information in a multithreaded server environment. Use the performance
monitor to monitor a server, multiple threads, or long running
processes.</p>
</div>
<div class="paragraph">
<p>Enable the monitor in <code>persistence.xml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.profiler" value="PerformanceMonitor"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The performance monitor can also be enabled through code using a
<code>SessionCustomizer</code>.</p>
</div>
<div class="paragraph">
<p>The performance monitor will output a dump of cumulative statistics
every minute to the EclipseLink log. The statistics contains three sets
of information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Info</strong>; statistics that are constant informational data, such as the
session name, or time of login.</p>
</li>
<li>
<p><strong>Counter</strong>; statistics that are cumulative counters of total
operations, such as cache hits, or query executions.</p>
</li>
<li>
<p><strong>Timer</strong>; statistics that are cumulative measurements of total time (in
nano seconds) for a specific type of operation, reading, writing,
database operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Statistics are generally grouped in total and also by query type, query
class, and query name. Counters and timers are generally recorded for
the same operations, so the time per operation could also be calculated.</p>
</div>
<div class="paragraph">
<p>The time between statistic dumps can be configured by using the
<code>setDumpTime(long)</code> method in the <code>PerformanceMonitor</code> class. If dumping
the results is not desired, then the <code>dumpTime</code> attribute can be set to
be very large such as <code>Long.MAX_VALUE</code>. The statistic can also be
accessed in a Java program with the <code>getOperationTime(String)</code> method.</p>
</div>
<div class="paragraph">
<p>The performance monitor can also be configured with a profile weight.
The profile weights are defined in the <code>SessionProfiler</code> class and used
by the PerformanceMonitor class. The weights include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>NONE</code>—No statistics are recorded.</p>
</li>
<li>
<p><code>NORMAL</code>—Informational statistics are recorded.</p>
</li>
<li>
<p><code>HEAVY</code>—Informational, counter and timer statistics are recorded.</p>
</li>
<li>
<p><code>ALL</code>—All statistics are recorded (this is the default).</p>
<div class="literalblock">
<div class="content">
<pre>+</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the current release, the performance monitor responds with the same
information for the <code>HEAVY</code> and <code>ALL</code> values.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="CIAFGJHI"><a class="anchor" href="#CIAFGJHI"></a>Task 3: Measure Fetch Group Field Usage</h4>
<div class="paragraph">
<p>Use the Fetch Group Monitor to measure fetch group field usage. This can
be useful for performance analysis in a complex system.</p>
</div>
<div class="paragraph">
<p>Enable this monitor by using the system property
<code>org.eclipse.persistence.fetchgroupmonitor=true</code>.</p>
</div>
<div class="paragraph">
<p>The monitor outputs the attribute used for a class every time a new
attribute is accessed.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDICBBA"><a class="anchor" href="#CHDICBBA"></a>Task 4: Identify Sources of Application Performance Problems</h4>
<div class="paragraph">
<p>Areas of the application where performance problems could occur include
the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identifying General Performance Optimization</p>
</li>
<li>
<p>Schema</p>
</li>
<li>
<p>Mappings and Descriptors</p>
</li>
<li>
<p>Sessions</p>
</li>
<li>
<p>Cache</p>
</li>
<li>
<p>Data Access</p>
</li>
<li>
<p>Queries</p>
</li>
<li>
<p>Unit of Work</p>
</li>
<li>
<p>Application Server and Database Optimization</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#CHDDCABJ">Task 5: Modify Poorly-Performing Application Components</a>
provides some guidelines for dealing with problems in each of these
areas.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDDCABJ"><a class="anchor" href="#CHDDCABJ"></a>Task 5: Modify Poorly-Performing Application Components</h4>
<div class="paragraph">
<p>For each source of application performance problems listed in
<a href="#CHDICBBA">Task 4: Identify Sources of Application Performance
Problems</a>, you can try specific workarounds, as described in this
section.</p>
</div>
<div class="sect4">
<h5 id="identifying-general-performance-optimizations"><a class="anchor" href="#identifying-general-performance-optimizations"></a>Identifying General Performance Optimizations</h5>
<div class="paragraph">
<p><strong>Avoid overriding EclipseLink default behavior unless your application
requires it</strong>. Some of these defaults are suitable for a development
environment; you should change these defaults to suit your production
environment. These defaults may include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Batch writing – See "jdbc.batch-writing" in <em>Jakarta Persistence API
(JPA) Extensions Reference for EclipseLink</em>.</p>
</li>
<li>
<p>Statement caching – See "jdbc.cache-statements" in <em>Jakarta
Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</li>
<li>
<p>Read and write connection pool size – See "connection-pool" in
<em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</li>
<li>
<p>Session cache size – See "maintain-cache" in <em>Jakarta Persistence API
(JPA) Extensions Reference for EclipseLink</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use the Workbench rather than manual coding.</strong> These tools are not only
easy to use: the default configuration they export to deployment XML
(and the code it generates, if required) represents best practices
optimized for most applications.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema"><a class="anchor" href="#schema"></a>Schema</h5>
<div class="paragraph">
<p>Optimization is an important consideration when you design your database
schema and object model. Most performance issues occur when the object
model or database schema is too complex, as this can make the database
slow and difficult to query. This is most likely to happen if you derive
your database schema directly from a complex object model.</p>
</div>
<div class="paragraph">
<p>To optimize performance, design the object model and database schema
together. However, allow each model to be designed optimally: do not
require a direct one-to-one correlation between the two.</p>
</div>
<div class="paragraph">
<p>Possible ways to optimize the schema include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Aggregating two tables into one</p>
</li>
<li>
<p>Splitting one table into many</p>
</li>
<li>
<p>Using a collapsed hierarchy</p>
</li>
<li>
<p>Choosing one out of many</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See "Data Storage Schema" in <em>EclipseLink Concepts</em> for additional
information.</p>
</div>
</div>
<div class="sect4">
<h5 id="mappings-and-descriptors"><a class="anchor" href="#mappings-and-descriptors"></a>Mappings and Descriptors</h5>
<div class="paragraph">
<p>If you find performance bottlenecks in your mapping and descriptors, try
these solutions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always use indirection (lazy loading). It is not only critical in
optimizing database access, but also allows EclipseLink to make several
other optimizations including optimizing its cache access and unit of
work processing. See "cache-usage" in <em>Jakarta Persistence API (JPA)
Extensions Reference for EclipseLink</em>.</p>
</li>
<li>
<p>Avoid using method access in your EclipseLink mappings, especially if
you have expensive or potentially dangerous side-effect code in your get
or set methods; use the default direct attribute access instead. See
"Using Method or Direct Field Access" in the <em>EclipseLink Concepts</em>.</p>
</li>
<li>
<p>Avoid using the existence checking option checkCacheThenDatabase on
descriptors, unless required by the application. The default existence
checking behavior offers better performance. See "@ExistenceChecking" in
<em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em>.</p>
</li>
<li>
<p>Avoid expensive initialization in the default constructor that
EclipseLink uses to instantiate objects. Instead, use lazy
initialization or use an EclipseLink instantiation policy to configure
the descriptor to use a different constructor. See
"@InstantiationCopyPolicy" in <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="cache"><a class="anchor" href="#cache"></a>Cache</h5>
<div class="paragraph">
<p>You can often improve performance through caching, even in a clustered
environment by implementing cache coordination. Cache coordination
allows multiple, possibly distributed instances of a session to
broadcast object changes among each other so that each session&#8217;s cache
can be kept up-to-date. For detailed information about optimizing cache
behavior, see "Understanding Caching" in <em>EclipseLink Concepts</em> and the
following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/Caching</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/CacheCoordination" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/CacheCoordination</a></code></p>
</li>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN</a></code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="data-access"><a class="anchor" href="#data-access"></a>Data Access</h5>
<div class="paragraph">
<p>Depending on the type of data source your application accesses,
EclipseLink offers a variety of <code>Login</code> options that you can use to tune
the performance of low level data reads and writes. For optimizing
higher-level data reads and writes, "Understanding Data Access" in
<em>EclipseLink Concepts</em> offers several techniques to improve data access
performance for your application. These techniques show you how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Optimize JDBC driver properties.</p>
</li>
<li>
<p>Optimize data format.</p>
</li>
<li>
<p>Use batch writing for optimization.</p>
</li>
<li>
<p>Use Outer-Join Reading with Inherited Subclasses.</p>
</li>
<li>
<p>Use Parameterized SQL (Parameter Binding) and Prepared Statement
Caching for Optimization.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="queries"><a class="anchor" href="#queries"></a>Queries</h5>
<div class="paragraph">
<p>EclipseLink provides an extensive query API for reading, writing, and
updating data. "Understanding EclipseLink Queries" in <em>EclipseLink
Concepts</em> offers several techniques to improve query performance for
your application. These techniques show you how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use parameterized SQL and prepared statement caching for optimization.</p>
</li>
<li>
<p>Use named queries for optimization.</p>
</li>
<li>
<p>Use batch and join reading for optimization.</p>
</li>
<li>
<p>Use partial object queries and fetch groups for optimization.</p>
</li>
<li>
<p>Use read-only queries for optimization.</p>
</li>
<li>
<p>Use JDBC fetch size for optimization.</p>
</li>
<li>
<p>Use cursored streams and scrollable cursors for optimization.</p>
</li>
<li>
<p>Use result set pagination for optimization.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also includes links to read and write optimization examples.</p>
</div>
</div>
<div class="sect4">
<h5 id="application-server-and-database-optimization"><a class="anchor" href="#application-server-and-database-optimization"></a>Application Server and Database Optimization</h5>
<div class="paragraph">
<p>To optimize the application server and database performance, consider
these techniques:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuring your application server and database correctly can have a
big impact on performance and scalability. Ensure that you correctly
optimize these key components of your application in addition to your
EclipseLink application and persistence.</p>
</li>
<li>
<p>For your application or Jakarta EE server, ensure your memory, thread
pool and connection pool sizes are sufficient for your server&#8217;s expected
load, and that your JVM has been configured optimally.</p>
</li>
<li>
<p>Ensure that your database has been configured correctly for optimal
performance and its expected load.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDHGFDI"><a class="anchor" href="#CHDHGFDI"></a>Task 6: Measure Performance Again</h4>
<div class="paragraph">
<p>Finally, after identifying possible performance bottlenecks and taking
some action on them, rerun your application, again with the profiler
enabled (see <a href="#CHDDAEHF">Enabling the EclipseLink Profiler</a>). Review
the results and, if more action is required, follow the procedures
outlined in <a href="#CHDDCABJ">Task 5: Modify Poorly-Performing Application
Components</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="RESTJPA"><a class="anchor" href="#RESTJPA"></a>19. Exposing JPA Entities Through RESTful Data Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how to expose JPA persistence units using RESTful
Data services.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#RESTJPA001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#RESTJPA002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#RESTJPA003">Additional Resources</a></p>
</li>
<li>
<p><a href="#RESTJPA004">RESTful Data Services API Reference</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Expose persistent data model and application logic over REST for the
development of Thin Server Architecture (TSA) clients including
HTML5/JavaScript and mobile technologies.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>Use RESTful Data Services to expose entities using a RESTful service,
without writing JAX-RS code.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Jakarta EE application server with the following:</p>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>Support for Java API for RESTful Web Services (JAX-RS) 1.0, for
example the JAX-RS reference implementation, Jersey (see
<code><a href="http://jersey.java.net/" class="bare">http://jersey.java.net/</a></code>).</p>
</li>
</ul>
</div>
</li>
<li>
<p>A compliant Java Database Connectivity (JDBC) database, such as Oracle
Database, Oracle Express, or MySQL</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="RESTJPA001"><a class="anchor" href="#RESTJPA001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>REpresentational State Transfer (REST) defines a set of architectural
principles for distributed systems, in which Web Services are viewed as
resources. Those resources are identified by URIs and can be addressed
and transferred using the HTTP protocol. REST can be used with a number
of technologies, including JPA. HTTP methods are used to access and
perform operations on resources.</p>
</div>
<div class="paragraph">
<p>The Java API for RESTful Web Services (JAX-RS) is an API designed to
make it easy to develop Java applications that use the REST
architecture. With JAX-RS, you use annotations to define resources and
the actions that can be performed on those resources.</p>
</div>
<div class="paragraph">
<p>While it is possible to use JAX-RS directly to interact with JPA
persistence units in a RESTful application, RESTful Data Services
provide an API that makes it easier to implement REST for JPA
persistence,. You can use this API to interact with JPA persistence
units without explicitly writing JAX-RS code, thus providing a simple
way to expose persistence units through REST.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For an example that uses JAX-RS directly to implement JPA persistence in
a RESTful application, see "RESTful Service Example" at
<code><a href="http://wiki.eclipse.org/EclipseLink/Examples/REST/GettingStarted" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/REST/GettingStarted</a></code>. For
information about simplifying that process by using RESTful Data
Services, continue reading this chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>RESTful Data Services are made available via a web fragment, which
extends the capabilities of a web application. The REST functionality is
made available by including the RESTful Data Services JAR file in the
<code>WEB-INF/lib</code> folder of a web application.</p>
</div>
<div class="paragraph">
<p>The RESTful Data Services runtime provides access to all persistence
units packaged in the application in which it is running, as well as any
dynamic persistence units that are provisioned within it.</p>
</div>
</div>
<div class="sect2">
<h3 id="RESTJPA002"><a class="anchor" href="#RESTJPA002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section contains the following tasks for exposing JPA entities
using RESTful Data Services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDCIBDG">Step 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#CHDGGJJJ">Step 2: Create and Configure the Application</a></p>
</li>
<li>
<p><a href="#CHDBHBAC">Step 3: Understand RESTful Data Services URI Basics</a></p>
</li>
<li>
<p><a href="#CHDBIIFF">Step 4: Represent Entities Using JPA, JAXB, or JSON</a></p>
</li>
<li>
<p><a href="#CHDCIHEG">Step 5: Issue Client Calls for Operations on the Persistence Unit</a></p>
</li>
<li>
<p><a href="#CHDGJEDF">Step 6: Implement Security</a></p>
</li>
<li>
<p><a href="#CHDHGACD">Step 7: Understand the Structure of RESTful Data Services Responses</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDCIBDG"><a class="anchor" href="#CHDCIBDG"></a>Step 1: Prerequisites</h4>
<div class="paragraph">
<p>To implement and use RESTful Data Services, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Either of the following Jakarta EE application servers:</p>
<div class="ulist">
<ul>
<li>
<p>Oracle WebLogic Server Release 4.0 or later.</p>
</li>
<li>
<p>Glassfish Server 3.1.2 or later.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With Glassfish Server 3.1.2, you must upgrade the EclipseLink version to
use the version of the RESTful Data Services shipped in EclipseLink
2.4.2 (and must also include DBWS). See
<code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code> for EclipseLink
downloads.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Those servers include the following:
<strong> EclipseLink 2.4 or later, configured as the persistence provider.
</strong> Jersey, the reference implementation of the Java API for RESTful Web
Services (JAX-RS) 1.0 specification.
* The <code>org.eclipse.persistence.jpars_`<em>`version_num`</em></code>.jar` file,
where <em>`version_num`</em> is the version of the jpars file, for example,
<code>org.eclipse.persistence.jpars_2.4.1.v20121003-ad44345.jar</code>. This file
is included in the EclipseLink distributions from the Eclipse
foundation, at <code><a href="http://www.eclipse.org/eclipselink/downloads/" class="bare">http://www.eclipse.org/eclipselink/downloads/</a></code>:
<strong> In the installer distribution, the file is located in
<code>eclipselink\jlib\jpa\</code>.
</strong> In the bundles distribution, the file is located with the other
bundles.
* Any compliant Java Database Connectivity (JDBC) database, including
Oracle Database, Oracle Database Express Edition (Oracle Database XE),
or MySQL. These instructions are based on Oracle Database XE 11g Release
2.
For the certification matrix, see</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDGGJJJ"><a class="anchor" href="#CHDGGJJJ"></a>Step 2: Create and Configure the Application</h4>
<div class="paragraph">
<p>RESTful Data Services are designed to function with standard JPA
applications, with little extra work required beyond enabling the
service, as described below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Develop an application using one or more standard JPA persistence units,
package it in a Web ARchive (WAR) file, and deploy it normally.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The fragment must be placed inside a WAR, because it offers Web
services. That WAR may optionally be packaged inside an Enterprise
Archive (EAR) file.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Weaving is required for several RESTful Data Services features to work:
providing relationships as links, editing relationships, and dealing
with lazy many-to-one relationships. Therefore, for those features, you
must either deploy to a Jakarta EE compliant server or statically weave
your classes.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Include the RESTful Data Services servlet in the WAR containing the
application. (For instructions on downloading, see.<a href="#CHDCIBDG">Step
1: Prerequisites</a>)</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RESTful Data Services JAR file includes a <code>web-fragment.xml</code> file
that identifies the servlet and defines the root URI for the RESTful
service.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Add the <code>org.eclipse.persistence.jpars_`<em>`version_num`</em></code>.jar` file to
the WAR containing the application, under <code>WEB-INF/lib</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDBHBAC"><a class="anchor" href="#CHDBHBAC"></a>Step 3: Understand RESTful Data Services URI Basics</h4>
<div class="paragraph">
<p>URIs used for making REST calls for RESTful Data Services follow these
standard patterns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The base URI for an application is:
<code><a href="http://server:port/application-name/persistence/{version}" class="bare">http://server:port/application-name/persistence/{version}</a></code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of EclipseLink 2.4.2, support for using RESTful Data Services URIs
without a version number is deprecated and will be removed in future
releases. The version of RESTful Data Services in EclipseLink 2.4.2 is
<code>v1.0</code>, and that version number should be used to make REST requests to
RESTful Data Services.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For base operations on the persistence unit, add the persistence unit
name:
<code>/persistence/{version}/{unit-name}</code></p>
</li>
<li>
<p>For specific types of operations, add the type of operation, for
example:</p>
<div class="ulist">
<ul>
<li>
<p>Entity operations: <code>/persistence/{version}/{unit-name}/entity</code></p>
</li>
<li>
<p>Query operations: <code>/persistence/{version}/{unit-name}/query</code></p>
</li>
<li>
<p>Single result query operations:
<code>/persistence/{version}/{unit-name}/singleResultQuery</code></p>
</li>
<li>
<p>Persistence unit level metadata operations:
<code>/persistence/{version}/{unit-name}/metadata</code></p>
</li>
<li>
<p>Base operations: <code>/persistence/{version}</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For complete documentation on how to construct these URIs, see
<a href="#RESTJPA004">RESTful Data Services API Reference.</a></p>
</div>
</div>
<div class="sect3">
<h4 id="CHDBIIFF"><a class="anchor" href="#CHDBIIFF"></a>Step 4: Represent Entities Using JPA, JAXB, or JSON</h4>
<div class="paragraph">
<p>Entities in RESTful Data Services are represented in two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>As JPA Entities</strong> - The mappings of the JPA entities must be
represented in the typical JPA fashion, using either annotations or XML
files. These mappings are used to interact with the data source.</p>
</li>
<li>
<p><strong>As JAXB/JSON</strong> - No specific mapping information is required when
using JAXB/JSON. By default, RESTful Data Services use the JAXB defaults
(defined in the JAXB specification) to map to JAXB/JSON. You can
optionally provide JAXB annotations on the classes to alter the way the
objects are mapped. Additionally, the persistence unit property
<code>eclipselink.jpa-rs.oxm</code> can be specified in a persistence unit&#8217;s
<code>persistence.xml</code> to specify XML-defined JAXB mappings.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="relationships"><a class="anchor" href="#relationships"></a>Relationships</h5>
<div class="paragraph">
<p>In general, JAXB default mappings are sufficient to allow information
exchange using JSON/JAXB. There are, however, some special cases when
dealing with relationships.</p>
</div>
<div class="paragraph">
<p><strong>Bidirectional Relationships and Cycles</strong></p>
</div>
<div class="paragraph">
<p>Bidirectional relationships are typical in JPA and are easy to represent
in a database using foreign keys. They are more difficult to represent
in an XML or JSON document using standard JAXB. However, the EclipseLink
JAXB implementation provides a way to define an inverse relationship.
Inverse relationships are not directly written to XML or JSON but are
populated when the XML or JSON is unmarshalled. The way this is handled
is as follows:</p>
</div>
<div class="paragraph">
<p>JPA bidirectional relationships are defined to have an owning side and a
non-owning side. The entity that has the table with a foreign key in the
database is the <em>owning</em> entity. The other table&#8212;&#8203;the one pointed to&#8212;&#8203;is
the <em>inverse</em> (non-owning) entity. JPA mapping provides a mapped-by
attribute that defines which is which. The <code>mappedBy</code> attribute must be
on the inverse side. RESTful Data Services default the owning side to be
an inverse relationship. As a result, when an object with an owned
relationship is read or written, that relationship is ignored.</p>
</div>
<div class="paragraph">
<p>Consider the following pseudo-code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">  @Entity
  ClassA{

  @Id
  int id

  @OneToOne
  myB

}


  @Entity
  ClassB{

  @Id
  int id

  @OneToOne(mappedby="myB")
  myA

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the objects are identified as follows&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>A1</code> with <code>id=1</code> and <code>myB = B1</code></p>
</li>
<li>
<p><code>B1</code> with <code>id=11</code> and <code>myA = A1</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#8230;&#8203;the following JSON corresponds to those objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">  A {
    id:1
  }

  B {
    id:11
    myA: {
      id: 1
    }
  }</code></pre>
</div>
</div>
<div id="CHDBDBHJ" class="paragraph">
<p><strong>Passing By Value vs. Passing By Reference</strong></p>
</div>
<div class="paragraph">
<p>RESTful Data Services allow relationship objects to be passed either by
value or by reference in the REST request. JSON attributes hold resource
references (see <a href="#CHDBADFD">"Pass By Value"</a>), while `_relationship`s
have "navigation" links (see <a href="#CHDFJAII">"Pass By Reference"</a>).</p>
</div>
<div id="CHDBADFD" class="paragraph">
<p><strong>Pass By Value</strong></p>
</div>
<div class="paragraph">
<p>To pass an object by value, create typical JSON or XML that represents
the object. The following JSON passes <code>myA</code> by value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">  B {
    id:11
    myA {
      id: 1
    }
  }</code></pre>
</div>
</div>
<div id="CHDFJAII" class="paragraph">
<p><strong>Pass By Reference</strong></p>
</div>
<div class="paragraph">
<p>To pass an object by reference, use a <code>_link</code>. The link represents the
RESTful Data Services call necessary to get that object. The following
JSON passes <code>myA</code> by reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">  B {
    id:11
    myA {
      _link:{
          href: "http://localhost:8080/app/persistence/v1.0/pu/entity/A/1"
          method: "GET"
          rel: "self"
      }
    }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>link</code> consists of <code>href</code>, <code>method</code> and <code>rel</code> attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>href</code> (Hypertext REFerence) is the URI of the entity linked to.
The <code>href</code> uniquely identifies the linked entity or attribute.</p>
</li>
<li>
<p>The <code>method</code> identifies the operation the <code>href</code> is to be used for.</p>
</li>
<li>
<p>The <code>rel</code> represents the relationship between the containing entity
and the entity linked to.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lists can mix and match items represented by reference and by value. The
corresponding entity must exist if an item is represented by reference
in a request; otherwise RESTful Data Services returns an error.</p>
</div>
<div class="paragraph">
<p>The following example shows JSON that can be sent to RESTful Data
Services as a request, in a regular-expression-like syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
    "numericAttribute": 1
    "stringAttribute": "auction1"
    "dateAttribute": 12-09-16
    "singleRelatedItem": RELATED_ITEM?
      "listRelatedItem":
      {
          RELATED_ITEM*
      }
  }


  RELATED_ITEM =

      {
        "numericAttribute": 11
        "stringAttribute": "myName"
      }

  OR

      "_link" {
        "rel"="self",
        "href" = "LINK_HREF",
        "method"="GET"
     }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following JSON represents an entity called <code>Auction</code> with several
directly mapped fields and a collection of an entity called <code>Bid</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">  {
    "description": "Auction 1",
    "endPrice": 0,
    "id": 2,
    "image": "auction1.jpg",
    "name": "A1",
    "sold": false,
    "startPrice": 100,
    "bids": [
      {
        "_link": {
       "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/auction/entity/Bid/5",
        "method": "GET",
        "rel": "self"
      }
    },
    {
      "_link": {
        "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/auction/entity/Bid/6",
        "method": "GET",
        "rel": "self"
      }
    }
  ]
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>XML representation mimics the JSON representation. The following is
sample XML for an entity called <code>Auction</code>, with several directly mapped
attributes and a list of an entity called <code>Bid</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Auction&gt;
    &lt;description&gt;Auction 1&lt;/description&gt;
    &lt;endPrice&gt;0.0&lt;/endPrice&gt;
    &lt;id&gt;2&lt;/id&gt;
    &lt;image&gt;auction1.jpg&lt;/image&gt;
    &lt;name&gt;A1&lt;/name&gt;
    &lt;sold&gt;false&lt;/sold&gt;
    &lt;startPrice&gt;100.0&lt;/startPrice&gt;
    &lt;bids&gt;
      &lt;_link href="http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/auction/entity/Bid/5" method="GET" rel="self" /&gt;
    &lt;/bids&gt;
    &lt;bids&gt;
      &lt;_link href="http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/auction/entity/Bid/6" method="GET" rel="self" /&gt;
    &lt;/bids&gt;
  &lt;/Auction&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDCIHEG"><a class="anchor" href="#CHDCIHEG"></a>Step 5: Issue Client Calls for Operations on the Persistence Unit</h4>
<div class="paragraph">
<p>Clients use HTTP calls to perform operations on persistence units in a
deployed application. The requirements and options for constructing the
calls are described in <a href="#RESTJPA004">RESTful Data
Services API Reference.</a></p>
</div>
<div class="sect4">
<h5 id="CHDCDFHG"><a class="anchor" href="#CHDCDFHG"></a>Specify Media Format in the Header</h5>
<div class="paragraph">
<p>This REST interface can handle both XML and JSON representations of
data. The caller is responsible for using HTTP header values to indicate
the format of the content:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Content-Type = application/json</code> indicates that the content being
sent is JSON</p>
</li>
<li>
<p><code>Content-Type = application/xml</code> indicates that the content being sent
is XML</p>
</li>
<li>
<p><code>Accept = application/json</code> indicates that the expected format of the
result is JSON</p>
</li>
<li>
<p><code>Accept = application/xml</code> indicates that the expected format of the
result is XML</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no header value is specified, JSON is used by default. If
<code>Content-type</code> is specified and <code>Accept</code> is not specified, the returned
format matches the <code>Content-type</code> passed in.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In many REST utilities, the <code>Accept</code> value is defaulted to
<code>application/xml</code>. In those cases, you must configure this value
explicitly if you want JSON.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="CHDGBJGH"><a class="anchor" href="#CHDGBJGH"></a>About Logging</h5>
<div class="paragraph">
<p>Messages related to RESTful Data Services operations are logged to a
logger called <code>org.eclipse.persistence.jpars</code>. Most messages are logged
at the <code>FINE</code> level. Exception stacks are logged at <code>FINER</code>.</p>
</div>
<div class="paragraph">
<p>Messages related to operations within `EntityManager`s,
`EntityManagerFactory`s and `JAXBContext`s are logged in the same manner
as other EclipseLink logging.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDGJEDF"><a class="anchor" href="#CHDGJEDF"></a>Step 6: Implement Security</h4>
<div class="paragraph">
<p>Secure RESTful Data Services through typical REST security mechanisms.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDHGACD"><a class="anchor" href="#CHDHGACD"></a>Step 7: Understand the Structure of RESTful Data Services Responses</h4>
<div class="paragraph">
<p>The RESTful Data Services response messages, either in XML or in JSON,
contain following categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basic data types, such as <code>int</code>, <code>double</code>, <code>String</code>, <code>Integer</code>,
<code>Double</code>, <code>Boolean</code>, etc.</p>
</li>
<li>
<p>Relationships (links and relationships)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The next sections explain the semantic and syntactic details of each
category of data.</p>
</div>
<div class="paragraph">
<p>There is also a minor generic difference between the XML and JSON
responses (other than format). The JSON responses do not include the
root name of an entity, while XML responses do. See the <code>employee</code>
root/grouping name in the XML response below. The root name is derived
from the name of the entity it represents.</p>
</div>
<div class="paragraph">
<p><strong>JSON</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "firstName":"John",
   "lastName": "Smith",
   …
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>XML</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;employee&gt;
   &lt;firstName&gt;John&lt;/firstName&gt;
   &lt;lastName&gt;Smith&lt;/lastName&gt;
   …
&lt;/employee&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="basic-data-types"><a class="anchor" href="#basic-data-types"></a>Basic Data Types</h5>
<div class="paragraph">
<p>In the RESTful Data Services responses, basic data types and primitives
are presented as simple JSON or XML fields. For example:</p>
</div>
<div class="paragraph">
<p><strong>JSON</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "firstName":"John",
   "lastName": "Smith",
   …
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>XML</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;employee&gt;
   &lt;firstName&gt;John&lt;/firstName&gt;
   &lt;lastName&gt;Smith&lt;/lastName&gt;
   …
&lt;/employee&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="links-and-relationships"><a class="anchor" href="#links-and-relationships"></a>Links and Relationships</h5>
<div class="paragraph">
<p>RESTful Data Services operations return all relationships by reference,
with the exception of JPA embeddables and element collections.</p>
</div>
<div class="paragraph">
<p>The <code>relationships</code> are links pointing to the (JPA) relationships of an
entity, such as one-to-one and one-to-many. For example, assume that an
employee has multiple phone numbers (one-to-many). When the employee is
read, the response will contain a relationship link pointing to the
relationship between the employee and the phone entities, plus a list of
the links, with each link pointing to a (unique) phone number that the
employee owns. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "firstName": "Jacob",
   "gender": "Male",
   "id": 743627,
   "lastName": "Smith",
   "version": 1,
   "_relationships": [
      {
         "_link": {
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/hr/entity/Employee/743627/phoneNumbers",
            "rel": "phoneNumbers"
         }
      }
   ],

   "phoneNumbers": [
      {
         "_link": {
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/hr/entity/PhoneNumber/743627+cell",
            "method": "GET",
            "rel": "self"
         }
      },
      {
         "_link": {
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/hr/entity/PhoneNumber/743627+work",
            "method": "GET",
            "rel": "self"
         }
      }
   ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Embedded objects and element collections are strictly privately-owned
(dependent) objects.They have no identity, and there is no cascade
option on an <code>ElementCollection</code>. The target objects are always
persisted, merged, and removed with their parent. Therefore, RESTful
Data Services embeds these objects directly in responses, rather than
providing links to them. For example, assume the <code>Employee</code> object has
<code>EmploymentPeriod</code> defined as <code>Embedded</code>. When the <code>Employee</code> is read,
the response will contain <code>EmploymentPeriod</code> as an embedded object, not
a link to it. Relationships are currently not supported for embedded
attributes. See the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "firstName": "John",
   "lastName": "Smith",

   "employmentPeriod": {
      "startDate": "2010-04-23T14:12:03.905-04:00",
      "endDate": "2013-01-23T12:00:02.301-04:00",
      "_relationships": []
   },
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, element collections are also directly contained in RESTful
Data Services responses as collections, not as links. For example,
assume the <code>Employee</code> object has a <code>"certifications"</code> attribute defined
as a collection of <code>Certification</code> objects. When the <code>Employee</code> is read,
the response will contain list of <code>Certification</code> objects, not links:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
   "firstName": "John",
   "lastName": "Smith",
   "certifications": [
      {
         "issueDate": "2013-04-23T15:02:23.071-04:00",
         "name": "Java"
      },
      {
         "issueDate": "2010-05-23T11:02:23.033-04:00",
         "name": "Weblogic"
      }
   ],
   ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="RESTJPA003"><a class="anchor" href="#RESTJPA003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Building RESTful Web Services with JAX-RS" in The Jakarta EE 6
Tutorial at <code><a href="http://docs.oracle.com/javaee/6/tutorial/doc/giepu.html" class="bare">http://docs.oracle.com/javaee/6/tutorial/doc/giepu.html</a></code>.</p>
</li>
<li>
<p>"RESTful Service Example" at
<code><a href="http://wiki.eclipse.org/EclipseLink/Examples/REST/GettingStarted" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/REST/GettingStarted</a></code>.</p>
</li>
<li>
<p>JSR 311: JAX-RS: The Java API for RESTful Web Services" at
<code><a href="http://jcp.org/en/jsr/detail?id=311" class="bare">http://jcp.org/en/jsr/detail?id=311</a></code></p>
</li>
<li>
<p>Jersey project at <code><a href="http://jersey.java.net/" class="bare">http://jersey.java.net/</a></code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="RESTJPA004"><a class="anchor" href="#RESTJPA004"></a>RESTful Data Services API Reference</h3>
<div class="paragraph">
<p>The following types of RESTful operations can be used with JPA via HTTP
when using RESTful Data Services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDEIFFJ">Entity Operations</a></p>
</li>
<li>
<p><a href="#CHDDAJBI">Entity Operations on Relationships</a></p>
</li>
<li>
<p><a href="#CHDJFCIF">Query Operations</a></p>
</li>
<li>
<p><a href="#CHDEHGDH">Base Operations</a></p>
</li>
<li>
<p><a href="#CHDFCFFA">Metadata Operations</a></p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="entity-operations"><a class="anchor" href="#entity-operations"></a>Entity Operations</h3>
<div class="paragraph">
<p>Entity operations are those performed against a specific entity type
within the persistence unit.</p>
</div>
<div class="paragraph">
<p>The base URI for entity operations is as follows:</p>
</div>
<div class="paragraph">
<p><code>/persistence/{version}/{unit-name}/entity/{type}/*</code></p>
</div>
<div class="paragraph">
<p>The <code>{type}</code> value refers to the type name (descriptor alias).</p>
</div>
<div class="paragraph">
<p>Supported entity operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDEBJID">FIND</a></p>
</li>
<li>
<p><a href="#CHDCIIIG">PERSIST</a></p>
</li>
<li>
<p><a href="#CHDGJGDD">MERGE</a></p>
</li>
<li>
<p><a href="#CHDDDDAB">DELETE</a></p>
</li>
</ul>
</div>
<hr>
<div class="sect3">
<h4 id="find"><a class="anchor" href="#find"></a>FIND</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/entity/{type}/{id}?{hints}</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{id}</code> is a string</p>
</li>
<li>
<p><em>`hints`</em> are specified using HTTP query parameters, with the key
being the name of the EclipseLink query hint</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OK</code>, with a payload containing the entity</p>
</li>
<li>
<p><code>NOT_FOUND</code> if the entity does not exist</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Usage</strong></p>
</div>
<div class="paragraph">
<p><strong>Composite Keys</strong></p>
</div>
<div class="paragraph">
<p>Composite keys are supported. The <code>` character is reserved and
therefore cannot be used in fields that represent keys. Composite keys
are separated using the `</code> character and should be specified in an
order corresponding to the Java default sorting of the attribute names.</p>
</div>
<div class="paragraph">
<p>For example, consider an entity <code>Phone</code>, with attributes <code>extB</code>=<code>123</code>
and <code>extA</code>=<code>321</code>. The URL to find the entity is:</p>
</div>
<div class="paragraph">
<p><code><a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Phone/321+123" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Phone/321+123</a></code></p>
</div>
<div class="paragraph">
<p>The <code>321</code> comes before the <code>123</code> because <code>extA</code> comes before <code>extB</code> when
sorted in Java.</p>
</div>
<div class="paragraph">
<p><strong>Result Caching</strong></p>
</div>
<div class="paragraph">
<p>Default EclipseLink and HTTP caching is enabled and configured through
standard means.</p>
</div>
<div class="paragraph">
<p><strong>Refresh</strong></p>
</div>
<div class="paragraph">
<p>The <code>EntityManager.refresh</code> operation can be invoked using the <code>find</code>
with the query hint for <code>Refresh</code>.</p>
</div>
<div class="paragraph">
<p><strong>Attributes</strong></p>
</div>
<div class="paragraph">
<p>Navigating into the attributes of an entity (for example, to get the
<code>Address</code> entity associated with an employee in a single REST request)
is supported to one level, for example:</p>
</div>
<div class="paragraph">
<p><code>/persistence/v1.0/{unit-name}/entity/{type}/{id}/{relationship}</code> will
work</p>
</div>
<div class="paragraph">
<p>while</p>
</div>
<div class="paragraph">
<p><code>/persistence/v1.0/{unit-name}/entity/{type}/{id}/{relationship}/{index}/{relationship2</code>}
will not</p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="persist"><a class="anchor" href="#persist"></a>PERSIST</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>PUT /persistence/{version}/{unit-name}/entity/{type}</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>PUT <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo</a></code></p>
</div>
<div class="paragraph">
<p><strong>Consumes</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Payload</strong></p>
</div>
<div class="paragraph">
<p>Entity</p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>Payload containing the entity returned by the persist operation</p>
</div>
<div class="paragraph">
<p><strong>Usage</strong></p>
</div>
<div class="paragraph">
<p><code>PUT</code> is required to be idempotent. As a result, it will fail if called
with an object that expects the server to provide an ID field. Typically
this will occur if the metadata specifies a generated key and the field
that contains that key is unpopulated.</p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="merge"><a class="anchor" href="#merge"></a>MERGE</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>POST /persistence/{version}/{unit-name}/entity/{type}</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>POST <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo</a></code></p>
</div>
<div class="paragraph">
<p><strong>Consumes</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Payload</strong></p>
</div>
<div class="paragraph">
<p>Entity</p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>Payload containing the entity returned by the merge operation.</p>
</div>
<div class="paragraph">
<p>Merge takes an object graph and makes it part of the persistence context
through comparison. It compares the object and all related objects to
the ones that already exist and issues `INSERT`s, `UPDATE`s, and
`DELETE`s to put the object in the persistence context.</p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="delete"><a class="anchor" href="#delete"></a>DELETE</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>DELETE /persistence/{version}/{unit-name}/entity/{type}{id}</code></p>
</div>
<div class="paragraph">
<p>where <code>{id}</code> is defined using a string</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>DELETE <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1</a></code></p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p><code>OK</code></p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="entity-operations-on-relationships"><a class="anchor" href="#entity-operations-on-relationships"></a>Entity Operations on Relationships</h3>
<div class="paragraph">
<p>The base URI for relationship operations is as follows:</p>
</div>
<div class="paragraph">
<p><code>/persistence/{version}/{unit-name}/entity/{entity}/{id}/{relationship}</code></p>
</div>
<div class="paragraph">
<p>Supported relationship operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDCEJCC">READ</a></p>
</li>
<li>
<p><a href="#CHDBEDDA">ADD</a></p>
</li>
<li>
<p><a href="#CHDDGAII">REMOVE</a></p>
</li>
</ul>
</div>
<hr>
<div class="sect3">
<h4 id="read"><a class="anchor" href="#read"></a>READ</h4>
<div class="paragraph">
<p>Use this operation to get the values of a relationship.</p>
</div>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/entity/{type}/{id}/{relationship}</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>{id}</code> is a string.</p>
</li>
<li>
<p><code>{relationship}</code> is the JPA name of the relationship.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OK</code>, Payload containing an entity or a list of entities.</p>
</li>
<li>
<p><code>NOT_FOUND</code> if the entity does not exist</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="add"><a class="anchor" href="#add"></a>ADD</h4>
<div class="paragraph">
<p>Use this operation to add to a list or replace the value of a
many-to-one relationship.</p>
</div>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>POST /persistence/{version}/{unit-name}/entity/{type}/{id}/{relationship}?{partner}</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As of EclipseLink 2.4.2, <code>partner</code> should be specified as a query
parameter. Specifying <code>partner</code> as a matrix parameter is deprecated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p>For unidirectional relationships, <code>{partner}</code> is not required, for
example:</p>
</div>
<div class="paragraph">
<p><code>POST <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship</a></code></p>
</div>
<div class="paragraph">
<p>For bi-directional relationships, you must provide the name of the
attribute that makes up the opposite side of the relationship. For
example, to update an <code>Auction.bid</code> where the opposite side of the
relationship is <code>Bid.auction</code>, use the following:</p>
</div>
<div class="paragraph">
<p><code>POST <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship?partner=bid" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship?partner=bid</a></code></p>
</div>
<div class="paragraph">
<p><strong>Consumes</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Payload</strong></p>
</div>
<div class="paragraph">
<p>Entity with the new value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Relationship objects can be passed by value or by reference. See
<a href="#CHDBDBHJ">"Passing By Value vs. Passing By
Reference"</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>Payload containing the entity with the added element</p>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="remove"><a class="anchor" href="#remove"></a>REMOVE</h4>
<div class="paragraph">
<p>Use this operation to remove a specific entity from the list or a null
on a many-to-one relationship.</p>
</div>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>DELETE /persistence/{version}/{unit-name}/entity/{type}/{id}/{relationship}?{relationshipListItemId}</code></p>
</div>
<div class="paragraph">
<p>where <code>relationshipListItemId</code> is an optional query parameter. The
<code>relationshipListItemId</code> is meaningful only when the <code>{relationship}</code> to
be removed is a list. The <code>relationshipListItemId</code> should be set to the
<code>id</code> of a member in the relationship list when only that member of the
relationship list needs to be removed. The entire list specified by the
<code>{relationship}</code> will be removed when <code>relationshipListItemId</code> is not
specified.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>DELETE <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/entity/Foo/1/myRelationship</a></code></p>
</div>
<div class="paragraph">
<p><strong>Consumes</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Relationship objects can be passed by value or by reference. See
<a href="#CHDBDBHJ">"Passing By Value vs. Passing By
Reference"</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>OK</p>
</li>
<li>
<p>Payload containing the entity with the removed element</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="query-operations"><a class="anchor" href="#query-operations"></a>Query Operations</h3>
<div class="paragraph">
<p>The base URI for query operations is as follows:</p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/query/{name}{params}</code></p>
</div>
<div class="paragraph">
<p>The following query operations are supported:</p>
</div>
<div class="paragraph">
<p>Named queries doing reads can be run two ways in JPA. Both are supported
in the REST API. They are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDBDEBE">Query Returning List of Results</a></p>
</li>
<li>
<p><a href="#CHDIHEJJ">Update/Delete Query</a></p>
</li>
</ul>
</div>
<hr>
<div class="sect3">
<h4 id="query-returning-list-of-results"><a class="anchor" href="#query-returning-list-of-results"></a>Query Returning List of Results</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/query/{name};{parameters}? {hints}</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>`parameters`</em> are specified using HTTP matrix parameters</p>
</li>
<li>
<p><em>`hints`</em> are specified using HTTP query parameters and with the key
being the name of the EclipseLink query hint</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.findByName;name=myname" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.findByName;name=myname</a></code></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.findByName;name=myname?eclipselink.jdbc.max-results=500" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.findByName;name=myname?eclipselink.jdbc.max-results=500</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>A payload containing a list of entities. An XML response contains a
<code>List</code> as a grouping name for a collection of items and <code>item</code> as a
grouping name for each member of a collection returned. JSON responses
use square brackets <code>[]</code> to encapsulate a collection and curly braces
<code>{}</code> to encapsulate each member of a collection. For example:</p>
</div>
<div class="paragraph">
<p><strong>XML Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;List&gt;
   &lt;item&gt;
      &lt;firstName&gt;Miles&lt;/firstName&gt;
      &lt;lastName&gt;Davis&lt;/lastName&gt;
      &lt;manager&gt;
         &lt;firstName&gt;Charlie&lt;/firstName&gt;
         &lt;lastName&gt;Parker&lt;/lastName&gt;
         &lt;gender&gt;Male&lt;/gender&gt;
         &lt;id&gt;26&lt;/id&gt;
      &lt;/manager&gt;
   &lt;/item&gt;
   &lt;item&gt;
      &lt;firstName&gt;Charlie&lt;/firstName&gt;
      &lt;lastName&gt;Parker&lt;/lastName&gt;
      &lt;manager&gt;
         &lt;firstName&gt;Louis&lt;/firstName&gt;
         &lt;lastName&gt;Armstrong&lt;/lastName&gt;
         &lt;gender&gt;Male&lt;/gender&gt;
         &lt;id&gt;27&lt;/id&gt;
      &lt;/manager&gt;
   &lt;/item&gt;
&lt;/List&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>JSON Example</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[
   {
      "firstName": "Miles",
      "lastName": "Davis",
      "manager": {
         "firstName": "Charlie",
         "lastName": "Parker",
         "gender": "Male",
         "id": 26
      }
   },
   {
      "firstName": "Charlie",
      "lastName": "Parker",
      "manager": {
         "firstName": "Louis",
         "lastName": "Armstrong",
         "gender": "Male",
         "id": 27
      }
   }
]</code></pre>
</div>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="updatedelete-query"><a class="anchor" href="#updatedelete-query"></a>Update/Delete Query</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>POST /persistence/{version}/{unit-name}/query/{name};parameters?hints</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>`parameters`</em> are specified using HTTP matrix parameters</p>
</li>
<li>
<p><em>`hints`</em> are specified using HTTP query parameters and with the key
being the name of the EclipseLink query hint</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p><code>POST <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.deleteAllByName;name=myname" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.deleteAllByName;name=myname</a></code></p>
</div>
<div class="paragraph">
<p><code>POST <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.updateName;name=myname?eclipselink.jdbc.max-results=500" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/query/Foo.updateName;name=myname?eclipselink.jdbc.max-results=500</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>A payload containing the number of entities updated or deleted</p>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="single-result-queries"><a class="anchor" href="#single-result-queries"></a>Single Result Queries</h3>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/singleResultQuery/{name};{parameters}?{hints}</code></p>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>`parameters`</em> are specified using HTTP matrix parameters</p>
</li>
<li>
<p><em>`hints`</em> are specified using HTTP query parameters and with the key
being the name of the EclipseLink query hint</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/singleResultQuery/Foo.findByName;name=myname" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/singleResultQuery/Foo.findByName;name=myname</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON, XML, or application/octet-stream</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>A payload containing an entity</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="base-operations"><a class="anchor" href="#base-operations"></a>Base Operations</h3>
<div class="paragraph">
<p>Base operations are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDCCFCI">List Existing Persistence Units</a></p>
</li>
</ul>
</div>
<hr>
<div class="sect3">
<h4 id="list-existing-persistence-units"><a class="anchor" href="#list-existing-persistence-units"></a>List Existing Persistence Units</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0" class="bare">http://localhost:8080/exampleApp/persistence/v1.0</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON or XML</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="paragraph">
<p>A payload containing a list of persistence unit names and links to
metadata about them. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[
   {

      "_link": {
         "href": "http://localhost:8080/exampleApp/persistence/v1.0/employee/metadata",
         "method": "application/json",
         "rel": "employee"
      }
   },
   {
      "_link": {
         "href": "http://localhost:8080/exampleApp/persistence/v1.0/traveler/metadata",
         "method": "application/json",
         "rel": "traveler"
      }
   }
]</code></pre>
</div>
</div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="metadata-operations"><a class="anchor" href="#metadata-operations"></a>Metadata Operations</h3>
<div class="paragraph">
<p>The following metadata operations are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDGHGHB">List Types in a Persistence Unit</a></p>
</li>
<li>
<p><a href="#CHDGEFIJ">List Queries in a Persistence Unit</a></p>
</li>
<li>
<p><a href="#CHDJBAFI">Describe a Specific Entity</a></p>
</li>
</ul>
</div>
<hr>
<div class="sect3">
<h4 id="list-types-in-a-persistence-unit"><a class="anchor" href="#list-types-in-a-persistence-unit"></a>List Types in a Persistence Unit</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/metadata</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/metadata" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/metadata</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OK</code>, with a payload containing a list of types, with links to more
detailed metadata, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
    "persistenceUnitName": "hr",
    "types": [
        {
            "_link": {
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/metadata/entity/Employee",
                "method": "application/json",
                "rel": "Employee"
            }
        },
        {
            "_link": {
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/metadata/entity/PhoneNumber",
                "method": "application/json",
                "rel": "PhoneNumber"
            }
        }
    ]
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>NOT_FOUND</code> if the persistence unit is not found</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="list-queries-in-a-persistence-unit"><a class="anchor" href="#list-queries-in-a-persistence-unit"></a>List Queries in a Persistence Unit</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/metadata/query</code></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/metadata/query" class="bare">http://localhost:8080/exampleApp/persistence/v1.0/ExamplePU/metadata/query</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OK</code> with a payload containing a list of all available queries, for
example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[
    {
        "queryName": "Employee.count",
        "returnTypes": [
            "Long"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.count",
            "rel": "execute"
        },
        "jpql": "SELECT count(e) FROM Employee e"
    },
    {
        "queryName": "EmployeeAddress.getRegion",
        "returnTypes": [
            "String",
            "String",
            "String"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/EmployeeAddress.getRegion",
            "rel": "execute"
        },
        "jpql": "SELECT u.postalCode, u.province, u.street FROM EmployeeAddress u"
    },
    {
        "queryName": "Employee.getPhoneNumbers",
        "returnTypes": [
            "String",
            "String",
            "PhoneNumber"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getPhoneNumbers",
            "rel": "execute"
        },
        "jpql": "SELECT e.firstName, e.lastName, pn FROM Employee e JOIN e.phoneNumbers pn"
    },
    {
        "queryName": "EmployeeAddress.getPicture",
        "returnTypes": [
            "byte[]"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/EmployeeAddress.getPicture;id={id}",
            "rel": "execute"
        },
        "jpql": "SELECT u.areaPicture FROM EmployeeAddress u where u.id = :id"
    },
    {
        "queryName": "EmployeeAddress.updatePostalCode",
        "returnTypes": [
            "EmployeeAddress"
        ],
        "linkTemplate": {
            "method": "post",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/EmployeeAddress.updatePostalCode;postalCode={postalCode};id={id}",
            "rel": "execute"
        },
        "jpql": "UPDATE EmployeeAddress u SET u.postalCode = :postalCode where u.id = :id"
    },
    {
        "queryName": "Employee.salaryMax",
        "returnTypes": [
            "int",
            "Object"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.salaryMax",
            "rel": "execute"
        },
        "jpql": "SELECT e.id, max(e.salary) AS max_salary from Employee e GROUP BY e.id, e.salary"
    },
    {
        "queryName": "EmployeeAddress.getAll",
        "returnTypes": [
            "EmployeeAddress"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/EmployeeAddress.getAll",
            "rel": "execute"
        },
        "jpql": "SELECT u FROM EmployeeAddress u"
    },
    {
        "queryName": "EmployeeAddress.getById",
        "returnTypes": [
            "EmployeeAddress"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/EmployeeAddress.getById;id={id}",
            "rel": "execute"
        },
        "jpql": "SELECT u FROM EmployeeAddress u where u.id = :id"
    },
    {
        "queryName": "Employee.getManagerById",
        "returnTypes": [
            "String",
            "String",
            "Employee"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getManagerById;id={id}",
            "rel": "execute"
        },
        "jpql": "select u.firstName, u.lastName, u.manager from Employee u where u.id = :id"
    },
    {
        "queryName": "Employee.findAll",
        "returnTypes": [
            "Employee"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.findAll",
            "rel": "execute"
        },
        "jpql": "SELECT e FROM Employee e ORDER BY e.id"
    },
    {
        "queryName": "Employee.getManager",
        "returnTypes": [
            "String",
            "String",
            "Employee"
        ],
        "linkTemplate": {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getManager",
            "rel": "execute"
        },
        "jpql": "select u.firstName, u.lastName, u.manager from Employee u"
    }
]</code></pre>
</div>
</div>
</li>
<li>
<p><code>NOT_FOUND</code> if persistence unit is not found</p>
</li>
</ul>
</div>
<hr>
</div>
<div class="sect3">
<h4 id="describe-a-specific-entity"><a class="anchor" href="#describe-a-specific-entity"></a>Describe a Specific Entity</h4>
<div class="paragraph">
<p><strong>HTTP Request Syntax</strong></p>
</div>
<div class="paragraph">
<p><code>GET /persistence/{version}/{unit-name}/metadata/entity/</code> <em>`type`</em></p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>GET <a href="http://localhost:8080/CustomerApp/persistence/v1.0/Inventory/metadata/entity/Customer" class="bare">http://localhost:8080/CustomerApp/persistence/v1.0/Inventory/metadata/entity/Customer</a></code></p>
</div>
<div class="paragraph">
<p><strong>Produces</strong></p>
</div>
<div class="paragraph">
<p>JSON</p>
</div>
<div class="paragraph">
<p><strong>Response</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OK</code>, with a payload containing details about the entity and available
operations on it, for example,</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">{
    "name": "Employee",
    "attributes": [
        {
            "name": "id",
            "type": "int"
        },
        {
            "name": "firstName",
            "type": "String"
        },
        {
            "name": "gender",
            "type": "Gender"
        },
        {
            "name": "lastName",
            "type": "String"
        },
        {
            "name": "salary",
            "type": "double"
        },
        {
            "name": "version",
            "type": "Long"
        },
        {
            "name": "period",
            "type": "EmploymentPeriod"
        },
        {
            "name": "manager",
            "type": "Employee"
        },
        {
            "name": "office",
            "type": "Office"
        },
        {
            "name": "address",
            "type": "EmployeeAddress"
        },
        {
            "name": "certifications",
            "type": "List&lt;Certification&gt;"
        },
        {
            "name": "responsibilities",
            "type": "List&lt;String&gt;"
        },
        {
            "name": "projects",
            "type": "List&lt;Project&gt;"
        },
        {
            "name": "expertiseAreas",
            "type": "List&lt;Expertise&gt;"
        },
        {
            "name": "managedEmployees",
            "type": "List&lt;Employee&gt;"
        },
        {
            "name": "phoneNumbers",
            "type": "List&lt;PhoneNumber&gt;"
        }
    ],
    "linkTemplates": [
        {
            "method": "get",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/entity/Employee/{primaryKey}",
            "rel": "find"
        },
        {
            "method": "put",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/entity/Employee",
            "rel": "persist"
        },
        {
            "method": "post",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/entity/Employee",
            "rel": "update"
        },
        {
            "method": "delete",
            "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/entity/Employee/{primaryKey}",
            "rel": "delete"
        }
    ],
    "queries": [
        {
            "queryName": "Employee.count",
            "returnTypes": [
                "Long"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.count",
                "rel": "execute"
            },
            "jpql": "SELECT count(e) FROM Employee e"
        },
        {
            "queryName": "Employee.getPhoneNumbers",
            "returnTypes": [
                "String",
                "String",
                "PhoneNumber"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getPhoneNumbers",
                "rel": "execute"
            },
            "jpql": "SELECT e.firstName, e.lastName, pn FROM Employee e JOIN e.phoneNumbers pn"
        },
        {
            "queryName": "Employee.salaryMax",
            "returnTypes": [
                "int",
                "Object"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.salaryMax",
                "rel": "execute"
            },
            "jpql": "SELECT e.id, max(e.salary) AS max_salary from Employee e GROUP BY e.id, e.salary"
        },
        {
            "queryName": "Employee.getManagerById",
            "returnTypes": [
                "String",
                "String",
                "Employee"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getManagerById;id={id}",
                "rel": "execute"
            },
            "jpql": "select u.firstName, u.lastName, u.manager from Employee u where u.id = :id"
        },
        {
            "queryName": "Employee.findAll",
            "returnTypes": [
                "Employee"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.findAll",
                "rel": "execute"
            },
            "jpql": "SELECT e FROM Employee e ORDER BY e.id"
        },
        {
            "queryName": "Employee.getManager",
            "returnTypes": [
                "String",
                "String",
                "Employee"
            ],
            "linkTemplate": {
                "method": "get",
                "href": "http://localhost:8080/eclipselink.jpars.test/persistence/v1.0/hr/query/Employee.getManager",
                "rel": "execute"
            },
            "jpql": "select u.firstName, u.lastName, u.manager from Employee u"
        }
    ]
}</code></pre>
</div>
</div>
</li>
<li>
<p><code>NOT_FOUND</code> if the persistence unit is not found</p>
</li>
</ul>
</div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="QCN"><a class="anchor" href="#QCN"></a>20. Using Database Events to Invalidate the Cache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes EclipseLink Database Change Notification (DCN),
which allows you to use caching with a shared database in JPA.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#QCN001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#QCN002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#QCN003">Limitations on the Solution</a></p>
</li>
<li>
<p><a href="#QCN004">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users want to use a shared cache with their JPA application, however,
external applications update the same database data, or the cache is in
a clustered environment. The cache may retain stale data.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink provides an API which allows the database to notify
EclipseLink of database changes. The changed objects can then be
invalidated in the EclipseLink shared cache. Stale data can be
discarded, even if other applications access the same data in the
database.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Oracle 11<em>g</em>R2 (11.2) (or higher) database</p>
</li>
<li>
<p>EclipseLink 2.4 or later.</p>
<div class="ulist">
<ul>
<li>
<p>EclipseLink library: eclipselink.jar</p>
</li>
<li>
<p>JDBC library: <code>ojdbc6.jar</code>.</p>
</li>
<li>
<p>JPA library: <code>persistence.jar</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>For sample files that illustrate the use of Database Change Notification
and shared caching in an application that uses JPA, see
"EclipseLink/Examples/JPA/DCN" in the EclipseLink documentation.</p>
</div>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN</a></code></p>
</div>
<div class="sect2">
<h3 id="QCN001"><a class="anchor" href="#QCN001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink provides a shared (L2) object cache that can reduce database
access for objects and their relationships. This cache is enabled by
default which is normally not a problem, unless the contents of the
database are modified directly by other applications, or by the same
application on other servers in a clustered environment. This may result
in stale data in the cache.</p>
</div>
<div class="paragraph">
<p>If the contents of the database are modified, then a mechanism is needed
to ensure that the contents of the cache are synchronized with the
database. That mechanism is provided by EclipseLink Database Change
Notification. DCN allows shared caching to be used in the JPA
environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Database Change Notification extends the functionality provided by the
Oracle Database Continuous Query Notification feature. For more
information, see "Continuous Query Notification" in <em>Oracle Database
JDBC Developer&#8217;s Guide</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>EclipseLink Database Change Notification extends the functionality
provided by the Oracle Database Continuous Query Notification. One of
the features of Continuous Query Notification is that it allows database
events to be raised when rows in a table are modified.</p>
</div>
<div class="paragraph">
<p>To detect modifications, EclipseLink DCN uses the <code>ROWID</code> to inform of
row level changes in the primary table. EclipseLink includes the <code>ROWID</code>
in all queries for a DCN-enabled class. EclipseLink also selects the
object&#8217;s <code>ROWID</code> after an insert operation. EclipseLink maintains a
cache index on the <code>ROWID</code>, in addition to the object&#8217;s <code>Id</code>.
EclipseLink also selects the database transaction ID once for each
transaction to avoid invalidating the cache on the server that is
processing the transaction.</p>
</div>
<div class="paragraph">
<p>EclipseLink DCN is enabled through the
<code>OracleChangeNotificationListener</code>
(<code>org.eclipse.persistence.platform.database.oracle.dcn.OracleChangeNotificationListener</code>)
listener class. This listener integrates with Oracle JDBC to receive
database change events. To enable the listener, specify the full path to
the <code>OracleChangeNotificationListener</code> class as the value of the
<code>eclipselink.cache.database-event-listener</code> property in the
<code>persistence.xml</code> file.</p>
</div>
<div class="paragraph">
<p>By default, all entities in the domain are registered for change
notification. However, you can selectively disable change notification
for certain classes by tagging them in the Java files with the
<code>databaseChangeNotificationType</code>
(<code>org.eclipse.persistence.annotations.DatabaseChangeNotificationType</code>)
attribute of the <code>Cache</code> annotation. The value of this attribute
determines the type of database change notification an entity should
use. The default value of the <code>databaseChangeNotificationType</code> attribute
is <code>Invalidate</code>. To disable change notification for a class, set the
value of the attribute to <code>None</code>.</p>
</div>
<div class="paragraph">
<p>The <code>databaseChangeNotificationType</code> attribute is relevant only if the
persistence unit has been configured with a database event listener,
such as the <code>OracleChangeNotificationListener</code> class, that receives
database change events. This allows the EclipseLink cache to be
invalidated or updated from database changes.</p>
</div>
<div class="paragraph">
<p>Oracle strongly suggests that you use optimistic locking (writes on
stale data will fail and automatically invalidate the cache) in your
transactions. If you include an <code>@Version</code> annotation in your entity,
then the version column in the primary table will always be updated, and
the object will always be invalidated.</p>
</div>
</div>
<div class="sect2">
<h3 id="QCN002"><a class="anchor" href="#QCN002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section contains the following tasks to enable shared caching in a
JPA environment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDBAJED">Task 1: Set up the Database and Tables</a></p>
</li>
<li>
<p><a href="#CHDDJAIE">Task 2: Grant User Permissions</a></p>
</li>
<li>
<p><a href="#CHDFIGGJ">Task 3: Set the Classpath</a></p>
</li>
<li>
<p><a href="#CHDJCFDD">Task 4: Identify Classes that will Participate in Change Notification</a></p>
</li>
<li>
<p><a href="#CHDBCIIE">Task 5: Add the Database Event Listener</a></p>
</li>
<li>
<p><a href="#CHDIIICG">Task 6: Edit the Java Files</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDBAJED"><a class="anchor" href="#CHDBAJED"></a>Task 1: Set up the Database and Tables</h4>
<div class="paragraph">
<p>The solution presumes that you are working with an Oracle 11gR2 (11.2)
or higher database that contains the tables that you are interested in.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDDJAIE"><a class="anchor" href="#CHDDJAIE"></a>Task 2: Grant User Permissions</h4>
<div class="paragraph">
<p>Among other permissions, the database user must be granted the <code>CHANGE</code>
<code>NOTIFICATION</code> privilege. To do this, you must have a DBA privilege,
such as <code>SYS</code>, or have your database administrator apply it:</p>
</div>
<div class="paragraph">
<p><code>grant change notification to</code> <em>`user`</em></p>
</div>
<div class="paragraph">
<p>The following example illustrates granting the change notification
privilege to user <code>SCOTT</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
define user="SCOTT"
define pass="tiger"
grant create session, alter session to &amp;&amp;user
/
grant resource, connect to &amp;&amp;user
/
grant select any dictionary to &amp;&amp;user
/
grant select any table to &amp;&amp;user
/
grant change notification to &amp;&amp;user
/
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDFIGGJ"><a class="anchor" href="#CHDFIGGJ"></a>Task 3: Set the Classpath</h4>
<div class="paragraph">
<p>Ensure that the <code>eclipselink.jar</code> EclipseLink library, the <code>ojdbc6.jar</code>
JDBC library, the <code>persistence.jar</code> JPA library, and the domain classes
are present on the classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDJCFDD"><a class="anchor" href="#CHDJCFDD"></a>Task 4: Identify Classes that will Participate in Change Notification</h4>
<div class="paragraph">
<p>By default, all entities in the domain will participate in change
notification. There are several different ways to limit the entities
that will participate. For example, the entity classes can be indicated
by the <code>&lt;entity class &#8230;&#8203;&gt;</code> element in the <code>orm.xml</code> file, indicated
with the <code>&lt;exclude-unlisted-classes&gt;</code> element in the <code>persistence.xml</code>
file, or contained in a JAR file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>&lt;exclude-unlisted-classes&gt;</code> element is not intended for use in the
Java SE environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Entity classes can also be excluded by using a <code>Cache</code> annotation
attribute in the Java files. For more information, see
<a href="#CHDGBGAG">Exclude Classes from Change Notification (Optional).</a></p>
</div>
<div class="paragraph">
<p>Another way to identify the entity classes is to use the <code>&lt;class&gt;</code>
element in the <code>persistence.xml</code> file. The following example indicates
that the <code>Order</code>, <code>OrderLine</code>, and <code>Customer</code> classes in the <code>model</code>
package will participate in change notification. For an example of a
complete <code>persistence.xml</code> file, see <a href="#CHDECAAF">Example 20-1</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
&lt;class&gt;model.Order&lt;/class&gt;
&lt;class&gt;model.OrderLine&lt;/class&gt;
&lt;class&gt;model.Customer&lt;/class&gt;
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDBCIIE"><a class="anchor" href="#CHDBCIIE"></a>Task 5: Add the Database Event Listener</h4>
<div class="paragraph">
<p>Use the <code>eclipselink.cache.database-event-listener</code> property to identify
the database event listener. The
<code>org.eclipse.persistence.platform.database.oracle.dcn.OracleChangeNotificationListener</code>
class is the listener for EclipseLink Database Change Notification. This
allows the EclipseLink cache to be invalidated by database events.</p>
</div>
<div class="paragraph">
<p>The following example illustrates the
<code>eclipselink.cache.database-event-listener</code> property configured with the
<code>OracleChangeNotificationListener</code> class. For an example of a complete
<code>persistence.xml</code> file, see <a href="#CHDECAAF">Example 20-1</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
   &lt;properties&gt;
      &lt;property name="eclipselink.cache.database-event-listener" value="org.eclipse.persistence.platform.database.oracle.dcn.OracleChangeNotificationListener"/&gt;
   &lt;/properties&gt;
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;property name="eclipselink.cache.database-event-listener" value="DCN"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#CHDECAAF">Example 20-1</a> illustrates an example of a complete
<code>persistence.xml</code> file. The classes that will participate in change
notification are the <code>Order</code>, <code>OrderLine</code>, and <code>Customer</code> classes from
the <code>model</code> package. The <code>eclipselink.cache.database-event-listener</code>
property is set to the full path of the
<code>OracleChangeNotificationListener</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>&lt;provider&gt;</code> tag is optional if running in a container where
EclipseLink is the default provider.
</td>
</tr>
</table>
</div>
<div id="CHDECAAF" class="paragraph">
<p><strong><em>Example 20-1 Sample persistence.xml File</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
                xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_2_0.xsd"
                version="2.0"&gt;
    &lt;persistence-unit name="acme" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
        &lt;class&gt;model.Order&lt;/class&gt;
        &lt;class&gt;model.OrderLine&lt;/class&gt;
        &lt;class&gt;model.Customer&lt;/class&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
        &lt;properties&gt;
            &lt;property name="eclipselink.cache.database-event-listener" value="DCN"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDIIICG"><a class="anchor" href="#CHDIIICG"></a>Task 6: Edit the Java Files</h4>
<div class="paragraph">
<p>Typically, to participate in change notification, no changes are needed
to the Java classes which correspond to database tables. However,
setting optimistic locking with the <code>@Version</code> annotation is strongly
suggested.</p>
</div>
<div class="paragraph">
<p>If you want to exclude classes that are listed in the persistence unit,
you can tag them in the Java files. EclipseLink tracks changes only to
the primary table. If you want changes to secondary tables to also be
tracked, you can indicate this in the Java files.</p>
</div>
<div class="sect4">
<h5 id="set-optimistic-locking"><a class="anchor" href="#set-optimistic-locking"></a>Set Optimistic Locking</h5>
<div class="paragraph">
<p>Oracle strongly suggests that you use optimistic locking: writes on
stale data will fail and automatically invalidate the cache. Include an
<code>@Version</code> annotation in your entity; the version column in the primary
table will always be updated, and the older version of the object will
always be invalidated.</p>
</div>
<div class="paragraph">
<p>In <a href="#CHDJGCBF">Example 20-2</a> the <code>@Version</code> annotation is defined for
the entity <code>Customer</code>. Note that getters and setters are defined for the
<code>version</code> variable.</p>
</div>
<div id="CHDJGCBF" class="paragraph">
<p><strong><em>Example 20-2 Defining the @Version Annotation</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
@Entity
@Table(name="DBE_CUSTOMER")
public class Customer implements Serializable {
    @Id
    @GeneratedValue(generator="CUST_SEQ")
    @TableGenerator(name="CUST_SEQ")
    @Column(name="CUST_NUMBER")
    private long id;

 @Version
    private long version;

 ...
    public long getVersion() {
        return version;
    }

    public void setVersion(long version) {
        this.version = version;
    }
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDGBGAG"><a class="anchor" href="#CHDGBGAG"></a>Exclude Classes from Change Notification (Optional)</h5>
<div class="paragraph">
<p>Use the <code>databaseChangeNotificationType</code> attribute of the <code>Cache</code>
annotation to identify the classes for which you do not want change
notifications. To exclude a class from change notification, set the
attribute to <code>DatabaseChangeNotificationType.NONE</code>, as illustrated in
the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
@Entity
@Cache(databaseChangeNotificationType=DatabaseChangeNotificationType.NONE)
public class Order {
...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="track-changes-in-secondary-tables-optional"><a class="anchor" href="#track-changes-in-secondary-tables-optional"></a>Track Changes in Secondary Tables (Optional)</h5>
<div class="paragraph">
<p>EclipseLink tracks changes only to the primary table. If any updates
occur in a secondary table, EclipseLink will not invalidate the object.
If you want changes to secondary tables to be tracked as well, add the
<code>@Version</code> annotation to the entity.</p>
</div>
<div class="paragraph">
<p>Oracle DCN listens only for events from the primary table. It does not
track changes in secondary tables, or relationships tables. The reason
for this is that Oracle DCN only tracks the <code>ROWID</code>, so there is no
correlation from the <code>ROWID</code> of the primary, secondary and relationship
tables. Thus, to receive events when a secondary or relationship table
changes, the version in the primary table must change so that the event
is returned.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="QCN003"><a class="anchor" href="#QCN003"></a>Limitations on the Solution</h3>
<div class="paragraph">
<p>EclipseLink Database Change Notification has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changes to an object&#8217;s secondary tables will not trigger it to be
invalidate unless a <code>@Version</code> annotation is used and updated in the
primary table.</p>
</li>
<li>
<p>Changes to an object&#8217;s <code>OneToMany</code>, <code>ManyToMany</code>, and
<code>ElementCollection</code> relationships will not trigger it to be invalidate,
unless an <code>@Version</code> annotation is used and updated in the primary
table.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="QCN004"><a class="anchor" href="#QCN004"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Continuous Query Notification" in <em>Oracle Database JDBC Developer&#8217;s
Guide</em>.</p>
</li>
<li>
<p>"EclipseLink/Examples/JPA/DCN"—This page describes an example of cache
sharing in a JPA environment that employs DCN. Sample files and
instructions for running the example are included. See the EclipseLink
documentation:</p>
<div class="paragraph">
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/DCN</a></code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="NOSQL"><a class="anchor" href="#NOSQL"></a>21. Using EclipseLink with NoSQL Databases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes how Oracle TopLink supports the ability to map
objects to NoSQL database systems such as internet databases, object
databases, XML databases, and even legacy databases.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#NOSQL001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#NOSQL002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#NOSQL003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>Users need to use EclipseLink with NoSQL data sources.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink provides support for multiple NoSQL data sources. This
solution illustrates using Oracle NoSQL and MongoDB.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later</p>
</li>
<li>
<p>NoSQL datasource.</p>
</li>
<li>
<p>JCA Adapter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sample</strong></p>
</div>
<div class="paragraph">
<p>See the following EclipseLink samples for related information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="http://wiki.eclipse.org/EclipseLink/Examples/JPA/NoSQL" class="bare">http://wiki.eclipse.org/EclipseLink/Examples/JPA/NoSQL</a></code></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="NOSQL001"><a class="anchor" href="#NOSQL001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink supports access to NoSQL data through the JavaEE Connector
Architecture. You must use a JCA adapter (provided by EclipseLink, a
third party, or custom built).</p>
</div>
<div class="paragraph">
<p>Most NoSQL data is hierarchical in form so using embeddable objects is
common. Some NoSQL adaptors support XML data, so NoSQL mapped objects
can use XML mappings when mapping to XML.</p>
</div>
</div>
<div class="sect2">
<h3 id="NOSQL002"><a class="anchor" href="#NOSQL002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>This section contains the following tasks for converting objects to and
from JSON documents.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#BABEBADB">Task 1: Prerequisites</a></p>
</li>
<li>
<p><a href="#BABIGCEC">Task 2: Mapping the Data</a></p>
</li>
<li>
<p><a href="#BABEIBBG">Task 3: Defining IDs</a></p>
</li>
<li>
<p><a href="#BABFIIFG">Task 4: Defining Mappings</a></p>
</li>
<li>
<p><a href="#BABFIJAA">Task 5: Using Locking</a></p>
</li>
<li>
<p><a href="#BABIIDED">Task 6: Defining Queries</a></p>
</li>
<li>
<p><a href="#BABFJIJE">Task 7: Connecting to the Database</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="BABEBADB"><a class="anchor" href="#BABEBADB"></a>Task 1: Prerequisites</h4>

</div>
<div class="sect3">
<h4 id="BABIGCEC"><a class="anchor" href="#BABIGCEC"></a>Task 2: Mapping the Data</h4>
<div class="paragraph">
<p>You can configure mappings to NoSQL data with the EclipseLink <code>@NoSQL</code>
annotation and <code>&lt;no-sql&gt;</code> XML element. The <code>@NoSQL</code> annotation defines
the class as mapping to non-relational data. You can use <code>@NoSQL</code> with
JPA Entity or Embeddable classes.</p>
</div>
<div class="paragraph">
<p>The <code>@NoSQL</code> annotation allows you to specify the <code>dataType</code> and
<code>dataFormat</code> of the data. The <code>dataType</code> will vary, depending on your
NoSQL datasource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For MongoDB, <code>dataType</code> is the collection name that the JSON documents
are stored to.</p>
</li>
<li>
<p>For Oracle NoSQL, <code>dataType</code> is the first part of the major key value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>dataFormat</code> depends on the type structure (data format) of data
being stored.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For MongoDB, use <code>MAPPED</code> for its structured database.</p>
</li>
<li>
<p>For Oracle NoSQL, use <code>MAPPED</code> (for key/value data) or <code>XML</code> (for a
single XML document).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#BABBBHHD">Example 21-1</a> illustrates how to use <code>@NoSQL</code> with
<code>@Entity</code> and <code>@Embeddable</code> classes.</p>
</div>
<div id="BABBBHHD" class="paragraph">
<p><strong><em>Example 21-1 Using @NoSql Annotation with JSON</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Entity
@NoSQL(dataType="orders", dataFormat=DataFormatType.MAPPED)
public class Order {
  @Id
  @GeneratedValue
  @Field(name="_id")
  private long id;
  @Basic
  @Field(name="description")
  private String description;
  @Embedded
  @Field(name="deliveryAddress")
  private Address deliveryAddress
  @ElementCollection
  @Field(name="orderLines")
  private List&lt;OrderLine&gt; orderLines;
  @ManyToOne
  @JoinField(name="customerId")
  private Customer customer;
}

@Embeddable
@NoSQL(dataFormat=DataFormatType.MAPPED)
public class OrderLine {
    @Field(name="lineNumber")
    private int lineNumber;
    @Field(name="itemName")
    private String itemName;
    @Field(name="quantity")
    private int quantity;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABEIBBG"><a class="anchor" href="#BABEIBBG"></a>Task 3: Defining IDs</h4>
<div class="paragraph">
<p>With EclipseLink, you can use any field (or set of fields) as your ID
when using a non-relational database, just like any other relational
Entity. You can use a <em>natural</em> ID (that is, assigned by the
application) or a <em>generated</em> ID (that is, assigned by EclipseLink).</p>
</div>
<div class="paragraph">
<p>MongoDB also requires an <code>_id</code> field in every document. If no <code>_id</code>
field is present, Mongo will automatically generate and assign the <code>_id</code>
field using an OID (object identifier), which is similar to a UUID
(universally unique identifier).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To use a natural ID as the Mongo ID, simply name the field as <code>_id</code> by
using the <code>@Field</code> (or <code>@Column</code>) annotation without any of the
relational details.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Field(name="_id")
private long id;</code></pre>
</div>
</div>
</li>
<li>
<p>To use the generated Mongo OID as your ID, simply include <code>@Id</code>,
<code>@GeneratedValue</code>, and <code>@Field(name="_id")</code> annotations in the object&#8217;s
ID field mapping.</p>
<div class="paragraph">
<p>The <code>@GeneratedValue</code> tells EclipseLink to use the Mongo OID to generate
this ID value. To use a UUID instead of the Mongo OID, use the
@UUIDGenerator annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MongoDB does not support <code>@SequenceGenerator</code> or <code>@TableGenerator</code> nor
the <code>IDENTITY</code>, <code>TABLE</code>, and <code>SEQUENCE</code> generation types.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ID of the Mongo OID or UUID is not a numerical value; you must map
it as a <code>String</code> or <code>byte[]</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Id
@GeneratedValue
@Field(name="_id")
private String id;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABFIIFG"><a class="anchor" href="#BABFIIFG"></a>Task 4: Defining Mappings</h4>
<div class="paragraph">
<p>With non-relational databases, EclipseLink maps objects to structured
data such as XML or JSON. NoSQL supports all existing JPA mapping
annotations and XML, including embedded data and embedded collections.
If you do not define a mapping annotation (or XML) for an attribute
EclipseLink uses the default mapping.</p>
</div>
<div class="paragraph">
<p><strong>Basic Mappings</strong></p>
</div>
<div class="paragraph">
<p>Because the NoSQL defaults follow the JPA defaults, most simple mappings
do not require any configuration. Field names used in the Mongo BSON
document will mirror the object attribute names (in uppercase). To use a
different BSON field name, use the <code>@Field</code> annotation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not use <code>@Column</code> or <code>@JoinColumn</code>. Instead use <code>@Field</code> and
<code>@JoinField</code>. Additionally, the <code>@JoinTable</code> and <code>@CollectionTable</code>
annotations are not supported or required.
</td>
</tr>
</table>
</div>
<div id="BABIFJJG" class="paragraph">
<p><strong>Embedded Values</strong></p>
</div>
<div class="paragraph">
<p>Use the <code>@Embedded</code> annotation to persist embedded values and the
<code>@ElementCollection</code> annotation for embedded collections. Because all
data is stored in the XML document, no separate table (that is,
<code>@CollectionTable</code>) is needed. Additionally, because embedded objects
are nested in the document and do not require unique field names, the
<code>@AttributeOverride</code> attribute is not needed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Normally, you will not need to use the <code>@Embedded</code> annotation, since it
will default correctly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However, EclipseLink does not default <code>@ElementCollection</code> mappings,
therefore you must include that annotation.</p>
</div>
<div class="paragraph">
<p><strong>Relationships</strong></p>
</div>
<div class="paragraph">
<p>You should use the relationship annotations (such as <code>@OneToOne</code>,
<code>@ManyToOne</code>, <code>@OneToMany</code> and <code>@ManyToMany</code>) only with <em>external</em>
relationships. Relationships <em>within</em> the document should use the
<a href="#BABIFJJG">Embedded Values</a>.</p>
</div>
<div class="paragraph">
<p>EclipseLink fully supports external relationships to other documents by
using a foreign key. The ID of the target object is stored in the source
object&#8217;s document. For a collection, a collection of IDs is stored. Use
the <code>@JoinField</code> annotation to define the name of the foreign key field
in the BSON document.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
EclipseLink does not support the <code>mappedBy</code> option for relationships
with non-relational databases, as the foreign keys would need to be
stored on both sides.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also define a relationship mapping by using a query. However you
must use a <code>DescriptorCustomizer</code> instead of an annotation.</p>
</div>
<div id="sthref229" class="paragraph">
<p><strong><em>Example 21-2 Sample Mappings</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Basic
private String description;
@Basic
private double totalCost = 0;
@Embedded
private Address billingAddress;
@Embedded
private Address shippingAddress;
@ElementCollection
private List&lt;OrderLine&gt; orderLines = new ArrayList&lt;OrderLine&gt;();
@ManyToOne(fetch=FetchType.LAZY)
private Customer customer;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABFIJAA"><a class="anchor" href="#BABFIJAA"></a>Task 5: Using Locking</h4>
<div class="paragraph">
<p>Locking support is dependent on the NoSQL platform. Some NoSQL platforms
may offer support for optimistic version locking.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Oracle NoSQL – Locking is not supported.</p>
</li>
<li>
<p>MongoDB – Version locking is supported.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MongoDB does not support transactions. If a lock error occurs during a
transaction, any objects that have been previously written will not be
rolled back.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the NoSQL platform does not support locking, you can use the
<code>@Version</code> annotation (as shown in <a href="#BABFACAI">Example 21-3</a>) to
validate objects on <code>merge()</code> operations.</p>
</div>
<div id="BABFACAI" class="paragraph">
<p><strong><em>Example 21-3 Using @Version</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Version
private long version;
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABIIDED"><a class="anchor" href="#BABIIDED"></a>Task 6: Defining Queries</h4>
<div class="paragraph">
<p>Querying in NoSQL is dependent on the NoSQL platform. Some NoSQL
data-sources may support dynamic querying through their own query
language, others may not support querying at all.</p>
</div>
<div class="sect4">
<h5 id="jpql-queries"><a class="anchor" href="#jpql-queries"></a>JPQL Queries</h5>
<div class="paragraph">
<p>The Java Persistence Query Language (JPQL) is the query language defined
by JPA. JPQL can be used for reading (<code>SELECT</code>), as well as bulk updates
(<code>UPDATE</code>) and deletes (<code>DELETE</code>). You can use JPQL in a <code>NamedQuery</code>
(through annotations or XML) or in dynamic queries using the
EntityManager <code>createQuery()</code> API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Oracle NoSQL – Supports <code>find()</code> and JPQL and Criteria by Id or with
no WHERE clause.</p>
</li>
<li>
<p>MongoDB – Supports JPQL and Criteria queries, with some restrictions:
joins, sub-selects, group by and certain database functions are not
supported.</p>
</li>
</ul>
</div>
<div id="sthref231" class="paragraph">
<p><strong><em>Example 21-4 Oracle NoSQL JPQL Examples</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"></code></pre>
</div>
</div>
<div id="sthref232" class="paragraph">
<p><strong><em>Example 21-5 MongoDB JPQL Examples</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("Select o from Order o where o.totalCost &gt; 1000");
List&lt;Order&gt; orders = query.getResultList();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("Select o from Order o where o.description like 'Pinball%'");
List&lt;Order&gt; orders = query.getResultList();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("Select o from Order o join o.orderLines l where l.description = :desc");
query.setParameter("desc", "shipping");
List&lt;Order&gt; orders = query.getResultList();</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createQuery("Select o.totalCost from Order o");
List&lt;BigDecimal&gt; orders = query.getResultList();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="native-queries"><a class="anchor" href="#native-queries"></a>Native Queries</h5>
<div class="paragraph">
<p>Native SQL queries are not translated, and passed directly to the
database. SQL queries can be used for advanced queries that require
database specific syntax.</p>
</div>
<div class="paragraph">
<p>Although native SQL queries are not supported with NoSQL, some NoSQL
platforms have their own, native query language. EclipseLink supports
JPA native queries using that language.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MongoDB – Supports JPA native queries by using the MongoDB native
command language.</p>
</li>
</ul>
</div>
<div id="sthref234" class="paragraph">
<p><strong><em>Example 21-6 Oracle NoSQL Native Query</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"></code></pre>
</div>
</div>
<div id="sthref235" class="paragraph">
<p><strong><em>Example 21-7 MongoDB Native Query</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = em.createNativeQuery("db.ORDER.findOne({\"_id\":\"" + oid + "\"})", Order.class);
Order order = (Order)query.getSingleResult();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="BABFJIJE"><a class="anchor" href="#BABFJIJE"></a>Task 7: Connecting to the Database</h4>
<div class="paragraph">
<p>EclipseLink connects to NoSQL databases through the persistence.xml
file. Use the <code>&lt;eclipselink.target-database&gt;</code> property to define the
specific NoSQL platform. You must also define a connection with the
<code>&lt;eclipselink.nosql.connection-spec&gt;</code> property. Additional connection
values (such as the <code>db</code>, <code>port</code>, and <code>host</code> can also be defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To connect to a cluster of Mongo databases, enter a comma, separated
list of values for the <code>host</code> and <code>port</code>.
</td>
</tr>
</table>
</div>
<div id="sthref236" class="paragraph">
<p><strong><em>Example 21-8 Oracle NoSQL persistence.xml Example</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn"></code></pre>
</div>
</div>
<div id="sthref237" class="paragraph">
<p><strong><em>Example 21-9 MongoDB persistence.xml Example</em></strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/persistence persistence_2_0.xsd" version="2.0"&gt;
    &lt;persistence-unit name="acme" transaction-type="RESOURCE_LOCAL"&gt;
        &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
        &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
        &lt;properties&gt;
            &lt;property name="eclipselink.target-database" value="org.eclipse.persistence.nosql.adapters.mongo.MongoPlatform"/&gt;
            &lt;property name="eclipselink.nosql.connection-spec" value="org.eclipse.persistence.nosql.adapters.mongo.MongoConnectionSpec"/&gt;
            &lt;property name="eclipselink.nosql.property.mongo.port" value="27017, 27017"/&gt;
            &lt;property name="eclipselink.nosql.property.mongo.host" value="host1, host2"/&gt;
            &lt;property name="eclipselink.nosql.property.mongo.db" value="acme"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="NOSQL003"><a class="anchor" href="#NOSQL003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following resources for more information about the technologies
and tools used to implement the solutions in this chapter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Developing JAXB Applications Using EclipseLink MOXy</em></p>
</li>
<li>
<p><em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em></p>
</li>
<li>
<p>EclipseLink Extensions Incubator:
<code><a href="http://wiki.eclipse.org/EclipseLink/Development/Incubator/Platform" class="bare">http://wiki.eclipse.org/EclipseLink/Development/Incubator/Platform</a></code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ORACLEDB"><a class="anchor" href="#ORACLEDB"></a>22. Using EclipseLink with the Oracle Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides instructions for understanding and
usingEclipseLink features that are designed specifically to support the
Oracle Database platform.</p>
</div>
<div class="paragraph">
<p>This chapter includes the following sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#ORACLEDB001">Introduction to the Solution</a></p>
</li>
<li>
<p><a href="#ORACLEDB002">Implementing the Solution</a></p>
</li>
<li>
<p><a href="#ORACLEDB003">Additional Resources</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Use Case</strong></p>
</div>
<div class="paragraph">
<p>EclipseLink offers a persistence solution that is designed to work with
any database. However, applications that plan to use the Oracle Database
platform can take advantage of enhanced support for the Oracle Database.</p>
</div>
<div class="paragraph">
<p><strong>Solution</strong></p>
</div>
<div class="paragraph">
<p>The solution is achieved by using various EclipseLink APIs and Oracle
products. Applications choose to implement different EclipseLink APIs
based on the Oracle Database feature or products being used.</p>
</div>
<div class="paragraph">
<p><strong>Components</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EclipseLink 2.4 or later.</p>
</li>
<li>
<p>Oracle Database</p>
</li>
<li>
<p>Additional Oracle Database and Middleware products are required
depending on the features that an application chooses to use.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="ORACLEDB001"><a class="anchor" href="#ORACLEDB001"></a>Introduction to the Solution</h3>
<div class="paragraph">
<p>EclipseLink includes enhanced support for the Oracle Database platform.
Applications that have standardized on the Oracle Database can take
advantage of this support to gain ease-of-use, increase performance and
scalability, and enhance security. EclipseLink includes support for
native Oracle JDBC-specific APIs, PL/SQL, Oracle Real Application
Clusters (RAC), Oracle Virtual Private Database, Oracle Proxy
Authentication, and Oracle Spatial and Graph. Refer to the Oracle
Database documentation for details on these technologies.</p>
</div>
<div class="paragraph">
<p>Much of the Oracle Database platform support is contained in the
<code>org.eclipse.persistence.platform.database.oracle*</code> package. For details
on the APIs, see <em>Java API Reference for EclipseLink</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ORACLEDB002"><a class="anchor" href="#ORACLEDB002"></a>Implementing the Solution</h3>
<div class="paragraph">
<p>The solution in this section is organized according to technology. The
organization allows developers to easily understand the different parts
of the solution and choose specific parts to implement.</p>
</div>
<div class="paragraph">
<p>This section includes the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDIBDGJ">Using Oracle Platform-Specific APIs</a></p>
</li>
<li>
<p><a href="#CHDDCIEC">Using Oracle PL/SQL With EclipseLink</a></p>
</li>
<li>
<p><a href="#CHDEFIBH">Using Oracle Virtual Private Database</a></p>
</li>
<li>
<p><a href="#CHDGDDJF">Using Oracle Proxy Authentication</a></p>
</li>
<li>
<p><a href="#CHDIEBBB">Using EclipseLink with Oracle RAC</a></p>
</li>
<li>
<p><a href="#CHDJBFIJ">Using Oracle Spatial and Graph</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="CHDIBDGJ"><a class="anchor" href="#CHDIBDGJ"></a>Using Oracle Platform-Specific APIs</h4>
<div class="paragraph">
<p>Oracle Database platform support is provided in the
<code>org.eclipse.persistence.platform.database.OraclePlatform</code> class, the
<code>org.eclipse.persistence.platform.database.oracle*</code> packages, and the
<code>org.eclipse.persistence.mappings.xdb</code> package for Oracle XML Database
support. For details on the API, see <em>Java API Reference for
EclipseLink</em>. For details on specific Oracle SQL types, see <em>Oracle
Database JDBC Java API Reference</em>.</p>
</div>
<div class="paragraph">
<p>The following support is provided for the Oracle Database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Batch writing with optimistic locking</p>
</li>
<li>
<p>Native SQL for <code>byte[]</code>, <code>Date</code>, <code>Time</code>, <code>Timestamp</code> and <code>Calendar</code></p>
</li>
<li>
<p>Support for <code>BLOB</code> and <code>CLOB</code> database types using Oracle JDBC
specific <code>LOBLocator</code> for large values</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For non-Oracle thin JDBC drivers or applications environments where the
thin driver is wrapped, it is possible to turn off <code>LOBLocator</code> usage
using <code>setShouldUseLocatorForLOBWrite(boolean)</code> on the platform
instance.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Native support for outer join syntax <code>(+) =</code></p>
</li>
<li>
<p>Native Sequencing (<code>SELECT SEQ_NAME.NEXTVAL FROM DUAL</code>)</p>
</li>
<li>
<p>Native SQL/ROWNUM support for <code>MaxRows</code> and <code>FirstResult</code> filtering.</p>
</li>
<li>
<p>Hierarchical selects (connect by prior)</p>
</li>
<li>
<p>Returning clause</p>
</li>
<li>
<p>Custom expression functions (<code>REGEXP_LIKE</code>, <code>LOCATE</code>, <code>ATAN2</code>, <code>LOG</code>,
<code>CONCAT</code>, <code>SYSDATE</code> (Date, Time, Today), <code>EXCEPT</code>)</p>
</li>
<li>
<p>PLSQL data types, stored functions, stored procedure syntax for
invoking and parameter passing, output parameters and output cursors.
See <a href="#CHDDCIEC">Using Oracle PL/SQL With EclipseLink.</a></p>
</li>
<li>
<p>Timestamp query for use in optimistic locking using <code>SYSDATE</code> and
<code>SYSTIMESTAMP</code></p>
</li>
<li>
<p>Multi-byte support of <code>NCHAR</code>, <code>NSTRING</code>, and <code>NCLOB</code></p>
</li>
<li>
<p>Support of <code>TIMESTAMP</code>, <code>TIMESTAMPTZ</code>, and <code>TIMESTAMPLTZ</code></p>
</li>
<li>
<p>Oracle XML Database support of <code>XMLType</code> field and custom XSQL
functions (<code>extract</code>, <code>extractValue</code>, <code>existsNode</code>, <code>isFragment</code>,
<code>getStringVal</code>, and <code>getNumberVal</code>)</p>
</li>
<li>
<p>XDK XML parser</p>
</li>
<li>
<p>Flashback Querying in Historical Sessions</p>
</li>
<li>
<p>Object-relational Mappings (ReferenceMapping, StructureMapping,
NestedTableMapping, ArrayMapping, ObjectArrayMapping)</p>
</li>
<li>
<p>Oracle AQ</p>
</li>
<li>
<p>Oracle Real Application Clusters. See <a href="#CHDIEBBB">Using EclipseLink
with Oracle RAC.</a></p>
</li>
<li>
<p>Virtual Private Database (VPD), including Oracle Label Security.
<a href="#CHDEFIBH">Using Oracle Virtual Private Database.</a></p>
</li>
<li>
<p>Proxy Authentication. See <a href="#CHDGDDJF">Using Oracle Proxy
Authentication.</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="CHDDCIEC"><a class="anchor" href="#CHDDCIEC"></a>Using Oracle PL/SQL With EclipseLink</h4>
<div class="paragraph">
<p>EclipseLink includes APIs for use with Oracle PL/SQL. The APIs are
located in the <code>org.eclipse.persistence.platform.database.oracle.plsql</code>
package and the
<code>org.eclipse.persistence.platform.database.oracle.annotations</code> package.</p>
</div>
<div class="paragraph">
<p>This Section contains the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDBBJIG">Executing an Oracle PL/SQL Stored Function</a></p>
</li>
<li>
<p><a href="#CHDDJJBI">Handling PL/SQL arguments for Oracle Stored Procedures</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="CHDBBJIG"><a class="anchor" href="#CHDBBJIG"></a>Executing an Oracle PL/SQL Stored Function</h5>
<div class="paragraph">
<p>Oracle PL/SQL stored functions can be used to return complex PL/SQL
data-types such as <code>RECORD</code> types and <code>TABLE</code> types. PL/SQL types are
not supported by Oracle JDBC, so these types must be translated to
Oracle <code>OBJECT</code> types and <code>VARRAY</code> types. <code>OBJECT</code> types are returned as
<code>java.sql.Struct</code> and <code>VARRAY</code> as <code>java.sql.Array</code> types in JDBC.</p>
</div>
<div class="paragraph">
<p>Executing PL/SQL stored functions or procedures requires defining mirror
<code>OBJECT</code> and <code>VARRAY</code> types for the <code>RECORD</code> and <code>TABLE</code> types. <code>OBJECT</code>
types can be mapped to classes annotated with either <code>@Entity</code> or
<code>@Embeddable</code> using the <code>@Struct</code> annotation. Typically, classes
annotated with <code>@Embeddable</code> are used, unless the <code>OBJECT</code> type defines
an <code>Id</code> and can be stored in a table. Nested <code>OBJECT</code> and <code>VARRAY</code> types
are mapped using the <code>@Structure</code> and <code>@Array</code> annotations.</p>
</div>
<div class="paragraph">
<p>Use the <code>PLSQLStoredFunctionCall</code> class or the
<code>@NamedPLSQLStoredFunctionQuery</code> annotation to call a stored function
using PL/SQL types. The <code>PLSQLStoredProcedureCall</code> class and the
<code>@NamedPLSQLStoredProcedureQuery</code> annotation also exist for stored
procedures. Use the <code>StoredFunctionCall</code> class, the
<code>@NamedStoredFunctionQuery</code> annotation, the <code>StoredProcedureCall</code> class,
and the <code>@NamedStoredProcedureQuery</code> annotation for stored functions and
procedure that do not return complex PL/SQL types.</p>
</div>
<div class="sect5">
<h6 id="main-tasks-3"><a class="anchor" href="#main-tasks-3"></a>Main Tasks</h6>
<div class="paragraph">
<p>To execute an Oracle PL/SQL stored function:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#CHDJBJEF">Task 1: Create an Oracle Stored Function That Returns a
PL/SQL Record Type</a></p>
</li>
<li>
<p><a href="#CHDIGHDG">Task 2: Define an Object Type Mirror</a></p>
</li>
<li>
<p><a href="#CHDEIABJ">Task 3: Define a Java Class Mapping The OBJECT Type</a></p>
</li>
<li>
<p><a href="#CHDFACEG">Task 4: Execute a PL/SQL Stored Function Using
JpaEntityManager</a></p>
</li>
<li>
<p><a href="#CHDHDIAF">Task 5: Define a Stored Function Using
@NamedPLSQLStoredFunctionQuery</a></p>
</li>
<li>
<p><a href="#CHDHEIFJ">Task 6: Use the Stored Function in a Query</a></p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="CHDJBJEF"><a class="anchor" href="#CHDJBJEF"></a>Task 1: Create an Oracle Stored Function That Returns a PL/SQL Record Type</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">CREATE OR REPLACE PACKAGE EMP_PKG AS
TYPE EMP_REC IS RECORD (F_NAME VARCHAR2(30), L_NAME VARCHAR2(30),
   SALARY NUMBER(10,2));
FUNCTION GET_EMP RETURN EMP_REC;
END EMP_PKG;

CREATE OR REPLACE PACKAGE BODY EMP_PKG AS
FUNCTION GET_EMP RETURN EMP_REC AS
   P_EMP EMP_REC;
   BEGIN P_EMP.F_NAME := 'Bob'; P_EMP.F_NAME := 'Smith'; P_EMP.SALARY := 30000;
   RETURN P_EMP;
END;
END EMP_PKG;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CHDIGHDG"><a class="anchor" href="#CHDIGHDG"></a>Task 2: Define an Object Type Mirror</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">CREATE OR REPLACE TYPE EMP_TYPE AS OBJECT (F_NAME VARCHAR2(30),
   L_NAME VARCHAR2(30), SALARY NUMBER(10,2))</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CHDEIABJ"><a class="anchor" href="#CHDEIABJ"></a>Task 3: Define a Java Class Mapping The OBJECT Type</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
public class Employee {
   @Column(name="F_NAME")
   private String firstName;
   @Column(name="L_NAME")
   private String lastName;
   @Column(name="SALARY")
   private BigDecimal salary;
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CHDFACEG"><a class="anchor" href="#CHDFACEG"></a>Task 4: Execute a PL/SQL Stored Function Using JpaEntityManager</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import jakarta.persistence.Query;
import org.eclipse.persistence.platform.database.orcle.plsql.
   PLSQLStoredFunctionCall;
import org.eclipse.persistence.queries.ReadAllQuery;

DataReadQuery databaseQuery = new DataReadQuery();
databaseQuery.setResultType(DataReadQuery.VALUE);
PLSQLrecord record = new PLSQLrecord();
record.setTypeName("EMP_PKG.EMP_REC");
record.setCompatibleType("EMP_TYPE");
record.setJavaType(Employee.class);
record.addField("F_NAME", JDBCTypes.VARCHAR_TYPE, 30);
record.addField("L_NAME", JDBCTypes.VARCHAR_TYPE, 30);
record.addField("SALARY", JDBCTypes.NUMERIC_TYPE, 10, 2);
PLSQLStoredFunctionCall call = new PLSQLStoredFunctionCall(record);
call.setProcedureName("EMP_PKG.GET_EMP");
databaseQuery.setCall(call);

Query query = ((JpaEntityManager)entityManager.getDelegate()).
   createQuery(databaseQuery);
Employee result = (Employee)query.getSingleResult();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CHDHDIAF"><a class="anchor" href="#CHDHDIAF"></a>Task 5: Define a Stored Function Using @NamedPLSQLStoredFunctionQuery</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">@NamedPLSQLStoredFunctionQuery(name="getEmployee", functionName="EMP_PKG.GET_EMP",
   returnParameter=@PLSQLParameter(name="RESULT", databaseType="EMP_PKG.EMP_REC"))
@Embeddable
@Struct(name="EMP_TYPE", fields={"F_NAME", "L_NAME", "SALARY"})
@PLSQLRecord(name="EMP_PKG.EMP_REC", compatibleType="EMP_TYPE",
   javaType=Employee.class,fields={@PLSQLParameter(name="F_NAME"),
@PLSQLParameter(name="L_NAME"), @PLSQLParameter(name="SALARY",
   databaseType="NUMERIC_TYPE")})

public class Employee {
 ...
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="CHDHEIFJ"><a class="anchor" href="#CHDHEIFJ"></a>Task 6: Use the Stored Function in a Query</h6>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Query query = entityManager.createNamedQuery("getEmployee");
Employee result = (Employee)query.getSingleResult();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="CHDDJJBI"><a class="anchor" href="#CHDDJJBI"></a>Handling PL/SQL arguments for Oracle Stored Procedures</h5>
<div class="paragraph">
<p>The standard way of handling a stored procedure is to build an instance
of the <code>StoredProcedureCall</code> class. However, the arguments must be
compatible with the JDBC specification. To handle Oracle PL/SQL
arguments (for example, <code>BOOLEAN</code>, <code>PLS_INTEGER</code>, PL/SQL record, and so
on), use the <code>PLSQLStoredProcedureCall</code> class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the <code>PLSQLStoredProcedureCall</code> class is only supported on Oracle8 or
higher.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using-the-plsqlstoredprocedurecall-class"><a class="anchor" href="#using-the-plsqlstoredprocedurecall-class"></a>Using the PLSQLStoredProcedureCall Class</h5>
<div class="paragraph">
<p>The following example demonstrates handling PL/SQL arguments using the
<code>PLSQLStoredProcedureCall</code> class. The example is based on the following
target procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">PROCEDURE bool_in_test(x IN BOOLEAN)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example of Using the PLSQLStoredProcedureCall Class</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import java.util.List;
import java.util.ArrayList;
import org.eclipse.persistence.logging.SessionLog;
import org.eclipse.persistence.platform.database.jdbc.JDBCTypes;
import org.eclipse.persistence.platform.database.oracle.Oracle10Platform;
import org.eclipse.persistence.platform.database.oracle.OraclePLSQLTypes;
import org.eclipse.persistence.platform.database.oracle.PLSQLStoredProcedureCall;
import org.eclipse.persistence.queries.DataModifyQuery;
import org.eclipse.persistence.sessions.DatabaseLogin;
import org.eclipse.persistence.sessions.DatabaseSession;
import org.eclipse.persistence.sessions.Project;
import org.eclipse.persistence.sessions.Session;

public class TestClass {

   public static String DATABASE_USERNAME = "username";
   public static String DATABASE_PASSWORD = "password";
   public static String DATABASE_URL = "jdbc:oracle:thin:@localhost:1521:ORCL";
   public static String DATABASE_DRIVER = "oracle.jdbc.driver.OracleDriver";

   public static void main(String[] args) {
      Project project = new Project();
      DatabaseLogin login = new DatabaseLogin();
      login.setUserName(DATABASE_USERNAME);
      login.setPassword(DATABASE_PASSWORD);
      login.setConnectionString(DATABASE_URL);
      login.setDriverClassName(DATABASE_DRIVER);
      login.setDatasourcePlatform(new Oracle10Platform());
      project.setDatasourceLogin(login);
      Session s = project.createDatabaseSession();
      s.setLogLevel(SessionLog.FINE);
      ((DatabaseSession)s).login();

      PLSQLStoredProcedureCall call = new PLSQLStoredProcedureCall();
      call.setProcedureName("bool_in_test");
      call.addNamedArgument("X", OraclePLSQLTypes.PLSQLBoolean);
      DataModifyQuery query = new DataModifyQuery();
      query.addArgument("X");
      query.setCall(call);
      List queryArgs = new ArrayList();
      queryArgs.add(Integer.valueOf(1));
      s.executeQuery(query, queryArgs);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following log excerpt shows the target procedure being invoked from
an anonymous PL/SQL block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...[EclipseLink Info]: 2007.11.23 01:03:23.890--DatabaseSessionImpl(15674464)--
   Thread(Thread[main,5,main])-- login successful
[EclipseLink Fine]: 2007.11.23 01:03:23.968--DatabaseSessionImpl(15674464)--
   Connection(5807702)--Thread(Thread[main,5,main])--
DECLARE
   X_TARGET BOOLEAN := SYS.SQLJUTL.INT2BOOL(:1);
BEGIN
   bool_in_test(X=&gt;X_TARGET);
END;
   bind =&gt; [:1 =&gt; 1]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Notice the conversion of the Integer to a PL/SQL <code>BOOLEAN</code> type in the
<code>DECLARE</code> stanza (as a similar conversion is used for OUT <code>BOOLEAN</code>
arguments).
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="mixing-jdbc-arguments-with-non-jdbc-arguments"><a class="anchor" href="#mixing-jdbc-arguments-with-non-jdbc-arguments"></a>Mixing JDBC Arguments With Non JDBC Arguments</h6>
<div class="paragraph">
<p>A Stored Procedure may have a mix of regular and non JDBC arguments. Use
the <code>PLSQLStoredProcedureCall</code> class when at least one argument is a non
JDBC type. In addition, some additional information may be required for
the JDBC type (length, scale or precision) because the target procedure
is invoked from an anonymous PL/SQL block. The example is based on the
following target procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">PROCEDURE two_arg_test(x IN BOOLEAN, y IN VARCHAR)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example of Mixing JDBC Arguments With NonJDBC Arguments</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import org.eclipse.persistence.platform.database.jdbc.JDBCTypes;
...
   PLSQLStoredProcedureCall call = new PLSQLStoredProcedureCall();
   call.setProcedureName("two_arg_test");
   call.addNamedArgument("X", OraclePLSQLTypes.PLSQLBoolean);
   call.addNamedArgument("Y", JDBCTypes.VARCHAR_TYPE, 40);
   DataModifyQuery query = new DataModifyQuery();
   query.addArgument("X");
   query.addArgument("Y");
   query.setCall(call);
   List queryArgs = new ArrayList();
   queryArgs.add(Integer.valueOf(0));
   queryArgs.add("test");
   boolean worked = false;
   String msg = null;
   s.executeQuery(query, queryArgs);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following log excerpt shows the target procedure being invoked from
an anonymous PL/SQL block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[EclipseLink Fine]: 2007.11.23 02:54:46.109--DatabaseSessionImpl(15674464)--
   Connection(5807702)--Thread(Thread[main,5,main])--
DECLARE
   X_TARGET BOOLEAN := SYS.SQLJUTL.INT2BOOL(:1);
   Y_TARGET VARCHAR(40) := :2;
BEGIN
   two_arg_test(X=&gt;X_TARGET, Y=&gt;Y_TARGET);
END;
   bind =&gt; [:1 =&gt; 0, :2 =&gt; test]</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="handling-in-and-out-arguments"><a class="anchor" href="#handling-in-and-out-arguments"></a>Handling IN and OUT Arguments</h6>
<div class="paragraph">
<p>The following example demonstrates a stored procedure that contain both
<code>IN</code> and <code>OUT</code> arguments and is based on the following target procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">PROCEDURE two_arg_in_out(x OUT BINARY_INTEGER, y IN VARCHAR) AS
BEGIN
   x := 33;
END;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example of Handling IN and OUT Arguments</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">import static org.eclipse.persistence.platform.database.oracle.OraclePLSQLTypes.
   BinaryInteger;
...
   PLSQLStoredProcedureCall call = new PLSQLStoredProcedureCall();
   call.setProcedureName("two_arg_in_out");
   call.addNamedOutputArgument("X", OraclePLSQLTypes.BinaryInteger);
   call.addNamedArgument("Y", JDBCTypes.VARCHAR_TYPE, 40);
   DataReadQuery query = new DataReadQuery();
   query.setCall(call);
   query.addArgument("Y");
   List queryArgs = new ArrayList();
   queryArgs.add("testsdfsdfasdfsdfsdfsdfsdfsdfdfsdfsdffds");
   boolean worked = false;
   String msg = null;
   List results = (List)s.executeQuery(query, queryArgs);
   DatabaseRecord record = (DatabaseRecord)results.get(0);
   BigDecimal x = (BigDecimal)record.get("X");
   if (x.intValue() != 33) {
      System.out.println("wrong x value");
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following log excerpt shows the target procedure being invoked from
an anonymous PL/SQL block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[EclipseLink Fine]: 2007.11.23 03:15:25.234--DatabaseSessionImpl(15674464)--
   Connection(5807702)--Thread(Thread[main,5,main])--
DECLARE
   Y_TARGET VARCHAR(40) := :1;
   X_TARGET BINARY_INTEGER;
BEGIN
   two_arg_in_out(X=&gt;X_TARGET, Y=&gt;Y_TARGET);
   :2 := X_TARGET;
END;
   bind =&gt; [:1 =&gt; testsdfsdfasdfsdfsdfsdfsdfsdfdfsdfsdffds, X =&gt; :2]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The order in which arguments are bound at runtime must be altered.
Anonymous PL/SQL blocks must process the ordinal markers (<code>:1</code>,<code>:2</code>) for
all the IN arguments first, then the OUT arguments. Inside the block,
the arguments are passed in the correct order for the target procedure,
but the bind order is managed in the <code>DECLARE</code> stanza and after the
target procedure has been invoked.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="handling-in-out-arguments"><a class="anchor" href="#handling-in-out-arguments"></a>Handling IN OUT Arguments</h6>
<div class="paragraph">
<p>Anonymous PL/SQL blocks cannot natively handle <code>IN OUT</code> arguments. The
arguments must be split into two parts: an IN-half and an OUT-half. The
following example demonstrates a stored procedure that handles IN OUT
arguments and is based on the following target procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">PROCEDURE two_args_inout(x VARCHAR, y IN OUT BOOLEAN) AS
BEGIN
   y := FALSE;
END;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Example of Handling IN OUT Arguments</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">...
   PLSQLStoredProcedureCall call = new PLSQLStoredProcedureCall();
   call.setProcedureName("two_args_inout");
   call.addNamedArgument("X", JDBCTypes.VARCHAR_TYPE, 20);
   call.addNamedInOutputArgument("Y", OraclePLSQLTypes.PLSQLBoolean);
   DataReadQuery query = new DataReadQuery();
   query.addArgument("X");
   query.addArgument("Y");
   query.setCall(call);
   List queryArgs = new ArrayList();
   queryArgs.add("test");
   queryArgs.add(Integer.valueOf(1));
   List results = (List)s.executeQuery(query, queryArgs);
   DatabaseRecord record = (DatabaseRecord)results.get(0);
   Integer bool2int = (Integer)record.get("Y");
   if (bool2int.intValue() != 0) {
      System.out.println("wrong bool2int value");
   }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following log excerpt shows the target procedure being invoked from
an anonymous PL/SQL block:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">[EclipseLink Fine]: 2007.11.23 03:39:55.000--DatabaseSessionImpl(25921812)--
   Connection(33078541)--Thread(Thread[main,5,main])--
DECLARE
   X_TARGET VARCHAR(20) := :1;
   Y_TARGET BOOLEAN := SYS.SQLJUTL.INT2BOOL(:2);
BEGIN
   two_args_inout(X=&gt;X_TARGET, Y=&gt;Y_TARGET);
   :3 := SYS.SQLJUTL.BOOL2INT(Y_TARGET);
END;
   bind =&gt; [:1 =&gt; test, :2 =&gt; 1, Y =&gt; :3]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Y</code> argument is split in two using the <code>:2</code> and <code>:3</code> ordinal
markers.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDEFIBH"><a class="anchor" href="#CHDEFIBH"></a>Using Oracle Virtual Private Database</h4>
<div class="paragraph">
<p>EclipseLink supports Oracle Virtual Private Database (VPD). Oracle VPD
is a server-enforced, fine-grained access control mechanism. Oracle VPD
ties a security policy to a table by dynamically appending SQL
statements with a predicate to limit data access at the row level. You
can create your own security policies, or use Oracle&#8217;s custom
implementation called Oracle Label Security (OLS). For details about
Oracle VPD, see <em>Oracle Database Security Guide</em>. For details about
Oracle Label Security, see <em>Oracle Label Security Administrator&#8217;s
Guide</em>.</p>
</div>
<div class="paragraph">
<p>For details about using Oracle VPD with Multitenancy, see
<a href="#MULTITENANCY004">Using VPD Multi-Tenancy.</a></p>
</div>
<div class="paragraph">
<p>To use the Oracle Database VPD feature in an EclipseLink application, an
isolated cache should be used. Any entity that maps to a table that uses
Oracle VPD should have the descriptor configured as isolated. In
addition, you typically use exclusive connections.</p>
</div>
<div class="paragraph">
<p>To support Oracle VPD, you must implement session event handlers that
the are invoked during the persistence context&#8217;s life cycle. The session
event handler you must implement depends on whether or not you are using
Oracle Database proxy authentication.</p>
</div>
<div class="paragraph">
<p><strong>Oracle VPD with Oracle Database Proxy Authentication</strong></p>
</div>
<div class="paragraph">
<p>By using Oracle Database proxy authentication, you can set up Oracle VPD
support entirely in the database. That is, rather than session event
handlers to execute SQL, the database performs the required setup in an
after login trigger using the proxy session_user.</p>
</div>
<div class="paragraph">
<p>For details on using Oracle proxy authentication, see
<a href="#CHDGDDJF">Using Oracle Proxy Authentication.</a></p>
</div>
<div class="paragraph">
<p><strong>Oracle VPD Without Oracle Database Proxy Authentication</strong></p>
</div>
<div class="paragraph">
<p>If you are not using Oracle Database proxy authentication, implement
session event handlers for the following session events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>postAcquireExclusiveConnection</code>: used to perform Oracle VPD setup at
the time a dedicated connection is allocated to an isolated session and
before the isolated session user uses the connection to interact with
the database.</p>
</li>
<li>
<p><code>preReleaseExclusiveConnection</code>: used to perform Oracle VPD cleanup at
the time the isolated session is released and after the user is finished
interacting with the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the implementation of these handlers, you can obtain the required
user credentials from the associated session&#8217;s properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="CHDGDDJF"><a class="anchor" href="#CHDGDDJF"></a>Using Oracle Proxy Authentication</h4>
<div class="paragraph">
<p>JPA and EclipseLink are typically used in a middle tier/server
environment with a shared connection pool. A connection pool allows
database connections to be shared to avoid the cost of reconnecting to
the database. Typically, the user logs into the application but does not
have their own database login as a shared login is used for the
connection pool. The provides a mechanism to set a proxy user on an
existing database connection. This allows for a shared connection pool
to be used, but to also gives the database a user context.</p>
</div>
<div class="paragraph">
<p>Oracle proxy authentication is configured using the following
persistence unit properties on an <code>EntityManager</code> object:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"eclipselink.oracle.proxy-type" : oracle.jdbc.OracleConnection.PROXYTYPE_USER_NAME, PROXYTYPE_CERTIFICATE, PROXYTYPE_DISTINGUISHED_NAME</code></p>
</li>
<li>
<p><code>oracle.jdbc.OracleConnection.PROXY_USER_NAME :</code> <em>`user_name`</em></p>
</li>
<li>
<p><code>oracle.jdbc.OracleConnection.PROXY_USER_PASSWORD :</code> <em>`password`</em></p>
</li>
<li>
<p><code>oracle.jdbc.OracleConnection.PROXY_DISTINGUISHED_NAME</code></p>
</li>
<li>
<p><code>oracle.jdbc.OracleConnection.PROXY_CERTIFICATE</code></p>
</li>
<li>
<p><code>oracle.jdbc.OracleConnection.PROXY_ROLES</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This connection is only used for writing by default; reads still use the
shared connection pool. To force reads to also use the connection, the
<code>eclipselink.jdbc.exclusive-connection.mode</code> property should be set to
<code>Always</code>, but this depends on if the application wishes to audit writes
or reads as well. The <code>eclipselink.jdbc.exclusive-connection.is-lazy</code>
property configures whether the connection should be connected up front,
or only when first required. If only writes are audited, then lazy
connections allow for the cost of creating a new database connection to
be avoided unless a write occurs.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="main-tasks-4"><a class="anchor" href="#main-tasks-4"></a>Main Tasks:</h5>
<div class="paragraph">
<p>To setup proxy authentication, create an <code>EntityManager</code> object and set
the persistence unit properties. Three examples are provided:</p>
</div>
<div class="paragraph">
<p><strong>Task: Audit Only Writes</strong></p>
</div>
<div class="paragraph">
<p>To configure proxy authentication when auditing only writes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map properties = new HashMap();
properties.put("eclipselink.oracle.proxy-type",
 oracle.jdbc.OracleConnection.PROXYTYPE_USER_NAME);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_NAME, user);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_PASSWORD, password);
properties.put("eclipselink.jdbc.exclusive-connection.mode", "Transactional");
properties.put("eclipselink.jdbc.exclusive-connection.is-lazy", "true");
EntityManager em = factory.createEntityManager(properties);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Task: Audit Reads and Writes</strong></p>
</div>
<div class="paragraph">
<p>To configure proxy authentication when auditing reads and writes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map properties = new HashMap();
properties.put("eclipselink.oracle.proxy-type",
 oracle.jdbc.OracleConnection.PROXYTYPE_USER_NAME);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_NAME, user);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_PASSWORD, password);
properties.put("eclipselink.jdbc.exclusive-connection.mode", "Always");
properties.put("eclipselink.jdbc.exclusive-connection.is-lazy", "false");
EntityManager em = factory.createEntityManager(properties);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Task: Configure Proxy Authentication in Jakarta EE Applications</strong></p>
</div>
<div class="paragraph">
<p>If a JEE and JTA managed entity manager is used, specifying a proxy user
and password can be more difficult, as the entity manager and JDBC
connection is not under the applications control. The persistence unit
properties can still be specified on an <code>EntityManager</code> object as long
as this is done before establishing a database connection.</p>
</div>
<div class="paragraph">
<p>If using JPA 2.<em>`n`</em>, the <code>setProperty</code> API can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">em.setProperty("eclipselink.oracle.proxy-type",
   oracle.jdbc.OracleConnection.PROXYTYPE_USER_NAME);
em.setProperty(oracle.jdbc.OracleConnection.PROXY_USER_NAME, user);
em.setProperty(oracle.jdbc.OracleConnection.PROXY_USER_PASSWORD, password);
em.setProperty("eclipselink.jdbc.exclusive-connection.mode", "Always");
em.setProperty("eclipselink.jdbc.exclusive-connection.is-lazy", "false");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, the <code>getDelegate</code> API can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map properties = new HashMap();
properties.put("eclipselink.oracle.proxy-type",
   oracle.jdbc.OracleConnection.PROXYTYPE_USER_NAME);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_NAME, user);
properties.put(oracle.jdbc.OracleConnection.PROXY_USER_PASSWORD, password);
properties.put("eclipselink.jdbc.exclusive-connection.mode", "Always");
properties.put("eclipselink.jdbc.exclusive-connection.is-lazy", "false");
((org.eclipse.persistence.internal.jpa.EntityManagerImpl)em.getDelegate()).
   setProperties(properties);</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="caching-and-security"><a class="anchor" href="#caching-and-security"></a>Caching and security</h5>
<div class="paragraph">
<p>By default, EclipseLink maintains a shared (L2) object cache. This is
fine for auditing, but if Oracle VPD or user based security is used to
prevent the reading of certain tables/classes, then the cache may need
to be disabled for these secure classes. To disable the shared cache,
see <a href="#CEGEDHAB">"Disabling Entity Caching"</a>.</p>
</div>
<div class="paragraph">
<p>If the database user is used to check security for reads, then set the
<code>eclipselink.jdbc.exclusive-connection.mode</code> property to <code>Isolated</code> to
only use the user connection for reads for the classes whose shared
cache has been disabled (isolated).</p>
</div>
</div>
<div class="sect4">
<h5 id="using-oracle-virtual-private-database-for-row-level-security"><a class="anchor" href="#using-oracle-virtual-private-database-for-row-level-security"></a>Using Oracle Virtual Private Database for Row-Level Security</h5>
<div class="paragraph">
<p>The Oracle Virtual Private Database (VPD) feature allows for row level
security within the Oracle database. Typically, database security only
allows access privileges to be assigned per table. Row level security
allows different users to have access to different rows within each
table.</p>
</div>
<div class="paragraph">
<p>The Oracle proxy authentication features in EclipseLink can be used to
support Oracle VPD. The proxy user allows for the row level security to
be checked. When using Oracle VPD, it is also important to disable
shared caching for the secured objects as these objects should not be
shared. To disable the shared cache, see
<a href="#CEGEDHAB">"Disabling Entity Caching"</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDIEBBB"><a class="anchor" href="#CHDIEBBB"></a>Using EclipseLink with Oracle RAC</h4>
<div class="paragraph">
<p>Oracle Real Application Clusters (RAC) extends the Oracle Database so
that you can store, update, and efficiently retrieve data using multiple
database instances on different servers at the same time. Oracle RAC
provides the software that manages multiple servers and instances as a
single group. Applications use Oracle RAC features to maximize
connection performance and availability and to mitigate down-time due to
connection problems. Applications have different availability and
performance requirements and implement Oracle RAC features accordingly.
For details on Oracle RAC, see the <em>Oracle Real Application Clusters
Administration and Deployment Guide</em>.</p>
</div>
<div class="paragraph">
<p>The Oracle Database and the Oracle WebLogic Server both provide
connection pool implementations that can create connections to a RAC
database and take advantage of various Oracle RAC features. The features
include Fast Connection Failover (FCF), Run-Time Connection Load
Balancing (RCLB), and connection affinity. In WebLogic Server,
applications create JDBC data sources (Multi Data Source or GridLink
Data Source) to connect to a RAC-enabled database. Standalone
applications use the Universal Connection Pool (UCP) JDBC connection
pool API (<code>ucp.jar</code>) to create data sources. Both connection pool
implementations require the Oracle Notification Service library
(<code>ons.jar</code>). This library is the primary means by which the connection
pools register for, and listen to, RAC events. For those new to these
technologies, refer to the <em>Oracle Universal Connection Pool for JDBC
Developer&#8217;s Guide</em> and the Oracle Fusion Middleware Configuring and
Managing JDBC Data Sources for Oracle WebLogic Server.</p>
</div>
<div class="paragraph">
<p>This sections assumes that you have an Oracle JDBC driver and Oracle
RAC-enabled database. Make sure that the RAC-enabled database is
operational and that you know the connection URL. In addition, download
the database Oracle Client software that contains the <code>ons.jar</code> file.
The <code>ucp.jar</code> file is included with the Oracle Database.</p>
</div>
<div class="sect4">
<h5 id="accessing-a-rac-enabled-database-from-jakarta-ee-applications"><a class="anchor" href="#accessing-a-rac-enabled-database-from-jakarta-ee-applications"></a>Accessing a RAC-Enabled database from Jakarta EE Applications</h5>
<div class="paragraph">
<p>The tasks in this section are used to connect to a RAC-enabled database
from a persistence application implemented in Oracle WebLogic Server.</p>
</div>
<div class="sect5">
<h6 id="task-1-configure-a-multi-data-source-or-gridlink-data-source"><a class="anchor" href="#task-1-configure-a-multi-data-source-or-gridlink-data-source"></a>Task 1: Configure a Multi Data Source or GridLink Data Source</h6>
<div class="paragraph">
<p>Refer to <a href="//:tlandwls.htm#ELWLS">Chapter 3, "Using EclipseLink with
WebLogic Server,"</a> and <em>Oracle Fusion Middleware Configuring and
Managing JDBC Data Sources for Oracle WebLogic Server</em> for details about
configuring a data source in WebLogic Server for Oracle RAC.</p>
</div>
</div>
<div class="sect5">
<h6 id="task-2-configure-the-persistence-unit"><a class="anchor" href="#task-2-configure-the-persistence-unit"></a>Task 2: Configure the Persistence Unit</h6>
<div class="paragraph">
<p>Edit the <code>persistence.xml</code> file and include the name of the data source
within a persistence unit configuration. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence-unit name="OrderManagement"&gt;
   &lt;jta-data-source&gt;jdbc/MyOrderDB&lt;/jta-data-source&gt;
   ...
&lt;/persistence-unit&gt;</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="task-3-include-the-required-jars"><a class="anchor" href="#task-3-include-the-required-jars"></a>Task 3: Include the Required JARs</h6>
<div class="paragraph">
<p>Ensure that the <code>ons.jar</code> is in the WebLogic Server classpath.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="accessing-a-rac-enabled-database-from-standalone-applications"><a class="anchor" href="#accessing-a-rac-enabled-database-from-standalone-applications"></a>Accessing a RAC-Enabled Database from Standalone Applications</h5>
<div class="paragraph">
<p>The tasks in this section are used to connect to a RAC database from a
standalone persistence application. The tasks demonstrate how to use UCP
data sources which are required for advanced RAC features.</p>
</div>
<div class="sect5">
<h6 id="task-1-create-a-ucp-data-source"><a class="anchor" href="#task-1-create-a-ucp-data-source"></a>Task 1: Create a UCP Data Source</h6>
<div class="paragraph">
<p>A UCP data source is used to connect to a RAC database. The data source
can specify advanced RAC configuration. For details on using advanced
RAC features with UCP, see <em>Oracle Universal Connection Pool for JDBC
Developer&#8217;s Guide</em>. The following example creates a data source and
enables FCF and configures ONS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">PoolDataSource datasource = PoolDataSourceFactory.getPoolDataSource();
datasource.setONSConfiguration(”nodes=host1:4200,host2:4200”);
datasource.setFastConnectionFailoverEnabled(true);
datasource.setConnectionFactoryClassName(”oracle.jdbc.pool.OracleDataSource”);
datasource.setURL(”jdbc:oracle:thin:@DESCRIPTION=
    (LOAD_BALANCE=on)
    (ADDRESS=(PROTOCOL=TCP)(HOST=host1)(PORT=1521))
    (ADDRESS=(PROTOCOL=TCP)(HOST=host2)(PORT=1521))
    (ADDRESS=(PROTOCOL=TCP)(HOST=host3)(PORT=1521))
    (ADDRESS=(PROTOCOL=TCP)(HOST=host4)(PORT=1521))
    (CONNECT_DATA=(SERVICE_NAME=service_name)))”);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Applications that do not require the advanced features provided by RAC
and UCP can connect to a RAC-enabled database using the native
connection pool in EclipseLink. In this case, edit the <code>persistence.xml</code>
file for you applications and add the RAC URL connection string for a
persistence unit. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://java.sun.com/xml/ns/persistence
   persistence_1_0.xsd" version="1.0"&gt;
   &lt;persistence-unit name="my-app" transaction-type="RESOURCE_LOCAL"&gt;
      &lt;provider&gt;org.eclipse.persistence.jpa.PersistenceProvider&lt;/provider&gt;
      &lt;exclude-unlisted-classes&gt;false&lt;/exclude-unlisted-classes&gt;
      &lt;properties&gt;
         &lt;property name="jakarta.persistence.jdbc.driver"
            value="oracle.jdbc.OracleDriver"/&gt;
         &lt;property name="jakarta.persistence.jdbc.url"
            value="jdbc:oracle:thin@(DESCRIPTION= "+ "(LOAD_BALANCE=on)"+
           "(ADDRESS=(PROTOCOL=TCP)(HOST=rac_node) (PORT=1521))"+
           "(ADDRESS=(PROTOCOL=TCP)(HOST=racnode2) (PORT=1521))"+
           "(CONNECT_DATA=(SERVICE_NAME=service_name))")"/&gt;
         &lt;property name="jakarta.persistence.jdbc.user" value="user_name"/&gt;
         &lt;property name="jakarta.persistence.jdbc.password" value="password"/&gt;
      &lt;/properties&gt;
   &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use the persistence unit, instantiate an <code>EntityManagerFactory</code> as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Persistence.createEntityManagerFactory("my-app");</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="task-2-use-the-ucp-data-source"><a class="anchor" href="#task-2-use-the-ucp-data-source"></a>Task 2: Use the UCP Data Source</h6>
<div class="paragraph">
<p>To use the UCP data source, instantiate an <code>EntityManagerFactory</code> an
pass in the data source as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">Map properties = new HashMap();
       properties.add("jakarta.persistence.nonJtaDataSource", datasource);
       Persistence.createEntityManagerFactory(properties);</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="task-3-include-the-required-jars-2"><a class="anchor" href="#task-3-include-the-required-jars-2"></a>Task 3: Include the Required JARs</h6>
<div class="paragraph">
<p>Ensure that both <code>ucp.jar</code> and <code>ons.jar</code> are in the application
classpath.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CHDJBFIJ"><a class="anchor" href="#CHDJBFIJ"></a>Using Oracle Spatial and Graph</h4>
<div class="paragraph">
<p>EclipseLink provides added support for querying Oracle Spatial and Graph
data in the Oracle Database. Oracle Spacial and Graph is used to
location-enable applications. It provides advanced features for spatial
data and analysis and for physical, logical, network, and social and
semantic graph applications. The spatial features provide a schema and
functions that facilitate the storage, retrieval, update, and query of
collections of spatial features in an Oracle database. For details about
developing Oracle Spacial and Graph applications, see <em>Oracle Spatial
and Graph Developer&#8217;s Guide</em>. To use Oracle Spatial and Graph within
WebLogic Server, see <a href="#BABHICHE">Chapter 3, "Task 7:
Extend the Domain to Use Advanced Oracle Database Features,"</a></p>
</div>
<div class="paragraph">
<p>EclipseLink applications can construct expressions that use Oracle
Spacial and Graph operators. See the
<code>org.eclipse.persistence.expressions.spatial</code> API for details. For
Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">ExpressionBuilder builder = new ExpressionBuilder();
Expression withinDistance = SpatialExpressions.withinDistance(myJGeometry1,
   myJGeometry2, "DISTANCE=10");
session.readAllObjects(GeometryHolder.class, withinDistance);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above expression requires a <code>oracle.spatial.geometry.JGeometry</code>
object. Use the EclipseLink
<code>org.eclipse.persistence.platform.database.oracle.converters.JGeometryConverter</code>
converter to convert the <code>JGeometry</code> object as it is read and written
from the Oracle database. The <code>JGeometryConverter</code> object must be added
to the Oracle Database platform either with the
<code>addStructConverter(StructConverter)</code> method or specified in the
<code>sessions.xml</code> file. The <code>JGeometry</code> type must also be available on the
classpath.</p>
</div>
<div class="paragraph">
<p>The following example demonstrates how to use the <code>FUNCTION</code> JPA
extension to perform Oracle Spatial queries. For details on the
<code>FUNCTION</code> extension, see <em>Jakarta Persistence API (JPA) Extensions
Reference for EclipseLink</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-oac_no_warn" data-lang="oac_no_warn">SELECT a FROM Asset a, Geography geo WHERE geo.id = :id AND a.id IN :id_list AND
   FUNCTION('ST_INTERSECTS', a.geometry, geo.geometry) = 'TRUE'

SELECT s FROM SimpleSpatial s WHERE FUNCTION('MDSYS.SDO_RELATE', s.jGeometry,
   :otherGeometry, :params) = 'TRUE' ORDER BY s.id ASC</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ORACLEDB003"><a class="anchor" href="#ORACLEDB003"></a>Additional Resources</h3>
<div class="paragraph">
<p>See the following links for additional resources about the solutions
discussed in this chapter.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Java API Reference for EclipseLink</em></p>
</li>
<li>
<p><em>Jakarta Persistence API (JPA) Extensions Reference for EclipseLink</em></p>
</li>
<li>
<p><em>Oracle Database JDBC Java API Reference</em></p>
</li>
<li>
<p><em>Oracle Database PL/SQL Language Reference</em></p>
</li>
<li>
<p><em>Oracle Database Security Guide</em></p>
</li>
<li>
<p><em>Oracle Label Security Administrator&#8217;s Guide</em></p>
</li>
<li>
<p><em>Oracle Fusion Middleware Configuring and Managing JDBC Data Sources
for Oracle WebLogic Server</em></p>
</li>
<li>
<p><em>Oracle Real Application Clusters Administration and Deployment Guide</em></p>
</li>
<li>
<p><em>Oracle Universal Connection Pool for JDBC Developer&#8217;s Guide</em></p>
</li>
<li>
<p><em>Oracle Spatial and Graph Developer&#8217;s Guide</em></p>
</li>
</ul>
</div>
<hr>
<div class="paragraph">
<p>Copyright © 2022 by The Eclipse Foundation under the <a href="http://www.eclipse.org/org/documents/epl-v10.php">Eclipse Public License (EPL)</a>
Updated: 2024-12-23 13:15:26 +0100</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>