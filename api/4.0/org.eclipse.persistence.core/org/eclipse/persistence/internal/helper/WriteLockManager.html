<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (21) -->
<title>WriteLockManager (EclipseLink 4.0.3, API Reference)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: module: org.eclipse.persistence.core, package: org.eclipse.persistence.internal.helper, class: WriteLockManager">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<div class="about-language"><br>EclipseLink 4.0.3, API Reference</div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../../index.html">Overview</a></li>
<li><a href="../../../../../module-summary.html">Module</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/WriteLockManager.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Nested</li>
<li><a href="#field-summary">Field</a></li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li><a href="#field-detail">Field</a></li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li><a href="#field-detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="module-label-in-type">Module</span>&nbsp;<a href="../../../../../module-summary.html">org.eclipse.persistence.core</a></div>
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">org.eclipse.persistence.internal.helper</a></div>
<h1 title="Class WriteLockManager" class="title">Class WriteLockManager</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.eclipse.persistence.internal.helper.WriteLockManager</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">WriteLockManager</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">INTERNAL:
 <p>
 <b>Purpose</b>: Acquires all required locks for a particular merge process.
 Implements a deadlock avoidance algorithm to prevent concurrent merge conflicts.

 <p>
 <b>Responsibilities</b>:
 <ul>
 <li> Acquires locks for writing threads.
 <li> Provides deadlock avoidance behavior.
 <li> Releases locks for writing threads.
 </ul></div>
<dl class="notes">
<dt>Since:</dt>
<dd>10.0.3</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static final int</code></div>
<div class="col-second even-row-color"><code><a href="#MAX_WAIT" class="member-name-link">MAX_WAIT</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
<div class="col-first odd-row-color"><code>static final int</code></div>
<div class="col-second odd-row-color"><code><a href="#MAXTRIES" class="member-name-link">MAXTRIES</a></code></div>
<div class="col-last odd-row-color">&nbsp;</div>
<div class="col-first even-row-color"><code>protected <a href="linkedlist/ExposedNodeLinkedList.html" title="class in org.eclipse.persistence.internal.helper.linkedlist">ExposedNodeLinkedList</a></code></div>
<div class="col-second even-row-color"><code><a href="#prevailingQueue" class="member-name-link">prevailingQueue</a></code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">WriteLockManager</a>()</code></div>
<div class="col-last even-row-color">&nbsp;</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#acquireLockAndRelatedLocks(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.internal.identitymaps.CacheKey,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">acquireLockAndRelatedLocks</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a>&nbsp;cacheKey,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This is a recursive method used to acquire read locks on all objects that
 will be cloned.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#acquireLocksForClone(java.lang.Object,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.identitymaps.CacheKey,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">acquireLocksForClone</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a>&nbsp;cacheKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method will return once the object is locked and all non-indirect
 related objects are also locked.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#acquireRequiredLocks(org.eclipse.persistence.internal.sessions.MergeManager,org.eclipse.persistence.internal.sessions.UnitOfWorkChangeSet)" class="member-name-link">acquireRequiredLocks</a><wbr>(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager,
 <a href="../sessions/UnitOfWorkChangeSet.html" title="class in org.eclipse.persistence.internal.sessions">UnitOfWorkChangeSet</a>&nbsp;changeSet)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method will be the entry point for threads attempting to acquire locks for all objects that have
 a changeset.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#addCacheKeyToMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread,org.eclipse.persistence.internal.helper.ConcurrencyManager,long)" class="member-name-link">addCacheKeyToMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&nbsp;cacheKeyThatCouldNotBeAcquired,
 long&nbsp;whileStartDate)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">The thread was doing its while loop to acquire all required locks to proceed with the commmit and it realized
 there was one cache key it is unable to acquire</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#appendLock(java.lang.Object,java.lang.Object,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.MergeManager,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">appendLock</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectToLock,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method will be called by a merging thread that is attempting to lock
 a new object that was not locked previously.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#attemptToAcquireLock(org.eclipse.persistence.descriptors.ClassDescriptor,java.lang.Object,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">attemptToAcquireLock</a><wbr>(<a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method performs the operations of finding the cacheKey and locking it if possible.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#checkAndLockObject(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.mappings.DatabaseMapping,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">checkAndLockObject</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectToLock,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../../mappings/DatabaseMapping.html" title="class in org.eclipse.persistence.mappings">DatabaseMapping</a>&nbsp;mapping,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 Simply check that the object is not already locked then pass it on to the locking method</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#clearMapThreadToObjectIdsWithChagenSet(java.lang.Thread)" class="member-name-link">clearMapThreadToObjectIdsWithChagenSet</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Remove the current thread from the map of object ids with change sets that are about to bec ommited</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#clearMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread)" class="member-name-link">clearMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Before the problematic while loop starts we should always clear for this thread the set of cache keys it could
 not acquire.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a><wbr>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#getMapWriteLockManagerThreadToObjectIdsWithChangeSet()" class="member-name-link">getMapWriteLockManagerThreadToObjectIdsWithChangeSet</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Getter for <code>MAP_WRITE_LOCK_MANAGER_THREAD_TO_OBJECT_IDS_WITH_CHANGE_SET</code></div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a><wbr>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&gt;&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#getThreadToFailToAcquireCacheKeys()" class="member-name-link">getThreadToFailToAcquireCacheKeys</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Getter for <code>THREAD_TO_FAIL_TO_ACQUIRE_CACHE_KEYS</code></div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#populateMapThreadToObjectIdsWithChagenSet(java.lang.Thread,java.util.Collection)" class="member-name-link">populateMapThreadToObjectIdsWithChagenSet</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Collection.html" title="class or interface in java.util" class="external-link">Collection</a>&lt;<a href="../sessions/ObjectChangeSet.html" title="class in org.eclipse.persistence.internal.sessions">ObjectChangeSet</a>&gt;&nbsp;objectChangeSets)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Before a thread starts long wait loop to acquire write locks during a commit transaction the thread will record
 in this map the object ids it holds with chance sets.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#releaseAllAcquiredLocks(org.eclipse.persistence.internal.sessions.MergeManager)" class="member-name-link">releaseAllAcquiredLocks</a><wbr>(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method will release all acquired locks</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#removeCacheKeyFromMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread,org.eclipse.persistence.internal.helper.ConcurrencyManager)" class="member-name-link">removeCacheKeyFromMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&nbsp;cacheKeyThatCouldNotBeAcquired)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">A cache keys was successfully acquired we want to make sure it is not recorded in the map of cache keys that
 could not be acquired.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#transitionToDeferredLocks(org.eclipse.persistence.internal.sessions.MergeManager)" class="member-name-link">transitionToDeferredLocks</a><wbr>(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method will transition the previously acquired active
 locks to deferred locks in the case a readlock could not be acquired for
 a related object.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#traverseRelatedLocks(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.AbstractSession)" class="member-name-link">traverseRelatedLocks</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 Traverse the object and acquire locks on all related objects.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#waitOnObjectLock(org.eclipse.persistence.descriptors.ClassDescriptor,java.lang.Object,org.eclipse.persistence.internal.sessions.AbstractSession,int)" class="member-name-link">waitOnObjectLock</a><wbr>(<a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session,
 int&nbsp;waitTime)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">INTERNAL:
 This method performs the operations of finding the cacheKey and locking it if possible.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="MAXTRIES">
<h3>MAXTRIES</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">MAXTRIES</span></div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="../../../../../../constant-values.html#org.eclipse.persistence.internal.helper.WriteLockManager.MAXTRIES">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="MAX_WAIT">
<h3>MAX_WAIT</h3>
<div class="member-signature"><span class="modifiers">public static final</span>&nbsp;<span class="return-type">int</span>&nbsp;<span class="element-name">MAX_WAIT</span></div>
<dl class="notes">
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="../../../../../../constant-values.html#org.eclipse.persistence.internal.helper.WriteLockManager.MAX_WAIT">Constant Field Values</a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="prevailingQueue">
<h3>prevailingQueue</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="linkedlist/ExposedNodeLinkedList.html" title="class in org.eclipse.persistence.internal.helper.linkedlist">ExposedNodeLinkedList</a></span>&nbsp;<span class="element-name">prevailingQueue</span></div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>WriteLockManager</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">WriteLockManager</span>()</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="acquireLocksForClone(java.lang.Object,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.identitymaps.CacheKey,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>acquireLocksForClone</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a></span>&nbsp;<span class="element-name">acquireLocksForClone</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a>&nbsp;cacheKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</span></div>
<div class="block">INTERNAL:
 This method will return once the object is locked and all non-indirect
 related objects are also locked.</div>
</section>
</li>
<li>
<section class="detail" id="acquireLockAndRelatedLocks(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.internal.identitymaps.CacheKey,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>acquireLockAndRelatedLocks</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">acquireLockAndRelatedLocks</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a>&nbsp;cacheKey,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</span></div>
<div class="block">INTERNAL:
 This is a recursive method used to acquire read locks on all objects that
 will be cloned.  These include all related objects for which there is no
 indirection.
 The returned object is the first object that the lock could not be acquired for.
 The caller must try for exceptions and release locked objects in the case
 of an exception.</div>
</section>
</li>
<li>
<section class="detail" id="transitionToDeferredLocks(org.eclipse.persistence.internal.sessions.MergeManager)">
<h3>transitionToDeferredLocks</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">transitionToDeferredLocks</span><wbr><span class="parameters">(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager)</span></div>
<div class="block">INTERNAL:
 This method will transition the previously acquired active
 locks to deferred locks in the case a readlock could not be acquired for
 a related object. Deferred locks must be employed to prevent deadlock
 when waiting for the readlock while still protecting readers from
 incomplete data.</div>
</section>
</li>
<li>
<section class="detail" id="traverseRelatedLocks(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>traverseRelatedLocks</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">traverseRelatedLocks</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectForClone,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</span></div>
<div class="block">INTERNAL:
 Traverse the object and acquire locks on all related objects.</div>
</section>
</li>
<li>
<section class="detail" id="acquireRequiredLocks(org.eclipse.persistence.internal.sessions.MergeManager,org.eclipse.persistence.internal.sessions.UnitOfWorkChangeSet)">
<h3>acquireRequiredLocks</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">acquireRequiredLocks</span><wbr><span class="parameters">(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager,
 <a href="../sessions/UnitOfWorkChangeSet.html" title="class in org.eclipse.persistence.internal.sessions">UnitOfWorkChangeSet</a>&nbsp;changeSet)</span></div>
<div class="block">INTERNAL:
 This method will be the entry point for threads attempting to acquire locks for all objects that have
 a changeset.  This method will hand off the processing of the deadlock algorithm to other member
 methods.  The mergeManager must be the active mergemanager for the calling thread.
 Returns true if all required locks were acquired
 This is wrapper method with semaphore logic.</div>
</section>
</li>
<li>
<section class="detail" id="appendLock(java.lang.Object,java.lang.Object,org.eclipse.persistence.descriptors.ClassDescriptor,org.eclipse.persistence.internal.sessions.MergeManager,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>appendLock</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">appendLock</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectToLock,
 <a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session)</span></div>
<div class="block">INTERNAL:
 This method will be called by a merging thread that is attempting to lock
 a new object that was not locked previously.  Unlike the other methods
 within this class this method will lock only this object.</div>
</section>
</li>
<li>
<section class="detail" id="attemptToAcquireLock(org.eclipse.persistence.descriptors.ClassDescriptor,java.lang.Object,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>attemptToAcquireLock</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">attemptToAcquireLock</span><wbr><span class="parameters">(<a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session)</span></div>
<div class="block">INTERNAL:
 This method performs the operations of finding the cacheKey and locking it if possible.
 Returns True if the lock was acquired, false otherwise</div>
</section>
</li>
<li>
<section class="detail" id="checkAndLockObject(java.lang.Object,java.util.Map,java.util.Map,org.eclipse.persistence.mappings.DatabaseMapping,org.eclipse.persistence.internal.sessions.AbstractSession)">
<h3>checkAndLockObject</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">checkAndLockObject</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;objectToLock,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;lockedObjects,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&nbsp;refreshedObjects,
 <a href="../../mappings/DatabaseMapping.html" title="class in org.eclipse.persistence.mappings">DatabaseMapping</a>&nbsp;mapping,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;cloningSession)</span></div>
<div class="block">INTERNAL:
 Simply check that the object is not already locked then pass it on to the locking method</div>
</section>
</li>
<li>
<section class="detail" id="releaseAllAcquiredLocks(org.eclipse.persistence.internal.sessions.MergeManager)">
<h3>releaseAllAcquiredLocks</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">releaseAllAcquiredLocks</span><wbr><span class="parameters">(<a href="../sessions/MergeManager.html" title="class in org.eclipse.persistence.internal.sessions">MergeManager</a>&nbsp;mergeManager)</span></div>
<div class="block">INTERNAL:
 This method will release all acquired locks</div>
</section>
</li>
<li>
<section class="detail" id="waitOnObjectLock(org.eclipse.persistence.descriptors.ClassDescriptor,java.lang.Object,org.eclipse.persistence.internal.sessions.AbstractSession,int)">
<h3>waitOnObjectLock</h3>
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../identitymaps/CacheKey.html" title="class in org.eclipse.persistence.internal.identitymaps">CacheKey</a></span>&nbsp;<span class="element-name">waitOnObjectLock</span><wbr><span class="parameters">(<a href="../../descriptors/ClassDescriptor.html" title="class in org.eclipse.persistence.descriptors">ClassDescriptor</a>&nbsp;descriptor,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&nbsp;primaryKey,
 <a href="../sessions/AbstractSession.html" title="class in org.eclipse.persistence.internal.sessions">AbstractSession</a>&nbsp;session,
 int&nbsp;waitTime)</span></div>
<div class="block">INTERNAL:
 This method performs the operations of finding the cacheKey and locking it if possible.
 Waits until the lock can be acquired</div>
</section>
</li>
<li>
<section class="detail" id="getThreadToFailToAcquireCacheKeys()">
<h3>getThreadToFailToAcquireCacheKeys</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&gt;&gt;</span>&nbsp;<span class="element-name">getThreadToFailToAcquireCacheKeys</span>()</div>
<div class="block">Getter for <code>THREAD_TO_FAIL_TO_ACQUIRE_CACHE_KEYS</code></div>
</section>
</li>
<li>
<section class="detail" id="getMapWriteLockManagerThreadToObjectIdsWithChangeSet()">
<h3>getMapWriteLockManagerThreadToObjectIdsWithChangeSet</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Map.html" title="class or interface in java.util" class="external-link">Map</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>,<wbr><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Set.html" title="class or interface in java.util" class="external-link">Set</a>&lt;<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a>&gt;&gt;</span>&nbsp;<span class="element-name">getMapWriteLockManagerThreadToObjectIdsWithChangeSet</span>()</div>
<div class="block">Getter for <code>MAP_WRITE_LOCK_MANAGER_THREAD_TO_OBJECT_IDS_WITH_CHANGE_SET</code></div>
</section>
</li>
<li>
<section class="detail" id="clearMapThreadToObjectIdsWithChagenSet(java.lang.Thread)">
<h3>clearMapThreadToObjectIdsWithChagenSet</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">clearMapThreadToObjectIdsWithChagenSet</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread)</span></div>
<div class="block">Remove the current thread from the map of object ids with change sets that are about to bec ommited</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>thread</code> - the thread that is clearing itself out of the map of change sets it needs to merge into the shared
            cache</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="populateMapThreadToObjectIdsWithChagenSet(java.lang.Thread,java.util.Collection)">
<h3>populateMapThreadToObjectIdsWithChagenSet</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">populateMapThreadToObjectIdsWithChagenSet</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Collection.html" title="class or interface in java.util" class="external-link">Collection</a>&lt;<a href="../sessions/ObjectChangeSet.html" title="class in org.eclipse.persistence.internal.sessions">ObjectChangeSet</a>&gt;&nbsp;objectChangeSets)</span></div>
<div class="block">Before a thread starts long wait loop to acquire write locks during a commit transaction the thread will record
 in this map the object ids it holds with chance sets. It will be useful information if a dead lock is taking
 place.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>thread</code> - the thread that is in the middle of merge to the shared cache trying to acquire write locks to do this
            merge</dd>
<dd><code>objectChangeSets</code> - the object change sets it has in its hands and that it would like to merge into the cache</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="clearMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread)">
<h3>clearMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">clearMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread)</span></div>
<div class="block">Before the problematic while loop starts we should always clear for this thread the set of cache keys it could
 not acquire.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>thread</code> - the thread that what clear his set of cache keys it is struggling to acquire.</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="addCacheKeyToMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread,org.eclipse.persistence.internal.helper.ConcurrencyManager,long)">
<h3>addCacheKeyToMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">addCacheKeyToMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&nbsp;cacheKeyThatCouldNotBeAcquired,
 long&nbsp;whileStartDate)</span>
                                                                              throws <span class="exceptions"><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></span></div>
<div class="block">The thread was doing its while loop to acquire all required locks to proceed with the commmit and it realized
 there was one cache key it is unable to acquire</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>thread</code> - thread the thread working on updating the shared cache</dd>
<dd><code>cacheKeyThatCouldNotBeAcquired</code> - the cache key it is not managing to acquire</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/InterruptedException.html" title="class or interface in java.lang" class="external-link">InterruptedException</a></code> - Should be fired because we are passing a flag into the
             determineIfReleaseDeferredLockAppearsToBeDeadLocked to say we do not want the thread to be blown up
             (e.g. we are afraid of breaking threads in the middle of a commit process could be quite dangerous).
             See
             <code>ALLOW_INTERRUPTED_EXCEPTION_TO_BE_FIRED_UP_FALSE</code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="removeCacheKeyFromMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired(java.lang.Thread,org.eclipse.persistence.internal.helper.ConcurrencyManager)">
<h3>removeCacheKeyFromMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">removeCacheKeyFromMapWriteLockManagerToCacheKeysThatCouldNotBeAcquired</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Thread.html" title="class or interface in java.lang" class="external-link">Thread</a>&nbsp;thread,
 <a href="ConcurrencyManager.html" title="class in org.eclipse.persistence.internal.helper">ConcurrencyManager</a>&nbsp;cacheKeyThatCouldNotBeAcquired)</span></div>
<div class="block">A cache keys was successfully acquired we want to make sure it is not recorded in the map of cache keys that
 could not be acquired. The situation theoretically can change. Failing to acquire a write lock can be a temporary
 situation. The lock might become available eventually. Otherwise there would be no point for the while loop that
 is trying to acquire these locks.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>thread</code> - the thread that just managed to grab a write lock</dd>
<dd><code>cacheKeyThatCouldNotBeAcquired</code> - the cache key it managed to acquire for writing.</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
